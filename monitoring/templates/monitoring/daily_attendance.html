{% extends "page_daily_attendance.html" %}

{% load i18n %}
{% load widget_tweaks %}
{% block title %}{{ page_title}} - Daily Attendance{% endblock %}
{% load static %}
{% load humanize %}

{% block style %} 
<style>

.nav-tabs{
  background-color: #ccc;
  color: #5f5d5d;
  padding: 0 0 0 0;
  -webkit-border-radius: 2px 2px 0 0;
  -moz-border-radius: 2px 2px 0 0;
  border-radius: 5px 5px 0 0;
  padding: 0px !important;
  border-bottom: 5px solid #257638 !important;
}

.nav-tabs > li > a{
  border: none;
  -webkit-border-radius: 2px 2px 0 0;
  -moz-border-radius: 2px 2px 0 0;
  border-radius: 5px 5px 0 0;
  color: #5f5d5d;
}

.nav-tabs .nav-item .nav-link.active {
  background-color: #257638;
  color: #fff;
  font-weight: bold;
  border-color: #257638;
  -webkit-border-radius: 2px 2px 0 0;
  -moz-border-radius: 2px 2px 0 0;
  border-radius: 5px 5px 0 0;
}

.nav-tabs>.active>a, .nav-tabs>.active>a:hover, .nav-tabs>.active>a:focus {
  background-color: #257638;
  border-color: #257638;
  border-bottom-color: transparent;
  -webkit-border-radius: 2px 2px 0 0;
  -moz-border-radius: 2px 2px 0 0;
  border-radius: 5px 5px 0 0;  
}

label {
    display: inline-block;
    margin-bottom: 0rem;
}

thead th { white-space: nowrap; }

</style>
{% endblock %}

{% block content %}

 	<!-- Content Wrapper. Contains page content -->
	<div class="content-wrapper" style="margin:0px; padding:0 0 0 0; background-color: #353538;">
	<!--<div class="content-wrapper" style="margin:0px; padding:0 0 0 0; background-color: #257638;">-->
		
	

		<!--
		<div class="content-header">
			<div class="col-6 offset-3">

			</div>
		</div>
		-->

    	<!-- Main content -->
    	<section class="content pt-1" style="padding:0 3px 0 3px;">


    		
    		<!-- SEARCH FORM START -->
			<!--<div class="card card-outline card-default" id="daily_attendance_search_card" style="position: fixed; top:50; width: 100%; z-index: 1;">-->
			<div class="card card-outline card-default text-light" id="daily_attendance_search_card" style="background-color: #353538;">

			  <div class="card-body" style="margin:0; padding:3px 0 2px 0;">
				<form class="form-inline" name="daily_attendance_search_form" id="daily_attendance_search_form">
					{% csrf_token %}

				  	<div class="d-flex flex-fill justify-content-center">
				  		
				  		<div class="d-flex justify-content-center">
						    <div class="form-inline">
						        <label class="control-label">Date</label>&nbsp;&nbsp;				        
						        <input type="text" class="form-control form-control-sm" style="border-radius: 0; width:85px;" id="id_dly_date" placeholder="dd/mm/yyyy">&nbsp;&nbsp;
						    	<label class="control-label">Shift</label>&nbsp;&nbsp;
						        <select id="id_search_shift_option" class="form-control form-control-sm" style="border-radius: 0; width: 90px;">
								  <option value="0">---------</option>
								  <option value="1" selected="">A | All</option>
								  <option value="2">D | Day shift</option>
								  <option value="3">N | Night shift</option>
						        </select>
						        	&nbsp;&nbsp;&nbsp;&nbsp;
			                      <input class="form-check-input" type="radio" name="searchOptions" id="id_search_by_cnt_id" value="1" checked>
			                      <label class="control-label" for="id_search_by_cnt_id">Contract No</label>&nbsp;
			                      <input type="number" min=0 maxlength="7" id="id_cus_id" class="form-control form-control-sm" style="border-radius: 0; width:80px;" value="" oninput="javascript: if (this.value.length > this.maxLength) this.value = this.value.slice(0, this.maxLength);">&nbsp;
			                      <input type="number" min=0 maxlength="3" id="id_cus_brn" class="form-control form-control-sm" style="border-radius: 0; width:50px;" value="" oninput="javascript: if (this.value.length > this.maxLength) this.value = this.value.slice(0, this.maxLength);">&nbsp;
			                      <input type="number" min=0 maxlength="3" id="id_cus_vol" class="form-control form-control-sm" style="border-radius: 0; width: 50px;" value="" oninput="javascript: if (this.value.length > this.maxLength) this.value = this.value.slice(0, this.maxLength);">&nbsp;&nbsp;&nbsp;
			                      <input class="form-check-input" type="radio" name="searchOptions" id="id_search_by_empid" style="border-radius: 0;" value="2" readonly>
			                      <label class="control-label" for="id_search_by_empid">Employee ID</label>&nbsp;
			                      <input type="text" id="id_search_emp_id" class="form-control form-control-sm" style="border-radius: 0; width:80px;" readonly>&nbsp;&nbsp;

			                      <button id="cancelDailyAttendanceButton" name="cancelDailyAttendanceButton" type="button" class="btn btn-sm btn-warning pull-right">Cancel</button>
		                    </div>
		                </div>
		                
					</div>
				</form>

			  </div>

			</div>
			<!-- SEARCH FORM END -->











        <!-- ./row -->
        <div class="row">
          <!--<div class="col-12 col-sm-6 col-lg-4">-->
          <div class="col-12">

            <div class="card card-tabs">

              
              <div style="padding:0px 0px 0px 0px !important; margin:0 0 0 0px !important;">

                <ul class="nav nav-tabs navbar-expand nav-fill" id="custom-tabs-one-tab" role="tablist" style="padding:0 !important; margin: 0 0 0 0 !important;">
                  
                  <li class="nav-item" style="padding:0 !important; margin:0 0 0 0px !important; font-size: 20px;">
                    <a class="nav-link active" id="custom-tabs-one-home-tab" data-toggle="pill" href="#custom-tabs-one-home" role="tab" aria-controls="custom-tabs-one-home" aria-selected="true">Attendance Information</a>
                  </li>


                  <li class="nav-item" style="padding:0 0 0 0px !important; font-size: 20px;">
                    

                    <a class="nav-link" id="tab2-tab" data-toggle="pill" href="#custom-tabs-one-profile" role="tab" aria-controls="custom-tabs-one-profile" aria-selected="false">
                    	Schedule Information
                    </a>
                    
                  </li>
                </ul>

              </div>

              
              <div class="card-body text-dark" style="padding:5px !important; border-right: 5px solid #257638; border-color: #257638; border-left: 5px solid #257638; border-bottom: 5px solid #257638; background-color: #e9ecef;">
                <div class="tab-content" id="custom-tabs-one-tabContent">                  
					<div class="tab-pane fade show active" id="custom-tabs-one-home" role="tabpanel" aria-labelledby="custom-tabs-one-home-tab">


						<!-- LEFT COLUMN -  CUSTOMER LIST TABLE -->
						<!-- START -->
						<div class="col-10 float-left" style="padding: 0 5px 0 0 !important;">
							

							<div class="col-12 p-0">
								<div class="col-8 float-left p-0">
									<form class="form-inline mt-1 mb-2" id="bulk_shift_status_form">
										{% csrf_token %}

										<div id="id_bulk_schedule_option p-0">
											<div class="form-group">
												<label for="id_bulk_shift_list_option">Shift</label>&nbsp;&nbsp;
											    <select id="id_bulk_shift_list_option" class="form-control form-control-xs" style="width: 100px;">
												  <option value="0" selected></option>
											    </select>								    
											</div>
										</div>

										<div class="form-group">
											&nbsp;&nbsp;
										    <select id="id_shift_status" class="form-control form-control-xs">
											  <option value="0" selected>Not Absent</option>
											  <option value="1">Absent</option>
										    </select>
										    &nbsp;
										</div>

										<div class="form-group">
									  		&nbsp;<button type="submit" class="btn btn-primary btn-xs">Change</button>
									  	</div>
									</form>
								</div>

								<div class="col-4 float-right p-0 pt-1">
								  									
								  <div class="input-group-append float-right">
									
								  	<input type="text" class="form-control form-control-xs border-secondary" placeholder="Filter Data" id="employee_search_text" style="border-top-right-radius:0px;border-bottom-right-radius:0px;" autocomplete="off">

								    <button class="btn btn-secondary btn-xs" type="button"  id="employee_search_clear_button" style="border-style: none none none none; border-top-left-radius:0px;border-bottom-left-radius:0px;">CLEAR</button>

								    &nbsp;&nbsp;|&nbsp;&nbsp;<button class="btn btn-outline-success btn-xs" href="#" onclick="export_to_excel();">&nbsp;&nbsp;<i class="far fa-file-excel"></i>&nbsp;&nbsp;Export&nbsp;&nbsp;</button>
								  </div>
									
								</div>
							</div>



			            	<!--<div id="id_employee_list" class="table-responsive table-striped">-->
			            	<div id="id_employee_list" class="">

								<font size='2em;'>
																
								<table id='employee_list_table' class='table table-sm dataTable' style="margin:0; white-space: nowrap; width: 100%;">
								  <thead class="bg-secondary">
								    <tr>
								      <th scope='col' class='d-none text-center' nowrap>Absent Status</th>
								      <th scope="col">&nbsp;</th>								      
								      <th scope='col' class='text-center'>No</th>								  	  								  		
								      <th scope='col' nowrap>Emp ID</th>
								      <th scope='col'>Name</th>

								      <th scope="col">Rank</th>
								      <th scope="col">Shift</th>
								      <th scope="col">Late</th>
								      <th scope="col">Full</th>
								      <th scope="col">Relief</th>

								      <th scope="col" nowrap>Rel. ID</th>
								      <th scope="col">Name</th>
								      <th scope='col' class='d-none'>Tel Status</th>
								      <th scope="col">Tel</th>
								      <th scope="col" nowrap>Tel Time</th>
								      
								      <th scope="col" nowrap>Tel Amt</th>
								      <th scope="col" nowrap>Tel Paid</th>
								      <th scope="col">Spare</th>
								      <th scope="col">Wage</th>
								      <th scope="col" nowrap>Upd Date</th>

								      <th scope="col" nowrap>Upd By</th>
								      <th scope="col" nowrap>Upd Flag</th>								      

								      <th scope="col" class='d-none' nowrap>Upd Gen</th>
								      <th scope="col" class='d-none' nowrap>Remark</th>
								      <th scope='col' class='d-none'>Relief Status</th>
								      <th scope='col' class='d-none'>Late Status</th>
								      <th scope='col' class='d-none'>Late Full Status</th>


								      <th scope='col' class='d-none'>OT</th>
								      <th scope='col' class='d-none'>OT Reason</th>
								      <th scope='col' class='d-none'>OT Time From</th>
								      <th scope='col' class='d-none'>OT Time To</th>
								      <th scope='col' class='d-none'>OT Hour Amount</th>
								      <th scope='col' class='d-none'>Shift Type</th>
								    </tr>
								  </thead>
							  
								  <tbody>
								    <tr>
								      <td class='d-none'>&nbsp;</td>
								      <td>&nbsp;</td>
								      <td>&nbsp;</td>
								      <td>&nbsp;</td>
								      <td>&nbsp;</td>

								      <td>&nbsp;</td>
								      <td>&nbsp;</td>
								      <td>&nbsp;</td>
								      <td>&nbsp;</td>
								      <td>&nbsp;</td>
								      
								      <td>&nbsp;</td>
								      <td>&nbsp;</td>
								      <td>&nbsp;</td>
								      <td>&nbsp;</td>
								      <td>&nbsp;</td>

								      <td>&nbsp;</td>
								      <td>&nbsp;</td>
								      <td>&nbsp;</td>
								      <td>&nbsp;</td>
								      <td>&nbsp;</td>

								      <td>&nbsp;</td>
								      <td>&nbsp;</td>

								      <td class='d-none'>&nbsp;</td>
								      <td class='d-none'>&nbsp;</td>
								      <td class='d-none'>&nbsp;</td>
								      <td class='d-none'>&nbsp;</td>
								      <td class='d-none'>&nbsp;</td>

								      <td class='d-none'>&nbsp;</td>
								      <td class='d-none'>&nbsp;</td>
								      <td class='d-none'>&nbsp;</td>
								      <td class='d-none'>&nbsp;</td>
								      <td class='d-none'>&nbsp;</td>
								      <td class='d-none'>&nbsp;</td>

								    </tr>
								  </tbody>
								</table>
								</font>
							</div>







						</div>
						<!-- END -->



						<!-- RIGHT COLUMN - NORMAL / PUBLIC TABLE -->

						<!-- START -->
						<div class="col-2 float-right" style="padding:0 0 0 0 !important;">
							<div class="right-col" style="padding:0 0 0 0 !important;">
								
								<div class="col-12" style="padding:0 0 0 0 !important;">
									<font size='2px;'>
									
									<div class="col-12 float-left" style="padding:0 0 0 0 !important;">
										<table class="table table-sm table-bordered table-striped">										  
										    <tr>
										      <td colspan="4" class="text-center badge-secondary"><b>NORMAL</b></td>
										    </tr>										  										  
										    <tr style="background-color: #ccc;">
										      <td class="text-center badge-secondary"><b>D</b></td>
										      <td class="text-center"><div id="totalNDP">0</div></td>
										      <td class="text-center"><div id="totalNDA">0</div></td>
										      <td class="text-center"><div id="totalNDM">0</div></td>
										    </tr>
										    <tr style="background-color: #ccc;">
										      <td class="text-center badge-secondary"><b>N</b></td>
										      <td class="text-center"><div id="totalNNP">0</div></td>
										      <td class="text-center"><div id="totalNNA">0</div></td>
										      <td class="text-center"><div id="totalNNM">0</div></td>
										    </tr>
										  
										</table>
									</div>

									<div class="col-12 float-right" style="padding:0 0 0 0 !important;">
										<table class="table table-sm table-bordered table-striped">
										    <tr>
										      <td colspan="4" class="text-center badge-secondary"><b>PUBLIC</b></td>
										    </tr>
										    <tr style="background-color: #ccc;">
										      <td class="text-center bg-secondary"><b>D</b></td>
										      <td class="text-center"><div id="totalPDP">0</div></td>
										      <td class="text-center"><div id="totalPDA">0</div></td>
										      <td class="text-center"><div id="totalPDM">0</div></td>
										    </tr>
										    <tr style="background-color: #ccc;">
										      <td class="text-center bg-secondary"><b>N</b></td>
										      <td class="text-center"><div id="totalPNP">0</div></td>
										      <td class="text-center"><div id="totalPNA">0</div></td>
										      <td class="text-center"><div id="totalPNM">0</div></td>
										    </tr>
										</table>
									</div>

									</font>

								</div>


							</div>
			  			</div>
			  			<!-- END -->


			  			
			  			<!-- EMPLOYEE FORM -->
			  			<!-- START -->			  			
						<!--<div class="card daily-attendance col-12" style="background-color: #dae2dc;">-->
						<div class="card daily-attendance border border-secondary col-12" style="background-color: #dde0e2;">							
							

						  <div class="card-header" style="padding: 5px 0 0 0 !important;">
						    
						    <div class="col-12 float-left"> 
					            <div class="form-check d-inline">
					              <label><input class="form-check-input" id="id_absent_check" name="absent_check" type="checkbox" /><span class="text-primary" style="cursor: pointer">Absent</span></label>&nbsp;&nbsp;&nbsp;&nbsp;
					            </div>

					            <div class="form-check d-inline">
					              <label><input class="form-check-input" id="id_late_check" name="late_check" type="checkbox" /><span class="text-primary" style="cursor: pointer">Late</span></label>&nbsp;&nbsp;&nbsp;&nbsp;
					            </div>

					            <div class="form-check d-inline">
					              <label><input class="form-check-input" id="id_phone_check" name="phone_check" type="checkbox" /><span class="text-primary" style="cursor: pointer">Phone</span></label>&nbsp;&nbsp;&nbsp;&nbsp;
					            </div>

							    <div class="form-check d-inline float-right" id="id_crud_button">
									<button id="add_button" type="button" class="btn btn-success btn-xs"><i class="fas fa-plus fa-xs"></i>&nbsp;&nbsp;{% trans 'New' %}</button>
									<button id="reset_button" type="button" class="btn btn-secondary btn-xs">&nbsp;{% trans 'Cancel' %}</button>&nbsp;&nbsp;|&nbsp;&nbsp;
						        	<button id="save_button" type="button" class="btn btn-primary btn-xs"><i class="fas fa-save fa-sm"></i>&nbsp;&nbsp;{% trans 'Save' %}</button>
						        	<button id="delete_button" type="button" class="btn btn-danger btn-xs"><i class="fas fa-trash fa-sm"></i>&nbsp;&nbsp;{% trans 'Delete' %}</button>		        	
							    </div>

							</div>
						  </div>



						  <div class="card-body" style="padding: 10px 0 0 0;">

								<form class="form-row" id="dailyAttendanceDataEntryForm">
								{% csrf_token %}

						  	<div class="col-md-12 float-left">


								<div class="row" style="padding: 0 5px 0 5px;">

								  <div class="col-2">   
									<div class="input-group">
										<span style="font-size:0.9rem;padding:3px 0 0 0; width:78px;"><b>Employee</b>&nbsp;&nbsp;&nbsp;</span>
								  		<input type="number" id="id_emp_id" name="id_emp_id" class="form-control form-control-xs input-xs" placeholder="Emp ID" />
								  		<button id="emp_id_lookup_button" type="button" class="btn btn-outline-primary btn-xs" data-toggle="modal" data-url=""><i class="fas fa-search fa-sm"></i></button>
									</div>	
								  </div>

								  <div class="col-2">
								    <input type="text" class="form-control form-control-xs" id="id_emp_fullname_th" placeholder="Employee Name" readonly>
								  </div>

								  <div class="col-1">
								    <input type="text" class="form-control form-control-xs" id="id_emp_rank" placeholder="Rank" readonly>
								  </div>

								  <div class="col-1">
								    <input type="text" class="form-control form-control-xs" id="id_emp_dept" placeholder="Dept" readonly>
								  </div>

								  <div class="col-2">
								    <input type="text" id="id_emp_join_date" class="form-control form-control-xs" placeholder="Join Date" readonly>
								  </div>    

								  <div class="col-2">
								    <input type="text" id="id_emp_term_date" class="form-control form-control-xs" placeholder="Terminate Date" readonly>
								  </div>

								  <div class="col-2">
								    <input type="text" id="id_emp_status" class="form-control form-control-xs" placeholder="Status" readonly >
								  </div>

								</div>


								<div class="row" style="padding: 0 5px 0 5px;">

								  <div class="col-2">   
									<div class="input-group">
										<!--
										<label class="text-primary" style="font-size:0.9rem;padding:0 0 0 0;cursor: pointer">
										<input class="" id="id_relief_check" name="relief_check" type="checkbox" />&nbsp;&nbsp;Relief by&nbsp;</label>
										-->
										<label class="text-primary" style="font-size:0.9rem;padding:0 0 0 0;cursor: pointer;width:78px;">
										<input class="" id="id_relief_check" name="relief_check" type="checkbox" />&nbsp;Relief by&nbsp;</label>
										<input type="number" id="id_relief_emp_id" name="id_relief_emp_id" class="form-control form-control-xs" placeholder="Relief ID" readonly="" />
										<button id="relief_emp_id_lookup_button" type="button" class="btn btn-outline-primary btn-xs" data-toggle="modal" data-url="" disabled=""><i class="fas fa-search fa-sm"></i></button>
									</div>
								  </div>

								  <div class="col-2">
								    <input type="text" class="form-control form-control-xs" id="id_relief_emp_fullname_th" placeholder="Relief Name" readonly>
								  </div>

								  <div class="col-1">    
								    <input type="text" class="form-control form-control-xs" id="id_relief_emp_rank" placeholder="Rank" readonly>
								  </div>

								  <div class="col-1">
								  	<input type="text" class="form-control form-control-xs" id="id_relief_emp_dept" placeholder="Dept" readonly>
								  </div>

								  <div class="col-2">
								    <input type="text" id="id_relief_emp_join_date" class="form-control form-control-xs" placeholder="Join Date" readonly>
								  </div>    

								  <div class="col-2">
								    <input type="text" id="id_relief_emp_term_date" class="form-control form-control-xs" placeholder="Terminate Date" readonly>
								  </div>

								  <div class="col-2">
								    <input type="text" id="id_relief_emp_status" class="form-control form-control-xs" placeholder="Status" readonly >
								  </div>
								 
								</div>



								<div class="row" style="padding: 0 5px 0 5px;">

								  <div class="col-2">   
									<div class="input-group">
										<span style="font-size:0.9rem;padding:3px 0 0 0; width: 78px;"><b>Sent spare</b>&nbsp;&nbsp;&nbsp;</span>
								  		<input type="number" id="id_sent_spare" name="sent_spare" class="form-control form-control-xs" />
									</div>	
								  </div>


								  <div class="col-2">
								  	<div class="input-group">
								  	<span style="font-size:0.9rem;padding:3px 0 0 0;"><b>Shift</b>&nbsp;</span>
								    <select id="id_shift_option" class="form-control form-control-xs">
									  <option value="99" selected>99   # DAY OFF ########</option>
									  <option value="999">999   # ANOTHER SITE #</option>
								    </select>
									</div>
								  </div>

								  <div class="col-2">
								  	<input type="text" id="id_call_time" name="call_time" class="form-control form-control-xs" placeholder="Call Time" readonly />	
								  </div>


								  <div class="col-2">
								  	<div class="input-group">
								  	<span style="font-size:0.9rem;padding:3px 0 0 0;"><b>Call Amount</b>&nbsp;</span>
								    <select id="id_call_amount_option" class="form-control form-control-xs">
									  <option value="0" selected>0 บาท</option>
									  <option value="1">1 บาท</option>
									  <option value="2">2 บาท</option>
									  <option value="3">3 บาท</option>
									  <option value="4">4 บาท</option>
									  <option value="5">5 บาท</option>	  
								    </select>
									</div>
								  </div>

								  <div class="col-4">&nbsp;</div>

								</div>







								<div class="row" style="padding:0 0 2px 0;">
								  <div class="col-12"></div>
								</div>





								<div class="row" style="padding: 0 5px 0 5px;">

								  <div class="col-3">   
								  	<div class="input-group">
										<span style="font-size:0.9rem;padding:3px 0 0 0; width: 78px;"><b>Late From</b>&nbsp;&nbsp;&nbsp;&nbsp;</span>
								  		<!--<input type="datetime" id="id_late_from" name="late_from" class="form-control form-control-xs" placeholder="dd-mm-yyyy" value="" min="1997-01-01" max="2030-12-31" />-->
								  		<input type="text" id="id_late_from" name="late_from" class="form-control form-control-xs" data-inputmask="'mask': '99/99/9999 99:99'" />
								  	</div>
								  </div>

								  <div class="col-3">   
								  	<div class="input-group">
										<span style="font-size:0.9rem;padding:3px 0 0 0;"><b>Late To</b>&nbsp;&nbsp;&nbsp;&nbsp;</span>
								  		<input type="text" id="id_late_to" name="late_to" class="form-control form-control-xs" data-inputmask="'mask': '99/99/9999 99:99'" />
								  		<!--<input type="datetime-local" id="id_late_to" name="late_to" class="form-control form-control-xs" />-->
								  	</div>
								  </div>


								  <div class="col-2">
								  	<div class="input-group text-left">
								  	<span style="font-size:0.9rem;padding:3px 0 0 0;"><b>Reason</b>&nbsp;&nbsp;&nbsp;</span>&nbsp;
								    <select id="id_late_reason_option" class="form-control form-control-xs">
								    </select>
									</div>
								  </div>

								  <div class="col-2">
									<div class="input-group">
								  		<span style="font-size:0.9rem;padding:3px 0 0 0;"><b>Total Time (hrs)</b>&nbsp;&nbsp;</span>
								  		<input type="number" id="id_late_hour" name="late_hour" class="form-control form-control-xs" readonly />&nbsp;&nbsp;
								  	</div>
								  </div>

								  <div class="col-2">
									<div class="input-group">  				
										<label class="text-primary" style="font-size:0.9rem;padding:0 0 0 0;cursor: pointer">
										<input class="" id="id_late_full_paid_check" name="late_full_paid_check" type="checkbox" />&nbsp;Full Paid</label>

								  	</div>
								  </div>


								</div>


								<div class="row" style="padding: 0 5px 5px 5px;">

								  <div class="col-6 float-left">

								  	<div class="input-group">
										<span style="font-size:0.9rem;padding:0 0 0 0;width:78px;"><b>Job Type</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
								        <select id="id_job_type_option" class="form-control form-control-xs" readonly>
										  <option value="00" selected>00 :No</option>
								        </select>								
								  		
								  	</div>

								  	<!--  	
								  	<div class="input-group">		
										<span style="font-size:0.9rem;padding:0 0 0 0;"><b>Special Benefits</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
								        <select id="id_job_type_option" class="form-control form-control-xs" readonly>
										  <option value="00" selected>No special benefit</option>
								        </select>								  		
								  	</div>
									-->

								  </div>

								  <div class="col-6 float-right">
									<div class="input-group">
								  		<span style="font-size:0.9rem;padding:3px 0 0 0;"><b>Remark</b>&nbsp;&nbsp;&nbsp;</span>
								  		<input type="text" id="id_remark" name="remark" class="form-control form-control-xs text-right float-right" />
								  	</div>
								  </div>

								</div>



								  <input type="hidden" id="id_add_new_record_status" name="add_new_record_status" value=0 />

								</form>



							</div>
						
						  </div>

						</div>
						
			  			<!-- END -->

                  </div>



                  <!-- Contract / Schedule Tab -->
                  <div class="tab-pane fade" id="custom-tabs-one-profile" role="tabpanel" aria-labelledby="custom-tabs-one-profile-tab" style="padding: 0;">


						<div>





					      	<div class="card card-secondary" style="padding: 0 0 0 0;">

						    	<div class="card-header" style="padding: 4px;">

						    		<div>
							        <h4 class="card-title">
							          <div id="customer_name_title" class="pt-2">
							            <b>Customer Information</b>
							          </div>
							        </h4>
							        </div>

								    <div class="card-tools pr-1">
								    	<div class="col-1 text-right align-self-center" id="id_cnt_active"></div>
								    </div>
							    </div>


						        <div class="card-body col-12" style="padding: 0 0 5px 0; background-color: #e8e5e5;" >
									
									<font size="2em;">
									<form id="cusomer_information_form" name="cusomer_information_form" style="padding:0 !important; margin:0 !important;">

							                <div class="form-group row" style="padding: 5px 0 0 0 !important; margin: 0 !important;">
							                    <div class="col-6">
							                        <label for="id_customer_name_th">Customer Name</label>
							                        <input type="text" class="form-control form-control-xs" id="id_customer_name_th" readonly>
							                        <!--<small class="form-text text-muted" id="id_customer_name_en"></small>-->
							                    </div>
							                    <div class="col-2">
							                        <label for="id_customer_phone">Phone</label>
							                        <input type="text" class="form-control form-control-xs" id="id_customer_phone" readonly>
							                    </div>
							                    <div class="col-2">
							                        <label for="id_customer_wage_rate">Wage Rate</label>
							                        <input type="text" class="form-control form-control-xs" id="id_customer_wage_rate" readonly>
							                        <input type="hidden" id="id_customer_wage_rate_id">
							                    </div>
							                    
							                    <!--<div class="col-1 text-right align-self-center" id="id_cnt_active"></div>-->
							                    <div class="col-2">
							                        <label for="id_customer_zone">Zone</label>
							                        <input type="text" class="form-control form-control-xs bg-success" id="id_customer_zone" readonly>
							                        <input type="hidden" id="id_customer_zone_id">
							                    </div>

							                </div>

							                <div class="form-group row" style="padding: 0 0 0 0 !important; margin: 0 !important;">
							                    <div class="col-6">
							                        <label for="id_site_customer_name_th">Site Name</label>
							                        <input type="text" class="form-control form-control-xs" id="id_site_customer_name_th" readonly>
							                        <!--<small class="form-text text-muted" id="id_site_customer_name_en"></small>-->
							                    </div>
							                    <div class="col-2">
							                        <label for="id_site_customer_phone">Phone</label>
							                        <input type="text" class="form-control form-control-xs" id="id_site_customer_phone" readonly>
							                    </div>
							                    <!--
							                    <div class="col-2">
							                        <label for="id_authorized_by">Authorized by</label>
							                        <input type="text" class="form-control form-control-xs" id="id_authorized_by" readonly>
							                    </div>
                                    			-->
							                    <div class="col-2">
							                        <label>Contract Term From</label>
							                        <input type="text" class="form-control form-control-xs" id="id_cnt_sign_frm" readonly>
							                    </div>
							                    <div class="col-2">
							                        <label>Contract Term To</label>
							                        <input type="text" class="form-control form-control-xs" id="id_cnt_sign_to" readonly>
							                    </div>   



							                </div>


							                <div class="form-group row" style="padding: 0 0 0 0 !important; margin: 0 !important;">
							                    <div class="col-8">
							                        <label for="id_cus_add1_th">Address</label>
							                        <input type="text" class="form-control form-control-xs" id="id_cus_add1_th" readonly>
							                    </div>

							                    <div class="col-2">
							                        <label>Effective Term From</label>
							                        <input type="text" class="form-control form-control-xs" id="id_cnt_eff_frm" readonly>
							                    </div>
							                    <div class="col-2">
							                        <label>Effective Term To</label>
							                        <input type="text" class="form-control form-control-xs" id="id_cnt_eff_to" readonly>
							                    </div>   

							                </div>                

							                {% comment %}
							                <div class="form-group row" style="padding: 0 0 0 0 !important; margin: 0 !important;">
							                    <div class="col-2">
							                        <label for="id_cnt_doc_no">Cnt.Ref.</label>
							                        <input type="text" class="form-control form-control-xs" id="id_cnt_doc_no" readonly>                        
							                    </div>
							                    <div class="col-3">
							                        <label>Contact</label>
							                        <input type="text" class="form-control form-control-xs" id="con_fname_th" readonly>
							                    </div>
							                    <div class="col-3">
							                        <label>Position</label>
							                        <input type="text" class="form-control form-control-xs" id="con_pos_th" readonly>
							                    </div>
                                           
							                </div> 
							                {% endcomment %}
							        </form>
							    	</font>
							    </div>

							</div>

						    <!-- Customer Information Section -->

						    <!-- Contract Service Section -->
					      	<div class="card card-secondary" id="id_contract_service_card">
							    
						    	<div class="card-header" style="padding: 4px;">
						    		<div>
							        <h4 class="card-title">
							          <div class="pt-2">
							            <span id="id_card_title_display"><b>Contract Service</b></span>
							          </div>
							        </h4>
							        </div>

								    <div class="card-tools pr-1">
								    	<button type="button" class="btn btn-tool text-light" data-card-widget="maximize"><i class="fas fa-expand"></i></button>
								    </div>
							    </div>

						        <div class="card-body" style="padding: 0 0 0 0; background-color: #e8e5e5; height: 150px; overflow: auto;">
									<div class="row p-0" style="white-space:nowrap;">

										<div class="col-12" style="padding: 2px 10px 0 10px;">

										  <div>
										  	<font size='2em;'>
												
												<table class='table table-sm table-striped table-condensed dataTable' id="id_customer_contract_service">
													<thead class=thead-light>
														<tr>
															<th scope='col'>No</th>
															<th scope='col'>Rank</th>
															<th scope='col'>Shift</th>
															<th scope='col'>QTY</th>
															<th scope='col'>Eff.Frm</th>
															<th scope='col'>Eff.To</th>
															<th scope='col'>MON</th>
															<th scope='col'>TUE</th>
															<th scope='col'>WED</th>
															<th scope='col'>THU</th>
															<th scope='col'>FRI</th>
															<th scope='col'>SAT</th>
															<th scope='col'>SUN</th>
															<th scope='col'>PUB</th>
															<th scope='col'>Status</th>
															<th scope='col'>Remark</th>
															<th scope='col'>Upd Date</th>
															<th scope='col'>Upd By</th>
															<th scope='col'>Upd Flag</th>
														</tr>
													</thead>
													<tbody>
														<tr>
															<td>&nbsp;</td>
															<td>&nbsp;</td>
															<td>&nbsp;</td>
															<td>&nbsp;</td>
															<td>&nbsp;</td>
															<td>&nbsp;</td>
															<td>&nbsp;</td>
															<td>&nbsp;</td>
															<td>&nbsp;</td>
															<td>&nbsp;</td>
															<td>&nbsp;</td>
															<td>&nbsp;</td>
															<td>&nbsp;</td>
															<td>&nbsp;</td>
															<td>&nbsp;</td>
															<td>&nbsp;</td>
															<td>&nbsp;</td>
															<td>&nbsp;</td>
															<td>&nbsp;</td>
														</tr>
													</tbody>
												</table>

										  	</font>
										  </div>
										</div>
									</div>
								</div>
								
					      	</div>
					      	
						   	<!-- End Contract Service Section -->



          <!--
          <div class="col-md-3">
            <div class="card card-danger">
              <div class="card-header">
                <h3 class="card-title">Maximizable</h3>

                <div class="card-tools">
                  <button type="button" class="btn btn-tool" data-card-widget="maximize"><i class="fas fa-expand"></i></button>
                </div>
          
              </div>
          
              <div class="card-body">
                The body of the card
              </div>
          
            </div>
          
          </div>
          -->




						    <!-- Schedule List Section -->
						    
					      	<div class="card card-secondary">
						       


						    	<div class="card-header" style="padding: 4px;">
						    		<div>
							        <h4 class="card-title">
							          <div class="pt-2">
							            <b>Schedule List</b>
							          </div>
							        </h4>
							        </div>

								    <div class="card-tools pr-1">
								    	<button type="button" class="btn btn-tool text-light" data-card-widget="maximize"><i class="fas fa-expand"></i></button>
								    </div>
							    </div>

							    

						        <div class="card-body col-12" style="padding: 0 0 0 0; background-color: #e8e5e5; height: 150px; overflow: auto;">
									<div class="row" style="white-space:nowrap;">
										<div class="col-12" style="padding: 2px 10px 0 10px;">
										  <div>
										  	<font size='2em;'>
									  			<table class='table table-sm table-striped table-condensed' id="id_customer_schedule_list">
													<thead class=thead-light>
														<tr>
															<th scope='col' class='text-center'>No</th>
															<th scope='col' nowrap>Emp ID</th>
															<th scope='col'>Name</th>
															<th scope='col' class='text-center'>Rank</th>
															<th scope='col' nowrap>Eff.Frm</th>
															<th scope='col' nowrap>Eff.To</th>
															<th scope='col' class='text-center'>MON</th>
															<th scope='col' class='text-center'>TUE</th>
															<th scope='col' class='text-center'>WED</th>
															<th scope='col' class='text-center'>THU</th>
															<th scope='col' class='text-center'>FRI</th>
															<th scope='col' class='text-center'>SAT</th>
															<th scope='col' class='text-center'>SUN</th>
															<th scope='col'>Status</th>
															<th scope='col' nowrap>Upd Date</th>
															<th scope='col' nowrap>Upd By</th>															
														</tr>
													</thead>
													<tbody>
														<tr><td colspan='16'>&nbsp;</td></tr>
													</tbody>
												</table>
										  	</font>
										  </div>
										</div>
									</div>
								</div>

					      	</div>
					      	
						   	<!-- End Schedule List Section -->

						</div>



                  </div>




                </div>
              </div>
              <!-- /.card -->

            </div>

          </div>





          <!--<div style="height:1000px;"></div>-->



    		

			<!-- END -->



    	</section>
	</div>
{% endblock %}




{% block javascript %}

<script>

var customer_contract_service_table = $('#id_customer_contract_service').DataTable({
  		"paging": false,
  		"scrollCollapse": true,
		"lengthChange": false,
		"searching": false,
		"ordering": true,
		"info": false,
		"autoWidth": true,
	}); 

$(document).ready( function () {
	$('#id_contract_service_card').on('maximized.lte.cardwidget', function() {	
		cus_id = $('#id_cus_id').val();
      	cus_brn = $('#id_cus_brn').val();
      	cus_vol = $('#id_cus_vol').val();		
		customer_number = parseInt(cus_id + cus_brn + cus_vol);
		customer_name = $("#tab2-tab").text();
				
		$("#id_contract_service_card").removeClass("card-secondary");
		$("#id_contract_service_card").addClass("card-success");
		$("#id_card_title_display").html("<b>" + customer_number + "&nbsp;&nbsp;|&nbsp;&nbsp;" + customer_name + "</b>");

	})

	$('#id_contract_service_card').on('minimized.lte.cardwidget', function() {
		$("#id_contract_service_card").removeClass("card-success");
		$("#id_contract_service_card").addClass("card-secondary");		
		$("#id_card_title_display").html("<b>Contract Service</b>");
	})



	$(function () {
	    var table = $('#employee_list_table').DataTable({
	      "paging": false,
	      "scrollY": "200px",
	      "scrollCollapse": true,
	      "lengthChange": false,
	      "searching": true,
	      "ordering": true,
	      "info": false,
	      "autoWidth": true,
	      //"language": { search: ""},
	      "dom": '<"top"i>rt<"bottom"><"clear">',
	      "search": "_INPUT_",
	      "searchPlaceholder": "Search",
		  "columnDefs": [
			{"targets": 0, "orderable": false},
			{"targets": 1, "orderable": false},

			{"targets": 2, "orderable": true}, 	// No
			{"targets": 3, "orderable": true},	// EMP ID
			{"targets": 4, "orderable": true},	// Name
			{"targets": 5, "orderable": true},	// Rank
			{"targets": 6, "orderable": true},	// Shift
			{"targets": 7, "orderable": false},
			{"targets": 8, "orderable": false},
			{"targets": 9, "orderable": false},
			{"targets": 10, "orderable": false},
			{"targets": 11, "orderable": false},
			{"targets": 12, "orderable": false},
			{"targets": 13, "orderable": false},
			{"targets": 14, "orderable": false},
			{"targets": 15, "orderable": false},
			{"targets": 16, "orderable": false},
			{"targets": 17, "orderable": false},
			{"targets": 18, "orderable": false},

			{"targets": 19, "orderable": false},
			{"targets": 20, "orderable": false},
			{"targets": 21, "orderable": false},
			{"targets": 22, "orderable": false},
			{"targets": 23, "orderable": false},
			{"targets": 24, "orderable": false},
			{"targets": 25, "orderable": false},
			{"targets": 26, "orderable": false},
			{"targets": 27, "orderable": false},
			{"targets": 28, "orderable": false},
			{"targets": 29, "orderable": false},
			{"targets": 30, "orderable": false},
			{"targets": 31, "orderable": false},
			{"targets": 32, "orderable": false},
		  ],
		  "dom": 'Brtip',
		  buttons: [
		    {
		        extend: 'print',
		        title: '',
		        exportOptions: {
		          columns: [ 0, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21]
		        }
		    },
		    {
		        extend: 'excelHtml5',        
		        title: '',
		        exportOptions: {
		          columns: [ 0, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21]
		        },
		        filename: function() {
		        	d = new Date();
		        	n = d.getTime();	        

					date_display = d.getDate() + "_" + d.getMonth() + "_" + d.getFullYear() + "_" + d.getHours() + "." + d.getMinutes() + "." + d.getSeconds();

					cus_id = $('#id_cus_id').val();
			      	cus_brn = $('#id_cus_brn').val();
			      	cus_vol = $('#id_cus_vol').val();
					customer_number = parseInt(cus_id + cus_brn + cus_vol);		
		        	return 'my_daily_attendance_' + customer_number + "_" + date_display;
		        },
		    },
		  ]		  		  
	    });
    
		table.buttons('.buttons-print').nodes().css("display", "none");
		table.buttons('.buttons-excel').nodes().css("display", "none");
		table.buttons('.buttons-pdf').nodes().css("display", "none");

		//columns: [ 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]

/*
	<thead class="bg-secondary">
	<tr>
		<th scope='col' class='d-none text-center' nowrap>Absent Status</th>
		<th scope="col">&nbsp;</th>								      
		<th scope='col' class='text-center'>No</th>								  	  								  		
		<th scope='col' nowrap>Emp ID</th>
		<th scope='col'>Name</th>

		<th scope="col">Rank</th>
		<th scope="col">Shift</th>
		<th scope="col">Late</th>
		<th scope="col">Full</th>
		<th scope="col">Relief</th>

		<th scope="col" nowrap>Rel. ID</th>
		<th scope="col">Name</th>
		<th scope='col' class='d-none'>Tel Status</th>
		<th scope="col">Tel</th>
		<th scope="col" nowrap>Tel Time</th>
		
		<th scope="col" nowrap>Tel Amt</th>
		<th scope="col" nowrap>Tel Paid</th>
		<th scope="col">Spare</th>
		<th scope="col">Wage</th>
		<th scope="col" nowrap>Upd Date</th>

		<th scope="col" nowrap>Upd By</th>
		<th scope="col" nowrap>Upd Flag</th>								      

		<th scope="col" class='d-none' nowrap>Upd Gen</th>
		<th scope="col" class='d-none' nowrap>Remark</th>
		<th scope='col' class='d-none'>Relief Status</th>
		<th scope='col' class='d-none'>Late Status</th>
		<th scope='col' class='d-none'>Late Full Status</th>


		<th scope='col' class='d-none'>OT</th>
		<th scope='col' class='d-none'>OT Reason</th>
		<th scope='col' class='d-none'>OT Time From</th>
		<th scope='col' class='d-none'>OT Time To</th>
		<th scope='col' class='d-none'>OT Hour Amount</th>
		<th scope='col' class='d-none'>Shift Type</th>
	</tr>
	</thead>


	table = $('#id_security_guard_list').DataTable({
	  "paging": false,
	  "pageLength": 15,
	  "scrollCollapse": true,
	  "lengthChange": false,
	  "searching": true,
	  "ordering": true,
	  "info": false,
	  "autoWidth": true,
	  "dom": '<"top"i>Brtip<"bottom"><"clear">',
	  "search": "_INPUT_",
	  "searchPlaceholder": "Search",  
	  "language": {
	    search: '<i class="fa fa-filter" aria-hidden="true"></i>',
	    searchPlaceholder: 'Filter data'
	  },
	  "columnDefs": [
	  	{"targets": 0, "orderable": true},
	  	{"targets": 1, "orderable": true},
	  	{"targets": 2, "orderable": true},
	  	{"targets": 3, "orderable": false},
	  	{"targets": 4, "orderable": false},
	  	{"targets": 5, "orderable": false},
	  	{"targets": 6, "orderable": false},
	  	{"targets": 7, "orderable": false},
	  	{"targets": 8, "orderable": false},
	  	{"targets": 9, "orderable": false},
	  	{"targets": 10, "orderable": false},
	  	{"targets": 11, "orderable": false},
	  	{"targets": 12, "orderable": false},
	  	{"targets": 13, "orderable": false},
	  	{"targets": 14, "orderable": false},
	  	{"targets": 15, "orderable": false},
	  	{"targets": 16, "orderable": false},
	  	{"targets": 17, "orderable": false},
	  	{"targets": 18, "orderable": false},
	  ],	
*/



 		$('#employee_search_button').on( 'keyup click', function () {
    		table.search($('#employee_search_text').val()).draw();
  		});

 		$('#employee_search_text').on( 'keyup click', function () {
    		table.search($('#employee_search_text').val()).draw();
  		});  		

 		$('#employee_search_clear_button').on( 'click', function () {
 			$('#employee_search_text').val("");
 			//$('#employee_search_text').draw();
 			table.search($('#employee_search_text').val()).draw();
 		});

	});

});

// 111
function checkSpecialBenefitList() {

	$("#id_job_type_option").attr("disabled", false);
	$("#id_job_type_option").attr("readonly", false);

  	var cus_id = $('#id_cus_id').val();
  	var cus_brn = $('#id_cus_brn').val();
  	var cus_vol = $('#id_cus_vol').val();
	var shift_id = $("#id_shift_option").val();

	// alert(cus_id + "|" + cus_brn + "|" + cus_vol + "|" + shift_id);

	$.ajax({
    	url : "/monitoring/ajax/get_job_type_list/",
    	type : "POST",
    	data : {          
      		csrfmiddlewaretoken: '{{ csrf_token }}',
      		cus_id: cus_id,
      		cus_brn: cus_brn,
      		cus_vol: cus_vol,
      		shift_id: shift_id,
    	},
    	success: function(data) {       		 	
			var $el = $("#id_job_type_option");
			$el.empty();			

			// DEMO
			// START
			//result = "<option value='00' selected>No special benefit</option>";
			// END

			// ACTUAL
			// START
			result = "<option value='00' selected>00 :No</option>";
			// END

			$el.append(result);
			if(data.job_type_list.length>0) {				
				for(var i=0; i<data.job_type_list.length; i++) {					
					srv_id = data.job_type_list[i]["srv_id"]; 
					spay1 = data.job_type_list[i]["spay1"];
					spay2 = data.job_type_list[i]["spay2"];
					spay3 = data.job_type_list[i]["spay3"];
					spay4 = data.job_type_list[i]["spay4"];					
					spay_total = data.job_type_list[i]["spay9"];					
					position = data.job_type_list[i]["position"];
					spay_detail = data.job_type_list[i]["spay_detail"];


					spay_total_display_text = position + " (";
					if(spay1>0)
						spay_total_display_text += "Position=" + spay1;
					if(spay2>0)
						spay_total_display_text += ", Incentive=" + spay2;
					if(spay3>0)
						spay_total_display_text += ", CCTV=" + spay3;
					if(spay4>0)
						spay_total_display_text += ", Traffic=" + spay4;
					spay_total_display_text += ") | TOTAL " + spay_total + " บาท";
					
					$el.append($("<option></option>").attr("value", srv_id+"|"+position).text(spay_total_display_text));
				}
			}

    	}
    });
}

	$(document).ready(function(){

		$(":input").inputmask();

		$("#id_shift_option").change(function () {
			// DEMO
			// START
			//checkSpecialBenefitList();
			// END
		});

	});

	$("#id_bulk_shift_list_option").change(function() {		
		$("#id_bulk_shift_list_option").css('border-color', '');
		$("#id_bulk_shift_list_option").css('background-color', '');
		$("#id_bulk_shift_list_option").css('border-style', '');		
	});





	$("#bulk_shift_status_form").submit(function(e) {
	    e.preventDefault();
	    		
		$("#id_bulk_shift_list_option").css('border-color', '');
		$("#id_bulk_shift_list_option").css('background-color', '');
		$("#id_bulk_shift_list_option").css('border-style', '');

	    var bulk_shift_id = $("#id_bulk_shift_list_option").val();
	    var bulk_shift_status = $("#id_shift_status").val();
        var attendance_date = $('#id_dly_date').val();
      	var cus_id = $('#id_cus_id').val();
      	var cus_brn = $('#id_cus_brn').val();
      	var cus_vol = $('#id_cus_vol').val();
      	var search_shift_option = $("#id_search_shift_option").val();
      	      	      	
	    if(bulk_shift_id=="0" || bulk_shift_id=="" || bulk_shift_status=="") {
	    	/*
			$.alert({
			    title: 'Error',
			    type: 'red',
			    content: "กรุณาเลือกกะการทำงานที่ต้องการเปลี่ยน Absent ของพนักงาน",
			    animation: 'zoom',
			    animationBounce: 1.5,
			    closeIcon: false,
			    boxWidth: '38%',
			    useBootstrap: false,
			});
			*/

		  	$(document).Toasts('create', {
		    	class: "bg-danger", 
		    	title: "{% trans 'Error' %}",
		    	subtitle: '',
		    	autohide: true,
		    	delay: 2000,
		    	body: "กรุณาเลือกกะที่ต้องการใช้งาน",
		    	autoDismiss: true,
		    	close: true,
		    	autoremove: true,
		  	});

		  	$("#id_bulk_shift_list_option").css('border-color','red');
		  	$("#id_bulk_shift_list_option").css('background-color', '#e4cdcf');
			$("#id_bulk_shift_list_option").css('border-style','solid');

	    	return false;  		
	    } else {

			//alert(bulk_shift_status)
			//return false;

	    	if(bulk_shift_status==1) {
	    		//alert("Absent");
	    		//return false;
				$.ajax({
			    	url : "/monitoring/ajax/bulk_update_absent_status/",
			    	type : "POST",
			    	data : {          
			      		csrfmiddlewaretoken: '{{ csrf_token }}',
			      		attendance_date: attendance_date,
			      		shift_id: bulk_shift_id,
			      		shift_status: bulk_shift_status,
			      		cus_id: cus_id,
			      		cus_brn: cus_brn,
			      		cus_vol: cus_vol,
			    	},
			    	success: function(data) {
			    		if(data.is_error) {																	
							$.alert({
							    title: 'Error',
							    type: 'red',
							    content: data.message,
							    animation: 'zoom',
							    animationBounce: 1.5,
							    closeIcon: false,
							    boxWidth: '38%',
							    useBootstrap: false,
							});

			    		} else {

						  	$(document).Toasts('create', {
						    	class: "bg-success", 
						    	title: "{% trans 'Success' %}",
						    	subtitle: '',
						    	autohide: true,
						    	delay: 2000,
						    	body: data.message,
						    	autoDismiss: true,
						    	close: true,
						    	autoremove: true,
						  	});

							$.ajax({
								url : "/monitoring/ajax/get_attendance_information/",
								type : "POST",
								data : {          
							  		csrfmiddlewaretoken: '{{ csrf_token }}',
							  		attendance_date: attendance_date,
							  		cus_id: cus_id,
							  		cus_brn: cus_brn,
							  		cus_vol: cus_vol,
							  		search_shift_option: search_shift_option,
								},
								success : function(data) {
									if(data.is_found) {

										// Get Schedule list info
										result = "";
										schedule_list_length = data.schedule_list.length;
										for(i=0; i<schedule_list_length; i++) {
											result += data.schedule_list[i];
										}

										employee_leave_list = null
										result = create_attandance_table(data.employee_list, employee_leave_list);

										$('#id_employee_list').html(result);

										// TOTAL
										$("#totalNDP").html(data.totalNDP);
										$("#totalNNP").html(data.totalNNP);
										$("#totalPDP").html(data.totalPDP);
										$("#totalPNP").html(data.totalPNP);

										$("#totalNDA").html(data.totalNDA);
										$("#totalNNA").html(data.totalNNA);
										$("#totalPDA").html(data.totalPDA);
										$("#totalPNA").html(data.totalPNA);

										if(data.totalNDM>=0)
											$("#totalNDM").html("<span class='text-danger'>" + data.totalNDM + "</span>");
										else
											$("#totalNDM").html("<span class='text-danger'>" + data.totalNDM + "</span>");

										if(data.totalNNM>=0)
											$("#totalNNM").html("<span class='text-danger'>" + data.totalNNM + "</span>");						
										else
											$("#totalNNM").html("<span class='text-danger'>" + data.totalNNM + "</span>");
										
										if(data.totalPDM>=0)
											$("#totalPDM").html("<span class='text-danger'>" + data.totalPDM + "</span>");
										else
											$("#totalPDM").html("<span class='text-danger'>" + data.totalPDM + "</span>");

										if(data.totalPNM>=0)
											$("#totalPNM").html("<span class='text-danger'>" + data.totalPNM + "</span>");
										else
											$("#totalPNM").html("<span class='text-danger'>" + data.totalPNM + "</span>");
									}
								}
							});

			    		}		    		
			    	},

			    });					        					        		


	    	} else {
	    		//alert("Not absent")
	    		//return false;

				// ironman
				// work_cross_site
				$.ajax({
			    	url : "/monitoring/ajax/ajax_is_scheduled_between_site/",
			    	type : "POST",
			    	data : {          
			      		csrfmiddlewaretoken: '{{ csrf_token }}',
			      		attendance_date: attendance_date,
			      		shift_id: bulk_shift_id,
			      		shift_status: bulk_shift_status,
			      		cus_id: cus_id,
			      		cus_brn: cus_brn,
			      		cus_vol: cus_vol,
			    	},
			    	success: function(data) {
						// alert("success");
						if(data.is_error) {
							//alert("is_error");

							if(data.is_over_capacity) {
								$.alert({
									title: 'Error',
									type: 'red',
									content: data.message,
									animation: 'zoom',
									animationBounce: 1.5,
									closeIcon: false,
									boxWidth: '38%',
									useBootstrap: false,
								});
								
								return false;

							} else {
																					
								$.confirm({
									title: 'Confirmation',
									type: 'red',
									content: data.message,
									animation: 'zoom',
									animationBounce: 1.5,
									closeIcon: true,
									boxWidth: '38%',
									useBootstrap: false,		    
									buttons: {
										confirm: {
											text: 'ตกลง',
											btnClass: 'btn-danger',
											action: function () {
												
												skip_is_scheduled_record = 1

												$.ajax({
													url : "/monitoring/ajax/bulk_update_absent_status/",
													type : "POST",
													data : {          
														csrfmiddlewaretoken: '{{ csrf_token }}',
														attendance_date: attendance_date,
														shift_id: bulk_shift_id,
														shift_status: bulk_shift_status,
														cus_id: cus_id,
														cus_brn: cus_brn,
														cus_vol: cus_vol,
														skip_is_scheduled_record,
													},
													success: function(data) {
														if(data.is_error) {
															//alert("ERROR: Please contact IT.");
															alert("ERROR: " + data.message);														

														} else {

															$.ajax({
																url : "/monitoring/ajax/get_attendance_information/",
																type : "POST",
																data : {          
																	csrfmiddlewaretoken: '{{ csrf_token }}',
																	attendance_date: attendance_date,
																	cus_id: cus_id,
																	cus_brn: cus_brn,
																	cus_vol: cus_vol,
																	search_shift_option: search_shift_option,
																},
																success : function(data) {
																	if(data.is_found) {

																		// Get Schedule list info
																		result = "";
																		schedule_list_length = data.schedule_list.length;
																		for(i=0; i<schedule_list_length; i++) {
																			result += data.schedule_list[i];
																		}

																		employee_leave_list = null
																		result = create_attandance_table(data.employee_list, employee_leave_list);

																		$('#id_employee_list').html(result);

																		// TOTAL
																		$("#totalNDP").html(data.totalNDP);
																		$("#totalNNP").html(data.totalNNP);
																		$("#totalPDP").html(data.totalPDP);
																		$("#totalPNP").html(data.totalPNP);

																		$("#totalNDA").html(data.totalNDA);
																		$("#totalNNA").html(data.totalNNA);
																		$("#totalPDA").html(data.totalPDA);
																		$("#totalPNA").html(data.totalPNA);

																		if(data.totalNDM>=0)
																			$("#totalNDM").html("<span class='text-danger'>" + data.totalNDM + "</span>");
																		else
																			$("#totalNDM").html("<span class='text-danger'>" + data.totalNDM + "</span>");

																		if(data.totalNNM>=0)
																			$("#totalNNM").html("<span class='text-danger'>" + data.totalNNM + "</span>");						
																		else
																			$("#totalNNM").html("<span class='text-danger'>" + data.totalNNM + "</span>");
																		
																		if(data.totalPDM>=0)
																			$("#totalPDM").html("<span class='text-danger'>" + data.totalPDM + "</span>");
																		else
																			$("#totalPDM").html("<span class='text-danger'>" + data.totalPDM + "</span>");

																		if(data.totalPNM>=0)
																			$("#totalPNM").html("<span class='text-danger'>" + data.totalPNM + "</span>");
																		else
																			$("#totalPNM").html("<span class='text-danger'>" + data.totalPNM + "</span>");
																	}
																}
															});

														}		    		
													},

												});					        					        		
											}
										},
										cancel: {
											text: 'ยกเลิก',
											action: function () {											
												//alert("Cancel");
											}
										}
									}
								});
							}
						} else {

							//alert("is_not_error");
							$.ajax({
						    	url : "/monitoring/ajax/bulk_update_absent_status/",
						    	type : "POST",
						    	data : {          
						      		csrfmiddlewaretoken: '{{ csrf_token }}',
						      		attendance_date: attendance_date,
						      		shift_id: bulk_shift_id,
						      		shift_status: bulk_shift_status,
						      		cus_id: cus_id,
						      		cus_brn: cus_brn,
						      		cus_vol: cus_vol,						      		
						    	},
						    	success: function(data) {

								  	$(document).Toasts('create', {
								    	class: "bg-success", 
								    	title: "{% trans 'Success' %}",
								    	subtitle: '',
								    	autohide: true,
								    	delay: 2000,
								    	body: data.message,
								    	autoDismiss: true,
								    	close: true,
								    	autoremove: true,
								  	});
						    		
						    		if(data.is_error) {
						    			//alert("aa");
						    		} else {						    			
										$.ajax({
											url : "/monitoring/ajax/get_attendance_information/",
											type : "POST",
											data : {          
										  		csrfmiddlewaretoken: '{{ csrf_token }}',
										  		attendance_date: attendance_date,
										  		cus_id: cus_id,
										  		cus_brn: cus_brn,
										  		cus_vol: cus_vol,
										  		search_shift_option: search_shift_option,
											},
											success : function(data) {
												if(data.is_found) {

													// Get Schedule list info
													result = "";
													schedule_list_length = data.schedule_list.length;
													for(i=0; i<schedule_list_length; i++) {
														result += data.schedule_list[i];
													}

													employee_leave_list = null
													result = create_attandance_table(data.employee_list, employee_leave_list);

													$('#id_employee_list').html(result);

													// TOTAL
													$("#totalNDP").html(data.totalNDP);
													$("#totalNNP").html(data.totalNNP);
													$("#totalPDP").html(data.totalPDP);
													$("#totalPNP").html(data.totalPNP);

													$("#totalNDA").html(data.totalNDA);
													$("#totalNNA").html(data.totalNNA);
													$("#totalPDA").html(data.totalPDA);
													$("#totalPNA").html(data.totalPNA);

													if(data.totalNDM>=0)
														$("#totalNDM").html("<span class='text-danger'>" + data.totalNDM + "</span>");
													else
														$("#totalNDM").html("<span class='text-danger'>" + data.totalNDM + "</span>");

													if(data.totalNNM>=0)
														$("#totalNNM").html("<span class='text-danger'>" + data.totalNNM + "</span>");						
													else
														$("#totalNNM").html("<span class='text-danger'>" + data.totalNNM + "</span>");
													
													if(data.totalPDM>=0)
														$("#totalPDM").html("<span class='text-danger'>" + data.totalPDM + "</span>");
													else
														$("#totalPDM").html("<span class='text-danger'>" + data.totalPDM + "</span>");

													if(data.totalPNM>=0)
														$("#totalPNM").html("<span class='text-danger'>" + data.totalPNM + "</span>");
													else
														$("#totalPNM").html("<span class='text-danger'>" + data.totalPNM + "</span>");
												}
											}
										});

						    		}		    		
						    	},

						    });	
						}


			    	}
			    });

				return false;

	    	}

	    }
	});


	$(document).ready(function(){
		var today = new Date();
		var date = today.getDate() + "/" + ("0" + today.getMonth()+1).slice(-2) + '/' + today.getFullYear() + " 00:00";

        $("#id_customer_wage_rate_id").val(0);
        $("#id_customer_zone_id").val(0);

		$("#id_cus_id").on('click', function(){
			$("#id_cus_id").select();
		});
		$("#id_cus_brn").on('click', function(){
			$("#id_cus_brn").select();
		});
		$("#id_cus_vol").on('click', function(){
			$("#id_cus_vol").select();
		});

		$("#id_late_hour").on('click', function(){
			$("#id_late_hour").select();
		});

		$("#id_relief_emp_id").on('click', function(){
			$("#id_relief_emp_id").select();
		});

		disableAllElements();

		// Set Late From/To
		//$("#id_late_from").val(date);
		//$("#id_late_to").val(date);


		$('#id_cus_id').focus();
		$('#id_cus_id').select();
	});


		
		/*
		$("#id_late_check").hide();
		$("#id_late_check").next("label").hide();
		$("#id_phone_check").hide();
		$("#id_phone_check").next("label").hide();
		*/

	$("#id_absent_check").change(function() {

		//$("#id_relief_emp_id").css('border-color','');
		//$("#id_relief_emp_id").css('border-style','');

	    if(this.checked) {
	    	
	   		$("#relief_employee_section").show();

	   		$("#id_late_check").prop("checked", false);

	   		//$("#id_late_check").hide();
	   		//$("#id_late_check").next("label").hide();

			//$("#id_phone_check").hide();
			//$("#id_phone_check").next("label").hide();

			$("#id_phone_check").prop("checked", false);
			$("#id_call_time").val("");
	    	$("#id_call_amount_option").val(0);

	    	$("#id_relief_emp_id").attr("disabled", false);
	    	$("#id_relief_emp_id").attr("readonly", false);

	    	//$("#id_relief_check").prop("checked", true);
	    	$("#id_relief_emp_id").focus();
	 		
	    } else {
			$("#id_relief_emp_id").css('border-color','');
			$("#id_relief_emp_id").css('border-style','');

			/*
			var tel_man = $("#employee_list_table").find('.highlight').find('td:eq(11)').text();
			var tel_time = $("#employee_list_table").find('.highlight').find('td:eq(13)').text();
			var tel_amount = $("#employee_list_table").find('.highlight').find('td:eq(14)').text();
			*/

			var tel_man = $("#employee_list_table").find('.highlight').find('td:eq(12)').text();
			var tel_time = $("#employee_list_table").find('.highlight').find('td:eq(14)').text();
			var tel_amount = $("#employee_list_table").find('.highlight').find('td:eq(15)').text();

			if(tel_man==1) {
				$("#id_phone_check").prop("checked", true);
				$("#id_call_time").val(tel_time);
				$("#id_call_amount_option").val(tel_amount);
			} else {
				$("#id_phone_check").prop("checked", false);
				$("#id_call_time").val("");
				$("#id_call_amount_option").val(0);
			}

	    	//$("#relief_employee_section").hide();

			$("#id_relief_check").prop("checked", false);
	    	$("#id_relief_emp_id").attr("disabled", true);

	    	//$("#id_late_check").show();
	    	//$("#id_late_check").next("label").show();	    	
	    	//$("#id_phone_check").show();
	    	//$("#id_phone_check").next("label").show();


	    }
	});


$("#id_late_from").inputmask("99/99/9999 99:99");
$("#id_late_from").bind("focus",function(e){
	if(e.keyCode!=undefined) {
		//console.log("a");
		this.setSelectionRange(11, 12);		
	} else {
		//console.log("b");
		this.setSelectionRange(11, 12);
	}
	
});
$("#id_late_from").bind("keyup",function(e){
	var keyup_point;
	keyup_point = this.selectionStart;
	if(e.keyCode==13) { // enter		

		/*
		if(keyup_point==11) {
			this.setSelectionRange(11, 13);
		}				
		this.setSelectionRange(11, 13);
		*/

		$("#id_late_to").focus();
	}

	if ((e.keyCode >= 48 && e.keyCode <= 57) || (e.keyCode >= 96 && e.keyCode <= 105)) {
		//console.log("number 0-9 keyup_point:" + keyup_point);
		if(keyup_point==11) {
			this.setSelectionRange(11, 13);	
		}
		if(keyup_point==12) {
			this.setSelectionRange(12, 13);
		}				
		if(keyup_point==14) {
			this.setSelectionRange(14, 15);
		}
		if(keyup_point==15) {
			this.setSelectionRange(15, 16);
		}
	}

	if(e.keyCode == 37) {
		//console.log("left arrow keyup_point:" + keyup_point);
		if(keyup_point==12) {
			this.setSelectionRange(11, 12);
		}

		if(keyup_point==13) {
			this.setSelectionRange(11, 13);		
		}

		if(keyup_point==14) {
			this.setSelectionRange(12, 13);
		}

		if(keyup_point==15) {
			this.setSelectionRange(14, 15);
		}		

		if(keyup_point==16) {
			this.setSelectionRange(15, 16);
		}		

	}

	if(e.keyCode == 39) {
		//console.log("right arrow keyup_point:" + keyup_point);
		if(keyup_point==12) {
			this.setSelectionRange(12, 13);
		}		

		if(keyup_point==13) {
			this.setSelectionRange(14, 15);		
		}		

		if(keyup_point==14) {
			this.setSelectionRange(15, 16);
		}

		if(keyup_point==15) {
			this.setSelectionRange(15, 16);
		}		
	}
});




$("#id_late_to").inputmask("99/99/9999 99:99");
$("#id_late_to").bind("focus",function(e){
	if(e.keyCode!=undefined) {
		console.log("a");
		this.setSelectionRange(11, 12);		
	} else {
		console.log("b");
		const input = document.getElementById('id_late_to');
		window.setTimeout(function() {
        	input.setSelectionRange(11, 12);
        }, 10);
	}	
});
$("#id_late_to").bind("focusout",function(e){
	console.log("focus out");
	event.preventDefault();
	var late_from = $("#id_late_from").val().split(' ');
	var late_from_day = late_from[0].split(/\//);
	var late_from_time = late_from[1];
	var late_from_day_time = late_from_day[1] + '/' + late_from_day[0] + '/' + late_from_day[2] + ' ' + late_from_time;
	var late_from_date = new Date(late_from_day_time);
	var late_to = $("#id_late_to").val().split(' ');
	var late_to_day = late_to[0].split(/\//);
	var late_to_time = late_to[1];
	var late_to_day_time = late_to_day[1] + '/' + late_to_day[0] + '/' + late_to_day[2] + ' ' + late_to_time;
	var late_to_date = new Date(late_from_day_time);
	var moment_late_from_day_time = late_from_day[2] + '-' + late_from_day[1] + '-' + late_from_day[0] + ' ' + late_from_time;
	var moment_late_to_day_time = late_to_day[2] + '-' + late_to_day[1] + '-' + late_to_day[0] + ' ' + late_to_time;
	var moment_late_from = moment(moment_late_from_day_time);
	var moment_late_to = moment(moment_late_to_day_time);	
	var duration = moment.duration(moment_late_to.diff(moment_late_from));
	var hours = duration.asHours().toFixed(2);
	
	$("#id_late_hour").val(hours);
});

$("#id_late_to").bind("keyup",function(e){
	var keyup_point;
	keyup_point = this.selectionStart;
	if(e.keyCode==13) { // enter		

		/*
		if(keyup_point==11) {
			this.setSelectionRange(11, 13);
		}				
		this.setSelectionRange(11, 13);
		*/
		
		$("#id_late_hour").focus();
	}

	if ((e.keyCode >= 48 && e.keyCode <= 57) || (e.keyCode >= 96 && e.keyCode <= 105)) {
		console.log("number 0-9 keyup_point:" + keyup_point);
		if(keyup_point==11) {
			this.setSelectionRange(11, 13);	
		}
		if(keyup_point==12) {
			this.setSelectionRange(12, 13);
		}				
		if(keyup_point==14) {
			this.setSelectionRange(14, 15);
		}
		if(keyup_point==15) {
			this.setSelectionRange(15, 16);
		}
	}

	if(e.keyCode == 37) {
		console.log("left arrow keyup_point:" + keyup_point);
		if(keyup_point==12) {
			this.setSelectionRange(11, 12);
		}

		if(keyup_point==13) {
			this.setSelectionRange(11, 13);		
		}

		if(keyup_point==14) {
			this.setSelectionRange(12, 13);
		}

		if(keyup_point==15) {
			this.setSelectionRange(14, 15);
		}		

		if(keyup_point==16) {
			this.setSelectionRange(15, 16);
		}
	}

	if(e.keyCode == 39) {
		console.log("right arrow keyup_point:" + keyup_point);
		if(keyup_point==12) {
			this.setSelectionRange(12, 13);
		}		

		if(keyup_point==13) {
			this.setSelectionRange(14, 15);		
		}		

		if(keyup_point==14) {
			this.setSelectionRange(15, 16);
		}

		if(keyup_point==15) {
			this.setSelectionRange(15, 16);
		}
	}
});



$("#id_late_hour").bind("keypress",function(e){	
	if(e.which == 13) {
		e.preventDefault();
		late_from = $("#id_late_from").val();
		late_to = $("#id_late_to").val();
		console.log("id_late_hour_keypress");
	}
});

$("#id_late_hour").bind("focus",function(e){
	event.preventDefault();
	var late_from = $("#id_late_from").val().split(' ');
	var late_from_day = late_from[0].split(/\//);
	var late_from_time = late_from[1];
	var late_from_day_time = late_from_day[1] + '/' + late_from_day[0] + '/' + late_from_day[2] + ' ' + late_from_time;
	var late_from_date = new Date(late_from_day_time);
	var late_to = $("#id_late_to").val().split(' ');
	var late_to_day = late_to[0].split(/\//);
	var late_to_time = late_to[1];
	var late_to_day_time = late_to_day[1] + '/' + late_to_day[0] + '/' + late_to_day[2] + ' ' + late_to_time;
	var late_to_date = new Date(late_from_day_time);
	var moment_late_from_day_time = late_from_day[2] + '-' + late_from_day[1] + '-' + late_from_day[0] + ' ' + late_from_time;
	var moment_late_to_day_time = late_to_day[2] + '-' + late_to_day[1] + '-' + late_to_day[0] + ' ' + late_to_time;
	var moment_late_from = moment(moment_late_from_day_time);
	var moment_late_to = moment(moment_late_to_day_time);	
	var duration = moment.duration(moment_late_to.diff(moment_late_from));
	//var hours = duration.asHours();	
	var hours = duration.asHours().toFixed(2);
	$("#id_late_hour").val(hours);
});

$("#id_late_hour").click( function() {
	event.preventDefault();

	var late_from = $("#id_late_from").val().split(' ');
	var late_from_day = late_from[0].split(/\//);
	var late_from_time = late_from[1];
	var late_from_day_time = late_from_day[1] + '/' + late_from_day[0] + '/' + late_from_day[2] + ' ' + late_from_time;
	var late_from_date = new Date(late_from_day_time);
	
	var late_to = $("#id_late_to").val().split(' ');
	var late_to_day = late_to[0].split(/\//);
	var late_to_time = late_to[1];
	var late_to_day_time = late_to_day[1] + '/' + late_to_day[0] + '/' + late_to_day[2] + ' ' + late_to_time;
	var late_to_date = new Date(late_from_day_time);


	/*
	console.log("late_from: " + late_from);
	console.log("late_from_date: " + late_from_date);
	console.log("late_to: " + late_to);
	console.log("late_to_date: " + late_to_date);
	*/

	var moment_late_from_day_time = late_from_day[2] + '-' + late_from_day[1] + '-' + late_from_day[0] + ' ' + late_from_time;
	var moment_late_to_day_time = late_to_day[2] + '-' + late_to_day[1] + '-' + late_to_day[0] + ' ' + late_to_time;
	var moment_late_from = moment(moment_late_from_day_time);
	var moment_late_to = moment(moment_late_to_day_time);

	// console.log("moment_late_from_day_time: " + moment_late_from_day_time);
	// console.log("moment_late_to_day_time: " + moment_late_to_day_time);
	
	var duration = moment.duration(moment_late_to.diff(moment_late_from));
	var hours = duration.asHours();	

	//console.log("hours:" + hours);

	$("#id_late_hour").val(hours);

});




	$("#id_late_check").change(function() {

		var now     = new Date(); 
        var year    = now.getFullYear();
        var month   = now.getMonth()+1; 
        var day     = now.getDate();
        if(month.toString().length == 1) {
             month = '0'+month;
        }
        if(day.toString().length == 1) {
             day = '0'+day;
        }   
        var dateTime = day+'/'+month+'/'+year+' '+'00:00';
		var late_date_from = dateTime;
		var late_date_to = dateTime;

		//$("#id_relief_emp_id").css('border-color','red');
		//$("#id_relief_emp_id").css('border-style','solid');

	    if(this.checked) {
	    	
	   		//$("#relief_employee_section").show();

	   		//$("#id_late_reason_option").val(56);
	   		$("#id_late_reason_option").val(1);

	   		//$("#id_late_reason_option").text("56 | มาสาย");
	   		//$("#id_shift_option").text("aa");
	   		//alert("a");

			$("#id_absent_check").prop("checked", false);

	   		$("#id_relief_emp_id").attr("disabled", false);
	   		$("#id_relief_emp_id").attr("readonly", false);

	   		$("#id_late_from").attr("disabled", false);
	   		$("#id_late_to").attr("disabled", false);
	   		$("#id_late_reason_option").attr("disabled", false);
	   		$("#id_late_hour").attr("disabled", false);
	   		$("#id_late_full_paid_check").attr("disabled", false);

			// Set Late From/To
			// var current_date = moment().format('YYYY-MM-DDTHH:mm:ss');	
			var current_date = moment().format('YYYY-MM-DD HH:mm');

			// "yyyy-MM-ddThh:mm"
			$("#id_late_from").val(late_date_from);
			$("#id_late_to").val(late_date_to);

	   		$("#id_relief_emp_id").focus();
	 		
	    } else {
	    	$("#id_relief_check").prop("checked", false);

	    	$("#id_late_reason_option").val("");

	    	$("#id_relief_emp_id").val("");
	    	$("#id_relief_emp_fullname_th").val("");
	    	$("#id_relief_emp_rank").val("");
	    	$("#id_relief_emp_dept").val("");
	    	$("#id_relief_emp_join_date").val("");
			$("#id_relief_emp_term_date").val("");
			$("#id_relief_emp_status").val("");

	   		$("#id_relief_emp_id").attr("disabled", true);
	   		$("#id_relief_emp_id").attr("readonly", true);

	   		$("#id_late_from").attr("disabled", true);
	   		$("#id_late_to").attr("disabled", true);
	   		$("#id_late_reason_option").attr("disabled", true);
	   		$("#id_late_hour").attr("disabled", true);
	   		$("#id_late_full_paid_check").attr("disabled", true);
	   		$("#id_late_full_paid_check").prop("checked", false);
	    }

	});

	$("#id_call_amount_option").change(function() {
		$("#id_call_amount_option").css('border-color','');
		$("#id_call_amount_option").css('border-style','');
	});

	$("#id_phone_check").change(function() {
		
	    if(this.checked) {
	    	/*
			var tel_man = $("#employee_list_table").find('.highlight').find('td:eq(11)').text();
			var tel_time = $("#employee_list_table").find('.highlight').find('td:eq(13)').text();
			var tel_amount = $("#employee_list_table").find('.highlight').find('td:eq(14)').text();
			*/

			var tel_man = $("#employee_list_table").find('.highlight').find('td:eq(12)').text();
			var tel_time = $("#employee_list_table").find('.highlight').find('td:eq(14)').text();
			var tel_amount = $("#employee_list_table").find('.highlight').find('td:eq(15)').text();

			$("#id_call_amount_option").css('border-color','green');
			$("#id_call_amount_option").css('border-style','solid');

			if(tel_man==1) {
				$("#id_call_time").val("{% now 'd/m/Y H:i' %}");
				$("#id_call_amount_option").val(tel_amount);
			} else {
				$("#id_call_amount_option").attr("disabled", false);
				$("#id_call_amount_option").attr("readonly", false);

				$("#id_call_time").val("{% now 'd/m/Y H:i' %}");
				$("#id_call_amount_option").val(0);
			}

			$("#id_absent_check").prop("checked", false);

			$("#id_call_amount_option").attr("readonly", false);
			$("#id_call_amount_option").attr("disabled", false);

	    } else {
	    	$("#id_call_time").val("");
	    	$("#id_call_amount_option").val(0);
			$("#id_call_amount_option").attr("disabled", true);
			$("#id_call_amount_option").attr("readonly", true);

			$("#id_call_amount_option").css('border-color','');
			$("#id_call_amount_option").css('border-style','');
	    }
	    
	});



 	function disableAllElements() {
 		$("#dailyAttendanceDataEntryForm:input").attr("disabled", true);
 		$("#dailyAttendanceDataEntryForm").trigger("reset");

 		$("#id_emp_id").attr("disabled", true);
 		$("#id_sent_spare").attr("disabled", true);

 		$("#id_shift_option").attr("disabled", true);

 		$("#emp_id_lookup_button").attr("disabled", true);
 		//$("#add_button").attr("disabled", true);
 		$("#reset_button").attr("disabled", true);
 		$("#save_button").attr("disabled", true);
 		$("#delete_button").attr("disabled", true);

 		$("#id_emp_id").attr("disabled", true);
 		$("#emp_id_lookup_button").attr("disabled", true);
		$("#id_sent_spare").attr("disabled", true);
		$("#id_shift_option").attr("disabled", true);
		$("#id_job_type_option").attr("disabled", true);
		
		$("#id_remark").attr("disabled", true);
		
		$("#id_call_section").hide();

		$("#id_late_from").attr("disabled", true);
		$("#id_late_to").attr("disabled", true);
		$("#id_late_reason_option").attr("disabled", true);
		$("#id_late_hour").attr("disabled", true);
   		$("#id_late_full_paid_check").attr("disabled", true);
   		$("#id_late_full_paid_check").prop("checked", false);
 	}

 	function enableAllElements() { 		
 		$("#dailyAttendanceDataEntryForm:input").attr("disabled", false);                              
 		
 		//$("#id_emp_id").attr("disabled", false);
 		//$("#emp_id_lookup_button").attr("disabled", false);
 		//$("#id_sent_spare").attr("disabled", false);
 		//$("#id_shift_option").attr("disabled", false); 		

 		$("#add_button").attr("disabled", false);
 		//$("#reset_button").attr("disabled", true);
 		//$("#save_button").attr("disabled", true);
 		//$("#delete_button").attr("disabled", true);

 		$("#id_absent_check").attr("disabled", false);
		$("#id_late_check").attr("disabled", false);
 		$("#id_phone_check").attr("disabled", false);
 	}

	$(document).on('keyup keypress', '#daily_attendance_search_form input[type="text"]', function(e) {
		if(e.which == 13) {
			e.preventDefault();
			return false;
	    }
	});

    $(document).on('keypress', '#id_cus_id', function(e) {
      if(e.which == 13) {      
        e.preventDefault();

        var obj = $(this);
      	var id_cus_id = obj.val();

      	if(id_cus_id!=0) {
	      	while (id_cus_id.length < 7)
	        	id_cus_id = "0" + id_cus_id;
	      	$('#id_cus_id').val(id_cus_id);

	        $('#id_cus_brn').focus();
	        $('#id_cus_brn').select();
      	} else {
      		$(this).focus();      		
      	}

      }
    });

    $(document).on('keypress', '#id_cus_brn', function(e) {
      if(e.which == 13) {      
        e.preventDefault();

      	var obj = $(this);
      	var id_cus_brn = obj.val();

      	while (id_cus_brn.length < 3) 
        	id_cus_brn = "0" + id_cus_brn;
      	
      	$('#id_cus_brn').val(id_cus_brn);

        $('#id_cus_vol').focus();
        $('#id_cus_vol').select();
      }
    });


    function create_attandance_table(employee_list, employee_leave_list) {    	
		var result = "";	
		var datatable = $('#employee_list_table').dataTable().api();		
		datatable.clear();

		if(employee_list.length>0) {
			
			day_count = 0;
			night_count = 0;
			dof_count = 0;

			result1 = "";

			for(i=0; i<employee_list.length; i++) {					
				emp_id = employee_list[i]["emp_id"];
				emp_fname_th = employee_list[i]["emp_fname_th"];
				emp_lname_th = employee_list[i]["emp_lname_th"];
				shf_type = employee_list[i]["shf_type"];
				sch_rank = employee_list[i]["sch_rank"];
				shf_desc = employee_list[i]["shf_desc"];
				absent = employee_list[i]["absent"];
				tel_status = employee_list[i]["tel_status"];
				tel_man = employee_list[i]["tel_man"];
				tel_time = employee_list[i]["tel_time"];
				tel_amt = employee_list[i]["tel_amt"];
				tel_paid = employee_list[i]["tel_paid"];
				spare = employee_list[i]["spare"];
				wage_id = employee_list[i]["wage_id"];

				upd_date = employee_list[i]["upd_date"];
				upd_date_naturalday = employee_list[i]["upd_date_naturalday"];

				upd_by = employee_list[i]["upd_by"];

				upd_flag = employee_list[i]["upd_flag"];
				upd_gen = employee_list[i]["upd_gen"];
				remark = employee_list[i]["remark"];

				relief = employee_list[i]["relief"];
				relief_id = employee_list[i]["relief_id"];							
				relief_emp_fullname_th = employee_list[i]["Remp_fname_th"] + " " + employee_list[i]["Remp_lname_th"]
				
				late_status = employee_list[i]["late"];
				late_full_status = employee_list[i]["late_full"];							
				
				ot = employee_list[i]["ot"];
				ot_reason = employee_list[i]["ot_reason"];
				ot_time_frm = employee_list[i]["ot_time_frm"];
				ot_time_to = employee_list[i]["ot_time_to"];
				ot_hr_amt = employee_list[i]["ot_hr_amt"];				
				
				update_by_user_first_name = employee_list[i]["update_by_user_first_name"];
				emp_leave_status = employee_list[i]["emp_leave_status"];

				sch_shift = employee_list[i]["sch_shift"];

		    	if(emp_leave_status==1)
					result += "    <tr class='text-danger'>";
				else
					result += "    <tr>";

				// 0. Absent status
				result += "	     <td class='d-none'>" + absent + "</td>";
				//result += "	     <td>" + absent + "</td>";
				
				// 1. Absent sign
				if(absent==1) {
					if (sch_shift=="99" || sch_shift=="999")
						result += "	     <td text-align='center' vertical-align='middle'><font size='1.8em;' style='color: #c39e2e;'><i class='fas fa-xs fa-lock'></i></font></td>";
					else
						result += "	     <td text-align='center' vertical-align='middle'><font size='1.8em;' class='text-danger'><i class='fas fa-times fa-xs'></i></font></td>";
					
				} else {
					result += "	     <td vertical-align='middle'><font size='1.8em;' class='text-success'><i class='fas fa-check fa-xs'></i></font></td>";
				}

				// 2. Ordering number
				if(shf_type=='D') {
					day_count++;
					result += "	     <td class='text-center'>" + day_count +"</td>";
				} else if(shf_type=='N') {
					night_count++;
					result += "	     <td class='text-center'>" + night_count +"</td>";
				} else if(shf_type=='O') {
					dof_count++;
					result += "	     <td class='text-center'>" + dof_count +"</td>";
				} else {
					result += "	     <td>?</td>";
				}

				// 3. Employee ID
				result += "	     <td>" + emp_id + "</td>";
			
				// 4. emp_fname_th
				result += "	     <td nowrap>" + emp_fname_th + "&nbsp;&nbsp;" + emp_lname_th + "</td>";



				// 5. sch_rank
				result += "	     <td>" + sch_rank + "</td>";

				// 6. shf_desc
				result += "	     <td nowrap>" + shf_desc + "</td>";
				
				// 7. late_status
				if(late_status)
					result += "	     <td class='text-center'><font class='text-success'><i class='fas fa-check fa-xs'></i></font></td>";
				else
					result += "	     <td>&nbsp;</td>";
				
				// 8. late_full_status
				if(late_full_status)
					result += "	     <td class='text-center'><font class='text-success'><i class='fas fa-check fa-xs'></i></font></td>";
				else
					result += "	     <td>&nbsp;</td>";

				// 9. relief_status
				if(relief)
					result += "	     <td class='text-center'><font class='text-success'><i class='fas fa-check fa-xs'></i></font></td>";
				else
					result += "	     <td>&nbsp;</td>";



				// aquaman

				// 10. relief_id
				result += "	     <td>" + relief_id + "</td>";

				// 11. relief_emp_fullname_th
				result += "	     <td nowrap>" + relief_emp_fullname_th + "</td>";

				// 12. tel_status
				result += "	     <td class='text-center d-none'>" + tel_status + "</td>";

				// 13. tel_man
				result += "	     <td class='text-center'>" + tel_man + "</td>";

				// 14. tel_time
				result += "	     <td nowrap>" + tel_time + "</td>";

				



				// 15. tel_amt
				result += "	     <td class='text-center'>" + tel_amt + "</td>";

				// 16. tel_paid
				if(tel_paid) {
					result += "	     <td class='text-center'><font size='1.83m;' class='text-success'><i class='fas fa-check fa-xs'></i></font></td>";
				} else {
					result += "	     <td>&nbsp;</td>";
				}
				

				// 17. spare
				result += "	     <td class='text-center'>" + parseInt(spare) + "</td>";

				// 18. wage_id
				result += "	     <td class='text-center'>" + wage_id + "</td>";

				// 19. upd_date
				result += "	     <td nowrap>" + upd_date + "</td>";
				


				
				// 20. upd_by
				//<a href='#'' data-toggle='tooltip' title='Some tooltip text!'>
				//result += "	     <td><a href='#'' data-toggle='tooltip' title='" + update_by_user_first_name + "'>" + upd_by + "</a></td>";
				result += "	     <td>" + upd_by + "</td>";

				// 21. upd_flag
				result += "	     <td class='text-center'>" + upd_flag + "</td>";
				




				// 22 . upd_gen
				result += "	     <td class='d-none'>" + upd_gen + "</td>";

				// 23. remark
				result += "	     <td class='d-none'>" + remark + "</td>";

				// 24. relief
				result += "	     <td class='d-none'>" + relief + "</td>";

				// 25. late_status
				result += "	     <td class='d-none'>" + late_status + "</td>";

				// 26. late_full_status
				result += "	     <td class='d-none'>" + late_full_status + "</td>";





				// 27. ot
				result += "	     <td class='d-none'>" + ot + "</td>";

				// 28 ot_reason
				result += "	     <td class='d-none'>" + ot_reason + "</td>";

				// 29. ot_time_frm
				result += "	     <td class='d-none'>" + ot_time_frm + "</td>";

				// 30. ot_time_to
				result += "	     <td class='d-none'>" + ot_time_to + "</td>";

				// 31. ot_hr_amt
				result += "	     <td class='d-none'>" + ot_hr_amt + "</td>";

				// 32. shf_type
				result += "	     <td class='d-none'>" + shf_type + "</td>";

				result += "    </tr>";
				
			
			}
		}
		else {
			//alert("b");
			//result += "    <tr class='text-center'>";
			//result += "	     <td colspan='31'><br><br>There is no data.1<br><br><br></td>";
			//result += "	   </tr>"

			result = "";
			result += "    <tr>";
			result += "      <td class='d-none'>&nbsp;</td>";
			result += "      <td>&nbsp;</td>";
			result += "      <td>&nbsp;</td>";
			result += "      <td>&nbsp;</td>";
			result += "      <td>&nbsp;</td>";
			result += "      <td>&nbsp;</td>";
			result += "      <td>&nbsp;</td>";
			result += "      <td>&nbsp;</td>";
			result += "      <td>&nbsp;</td>";
			result += "      <td>&nbsp;</td>";    
			result += "      <td>&nbsp;</td>";
			result += "      <td>&nbsp;</td>";
			result += "      <td>&nbsp;</td>";
			result += "      <td>&nbsp;</td>";
			result += "      <td>&nbsp;</td>";
			result += "      <td>&nbsp;</td>";
			result += "      <td>&nbsp;</td>";
			result += "      <td>&nbsp;</td>";
			result += "      <td>&nbsp;</td>";
			result += "      <td>&nbsp;</td>";
			result += "      <td>&nbsp;</td>";
			result += "      <td>&nbsp;</td>";
			result += "      <td class='d-none'>&nbsp;</td>";
			result += "      <td class='d-none'>&nbsp;</td>";
			result += "      <td class='d-none'>&nbsp;</td>";
			result += "      <td class='d-none'>&nbsp;</td>";
			result += "      <td class='d-none'>&nbsp;</td>";
			result += "      <td class='d-none'>&nbsp;</td>";
			result += "      <td class='d-none'>&nbsp;</td>";
			result += "      <td class='d-none'>&nbsp;</td>";
			result += "      <td class='d-none'>&nbsp;</td>";
			result += "      <td class='d-none'>&nbsp;</td>";
			result += "      <td class='d-none'>&nbsp;</td>";
			result += "    </tr>";
		}
					
		var datatable = $('#employee_list_table').dataTable().api();
		datatable.clear();		
		html = $(result.trim().replace(/\s+/g, " ").replace(/\<\/tr\> \<tr/g, '</tr><tr'));
		datatable.rows.add(html).draw();
    }

    
	// ID_CUS_VOL
    $(document).on('keypress', '#id_cus_vol', function(e) {
      if(e.which == 13) {            

      	showLoading();

        e.preventDefault();
        
    	var obj = $(this);
      	var id_cus_vol = obj.val();
      	while (id_cus_vol.length < 3)
        	id_cus_vol = "0" + id_cus_vol;

        $('#id_cus_vol').val(id_cus_vol);

        var attendance_date = $('#id_dly_date').val();
		var search_shift_option = $("#id_search_shift_option").val();
      	var cus_id = $('#id_cus_id').val();
      	var cus_brn = $('#id_cus_brn').val();
      	var cus_vol = $('#id_cus_vol').val();

		$.ajax({
			url : "/monitoring/ajax/get_attendance_information/",
			type : "POST",
			data : {
		  		csrfmiddlewaretoken: '{{ csrf_token }}',
		  		attendance_date: attendance_date,
		  		search_shift_option: search_shift_option,
		  		cus_id: cus_id,
		  		cus_brn: cus_brn,
		  		cus_vol: cus_vol,
			},
			success : function(data) {
				if(data.is_found) {
					
					// Get Schedule list info
					result = "";
					schedule_list_length = data.schedule_list.length;
					for(i=0; i<schedule_list_length; i++) {
						result += data.schedule_list[i];
					}

					// TODO
					//$('#id_schedule_option').text(result);
					/*
					result = "<div class='form-group mb-2 mt-2'>";
					result += "	<label for='id_bulk_shift_list_option'>Shift</label>&nbsp;&nbsp;";
					result += "  <select id='id_bulk_shift_list_option' class='form-control form-control-sm'>";
					result += "		<option value='1' selected>1 </option>";
					result += "	  	<option value='2'>2</option>";
					result += "  </select>";
					result += "</div>";
					$('#id_bulk_schedule_option').html(result);
					*/

					var $test = $("#id_bulk_shift_list_option");
					$test.empty();				
					$test.append($("<option></option>").attr("value", 0).text(""));
					if(data.schedule_list.length>0) {
						for(i=0; i<data.schedule_list.length; i++) {							
							shf_id = data.schedule_list[i]["shf_id"];
							shf_desc = data.schedule_list[i]["shf_desc"];
							if(shf_id=="99" || shf_id=="999") {								
								
							} else {
								$test.append($("<option></option>").attr("value", shf_id).text(shf_desc));
							}

							//alert(shf_id);
						}
					}

					// Get Attandance Employee List
					create_attandance_table(data.employee_list, data.employee_leave_list);
								
					// Show available Shift option
					var $el = $("#id_shift_option");
					$el.empty();				
					result += "<option value='0' selected></option>";
					$el.append(result);
					if(data.schedule_list.length>0) {
						for(i=0; i<data.schedule_list.length; i++) {
							shf_id = data.schedule_list[i]["shf_id"];
							shf_desc = data.schedule_list[i]["shf_desc"];
							$el.append($("<option></option>").attr("value", shf_id).text(shf_desc));
						}
					}

					// Show ot reason option
					var $el = $("#id_late_reason_option");
					$el.empty();				
					//result += "<option value='0' selected></option>";
					$el.append(result);
					if(data.ot_reason_list.length>0) {
						for(i=0; i<data.ot_reason_list.length; i++) {
							ot_res_id = data.ot_reason_list[i]["ot_res_id"];
							ot_res_th = data.ot_reason_list[i]["ot_res_th"];
							$el.append($("<option></option>").attr("value", ot_res_id).html(ot_res_id + "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| " + ot_res_th));
							//$el.append($("<option></option>").attr("value", ot_res_id).text(ot_res_th));
						}
					}


					// TOTAL
					$("#totalNDP").html(data.totalNDP);
					$("#totalNNP").html(data.totalNNP);
					$("#totalPDP").html(data.totalPDP);
					$("#totalPNP").html(data.totalPNP);

					$("#totalNDA").html(data.totalNDA);
					$("#totalNNA").html(data.totalNNA);
					$("#totalPDA").html(data.totalPDA);
					$("#totalPNA").html(data.totalPNA);


					if(data.totalNDM>=0)
						$("#totalNDM").html("<span class='text-danger'>" + data.totalNDM + "</span>");
					else
						$("#totalNDM").html("<span class='text-danger'>" + data.totalNDM + "</span>");

					if(data.totalNNM>=0)
						$("#totalNNM").html("<span class='text-danger'>" + data.totalNNM + "</span>");						
					else
						$("#totalNNM").html("<span class='text-danger'>" + data.totalNNM + "</span>");
					
					if(data.totalPDM>=0)
						$("#totalPDM").html("<span class='text-danger'>" + data.totalPDM + "</span>");						
					else
						$("#totalPDM").html("<span class='text-danger'>" + data.totalPDM + "</span>");

					if(data.totalPNM>=0)
						$("#totalPNM").html("<span class='text-danger'>" + data.totalPNM + "</span>");						
					else
						$("#totalPNM").html("<span class='text-danger'>" + data.totalPNM + "</span>");


					// Get Contract Information					
					cus_name_th = data.contract_info[0][0];
					cus_name_en = data.contract_info[0][1];
					cus_tel = data.contract_info[0][2];
					
					cus_add1_th = data.contract_info[0][6];
					cus_add2_th = data.contract_info[0][7];
					dist_th = data.contract_info[0][24];
					city_th = data.contract_info[0][26];
					country_th = data.contract_info[0][28];

					dist_en = data.contract_info[0][25];
					city_en = data.contract_info[0][27];

					site_name_th = data.contract_info[0][3];
					site_name_en = data.contract_info[0][4];
					site_cus_tel = data.contract_info[0][5];

					con_fname_th = data.contract_info[0][8];
					con_lname_th = data.contract_info[0][9];
					con_pos_th = data.contract_info[0][10];

					con_fname_en = data.contract_info[0][11];
					con_lname_en = data.contract_info[0][12];
					con_pos_en = data.contract_info[0][13];

					cnt_doc_no = data.contract_info[0][14];
					cnt_sign_frm = convertStringToDate(data.contract_info[0][15]);
					cnt_sign_to = convertStringToDate(data.contract_info[0][16]);
					cnt_eff_frm = convertStringToDate(data.contract_info[0][17]);
					cnt_eff_to = convertStringToDate(data.contract_info[0][18]);

					wage_id = data.contract_info[0][19];
					wage_en = data.contract_info[0][20];
					apr_name_en = data.contract_info[0][21];
					
					zone_id = data.contract_info[0][22];
					zone_name = data.contract_info[0][30];

					cnt_active = data.contract_info[0][23];

					

					// Get Customer Contract Service List
					// TODO
					number_of_rows = data.customer_contract_service_list.length;
					if(number_of_rows>0) {
						
						result = "<table id='id_customer_contract_service'>";
						result += "  <thead class=thead-light>";
						result += "    <tr>";
						result += "      <th scope='col'>No</th>";
						result += "      <th scope='col'>Rank</th>";
						result += "      <th scope='col'>Shift</th>";
						result += "      <th scope='col'>QTY</th>";
						result += "      <th scope='col'>Eff.Frm</th>";
						result += "      <th scope='col'>Eff.To</th>";
						result += "      <th scope='col'>MON</th>";
						result += "      <th scope='col'>TUE</th>";
						result += "      <th scope='col'>WED</th>";
						result += "      <th scope='col'>THU</th>";
						result += "      <th scope='col'>FRI</th>";
						result += "      <th scope='col'>SAT</th>";
						result += "      <th scope='col'>SUN</th>";
						result += "      <th scope='col'>PUB</th>";
						result += "      <th scope='col'>Status</th>";
						result += "      <th scope='col'>Remark</th>";
						result += "      <th scope='col'>Upd.Date</th>";
						result += "      <th scope='col'>Upd.By</th>";
						result += "      <th scope='col'>Upd.Flag</th>";
						result += "    </tr>";
						result += "  </thead>";
						result += "  <tbody>";
						count = 1;

						result = "";
						for(i=0; i<number_of_rows; i++) {
							srv_rank = data.customer_contract_service_list[i][19];
							shift = data.customer_contract_service_list[i][39];
							srv_eff_frm = convertStringToDate(data.customer_contract_service_list[i][21]);
							srv_eff_to = convertStringToDate(data.customer_contract_service_list[i][22]);
							srv_qty = data.customer_contract_service_list[i][23];							
							srv_mon = data.customer_contract_service_list[i][24];
							srv_tue = data.customer_contract_service_list[i][25];
							srv_wed = data.customer_contract_service_list[i][26];
							srv_thu = data.customer_contract_service_list[i][27];
							srv_fri = data.customer_contract_service_list[i][28];
							srv_sat = data.customer_contract_service_list[i][29];
							srv_sun = data.customer_contract_service_list[i][30];
							srv_pub = data.customer_contract_service_list[i][31];
							srv_active = data.customer_contract_service_list[i][48];
							remark = data.customer_contract_service_list[i][34];
							upd_date = convertStringToDate(data.customer_contract_service_list[i][70]);
							upd_by = data.customer_contract_service_list[i][71];
							upd_flag = data.customer_contract_service_list[i][72];

							result += "<tr>";
							result += "<td class='text-center'>" + count + "</td>";
							result += "<td class='text-center'>" + srv_rank + "</td>";
							result += "<td><b>" + shift + "</b></td>";
							result += "<td class='text-center'>" + srv_qty + "</td>";
							result += "<td>" + srv_eff_frm + "</td>";
							result += "<td>" + srv_eff_to + "</td>";
							result += "<td class='text-center'>" + srv_mon + "</td>";
							result += "<td class='text-center'>" + srv_tue + "</td>";
							result += "<td class='text-center'>" + srv_wed + "</td>";
							result += "<td class='text-center'>" + srv_thu + "</td>";
							result += "<td class='text-center'>" + srv_fri + "</td>";
							result += "<td class='text-center'>" + srv_sat + "</td>";
							result += "<td class='text-center'>" + srv_sun + "</td>";
							result += "<td class='text-center'>" + srv_pub + "</td>";

							//result += "<td>" + srv_active + "</td>";
							if(srv_active)
								result += "<td><span class='badge badge-success'>Active</span></td>";
							else
								result += "<td><span class='badge badge-secondary'>Inactive</span></td>";

							result += "<td>" + remark + "</td>";
							result += "<td>" + upd_date + "</td>";
							result += "<td>" + upd_by + "</td>";
							result += "<td>" + upd_flag + "</td>";
							result += "</tr>";
							count++;
						}
						
						//result += "  </tbody>";
						//result += "</table>";
						//$("#id_customer_contract_service").html(result);
						
						customer_contract_service_table.destroy();
						$('#id_customer_contract_service tbody').empty().append(result);						
						customer_contract_service_table = $('#id_customer_contract_service').DataTable({
							"paging": false,
							"scrollCollapse": true,
							"lengthChange": false,
							"searching": false,
							"ordering": true,
							"info": false,
							"autoWidth": true,
						}); 
						
					}

					
					// Get Customer Schedule List
					number_of_rows = data.customer_schedule_list.length;
					if(number_of_rows>0) {
						result = "<table id='id_customer_schedule_list'>";
						result += "  <thead class=thead-light>";
						result += "    <tr>";
						result += "      <th scope='col' class='text-center'>No</th>";
						result += "      <th scope='col' nowrap>Emp ID</th>";
						result += "      <th scope='col'>Name</th>";
						result += "      <th scope='col' class='text-center'>Rank</th>";
						result += "      <th scope='col' nowrap>Eff.Frm</th>";
						result += "      <th scope='col'>Eff.To</th>";
						result += "      <th scope='col' class='text-center'>MON</th>";
						result += "      <th scope='col' class='text-center'>TUE</th>";
						result += "      <th scope='col' class='text-center'>WED</th>";
						result += "      <th scope='col' class='text-center'>THU</th>";
						result += "      <th scope='col' class='text-center'>FRI</th>";
						result += "      <th scope='col' class='text-center'>SAT</th>";
						result += "      <th scope='col' class='text-center'>SUN</th>";
						result += "      <th scope='col' nowrap>Status</th>";
						result += "      <th scope='col' nowrap>Upd.Date</th>";
						result += "      <th scope='col' nowrap>Upd.By</th>";
						result += "    </tr>";
						result += "  </thead>";
						result += "  <tbody>";
						count = 1;
						for(i=0; i<number_of_rows; i++) {
							emp_id = data.customer_schedule_list[i][3];
							emp_fullname_th = data.customer_schedule_list[i][19] + " " + data.customer_schedule_list[i][20];
							emp_rank = data.customer_schedule_list[i][4];
							emp_eff_frm = convertStringToDate(data.customer_schedule_list[i][6]);
							emp_eff_to = convertStringToDate(data.customer_schedule_list[i][7]);
							emp_mon = data.customer_schedule_list[i][8];
							emp_tue = data.customer_schedule_list[i][9];
							emp_wed = data.customer_schedule_list[i][10];
							emp_thu = data.customer_schedule_list[i][11];
							emp_fri = data.customer_schedule_list[i][12];
							emp_sat = data.customer_schedule_list[i][13];
							emp_sun = data.customer_schedule_list[i][14];
							status = data.customer_schedule_list[i][15];
							upd_date = convertStringToDate(data.customer_schedule_list[i][16]);
							upd_by = data.customer_schedule_list[i][17];


							result += "<tr>";
							result += "<td class='text-center'>" + count + "</td>";

							//result += "<td>" + emp_id + "</td>";
							if(status=="true")
								result += "<td>" + emp_id + "</td>";
							else
								result += "<td>" + emp_id + "</td>";

							//result += "<td>" + emp_fullname_th + "</td>";
							if(status=="true")
								result += "<td>" + emp_fullname_th + "</td>";
							else
								result += "<td>" + emp_fullname_th + "</td>";

							result += "<td class='text-center'>" + emp_rank + "</td>";						
							result += "<td>" + emp_eff_frm + "</td>";
							result += "<td>" + emp_eff_to + "</td>";							


							//result += "<td>" + emp_mon + "</td>";
							if (emp_mon==99) {
								if(status=="true")
									result += "<td class='text-danger text-center'><b>DOF</b></td>";
								else
									result += "<td class='text-center'>DOF</td>";
							}
							else
								result += "<td class='text-center'>" + emp_mon + "</td>";


							//result += "<td>" + emp_tue + "</td>";
							if (emp_tue==99) {
								if(status=="true")
									result += "<td class='text-danger text-center'><b>DOF</b></td>";
								else
									result += "<td class='text-center'>DOF</td>";
							}
							else
								result += "<td class='text-center'>" + emp_tue + "</td>";


							//result += "<td>" + emp_wed + "</td>";
							if (emp_wed==99) {
								if(status=="true")
									result += "<td class='text-danger text-center'><b>DOF</b></td>";
								else
									result += "<td class='text-center'>DOF</td>";
							}
							else
								result += "<td class='text-center'>" + emp_wed + "</td>";


							//result += "<td>" + emp_thu + "</td>";
							if (emp_thu==99) {
								if(status=="true")
									result += "<td class='text-danger text-center'><b>DOF</b></td>";
								else
									result += "<td class='text-center'>DOF</td>";
							}
							else
								result += "<td class='text-center'>" + emp_thu + "</td>";


							//result += "<td>" + emp_fri + "</td>";
							if (emp_fri==99) {
								if(status=="true")
									result += "<td class='text-danger text-center'><b>DOF</b></td>";
								else
									result += "<td class='text-center'>DOF</td>";
							}
							else
								result += "<td class='text-center'>" + emp_fri + "</td>";


							//result += "<td>" + emp_sat + "</td>";
							if (emp_sat==99) {
								if(status=="true")
									result += "<td class='text-danger text-center'><b>DOF</b></td>";
								else
									result += "<td class='text-center'>DOF</td>";
							}
							else
								result += "<td class='text-center'>" + emp_sat + "</td>";


							//result += "<td>" + emp_sun + "</td>";
							if (emp_sun==99) {
								if(status=="true")
									result += "<td class='text-danger text-center'><b>DOF</b></td>";
								else
									result += "<td class='text-center'>DOF</td>";
							}
							else
								result += "<td class='text-center'>" + emp_sun + "</td>";							


							if(status=="true" && status=="true")
								result += "<td><span class='badge badge-success'>Active</span></td>";
							else
								result += "<td><span class='badge badge-secondary'>Inactive</span></td>";

							result += "<td>" + upd_date + "</td>";
							result += "<td>" + upd_by + "</td>";

							result += "</tr>";
							count++;
						}
						result += "  </tbody>";
						result += "</table>";
					} else {
						result = "<table class=table table-sm'>";
						result += "<tr><td>No information.</td><tr>";
						result += "</table>";
					}
					$("#id_customer_schedule_list").html(result);



					$("#id_customer_name_th").val(cus_name_th);
					$("#id_customer_name_en").text(cus_name_en);
					$("#id_customer_phone").val(cus_tel);
					$("#id_customer_wage_rate").val(wage_id + " | " + wage_en);

					if(cnt_active=="1") {					
						result = "<button type='button' class='btn btn-sm btn-success'>Active</button>";
					} else {
						result = "<button type='button' class='btn btn-sm btn-danger'>Pending</button>";
					}
					$("#id_cnt_active").html(result);

					$("#id_site_customer_name_th").val(site_name_th);
					$("#id_site_customer_name_en").html(site_name_en);
					$("#id_site_customer_phone").val(site_cus_tel);
					$("#id_authorized_by").val(apr_name_en);

					$("#id_customer_zone").val(zone_id + " | " + zone_name);
										
					$("#id_cus_add1_th").val(cus_add1_th + " " + cus_add2_th + " " + dist_th + " " + city_th + " " + country_th);					
					
					$("#id_cnt_doc_no").val(cnt_doc_no);
					$("#id_cnt_sign_frm").val(cnt_sign_frm);
					$("#id_cnt_sign_to").val(cnt_sign_to);
					$("#id_cnt_eff_frm").val(cnt_eff_frm);
					$("#id_cnt_eff_to").val(cnt_eff_to);					
					
					$("#con_fname_th").val(con_fname_th + " " + con_lname_th);
					$("#con_pos_th").val(con_pos_th);

                	$("#id_customer_wage_rate_id").val(wage_id);
                	$("#id_customer_zone_id").val(zone_id);
					//$("#").val();

					$("#daily_attendance_search_form :input").attr("disabled", true);				
					$("#cancelDailyAttendanceButton").removeAttr("disabled");

					$("#tab2-tab").text(cus_name_th);
									
					
					if(data.allow_crud) {
						$('#id_crud_button').css('visibility', 'visible');
					} else {
						$('#id_crud_button').css('visibility', 'hidden');
					}
												
					$.LoadingOverlay("hide");
				} else {


					error_message = data.message

					$.alert({
					    title: 'Error',
					    type: 'red',
					    content: error_message,
					    animation: 'zoom',
					    animationBounce: 1.5,
					    closeIcon: false,
					    boxWidth: '38%',
					    useBootstrap: false,
					});


					// TODO	
					result = "";
					result += "    <tr>";
					result += "      <td class='d-none'>&nbsp;</td>";
					result += "      <td>&nbsp;</td>";
					result += "      <td>&nbsp;</td>";
					result += "      <td>&nbsp;</td>";
					result += "      <td>&nbsp;</td>";
					result += "      <td>&nbsp;</td>";
					result += "      <td>&nbsp;</td>";
					result += "      <td>&nbsp;</td>";
					result += "      <td>&nbsp;</td>";
					result += "      <td>&nbsp;</td>";    
					result += "      <td>&nbsp;</td>";
					result += "      <td>&nbsp;</td>";
					result += "      <td>&nbsp;</td>";
					result += "      <td>&nbsp;</td>";
					result += "      <td>&nbsp;</td>";
					result += "      <td>&nbsp;</td>";
					result += "      <td>&nbsp;</td>";
					result += "      <td>&nbsp;</td>";
					result += "      <td>&nbsp;</td>";
					result += "      <td>&nbsp;</td>";
					result += "    </tr>";

					$("#id_employee_list tbody").html(result);
					
					$('#employee_search_text').val("");
					var table = $('#employee_list_table').DataTable();		
					table.search($('#employee_search_text').val()).clear().draw();




					/*
					$.alert({
					    title: 'Error',
					    type: 'red',
					    content: "No attendance schedule is available on <strong>" + attendance_date + "</strong><br>Please contact your supervisor to generate the schedule first.",
					    animation: 'zoom',
					    animationBounce: 1.5,
					    closeIcon: false,
					    boxWidth: '38%',
					    useBootstrap: false,
					});
					*/

					$.LoadingOverlay("hide");			
				}
			}
		});

		//$.LoadingOverlay("hide");
      	
      }
    });


	function convertStringToDate(strdate) {
		var new_date = ""
		var new_date_temp = new Date(strdate);
		var dd = String(new_date_temp.getDate()).padStart(2, '0');
		var mm = String(new_date_temp.getMonth() + 1).padStart(2, '0');
		var yyyy = new_date_temp.getFullYear();
		new_date = dd + '/' + mm + '/' + yyyy;

		return new_date;
	}

	/*
    $(document).on('keypress', '#id_emp_id', function(e) {
      if(e.which == 13) {      
        e.preventDefault();
        alert("emp_id keypress");
      }
    });
	*/

	$(document).on('keypress', '#id_emp_id', function(e) {
		if(e.which == 13) {      
			e.preventDefault();

			cus_id = $('#id_cus_id').val();
			cus_brn = $('#id_cus_brn').val();
			cus_vol = $('#id_cus_vol').val();
			emp_id = $(this).val();
			shift_id = $("#id_shift_option").val();

			if(cus_id=="") {
				alert("Please entet Customer ID.");
				$('#id_cus_id').focus();				
				return false;
			}

			if(cus_brn=="") {
				alert("Please entet Customer Branch.");
				$('#id_cus_brn').focus();
				return false;			
			}

			if(cus_vol=="") {
				alert("Please entet Customer Volume.");
				$('#id_cus_vol').focus();
				return false;
			}
		
			if(emp_id=="") {
				/*
			  	$(document).Toasts('create', {
			    	class: "bg-danger", 
			    	title: "{% trans 'Error' %}",
			    	subtitle: '',
			    	autohide: true,
			    	delay: 2000,
			    	body: "Please select Employee ID&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;",
			    	autoDismiss: true,
			    	close: true,
			    	autoremove: true,
			  	});
			  	*/

				$.alert({
				    title: 'Error',
				    type: 'red',
				    content: "Please select Employee ID&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;",
				    animation: 'zoom',
				    animationBounce: 1.5,
				    closeIcon: false,
				    boxWidth: '38%',
				    useBootstrap: false,
				});

	    		$("#id_emp_id").focus();
			} else {
				
				showLoading();

				$.ajax({
			    	url : "/monitoring/ajax/get_employee",
			    	type : "GET",
			    	data : {          
			      		csrfmiddlewaretoken: '{{ csrf_token }}',
			      		emp_id: emp_id,
			      		shift_id: shift_id,
			      		cus_id: cus_id,
			      		cus_brn: cus_brn,
			      		cus_vol: cus_vol,

			    	},
			    	success: function(data) {
						$("#id_emp_name_th").val("");
		    			$("#id_emp_rank").val("");
		    			$("#id_emp_dept").val("");
		    			$("#id_emp_status").val("");
		    			$("#id_emp_join_date").val("");
		    			$("#id_emp_term_date").val("");

			    		/*		    			
			    		$("#id_emp_name_th").css("background-color", '');
			    		$("#id_emp_name_th").animate({color:''}, 1000);
			    		$("#employeePhoto").html("<img src='/static/img/profile-128x128.png' width='90px;'' />");
						*/

			    		if(data.is_found) {
			    			$("#id_emp_fullname_th").val(data.emp_fname_th.trim() + "  " + data.emp_lname_th.trim());
							$("#id_emp_rank").val(data.emp_rank);
			    			$("#id_emp_dept").val(data.emp_dept);
			    			$("#id_emp_status").val(data.emp_status);
			    			$("#id_emp_join_date").val(data.emp_join_date);

			    			/*
			    			$("#id_emp_term_date").val(data.emp_term_date);
			    			if(data.emp_status_id=='9') {		    				
				    			$("#id_emp_status").animate({color:'red'}, 1000);
			    			} else {
			    				$("#id_emp_status").animate({color:'#495057'}, 1000);
			    			}
			    			*/
			    			
			    			// batman
			    			if (data.emp_term_date!="") {
				    			$("#id_emp_term_date").val(data.emp_term_date);
				    			$("#id_emp_status").val(data.emp_status);

				    			$('#id_emp_status').css('border-color', 'red');
				    			$('#id_emp_status').css('background-color', '#e4cdcf');
								

			    			} else {
				    			$("#id_emp_term_date").val(data.emp_term_date);
				    			$("#id_emp_status").val(data.emp_status);

				    			$('#id_emp_status').css('border-color', '');		    			
				    			$('#id_emp_status').css('background-color', '');
				    			$('#id_relief_emp_status').css('border-color', '');
								$('#id_relief_emp_status').css('background-color', '');
			    			}


			    			$("#save_button").attr("disabled", false);
			    			$("#delete_button").attr("disabled", true);

			    			$("#id_phone_check").attr("disabled", false);

			    			/*
							$("#employeePhoto").html("<img src='data:image/png;base64," + data.employee_photo + "' style='width:90px;'/>");
			    			$("#id_emp_name_th").val(data.emp_fname_th.trim() + "  " + data.emp_lname_th.trim());
			    			$("#id_emp_rank").val(data.emp_rank);
			    			$("#id_emp_dept").val(data.emp_type);
				    		$("#id_emp_name_th").css("background-color", 'green');
				    		$("#id_emp_name_th").animate({color:'white'}, 1000);
				    		*/
			    		} else {
			    			/*
						  	$(document).Toasts('create', {
						    	class: "bg-danger", 
						    	title: "{% trans 'Error' %}",
						    	subtitle: '',
						    	autohide: true,
						    	delay: 2000,
						    	body: "Employee ID not found.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;",
						    	autoDismiss: true,
						    	close: true,
						    	autoremove: true,
						  	});
						  	*/

							$('#id_emp_status').css('border-color', '');
				    		$('#id_emp_status').css('background-color', '');
				    		$('#id_relief_emp_status').css('border-color', '');
							$('#id_relief_emp_status').css('background-color', '');

							$.alert({
							    title: 'Error',
							    type: 'red',
							    content: "Employee ID not found.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;",
							    animation: 'zoom',
							    animationBounce: 1.5,
							    closeIcon: false,
							    boxWidth: '38%',
							    useBootstrap: false,
							});



			    		}

			    		//showLoading();
			    		$.LoadingOverlay("hide");
			    		$("#id_emp_id").select();
			    	},
			    });
			}		
		}
	});

	
	$(document).on('keypress', '#id_relief_emp_id', function(e) {

		$("#id_relief_check").prop("checked", true);
		$('#id_relief_emp_status').css('border-color', '');
		$('#id_relief_emp_status').css('background-color', '');
		$("#id_relief_emp_id").css('border-color','');
		$("#id_relief_emp_id").css('border-style','');

		if(e.which == 13) {
			e.preventDefault();

			cus_id = $('#id_cus_id').val();
			cus_brn = $('#id_cus_brn').val();
			cus_vol = $('#id_cus_vol').val();
			emp_id = $('#id_emp_id').val();	
			shift_id = $("#id_shift_option").val();

	    	var relief_status = 0;
	    	if($("#id_relief_check").is(":checked")) {	    		
	    		relief_status = 1;
	    		relief_emp_id = $(this).val();
	    	} else {
	    		relief_emp_id = null;
	    	}

	    	//alert(relief_status);

			if(cus_id=="") {
				alert("Please entet Customer ID.");
				$('#id_cus_id').focus();				
				return false;
			}

			if(cus_brn=="") {
				alert("Please entet Customer Branch.");
				$('#id_cus_brn').focus();
				return false;			
			}

			if(cus_vol=="") {
				alert("Please entet Customer Volume.");
				$('#id_cus_vol').focus();
				return false;
			}
		
			if(relief_emp_id=="") {
				/*
			  	$(document).Toasts('create', {
			    	class: "bg-danger", 
			    	title: "{% trans 'Error' %}",
			    	subtitle: '',
			    	autohide: true,
			    	delay: 2000,
			    	body: "กรุณาป้อนรหัสพนักงานลงเวรแทน&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;",
			    	autoDismiss: true,
			    	close: true,
			    	autoremove: true,
			  	});    		
	    		*/

				$.alert({
				    title: 'Error',
				    type: 'red',
				    content: "กรุณาป้อนรหัสพนักงานลงเวรแทน&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;",
				    animation: 'zoom',
				    animationBounce: 1.5,
				    closeIcon: false,
				    boxWidth: '38%',
				    useBootstrap: false,
				});

	    		$("#id_relief_emp_id").focus();
	    		return false;

			} else {
				
				if(emp_id==relief_emp_id) {
				  	$(document).Toasts('create', {
				    	class: "bg-danger", 
				    	title: "{% trans 'Error' %}",
				    	subtitle: '',
				    	autohide: true,
				    	delay: 2000,
				    	body: "เลือกรหัสพนักงานลงเวรแทนไม่ถูกต้อง&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;",
				    	autoDismiss: true,
				    	close: true,
				    	autoremove: true,
				  	});    		
		    		$("#id_relief_emp_id").focus();
		    		return false;
				}

				showLoading();

				$.ajax({
			    	url : "/monitoring/ajax/get_employee",
			    	type : "GET",
			    	data : {          
			      		csrfmiddlewaretoken: '{{ csrf_token }}',
			      		emp_id: emp_id,
			      		shift_id: shift_id,
			      		cus_id: cus_id,
			      		cus_brn: cus_brn,
			      		cus_vol: cus_vol,
			      		relief_status: relief_status,
			      		relief_emp_id: relief_emp_id
			    	},
			    	success: function(data) {

						$("#id_relief_emp_fullname_th").val("");
		    			$("#id_relief_emp_rank").val("");
		    			$("#id_relief_emp_dept").val("");
		    			$("#id_relief_emp_status").val("");
		    			$("#id_relief_emp_join_date").val("");
		    			$("#id_relief_emp_term_date").val("");
			    	
			    		if(data.is_found) {			    			
			    			$("#id_relief_emp_fullname_th").val(data.emp_fname_th.trim() + "  " + data.emp_lname_th.trim());
							$("#id_relief_emp_rank").val(data.emp_rank);
			    			$("#id_relief_emp_dept").val(data.emp_dept);
			    			$("#id_relief_emp_status").val(data.emp_status_id + " | " + data.emp_status);

			    			if(data.emp_status_id=='9') {		    				
				    			$("#id_relief_emp_status").animate({color:'red'}, 1000);
			    			} else {
			    				$("#id_relief_emp_status").animate({color:'#495057'}, 1000);
			    			}

			    			$("#id_relief_emp_join_date").val(data.emp_join_date);
			    			$("#id_relief_emp_term_date").val(data.emp_term_date);

			    			$("#save_button").attr("disabled", false);
			    			$("#delete_button").attr("disabled", true);
			    		
			    			$("#id_relief_check").prop("checked", true);

			    			if(data.emp_status_id!='2') {
			    				$('#id_relief_emp_status').css('border-color', 'red');
			    				$('#id_relief_emp_status').css('background-color', '#e4cdcf');
			    			}

			    		} else {
			    			/*
						  	$(document).Toasts('create', {
						    	class: "bg-danger", 
						    	title: "{% trans 'Error' %}",
						    	subtitle: '',
						    	autohide: true,
						    	delay: 2000,
						    	body: data.message,
						    	autoDismiss: true,
						    	close: true,
						    	autoremove: true,
						  	});
							*/

							$.alert({
							    title: 'Error',
							    type: 'red',
							    content: data.message,
							    animation: 'zoom',
							    animationBounce: 1.5,
							    closeIcon: false,
							    boxWidth: '38%',
							    useBootstrap: false,
							});

			    		}

			    		//showLoading();
			    		$.LoadingOverlay("hide");
			    					    		
			    		if($("#id_late_check").is(":checked")) {
			    			//$("#id_late_from").focus();
			    		}
			    		else {
			    			$("#id_relief_emp_id").focus();
			    			$("#id_relief_emp_id").select();
			    		}			    		
			    	},

			    });
			}

			
		}
	});



	$('#id_dly_date').datepicker({format: 'dd/mm/yyyy', altField: '#thealtdate', altFormat: 'dd/mm/yyyy', autoclose: true, todayHighlight: true}).datepicker("setDate", new Date());
	
	$("input:radio[name='searchOptions']").change(function(){
		var _val = $(this).val();
		if(_val==1) {
			// Search by Contract ID
			$("#id_cus_id").focus();		
			$("#id_cus_id").attr("readonly", false);
			$("#id_cus_brn").attr("readonly", false);
			$("#id_cus_vol").attr("readonly", false);

			$("#id_emp_id").attr("readonly", true);
		} else {
			// Search by Employee ID
			$("#id_emp_id").focus();
			$("#id_emp_id").attr("readonly", false);
			$("#id_cus_id").attr("readonly", true);
			$("#id_cus_brn").attr("readonly", true);
			$("#id_cus_vol").attr("readonly", true);
		}
	});


	function showLoading() {
		$.LoadingOverlaySetup({
		    background      : "rgba(0, 0, 0, 0.5)",
		    image           : "/static/img/logo-small.png",
		    imageAnimation  : "1.5s fadein",
		    imageColor      : "#ffcc00"
		});
		$.LoadingOverlay("show");	
	}


    $(document).on('click', '#id_absent_check', function(e) {
    	//alert("click absent checkbox");
    });

    $(document).on('click', '#id_late_check', function(e) {
		// alert("click late checkbox");
    });
    
    // ID_PHONE_CHECK
    $(document).on('click', '#id_phone_check', function(e) {
    	/*
		var tel_man = $("#employee_list_table").find('.highlight').find('td:eq(11)').text();
		var tel_time = $("#employee_list_table").find('.highlight').find('td:eq(13)').text();
		var tel_amount = $("#employee_list_table").find('.highlight').find('td:eq(14)').text();
		*/

		var tel_man = $("#employee_list_table").find('.highlight').find('td:eq(12)').text();
		var tel_time = $("#employee_list_table").find('.highlight').find('td:eq(14)').text();
		var tel_amount = $("#employee_list_table").find('.highlight').find('td:eq(15)').text();

		if($("#id_phone_check").is(":checked"))
			$("#id_phone_check").prop("checked", true);
		else
			$("#id_phone_check").prop("checked", false);

		if(tel_man==1) {
			$("#id_call_time").val(tel_time);
			$("#id_call_amount_option").val(tel_amount);
		} 
    });

    $(document).on('click', '#id_relief_check', function(e) {
    	if($("#id_relief_check").is(":checked")) {
    		relief_status = 1;

    		$("#id_relief_emp_id").attr("disabled", false);
    		$("#id_relief_emp_id").attr("readonly", false);
    		$("#relief_emp_id_lookup_button").attr("disabled", false);
    		$("#id_relief_emp_id").focus();
    	}
    	else {
    		//alert("uncheck");
    		relief_status = 0;

    		$("#id_relief_emp_id").attr("disabled", true);
    		$("#id_relief_emp_id").attr("readonly", false);
    		$("#relief_emp_id_lookup_button").attr("disabled", true);

    		$("#id_relief_emp_id").val("");
    		$("#id_relief_emp_fullname_th").val("");
    		$("#id_relief_emp_rank").val("");
    		$("#id_relief_emp_dept").val("");
    		$("#id_relief_emp_join_date").val("");
    		$("#id_relief_emp_term_date").val("");
    		$("#id_relief_emp_status").val("");

			$("#id_relief_emp_id").css('border-color','');
			$("#id_relief_emp_id").css('border-style','');    		
    	}

    	//alert("click relief");
    	//$("#id_absent_check").prop("checked", true);

    });

    function clearEmployeeListTable() {    	
    	/*
		result = "";
		result += "    <tr>";
		result += "      <td class='d-none'>&nbsp;</td>";
		result += "      <td>&nbsp;</td>";
		result += "      <td>&nbsp;</td>";
		result += "      <td>&nbsp;</td>";
		result += "      <td>&nbsp;</td>";
		result += "      <td>&nbsp;</td>";
		result += "      <td>&nbsp;</td>";
		result += "      <td>&nbsp;</td>";
		result += "      <td>&nbsp;</td>";
		result += "      <td>&nbsp;</td>";    
		result += "      <td>&nbsp;</td>";
		result += "      <td>&nbsp;</td>";
		result += "      <td>&nbsp;</td>";
		result += "      <td>&nbsp;</td>";
		result += "      <td>&nbsp;</td>";
		result += "      <td>&nbsp;</td>";
		result += "      <td>&nbsp;</td>";
		result += "      <td>&nbsp;</td>";
		result += "      <td>&nbsp;</td>";
		result += "      <td>&nbsp;</td>";
		result += "    </tr>";

		$("#id_employee_list tbody").html(result);
		*/

		//$('#employee_search_text').val("");
		//var table = $('#employee_list_table').DataTable();		
		//table.search($('#employee_search_text').val()).clear().draw();
		//table.clear();
		//table.draw();
		

		//$('#employee_list_table').dataTable().fnClearTable();
		$('#employee_list_table').DataTable().clear().draw();
    }



    // ClickRow
	$(document).on('click', '#employee_list_table tbody tr', function(row, $el, field) {		
		var today = new Date();
		var date = today.getDate() + "/" + today.getMonth() + '/' + today.getFullYear() + " 00:00";

		$("#id_relief_emp_fullname_th").val("");
		$("#id_relief_emp_rank").val("");
		$("#id_relief_emp_dept").val("");
		$("#id_relief_emp_status").val("");
		$("#id_relief_emp_join_date").val("");
		$("#id_relief_emp_term_date").val("");

		$("#id_relief_check").prop("checked", false);

		$('#id_relief_emp_id').val(null);
		$('#id_relief_emp_id').attr("disabled", true);
		$('#relief_emp_id_lookup_button').attr("disabled", true);
		$("#id_add_new_record_status").val(0);


		$("#id_emp_id").attr("disabled", true);
		//$("#id_late_check").hide();
		//$("#id_late_check").next("label").hide();
		//$("#id_phone_check").hide();
		//$("#id_phone_check").next("label").hide();

		// Clear red highlight textbox
		$("#id_relief_emp_id").css('border-color','');
		$("#id_relief_emp_id").css('border-style','');		
		$("#id_call_amount_option").css('border-color','');
		$("#id_call_amount_option").css('border-style','');
		$("#id_shift_option").css('border-color','');
		$("#id_shift_option").css('border-style','');

		$('#id_emp_status').css('border-color', '');
		$('#id_emp_status').css('background-color', '');

		$('#id_relief_emp_status').css('border-color', '');
		$('#id_relief_emp_status').css('background-color', '');

		$("#id_bulk_shift_list_option").css('border-color', '');
		$("#id_bulk_shift_list_option").css('background-color', '');
		$("#id_bulk_shift_list_option").css('border-style', '');

		var cus_id = $("#id_cus_id").val();
		var cus_brn = $("#id_cus_brn").val();
		var cus_vol = $("#id_cus_vol").val();

		var absent_status = $(this).find('td:eq(0)').text();
		//var late_status = $(this).find('td:eq(25)').text();
		//var tel_status = $(this).find('td:eq(12)').text();			
		var late_status = $(this).find('td:eq(26)').text();
		var tel_status = $(this).find('td:eq(12)').text();		
		// aquaman
		
		if($("#id_absent_check").is(":checked"))
			var ui_absent_status = 1;
		else
			var ui_absent_status = 0;

		if($("#id_late_check").is(":checked"))
			var ui_late_status = 1;
		else
			var ui_late_status = 0;

		if($("#id_phone_check").is(":checked"))
			var ui_tel_status = 1;
		else
			var ui_tel_status = 0;

		var emp_id = $(this).find('td:eq(3)').text();
		var emp_fullname_th = $(this).find('td:eq(4)').text();
		var sch_rank = $(this).find('td:eq(5)').text();
		var shf_desc = $(this).find('td:eq(6)').text();	
		var shift_id =  parseInt(shf_desc.substring(0,4));
		var upd_gen = $(this).find('td:eq(22)').text();
		var remark = $(this).find('td:eq(23)').text();
		var tel_time = $(this).find('td:eq(14)').text();
		var tel_amount = $(this).find('td:eq(15)').text();	
		var tel_paid = $(this).find('td:eq(16)').text();
		var relief_status = $(this).find('td:eq(24)').text();
		var relief_emp_id = $(this).find('td:eq(10)').text();
		var relief_emp_fullname_th = $(this).find('td:eq(11)').text();
		var late_full_status = $(this).find('td:eq(26)').text();
		var ot_reason = $(this).find('td:eq(28)').text();
		var ot_time_from = $(this).find('td:eq(29)').text();		
		var ot_time_to = $(this).find('td:eq(30)').text();
		var ot_hour_amount = $(this).find('td:eq(31)').text();

		var today = new Date();
		var dd = String(today.getDate()).padStart(2, '0');
		var mm = String(today.getMonth() + 1).padStart(2, '0');
		var yyyy = today.getFullYear();
		today = dd + '/' + mm + '/' + yyyy + " 00:00";

		if(shift_id==999 || shift_id==99) {			
			$("#save_button").attr("disabled", true);

			// Clear checkbox
			$("#id_absent_check").attr("disabled", true);
			$("#id_absent_check").prop("checked", false);
			$("#id_late_check").attr("disabled", true);
			$("#id_phone_check").attr("disabled", true);

			// Clear textbox
			$("#id_emp_id").val("");
			$("#id_emp_fullname_th").val("");
			$("#id_emp_rank").val("");
			$("#id_emp_dept").val("");
			$("#id_emp_join_date").val("");
			$("#id_emp_term_date").val("");
			$("#id_emp_status").val("");

			// Clear dropdown
			$("#id_shift_option").val(0);
			$("#id_late_reason_option").val(0);
			$("#id_job_type_option").val(0);

			if(upd_gen=='G') {
				$("#delete_button").attr("disabled", true);

				$("#id_relief_check").attr('disabled', true);					
				$("#id_relief_emp_id").attr('disabled', true);
			}
			else {
				$("#delete_button").attr("disabled", false);
			}

			$("#id_shift_option").attr("disabled", true);			
			$("#id_remark").attr("disabled", false);
			$("#id_remark").attr("readonly", false);

			//$(this).addClass('highlight').siblings().removeClass('highlight');\
			return false;

		} else {
			// Checkbox
			$("#id_relief_check").attr("disabled", false);

			$("#id_absent_check").attr("disabled", false);
			$("#id_absent_check").prop("checked", false);
			$("#id_late_check").attr("disabled", false);
			$("#id_late_check").prop("checked", false);
			$("#id_phone_check").attr("disabled", false);
			$("#id_phone_check").prop("checked", false);		
		}

		$("#emp_id_lookup_button").attr("disabled", true);

		$("#id_emp_fullname_th").val(emp_fullname_th);
		$("#id_emp_id").val(emp_id);
		$("#id_emp_rank").val(sch_rank);
		$("#id_remark").val(remark);		

			
		if(relief_status==1) {
			if(absent_status==1) {
				$("#id_relief_check").prop("checked", true);
			} else {
				$("#id_relief_check").prop("checked", false);
				$("#id_relief_check").attr("disabled", true);
			}

			$("#id_relief_check").prop("checked", true);
			$("#id_relief_check").attr("disabled", false);

			$("#id_relief_emp_id").val(relief_emp_id);
			$("#id_relief_emp_fullname_th").val(relief_emp_fullname_th);

			// DEBUG
			// TODO
			// Get Employee information
			// alert("DEBUG");
			$.ajax({
		    	url : "/monitoring/ajax/get_employee",
		    	type : "GET",
		    	data : {          
		      		csrfmiddlewaretoken: '{{ csrf_token }}',
		      		emp_id: relief_emp_id,
		      		shf_desc: shf_desc,
		      		cus_id: cus_id,
		      		cus_vol: cus_vol,
		      		cus_brn: cus_brn,
		    	},
		    	success: function(data) {
		    		if(data.is_found) {

						$("#id_relief_emp_rank").val(data.emp_rank);
		    			$("#id_relief_emp_dept").val(data.emp_dept);	    			
		    			$("#id_relief_emp_join_date").val(data.emp_join_date);

		    			if (data.emp_term_date!="") {
			    			$("#id_relief_emp_term_date").val(data.emp_term_date);
			    			$("#id_relief_emp_status").val(data.emp_status);

			    			$('#id_relief_emp_status').css('border-color', 'red');
			    			$('#id_relief_emp_status').css('background-color', '#e4cdcf');

		    			} else {
			    			$("#id_relief_emp_term_date").val(data.emp_term_date);
			    			$("#id_relief_emp_status").val(data.emp_status);

			    			$('#id_relief_emp_status').css('border-color', '');		    			
			    			$('#id_relief_emp_status').css('background-color', '');
		    			}

		    			var emp_join_date = data.emp_join_date;
		    			var emp_term_date = data.emp_term_date;
		    		} else {
		    			var emp_join_date = "";
		    			var emp_term_date = "";
		    		}		    		
		    	},
		    });			

		} else {
			$("#id_relief_check").prop("checked", false);
			$("#id_relief_emp_id").val("");
			$("#id_relief_emp_fullname_th").val("");

			//$('#id_relief_emp_status').css('border-color', '');		    			
			//$('#id_relief_emp_status').css('background-color', '');			
		}


		// Late Status
		if(late_status==1) {
			$("#id_late_check").prop("checked", true);	
		} else {
			$("#id_late_check").prop("checked", false);
		}

		// Full Paid
		if(late_full_status==1) {
			$("#id_late_full_paid_check").prop("checked", true);
		} else {
			$("#id_late_full_paid_check").prop("checked", false);
		}

		// Set OT Reason
		$("#id_late_reason_option").val(ot_reason);

		// Set OT Time From		
		//console.log(ot_time_from + "," + ot_time_to);

		if(ot_time_from!="") {
			//alert(ot_time_from);
			if(ot_time_from != "null")
				$("#id_late_from").val(ot_time_from);
			else
				$("#id_late_from").val("");
		} else {
			$("#id_late_from").val(date);		
		}

		// Set OT Time To
		if(ot_time_to!="") {
			if(ot_time_to != "null")
				$("#id_late_to").val(ot_time_to);
			else
				$("#id_late_to").val("");
		} else {
			$("#id_late_to").val(date);
		}

		// Set OT Hour Amount
		$("#id_late_hour").val(ot_hour_amount);

		// Get Employee information
		$.ajax({
	    	url : "/monitoring/ajax/get_employee",
	    	type : "GET",
	    	data : {          
	      		csrfmiddlewaretoken: '{{ csrf_token }}',
	      		emp_id: emp_id,
	      		shf_desc: shf_desc,
	      		cus_id: cus_id,
	      		cus_vol: cus_vol,
	      		cus_brn: cus_brn,
	    	},
	    	success: function(data) {
	    		if(data.is_found) {
	    			
					$("#id_emp_rank").val(data.emp_rank);
	    			$("#id_emp_dept").val(data.emp_dept);	    			
	    			$("#id_emp_join_date").val(data.emp_join_date);
	    			

	    			// batman
	    			if (data.emp_term_date!="") {
		    			$("#id_emp_term_date").val(data.emp_term_date);
		    			$("#id_emp_status").val(data.emp_status);

		    			$('#id_emp_status').css('border-color', 'red');
		    			$('#id_emp_status').css('background-color', '#e4cdcf');

		    			//$('#id_relief_emp_status').css('border-color', 'red');
						//$('#id_relief_emp_status').css('background-color', '#e4cdcf');

	    			} else {
		    			$("#id_emp_term_date").val(data.emp_term_date);
		    			$("#id_emp_status").val(data.emp_status);

		    			$('#id_emp_status').css('border-color', '');		    			
		    			$('#id_emp_status').css('background-color', '');

						//$('#id_relief_emp_status').css('border-color', '');
						//$('#id_relief_emp_status').css('background-color', '');		    			
	    			}

	    			var emp_join_date = data.emp_join_date;
	    			var emp_term_date = data.emp_term_date;
	    		} else {
	    			var emp_join_date = "";
	    			var emp_term_date = "";
	    		}
	    		//$.LoadingOverlay("hide");
	    	},
	    });


		// amnaj
		$(this).addClass('highlight').siblings().removeClass('highlight');

		if(absent_status==1) {
			$("#id_absent_check").prop("checked", true);
			$("#relief_employee_section").show();

	    	$("#id_relief_emp_id").attr("disabled", false);
	    	$("#id_relief_emp_id").attr("readonly", false);

			//$("#id_relief_check").prop("checked", true);						
	    	$("#id_relief_emp_id").focus();

	   		//$("#id_late_check").hide();
	   		//$("#id_late_check").next("label").hide();

   			//$("#id_call_time").val("");
   			//$("#id_call_amount_option").val(0);	   		

			$("#id_call_amount_option").attr("disabled", true);
			$("#id_call_amount_option").attr("readonly", true);
			$("#id_call_amount_option").val(0);

		} else {
			
			$("#id_absent_check").prop("checked", false);
			//$("#relief_employee_section").hide();

	    	$("#id_late_check").show();
	    	$("#id_late_check").next("label").show();	    	

	    	$("#id_phone_check").show();
	    	$("#id_phone_check").next("label").show();

			//var tel_status = $(this).find('td:eq(11)').text();			
			//var tel_time = $(this).find('td:eq(13)').text();
			//var tel_amount = $(this).find('td:eq(14)').text();	
			//var tel_paid = $(this).find('td:eq(15)').text();	
			
	   		if(tel_status==1) {
	   			//console.log(tel_status);

	   			$("#id_phone_check").prop("checked", true);
	   			//$("#id_call_time").attr("disabled", false);	   			

	   			$("#id_call_time").val(tel_time);
	   			$("#id_call_amount_option").attr("disabled", false);
	   			$("#id_call_amount_option").attr("readonly", false);
	   			$("#id_call_amount_option").val(tel_amount);

	   		} else {
	   			$("#id_phone_check").prop("checked", false);
	   			$("#id_call_time").attr("disabled", true);
	   			$("#id_call_amount_option").attr("disabled", true);
	   			$("#id_call_time").val("");
	   			$("#id_call_amount_option").val("0");
	   		}
	   		
		}

		//shift_id =  parseInt(shf_desc.substring(0,4));
		
		$('#id_shift_option').val(shift_id);

		if(shift_id==999 || shift_id==99) {	
			$("#save_button").attr("disabled", true);

			if(upd_gen=='G') {
				$("#delete_button").attr("disabled", true);

				$("#id_relief_check").attr('disabled', true);					
				$("#id_relief_emp_id").attr('disabled', true);
			}
			else {
				$("#delete_button").attr("disabled", false);
			}

			$("#id_shift_option").attr("disabled", true);
			
			$("#id_remark").attr("disabled", false);
			$("#id_remark").attr("readonly", false);
		} else {

			$("#save_button").attr("disabled", false);
			$("#reset_button").attr("disabled", false);

			if(upd_gen=='G')
				$("#delete_button").attr("disabled", true);
			else
				$("#delete_button").attr("disabled", false);			
			
			$("#id_remark").attr("disabled", false);
			$("#id_remark").attr("readonly", false);

			$("#id_shift_option").attr("disabled", false);
			
			// DEMO
			// START
			//checkSpecialBenefitList();
			// END
		}
		
		//console.log(ot_time_from + "," + ot_time_to);
	});



	// ADD
    $(document).on('click', '#add_button', function(e) {
    	//alert("Check");
    	$("#id_add_new_record_status").val(1);

    	$("#reset_button").attr("disabled", false);
    	$("#save_button").attr("disabled", false);
    	$("#delete_button").attr("disabled", true);
    
    	$("#id_emp_id").attr("disabled", false);
    	$("#emp_id_lookup_button").attr("disabled", false);
		$("#id_sent_spare").attr("disabled", false);
		$("#id_shift_option").attr("disabled", false);

		$("#id_remark").attr("disabled", false);
		$('#id_remark').attr("readonly", false);

    	$("#id_absent_check").prop("checked", false);
		$("#id_late_check").show();
		$("#id_late_check").next("label").show();
		$("#id_phone_check").show();
		$("#id_phone_check").next("label").show();

		$('#id_emp_status').css('border-color', '');		    			
		$('#id_emp_status').css('background-color', '');		
		$('#id_relief_emp_status').css('border-color', '');
		$('#id_relief_emp_status').css('background-color', '');

		$("#id_bulk_shift_list_option").css('border-color', '');
		$("#id_bulk_shift_list_option").css('background-color', '');
		$("#id_bulk_shift_list_option").css('border-style', '');

		current_shift_option = $("#id_shift_option").val();
		$("#dailyAttendanceDataEntryForm").trigger("reset");
		$("#id_shift_option").val(current_shift_option);

        $('#id_emp_id').focus();     
    });


    $(document).on('click', '#reset_button', function(e) {    	
    	$("#reset_button").attr("disabled", true);
    	$("#save_button").attr("disabled", true);

    	$("#id_add_new_record_status").val(0);
    	//$("#dailyAttendanceDataEntryForm").trigger("reset");

		$('#id_emp_status').css('border-color', '');		    			
		$('#id_emp_status').css('background-color', '');

		$('#id_relief_emp_status').css('border-color', '');
		$('#id_relief_emp_status').css('background-color', '');

    	if($("#id_absent_check").is(":checked")) {
    		$("#id_absent_check").prop("checked", false);    		
    		$("#id_relief_emp_id").attr("disabled", true);
    	}

		$("#id_bulk_shift_list_option").css('border-color', '');
		$("#id_bulk_shift_list_option").css('background-color', '');
		$("#id_bulk_shift_list_option").css('border-style', '');

    	$('#employee_list_table tr').removeClass('highlight');

    	disableAllElements();
    	$("#id_late_check").prop("checked", false);

    	//$('#id_emp_id').focus();
    });

    function saveRecord_cross_site(allowZeroBathForPhoneAmount,AEdly,dly_date,cus_id,cus_brn,cus_vol,emp_id,emp_rank,emp_dept,shift_id,shift_name,relief_emp_id,ui_phone_status,tel_time,tel_amount,ui_absent_status,ui_relief_status,ui_late_status,late_from,late_to,late_reason_option,late_hour,late_full_paid_status,id_search_emp_id,customer_wage_rate_id,customer_zone_id,Timecross) {

    	//alert("saveRecord_cross_site");
    	//return false;

		if(ui_phone_status==0) {    		
			phone_status = 0;
			tel_man = 0;
			tel_time = "";
			tel_amount = 0;
			tel_paid = 0;
		}

		var relief_status = 0;		
		if(ui_relief_status==1) {		
			relief_status = 1;
			if (emp_id == relief_emp_id) {
			  	$(document).Toasts('create', {
			    	class: "bg-danger",
			    	title: "{% trans 'Error' %}",
			    	subtitle: '',
			    	autohide: true,
			    	delay: 2000,
			    	body: "เลือกรหัสพนักงานที่จะลงเวรแทนไม่ถูกต้อง &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;",
			    	autoDismiss: true,
			    	close: true,
			    	autoremove: true,
			  	});

			  	$('#id_relief_emp_id').focus();
	    		return false;    			
			}
		}

		var job_type_option = $("#id_job_type_option").val();
		var remark = $("#id_remark").val();    	

		var totalNDP = $("#totalNDP").text();
		var totalNDA = $("#totalNDA").text();
		var totalNDM = $("#totalNDM").text();

		var totalNNP = $("#totalNNP").text();
		var totalNNA = $("#totalNNA").text();
		var totalNNM = $("#totalNNM").text();

		var totalPDP = $("#totalPDP").text();
		var totalPDA = $("#totalPDA").text();
		var totalPDM = $("#totalPDM").text();

		var totalPNP = $("#totalPNP").text();
		var totalPNA = $("#totalPNA").text();
		var totalPNM = $("#totalPNM").text();

		var search_shift_option = $("#id_search_shift_option").val();

		if(emp_id=="") {
			$.alert({
			    title: 'Error',
			    type: 'red',
			    content: "กรุณาเลือกพนักงานที่ต้องการลางาน &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;",
			    animation: 'zoom',
			    animationBounce: 1.5,
			    closeIcon: false,
			    boxWidth: '38%',
			    useBootstrap: false,
			});
		  	$('#id_emp_id').focus();
			return false;
		}
		
		if(shift_id=="0"){
			$.alert({
			    title: 'Error',
			    type: 'red',
			    content: "Please select Shift.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;",
			    animation: 'zoom',
			    animationBounce: 1.5,
			    closeIcon: false,
			    boxWidth: '38%',
			    useBootstrap: false,
			});

			$("#id_shift_option").css('border-color','red');
			$("#id_shift_option").css('border-style','solid');

		  	$('#id_shift_option').focus();
			return false;
		} else {
			$("#id_shift_option").css('border-color','');
			$("#id_shift_option").css('border-style','');
		}

		showLoading();

		$.ajax({
	    	url : "/monitoring/ajax/get_employee",
	    	type : "GET",
	    	data : {
	      		csrfmiddlewaretoken: '{{ csrf_token }}',
	      		cus_id: cus_id,
	      		cus_brn: cus_brn,
	      		cus_vol: cus_vol,
	      		emp_id: emp_id,
	      		shift_id: shift_id,
	      		relief_status: relief_status,
	      		relief_emp_id: relief_emp_id     		
	    	},
	    	success: function(data) {
				$("#id_emp_name_th").val("");
				$("#id_emp_rank").val("");
				$("#id_emp_dept").val("");
				$("#id_emp_status").val("");
				$("#id_emp_join_date").val("");
				$("#id_emp_term_date").val("");

	    		if(data.is_found) {
	    			$("#id_emp_fullname_th").val(data.emp_fname_th.trim() + "  " + data.emp_lname_th.trim());
					$("#id_emp_rank").val(data.emp_rank);
	    			$("#id_emp_dept").val(data.emp_dept);
	    			$("#id_emp_status").val(data.emp_status);
	    			
	    			if(data.emp_status_id=='9') {		    				
		    			$("#id_emp_status").animate({color:'red'}, 1000);
	    			} else {
	    				$("#id_emp_status").animate({color:'#495057'}, 1000);
	    			}
	    			$("#id_emp_join_date").val(data.emp_join_date);
	    			$("#id_emp_term_date").val(data.emp_term_date);

	    			$("#save_button").attr("disabled", false);
	    			$("#delete_button").attr("disabled", true);	    			    		

					$.ajax({
				    	url : "/monitoring/ajax/save_daily_attendance_cross_site",
				    	type : "GET",
				    	data : {          
				      		csrfmiddlewaretoken: '{{ csrf_token }}',
				      		AEdly: AEdly,
				      		dly_date: dly_date,
				      		allowZeroBathForPhoneAmount: allowZeroBathForPhoneAmount,	      		
				      		cus_id: cus_id,
				      		cus_brn: cus_brn,
				      		cus_vol: cus_vol,
				      		emp_id: emp_id,
				      		emp_rank: emp_rank,
				      		emp_dept: emp_dept,
				      		shift_id: shift_id,
				      		shift_name: shift_name,

				      		ui_absent_status: ui_absent_status,
				      		ui_late_status: ui_late_status,
							ui_phone_status: ui_phone_status,
							ui_relief_status: ui_relief_status,

							late_from: late_from,
							late_to: late_to,
							late_reason_option: late_reason_option,
							late_hour: late_hour,
							late_full_paid_status: late_full_paid_status,				      		
				      		tel_man: ui_phone_status,
				      		tel_time: tel_time,
				      		tel_amount: tel_amount,				      		
				      		relief_emp_id: relief_emp_id,
				      		job_type_option: job_type_option,
				      		remark: remark,
				      		totalNDP: totalNDP,
				      		totalNDA: totalNDA,
				      		totalNDM: totalNDM,
				      		totalNNP: totalNNP,
				      		totalNNA: totalNNA,
				      		totalNNM: totalNNM,
				      		totalPDP: totalPDP,
				      		totalPDA: totalPDA,
				      		totalPDM: totalPDM,
				      		totalPNP: totalPNP,
				      		totalPNA: totalPNA,
				      		totalPNM: totalPNM,
				      		search_emp_id: id_search_emp_id,
							customer_wage_rate_id: customer_wage_rate_id,
							customer_zone_id: customer_zone_id,
							Timecross: Timecross,
				    	},
				    	success: function(data) {
				    		if(data.success) {
					    		if(data.success) {
									$.ajax({
										url : "/monitoring/ajax/get_attendance_information/",
										type : "POST",
										data : {          
									  		csrfmiddlewaretoken: '{{ csrf_token }}',
									  		attendance_date: dly_date,
									  		search_shift_option: search_shift_option,
									  		cus_id: cus_id,
									  		cus_brn: cus_brn,
									  		cus_vol: cus_vol,
										},
										success : function(data) {
											if(data.is_found) {

												// Get Schedule list info
												result = "";
												schedule_list_length = data.schedule_list.length;
												for(i=0; i<schedule_list_length; i++) {
													result += data.schedule_list[i];
												}

												// TODO
												//$('#id_schedule_option').text(result);
												//$('#id_bulk_schedule_option').text("");

												

												// Get Employee info
												// Get Attandance Employee List
												//result = create_attandance_table(data.employee_list);												

												// SUDO
												// Get Attandance Employee List
												employee_leave_list = null
												result = create_attandance_table(data.employee_list, employee_leave_list);
												

												$('#id_employee_list').html(result);

												// TOTAL
												$("#totalNDP").html(data.totalNDP);
												$("#totalNNP").html(data.totalNNP);
												$("#totalPDP").html(data.totalPDP);
												$("#totalPNP").html(data.totalPNP);

												$("#totalNDA").html(data.totalNDA);
												$("#totalNNA").html(data.totalNNA);
												$("#totalPDA").html(data.totalPDA);
												$("#totalPNA").html(data.totalPNA);

												if(data.totalNDM>=0)
													$("#totalNDM").html("<span class='text-danger'>" + data.totalNDM + "</span>");
												else
													$("#totalNDM").html("<span class='text-danger'>" + data.totalNDM + "</span>");

												if(data.totalNNM>=0)
													$("#totalNNM").html("<span class='text-danger'>" + data.totalNNM + "</span>");						
												else
													$("#totalNNM").html("<span class='text-danger'>" + data.totalNNM + "</span>");
												
												if(data.totalPDM>=0)
													$("#totalPDM").html("<span class='text-danger'>" + data.totalPDM + "</span>");						
												else
													$("#totalPDM").html("<span class='text-danger'>" + data.totalPDM + "</span>");

												if(data.totalPNM>=0)
													$("#totalPNM").html("<span class='text-danger'>" + data.totalPNM + "</span>");						
												else
													$("#totalPNM").html("<span class='text-danger'>" + data.totalPNM + "</span>");

												

												// aquaman
												$("#id_absent_check").prop("checked", false);
												$("#id_phone_check").prop("checked", false);
												$("#id_call_amount_option").attr("readonly", true);
												$("#id_call_amount_option").attr("disabled", true);
											}
										}
									});
					    			
							 		$("#dailyAttendanceDataEntryForm:input").attr("disabled", true);
							 		$("#dailyAttendanceDataEntryForm").trigger("reset");

									$("#totalNDP").html("");
									$("#totalNNP").html("");
									$("#totalPDP").html("");
									$("#totalPNP").html("");

									$("#totalNDA").html("");
									$("#totalNNA").html("");
									$("#totalPDA").html("");
									$("#totalPNA").html("");

									$("#totalNDM").html("");
									$("#totalNNM").html("");
									$("#totalPDM").html("");
									$("#totalPNM").html("");

									// Clear call amount highlight
									$("#id_call_amount_option").css('border-color','');
									$("#id_call_amount_option").css('border-style','');
									$("#id_shift_option").css('border-color','');
									$("#id_shift_option").css('border-style','');
									$("#id_relief_emp_id").css('border-color','');
									$("#id_relief_emp_id").css('border-style','');
									$("#id_late_hour").css('border-color','');
									$("#id_late_hour").css('border-style','');									

					    		} else {
					    			alert("ERRROR : " + data.message);
					    		}

					    		/*
								$.alert({
								    title: data.title,
								    type: data.type,
								    content: data.message,
								    animation: 'zoom',
								    animationBounce: 1.5,
								    closeIcon: false,
								    boxWidth: '38%',
								    useBootstrap: false,
								});
								*/

							  	$(document).Toasts('create', {
							    	class: "bg-success", 
							    	title: "{% trans 'Success' %}",
							    	subtitle: '',
							    	autohide: true,
							    	delay: 2000,		    	
							    	//body: data.message,
							    	body: "ทำรายการสำเร็จ&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;",
							    	autoDismiss: true,
							    	close: true,
							    	autoremove: true,
							  	});								
									
								$("#dailyAttendanceDataEntryForm").trigger("reset");

								//TODO1: refresh table

								$("#id_emp_id").focus();
				    		} else {
								$.alert({
								    title: data.title,
								    type: data.type,
								    content: data.message,
								    animation: 'zoom',
								    animationBounce: 1.5,
								    closeIcon: false,
								    boxWidth: '38%',
								    useBootstrap: false,
								});

								$("#id_emp_id").focus();
				    		}				    		
				    	},
				    });
	    		} else {

				  	$(document).Toasts('create', {
				    	class: "bg-danger", 
				    	title: "{% trans 'Error' %}",
				    	subtitle: '',
				    	autohide: true,
				    	delay: 2000,
				    	body: "รหัสพนักงาน <b>" + relief_emp_id + "</b> ไม่มีในระบบ&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;",
				    	autoDismiss: true,
				    	close: true,
				    	autoremove: true,
				  	});

				  	$.LoadingOverlay("hide");
				  	$("#id_relief_emp_id").select();
				  	return false;
	    		}

	    		$.LoadingOverlay("hide");
	    		$("#id_emp_id").select();	    		
	    	},
	    });
    }


    function saveRecord(allowZeroBathForPhoneAmount,AEdly,dly_date,cus_id,cus_brn,cus_vol,emp_id,emp_rank,emp_dept,shift_id,shift_name,relief_emp_id,ui_phone_status,tel_time,tel_amount,ui_absent_status,ui_relief_status,ui_late_status,late_from,late_to,late_reason_option,late_hour,late_full_paid_status,id_search_emp_id,customer_wage_rate_id,customer_zone_id) {
    	
    	//return false;

    	//alert("test");

    	/*
		var late_status = 0;
		if($("#id_late_check").is(":checked"))
			late_status = 1;
		*/

		/*
		var phone_status = 0;
		if($("#id_phone_check").is(":checked")) {    		
			phone_status = 1;
			tel_man = 1;
			tel_time = $("#id_call_time").val();
			tel_amount = $("#id_call_amount_option").val();
			tel_paid = 1;
		} else {
			phone_status = 0;
			tel_man = 0;
			tel_time = "";
			tel_amount = 0;
			tel_paid = 0;
		}
		*/
		if(ui_phone_status==0) {    		
			phone_status = 0;
			tel_man = 0;
			tel_time = "";
			tel_amount = 0;
			tel_paid = 0;
		}



		//print("tel_time:", tel_time)

		//var relief_emp_id = $("#id_relief_emp_id").val();		
		var relief_status = 0;		
		//if($("#id_relief_check").is(":checked")) {
		if(ui_relief_status==1) {		
			relief_status = 1;
			if (emp_id == relief_emp_id) {
			  	$(document).Toasts('create', {
			    	class: "bg-danger",
			    	title: "{% trans 'Error' %}",
			    	subtitle: '',
			    	autohide: true,
			    	delay: 2000,
			    	body: "เลือกรหัสพนักงานที่จะลงเวรแทนไม่ถูกต้อง &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;",
			    	autoDismiss: true,
			    	close: true,
			    	autoremove: true,
			  	});

			  	$('#id_relief_emp_id').focus();
	    		return false;    			
			}
		}


		var job_type_option = $("#id_job_type_option").val();
		var remark = $("#id_remark").val();    	

		var totalNDP = $("#totalNDP").text();
		var totalNDA = $("#totalNDA").text();
		var totalNDM = $("#totalNDM").text();

		var totalNNP = $("#totalNNP").text();
		var totalNNA = $("#totalNNA").text();
		var totalNNM = $("#totalNNM").text();

		var totalPDP = $("#totalPDP").text();
		var totalPDA = $("#totalPDA").text();
		var totalPDM = $("#totalPDM").text();

		var totalPNP = $("#totalPNP").text();
		var totalPNA = $("#totalPNA").text();
		var totalPNM = $("#totalPNM").text();

		var search_shift_option = $("#id_search_shift_option").val();

		if(emp_id=="") {
			/*
		  	$(document).Toasts('create', {
		    	class: "bg-danger", 
		    	title: "{% trans 'Error' %}",
		    	subtitle: '',
		    	autohide: true,
		    	delay: 2000,
		    	body: "กรุณาเลือกพนักงานที่ต้องการลางาน &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;",
		    	autoDismiss: true,
		    	close: true,
		    	autoremove: true,
		  	});
		  	*/
			$.alert({
			    title: 'Error',
			    type: 'red',
			    content: "กรุณาเลือกพนักงานที่ต้องการลางาน &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;",
			    animation: 'zoom',
			    animationBounce: 1.5,
			    closeIcon: false,
			    boxWidth: '38%',
			    useBootstrap: false,
			});
		  	$('#id_emp_id').focus();
			return false;
		}
		
		// console.log(shift_id)

		if(shift_id=="0"){
			/*
		  	$(document).Toasts('create', {
		    	class: "bg-danger", 
		    	title: "{% trans 'Error' %}",
		    	subtitle: '',
		    	autohide: true,
		    	delay: 2000,
		    	body: "Please select Shift.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;",
		    	autoDismiss: true,
		    	close: true,
		    	autoremove: true,
		  	});
			*/

			$.alert({
			    title: 'Error',
			    type: 'red',
			    content: "Please select Shift.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;",
			    animation: 'zoom',
			    animationBounce: 1.5,
			    closeIcon: false,
			    boxWidth: '38%',
			    useBootstrap: false,
			});

			$("#id_shift_option").css('border-color','red');
			$("#id_shift_option").css('border-style','solid');

		  	$('#id_shift_option').focus();
			return false;
		} else {
			$("#id_shift_option").css('border-color','');
			$("#id_shift_option").css('border-style','');
		}

		showLoading();

		//alert("Test");
		//return false;

		$.ajax({
	    	url : "/monitoring/ajax/get_employee",
	    	type : "GET",
	    	data : {
	      		csrfmiddlewaretoken: '{{ csrf_token }}',
	      		cus_id: cus_id,
	      		cus_brn: cus_brn,
	      		cus_vol: cus_vol,
	      		emp_id: emp_id,
	      		shift_id: shift_id,
	      		relief_status: relief_status,
	      		relief_emp_id: relief_emp_id     		
	    	},
	    	success: function(data) {
				$("#id_emp_name_th").val("");
				$("#id_emp_rank").val("");
				$("#id_emp_dept").val("");
				$("#id_emp_status").val("");
				$("#id_emp_join_date").val("");
				$("#id_emp_term_date").val("");

	    		if(data.is_found) {

	    			/*
	    			$("#id_emp_fullname_th").val(data.emp_fname_th.trim() + "  " + data.emp_lname_th.trim());
					$("#id_emp_rank").val(data.emp_rank);
	    			$("#id_emp_dept").val(data.emp_dept);
	    			$("#id_emp_status").val(data.emp_status);
	    			
	    			if(data.emp_status_id=='9') {		    				
		    			$("#id_emp_status").animate({color:'red'}, 1000);
	    			} else {
	    				$("#id_emp_status").animate({color:'#495057'}, 1000);
	    			}
	    			$("#id_emp_join_date").val(data.emp_join_date);
	    			$("#id_emp_term_date").val(data.emp_term_date);
					*/

	    			$("#save_button").attr("disabled", false);
	    			$("#delete_button").attr("disabled", true);	    			    		

					$.ajax({
				    	url : "/monitoring/ajax/save_daily_attendance",
				    	type : "GET",
				    	data : {          
				      		csrfmiddlewaretoken: '{{ csrf_token }}',
				      		AEdly: AEdly,
				      		dly_date: dly_date,
				      		allowZeroBathForPhoneAmount: allowZeroBathForPhoneAmount,	      		
				      		cus_id: cus_id,
				      		cus_brn: cus_brn,
				      		cus_vol: cus_vol,
				      		emp_id: emp_id,
				      		emp_rank: emp_rank,
				      		emp_dept: emp_dept,
				      		shift_id: shift_id,
				      		shift_name: shift_name,

				      		ui_absent_status: ui_absent_status,
				      		ui_late_status: ui_late_status,
							ui_phone_status: ui_phone_status,
							ui_relief_status: ui_relief_status,

							late_from: late_from,
							late_to: late_to,
							late_reason_option: late_reason_option,
							late_hour: late_hour,
							late_full_paid_status: late_full_paid_status,				      		
				      		tel_man: ui_phone_status,
				      		tel_time: tel_time,
				      		tel_amount: tel_amount,				      		
				      		relief_emp_id: relief_emp_id,
				      		job_type_option: job_type_option,
				      		remark: remark,
				      		totalNDP: totalNDP,
				      		totalNDA: totalNDA,
				      		totalNDM: totalNDM,
				      		totalNNP: totalNNP,
				      		totalNNA: totalNNA,
				      		totalNNM: totalNNM,
				      		totalPDP: totalPDP,
				      		totalPDA: totalPDA,
				      		totalPDM: totalPDM,
				      		totalPNP: totalPNP,
				      		totalPNA: totalPNA,
				      		totalPNM: totalPNM,
				      		search_emp_id: id_search_emp_id,
							customer_wage_rate_id,
							customer_zone_id
				    	},
				    	success: function(data) {

				    		current_shift_option = $("#id_shift_option").val();

				    		if(data.success) {
					    		if(data.success) {
    	

									$.ajax({
										url : "/monitoring/ajax/get_attendance_information/",
										type : "POST",
										data : {          
									  		csrfmiddlewaretoken: '{{ csrf_token }}',
									  		attendance_date: dly_date,
									  		search_shift_option: search_shift_option,
									  		cus_id: cus_id,
									  		cus_brn: cus_brn,
									  		cus_vol: cus_vol,
										},
										success : function(data) {


											if(data.is_found) {

												// Get Schedule list info
												result = "";
												schedule_list_length = data.schedule_list.length;
												for(i=0; i<schedule_list_length; i++) {
													result += data.schedule_list[i];
												}

												// TODO
												//$('#id_schedule_option').text(result);
												//$('#id_bulk_schedule_option').text("");

												

												// Get Employee info
												// Get Attandance Employee List
												//result = create_attandance_table(data.employee_list);												

												// SUDO
												// Get Attandance Employee List
												employee_leave_list = null
												result = create_attandance_table(data.employee_list, employee_leave_list);
												

												$('#id_employee_list').html(result);

												// TOTAL
												$("#totalNDP").html(data.totalNDP);
												$("#totalNNP").html(data.totalNNP);
												$("#totalPDP").html(data.totalPDP);
												$("#totalPNP").html(data.totalPNP);

												$("#totalNDA").html(data.totalNDA);
												$("#totalNNA").html(data.totalNNA);
												$("#totalPDA").html(data.totalPDA);
												$("#totalPNA").html(data.totalPNA);

												if(data.totalNDM>=0)
													$("#totalNDM").html("<span class='text-danger'>" + data.totalNDM + "</span>");
												else
													$("#totalNDM").html("<span class='text-danger'>" + data.totalNDM + "</span>");

												if(data.totalNNM>=0)
													$("#totalNNM").html("<span class='text-danger'>" + data.totalNNM + "</span>");						
												else
													$("#totalNNM").html("<span class='text-danger'>" + data.totalNNM + "</span>");
												
												if(data.totalPDM>=0)
													$("#totalPDM").html("<span class='text-danger'>" + data.totalPDM + "</span>");						
												else
													$("#totalPDM").html("<span class='text-danger'>" + data.totalPDM + "</span>");

												if(data.totalPNM>=0)
													$("#totalPNM").html("<span class='text-danger'>" + data.totalPNM + "</span>");						
												else
													$("#totalPNM").html("<span class='text-danger'>" + data.totalPNM + "</span>");

												

												// aquaman
												$("#id_absent_check").prop("checked", false);
												$("#id_phone_check").prop("checked", false);
												$("#id_call_amount_option").attr("readonly", true);
												$("#id_call_amount_option").attr("disabled", true);


												
												$("#id_shift_option").val(current_shift_option);
    											//return false;

											}
										}
									});
					    			
							 		$("#dailyAttendanceDataEntryForm:input").attr("disabled", true);
							 		$("#dailyAttendanceDataEntryForm").trigger("reset");

									$("#totalNDP").html("");
									$("#totalNNP").html("");
									$("#totalPDP").html("");
									$("#totalPNP").html("");

									$("#totalNDA").html("");
									$("#totalNNA").html("");
									$("#totalPDA").html("");
									$("#totalPNA").html("");

									$("#totalNDM").html("");
									$("#totalNNM").html("");
									$("#totalPDM").html("");
									$("#totalPNM").html("");

									// Clear call amount highlight
									$("#id_call_amount_option").css('border-color','');
									$("#id_call_amount_option").css('border-style','');
									$("#id_shift_option").css('border-color','');
									$("#id_shift_option").css('border-style','');
									$("#id_relief_emp_id").css('border-color','');
									$("#id_relief_emp_id").css('border-style','');
									$("#id_late_hour").css('border-color','');
									$("#id_late_hour").css('border-style','');

									$('#id_emp_status').css('border-color', '');		    			
									$('#id_emp_status').css('background-color', '');

									$('#id_relief_emp_status').css('border-color', '');
									$('#id_relief_emp_status').css('background-color', '');

					    		} else {
					    			alert("ERROR: Please contact IT.");
					    		}

					    		/*
								$.alert({
								    title: data.title,
								    type: data.type,
								    content: data.message,
								    animation: 'zoom',
								    animationBounce: 1.5,
								    closeIcon: false,
								    boxWidth: '38%',
								    useBootstrap: false,
								});
								*/

							  	$(document).Toasts('create', {
							    	class: "bg-success", 
							    	title: "{% trans 'Success' %}",
							    	subtitle: '',
							    	autohide: true,
							    	delay: 2000,		    	
							    	//body: data.message,
							    	body: "ทำรายการสำเร็จ&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;",
							    	autoDismiss: true,
							    	close: true,
							    	autoremove: true,
							  	});								
									
								$("#dailyAttendanceDataEntryForm").trigger("reset");

								//TODO1: refresh table

								$("#id_emp_id").focus();
				    		} else {								
								$.alert({
								    title: data.title,
								    type: data.type,
								    content: data.message,
								    animation: 'zoom',
								    animationBounce: 1.5,
								    closeIcon: false,
								    boxWidth: '38%',
								    useBootstrap: false,
								});

								$("#id_emp_id").focus();
				    		}				    		
				    	},
				    });
	    		} else {

				  	$(document).Toasts('create', {
				    	class: "bg-danger", 
				    	title: "{% trans 'Error' %}",
				    	subtitle: '',
				    	autohide: true,
				    	delay: 2000,
				    	body: "รหัสพนักงาน <b>" + relief_emp_id + "</b> ไม่มีในระบบ&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;",
				    	autoDismiss: true,
				    	close: true,
				    	autoremove: true,
				  	});

				  	$.LoadingOverlay("hide");
				  	$("#id_relief_emp_id").select();
				  	return false;
	    		}

	    		$.LoadingOverlay("hide");
	    		$("#id_emp_id").select();	    		
	    	},
	    });
    }


    // SAVE_BUTTON
    $(document).on('click', '#save_button', function(e) {

		//alert("test");
		//return false;

    	var add_new_record_status = $("#id_add_new_record_status").val();

    	var allowZeroBathForPhoneAmount = 0;
    	var AEdly = $("#id_add_new_record_status").val();
    	var dly_date = $("#id_dly_date").val();
      	var cus_id = $('#id_cus_id').val();
      	var id_search_emp_id = $("#id_search_emp_id").val();
      	var cus_brn = $('#id_cus_brn').val();
      	var cus_vol = $('#id_cus_vol').val();    	
    	var emp_id = $("#id_emp_id").val();
    	var emp_rank = $("#id_emp_rank").val();
    	var emp_dept = $("#id_emp_dept").val();

    	var shift_id = $("#id_shift_option").val();    	
    	var shift_name = $("#id_shift_option option:selected").text();    	
    	//console.log(shift_id + " | " + shift_name);

    	var relief_emp_id = $("#id_relief_emp_id").val();

        var customer_wage_rate_id = $("#id_customer_wage_rate_id").val();
        var customer_zone_id = $("#id_customer_zone_id").val();

        //console.log(customer_wage_rate_id + "," + customer_zone_id);

    	var ui_absent_status = 0;
    	if($("#id_absent_check").is(":checked")) 
    		ui_absent_status = 1;
    	else
    		ui_absent_status = 0;

    	var ui_late_status = 0;
    	if($("#id_late_check").is(":checked"))
    		ui_late_status = 1;
    	else
    		ui_late_status = 0;

    	var ui_phone_check = 0;
		if($("#id_phone_check").is(":checked"))
    		ui_phone_check = 1;
    	else
    		ui_phone_check = 0;

    	var tel_time = $("#id_call_time").val();
    	var tel_amount = $("#id_call_amount_option").val();

    	var ui_relief_status = 0;
    	if($("#id_relief_check").is(":checked")) 
    		ui_relief_status = 1;
    	else
    		ui_relief_status = 0;
		
    	var late_from = $("#id_late_from").val();
    	var late_to = $("#id_late_to").val();
    	var late_reason_option = $("#id_late_reason_option").val();
    	var late_hour = $("#id_late_hour").val();
    	
    	var special_benefit_option = $("#id_job_type_option").val();    	

    	if(ui_late_status==1 & relief_emp_id=="") {
		  	$(document).Toasts('create', {
		    	class: "bg-danger", 
		    	title: "{% trans 'Error' %}",
		    	subtitle: '',
		    	autohide: true,
		    	delay: 2000,
		    	body: "กรุณาเลือกพนักงานที่มาเข้าเวรแทน",
		    	autoDismiss: true,
		    	close: true,
		    	autoremove: true,
		  	});
						
			$("#id_relief_emp_id").css('border-color','red');
			$("#id_relief_emp_id").css('border-style','solid');			

			$("#id_relief_emp_id").focus();

    		return false;
    	}


    	// Check Total Hour Amount
    	if(ui_late_status==1 & late_hour<=0) {
		  	$(document).Toasts('create', {
		    	class: "bg-danger", 
		    	title: "{% trans 'Error' %}",
		    	subtitle: '',
		    	autohide: true,
		    	delay: 2000,
		    	body: "กรุณาป้อนจำนวนชั่วโมง",
		    	autoDismiss: true,
		    	close: true,
		    	autoremove: true,
		  	});

			$("#id_late_hour").css('border-color','red');
			$("#id_late_hour").css('border-style','solid');
		  	$("#id_late_from").focus();
		  	$("#id_late_from").select();

		  	return false;
    	}

    	// Check Total Hour Amount
    	if(ui_late_status==1 & late_hour>2) {
		  	$(document).Toasts('create', {
		    	class: "bg-danger", 
		    	title: "{% trans 'Error' %}",
		    	subtitle: '',
		    	autohide: true,
		    	delay: 2000,
		    	body: "เวลาควงรอเกินกว่า 2 ชั่วโมง",
		    	autoDismiss: true,
		    	close: true,
		    	autoremove: true,
		  	});

			$("#id_late_hour").css('border-color','red');
			$("#id_late_hour").css('border-style','solid');
		  	$("#id_late_hour").focus();
		  	$("#id_late_hour").select();

		  	return false;
    	}


    	var late_full_paid_status = 0;
    	if($("#id_late_full_paid_check").is(":checked"))
    		late_full_paid_status = 1;

    	//console.log(ui_late_status,late_from,late_to,late_reason_option,late_hour,late_full_paid_status);



    	




    	if(add_new_record_status==1) {

    		//alert("ADD NEW");

	    	if(ui_absent_status==1) {
	    		if(ui_relief_status==1) {
		    		if(relief_emp_id=="") {
					  	$(document).Toasts('create', {
					    	class: "bg-danger", 
					    	title: "{% trans 'Error' %}",
					    	subtitle: '',
					    	autohide: true,
					    	delay: 2000,		    	
					    	body: "กรุณาเลือกพนักงานที่มาเข้าเวรแทน &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;",
					    	autoDismiss: true,
					    	close: true,
					    	autoremove: true,
					  	});

						$("#id_relief_emp_id").css('border-color','red');
						$("#id_relief_emp_id").css('border-style','solid');

						$('#id_relief_emp_id').focus();

						return false;    			
		    		} else {
						
						$.ajax({
							url : "/monitoring/ajax/is_scheduled/",
							type : "POST",
							data : {          
						  		csrfmiddlewaretoken: '{{ csrf_token }}',
						  		dly_date: dly_date,
						  		shift_id: shift_id,
						  		cus_id: cus_id,
						  		cus_brn: cus_brn,
						  		cus_vol: cus_vol,
						  		emp_id: emp_id,
							},
							success : function(data) {
								//alert("..");
								if (data.is_scheduled) {
									$.alert({
									    title: 'Error',
									    type: 'red',
									    content: data.message,
									    animation: 'zoom',
									    animationBounce: 1.5,
									    closeIcon: false,
									    boxWidth: '38%',
									    useBootstrap: false,
									});
									return false;
								} else {
									//alert("test");
									saveRecord(allowZeroBathForPhoneAmount,AEdly,dly_date,cus_id,cus_brn,cus_vol,emp_id,emp_rank,emp_dept,shift_id,shift_name,relief_emp_id,ui_phone_check,tel_time,tel_amount,ui_absent_status,ui_relief_status,ui_late_status,late_from,late_to,late_reason_option,late_hour,late_full_paid_status,id_search_emp_id,customer_wage_rate_id,customer_zone_id);
								}
							},
						});

		    			//saveRecord(allowZeroBathForPhoneAmount,AEdly,dly_date,cus_id,cus_brn,cus_vol,emp_id,emp_rank,emp_dept,shift_id,shift_name,relief_emp_id,ui_phone_check,tel_time,tel_amount,ui_absent_status,ui_relief_status,ui_late_status,late_from,late_to,late_reason_option,late_hour,late_full_paid_status,id_search_emp_id,customer_wage_rate_id,customer_zone_id);

		    			$("#id_late_check").prop("checked", false);
		    			return false;
		    		}

	    		} else {

				
	    			saveRecord(allowZeroBathForPhoneAmount,AEdly,dly_date,cus_id,cus_brn,cus_vol,emp_id,emp_rank,emp_dept,shift_id,shift_name,relief_emp_id,ui_phone_check,tel_time,tel_amount,ui_absent_status,ui_relief_status,ui_late_status,late_from,late_to,late_reason_option,late_hour,late_full_paid_status,id_search_emp_id,customer_wage_rate_id,customer_zone_id);
	    			$("#id_late_check").prop("checked", false);
	    			return false;
	    		}
	    	} else {

		    	// Not absent / Call
		    	if(ui_phone_check==1) {
		    		if(tel_amount=="0") {
						$.confirm({
						    title: 'Confirmation',
						    type: 'red',
						    content: 'ยืนยันที่จะป้อนค่าโทรแจ้งเวรเป็น 0 บาท',
							animation: 'zoom',
						    animationBounce: 1.5,
						    closeIcon: true,
						    boxWidth: '38%',
						    useBootstrap: false,		    
						    buttons: {
						        confirm: {
						        	text: 'ยืนยัน',
						        	btnClass: 'btn-danger',
						        	action: function () {						    		

						        		allowZeroBathForPhoneAmount = 1;
						        		//saveRecord(allowZeroBathForPhoneAmount,AEdly,dly_date,cus_id,cus_brn,cus_vol,emp_id,emp_rank,emp_dept,shift_id,shift_name,relief_emp_id,ui_phone_check,tel_time,tel_amount,ui_absent_status,ui_relief_status,ui_late_status,late_from,late_to,late_reason_option,late_hour,late_full_paid_status,id_search_emp_id,customer_wage_rate_id,customer_zone_id);

						        		
										$.ajax({
											url : "/monitoring/ajax/is_scheduled/",
											type : "POST",
											data : {          
										  		csrfmiddlewaretoken: '{{ csrf_token }}',
										  		dly_date: dly_date,
										  		shift_id: shift_id,
										  		cus_id: cus_id,
										  		cus_brn: cus_brn,
										  		cus_vol: cus_vol,
										  		emp_id: emp_id,
											},
											success : function(data) {
												if (data.is_scheduled) {
													$.alert({
													    title: 'Error',
													    type: 'red',
													    content: data.message,
													    animation: 'zoom',
													    animationBounce: 1.5,
													    closeIcon: false,
													    boxWidth: '38%',
													    useBootstrap: false,
													});
													return false;
												} else {												
													saveRecord(allowZeroBathForPhoneAmount,AEdly,dly_date,cus_id,cus_brn,cus_vol,emp_id,emp_rank,emp_dept,shift_id,shift_name,relief_emp_id,ui_phone_check,tel_time,tel_amount,ui_absent_status,ui_relief_status,ui_late_status,late_from,late_to,late_reason_option,late_hour,late_full_paid_status,id_search_emp_id,customer_wage_rate_id,customer_zone_id);
												}
											},
										});
														        		
									}
						        },
						        cancel: {					        	
						        	action: function () {
										//$("#id_call_amount_option").addClass("highlight").focus();
										$("#id_call_amount_option").css('border-color','red');
										$("#id_call_amount_option").css('border-style','solid');
						        	}
						        }
						    }
						});
		    		} else {
		    			//saveRecord(allowZeroBathForPhoneAmount,AEdly,dly_date,cus_id,cus_brn,cus_vol,emp_id,emp_rank,emp_dept,shift_id,shift_name,relief_emp_id,ui_phone_check,tel_time,tel_amount,ui_absent_status,ui_relief_status,ui_late_status,late_from,late_to,late_reason_option,late_hour,late_full_paid_status,id_search_emp_id,customer_wage_rate_id,customer_zone_id);

						$.ajax({
							url : "/monitoring/ajax/is_scheduled/",
							type : "POST",
							data : {          
						  		csrfmiddlewaretoken: '{{ csrf_token }}',
						  		dly_date: dly_date,
						  		shift_id: shift_id,
						  		cus_id: cus_id,
						  		cus_brn: cus_brn,
						  		cus_vol: cus_vol,
						  		emp_id: emp_id,
							},
							success : function(data) {
								if (data.is_scheduled) {
									$.alert({
									    title: 'Error',
									    type: 'red',
									    content: data.message,
									    animation: 'zoom',
									    animationBounce: 1.5,
									    closeIcon: false,
									    boxWidth: '38%',
									    useBootstrap: false,
									});
									return false;
								} else {								
									saveRecord(allowZeroBathForPhoneAmount,AEdly,dly_date,cus_id,cus_brn,cus_vol,emp_id,emp_rank,emp_dept,shift_id,shift_name,relief_emp_id,ui_phone_check,tel_time,tel_amount,ui_absent_status,ui_relief_status,ui_late_status,late_from,late_to,late_reason_option,late_hour,late_full_paid_status,id_search_emp_id,customer_wage_rate_id,customer_zone_id);
								}
							},
						});					
		    		}
		    	} else {
		    		// Not absent / Not Call
					$.ajax({
						url : "/monitoring/ajax/is_scheduled/",
						type : "POST",
						data : {          
					  		csrfmiddlewaretoken: '{{ csrf_token }}',
					  		dly_date: dly_date,
					  		shift_id: shift_id,
					  		cus_id: cus_id,
					  		cus_brn: cus_brn,
					  		cus_vol: cus_vol,
					  		emp_id: emp_id,
						},
						success : function(data) {
							if (data.is_scheduled) {
								$.alert({
								    title: 'Error',
								    type: 'red',
								    content: data.message,
								    animation: 'zoom',
								    animationBounce: 1.5,
								    closeIcon: false,
								    boxWidth: '38%',
								    useBootstrap: false,
								});

								return false;			
							} else {

								$.ajax({
									url : "/monitoring/ajax/save_daily_attendance_check_rule_1/",
									type : "POST",
									data : {          
								  		csrfmiddlewaretoken: '{{ csrf_token }}',
								  		dly_date: dly_date,
								  		shift_id: shift_id,
								  		cus_id: cus_id,
								  		cus_brn: cus_brn,
								  		cus_vol: cus_vol,
								  		emp_id: emp_id,
									},
									success : function(data) {
										if (data.is_cross_site) {
											
											Timecross = data.Timecross;
											
											$.confirm({
											    title: 'Confirmation',
											    type: 'red',
											    content: data.message,
												animation: 'zoom',
											    animationBounce: 1.5,
											    closeIcon: true,
											    boxWidth: '38%',
											    useBootstrap: false,		    
											    buttons: {
											        confirm: {
											        	text: 'ยืนยัน',
											        	btnClass: 'btn-danger',
											        	action: function () {

											        		saveRecord_cross_site(allowZeroBathForPhoneAmount,AEdly,dly_date,cus_id,cus_brn,cus_vol,emp_id,emp_rank,emp_dept,shift_id,shift_name,relief_emp_id,ui_phone_check,tel_time,tel_amount,ui_absent_status,ui_relief_status,ui_late_status,late_from,late_to,late_reason_option,late_hour,late_full_paid_status,id_search_emp_id,customer_wage_rate_id,customer_zone_id, Timecross);
														}
											        },
											        cancel: {					        	
											        	action: function () {											
															$("#id_emp_id").focus();														
											        	}								        	
											        }
											    }
											});							
										} else {

											saveRecord(allowZeroBathForPhoneAmount,AEdly,dly_date,cus_id,cus_brn,cus_vol,emp_id,emp_rank,emp_dept,shift_id,shift_name,relief_emp_id,ui_phone_check,tel_time,tel_amount,ui_absent_status,ui_relief_status,ui_late_status,late_from,late_to,late_reason_option,late_hour,late_full_paid_status,id_search_emp_id,customer_wage_rate_id,customer_zone_id);

											return false;
										}
									},
								});



							}
						},
					});

		    	}    		
	    	}





    	} else {
			// EDIT MODE

    		//alert("EDIT RECORD");
			//return false;
    	
	    	if(ui_absent_status==1) {				
	    		if(ui_relief_status==1) {

					//alert("edit + หยุดงาน + มีควงรอ");
					//return false;

		    		if(relief_emp_id=="") {
					  	$(document).Toasts('create', {
					    	class: "bg-danger", 
					    	title: "{% trans 'Error' %}",
					    	subtitle: '',
					    	autohide: true,
					    	delay: 2000,
					    	body: "กรุณาเลือกพนักงานที่มาเข้าเวรแทน &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;",
					    	autoDismiss: true,
					    	close: true,
					    	autoremove: true,
					  	});

						$("#id_relief_emp_id").css('border-color','red');
						$("#id_relief_emp_id").css('border-style','solid');

						$('#id_relief_emp_id').focus();

						return false;    			
		    		} else {


						// ironman
						$.ajax({
							url : "/monitoring/ajax/is_scheduled/",
							type : "POST",
							data : {          
						  		csrfmiddlewaretoken: '{{ csrf_token }}',
						  		dly_date: dly_date,
						  		shift_id: shift_id,
						  		cus_id: cus_id,
						  		cus_brn: cus_brn,
						  		cus_vol: cus_vol,
						  		//emp_id: emp_id,
								emp_id: relief_emp_id,
							},
							success : function(data) {								
								if (data.is_scheduled) {
									$.alert({
									    title: 'Error',
									    type: 'red',
									    content: data.message,
									    animation: 'zoom',
									    animationBounce: 1.5,
									    closeIcon: false,
									    boxWidth: '38%',
									    useBootstrap: false,
									});
									return false;
								} else {
									//alert("test");
									saveRecord(allowZeroBathForPhoneAmount,AEdly,dly_date,cus_id,cus_brn,cus_vol,emp_id,emp_rank,emp_dept,shift_id,shift_name,relief_emp_id,ui_phone_check,tel_time,tel_amount,ui_absent_status,ui_relief_status,ui_late_status,late_from,late_to,late_reason_option,late_hour,late_full_paid_status,id_search_emp_id,customer_wage_rate_id,customer_zone_id);
									$("#id_late_check").prop("checked", false);
									return false;
								}
							},
						});

		    			//saveRecord(allowZeroBathForPhoneAmount,AEdly,dly_date,cus_id,cus_brn,cus_vol,emp_id,emp_rank,emp_dept,shift_id,shift_name,relief_emp_id,ui_phone_check,tel_time,tel_amount,ui_absent_status,ui_relief_status,ui_late_status,late_from,late_to,late_reason_option,late_hour,late_full_paid_status,id_search_emp_id,customer_wage_rate_id,customer_zone_id);

		    			$("#id_late_check").prop("checked", false);
		    			return false;
		    		}

	    		} else {
				
	    			saveRecord(allowZeroBathForPhoneAmount,AEdly,dly_date,cus_id,cus_brn,cus_vol,emp_id,emp_rank,emp_dept,shift_id,shift_name,relief_emp_id,ui_phone_check,tel_time,tel_amount,ui_absent_status,ui_relief_status,ui_late_status,late_from,late_to,late_reason_option,late_hour,late_full_paid_status,id_search_emp_id,customer_wage_rate_id,customer_zone_id);
	    			
	    			$("#id_late_check").prop("checked", false);
	    			return false;
	    		}
	    	} 
			else {
				// edit + เคสมาสาย + ควงรอ			

				//alert("edit + มาสาย + ควงรอ" + " | " + ui_late_status + "," + late_hour + "," + late_full_paid_status);
				//return false;

				// มาทำงาน
				// ironman	
				/*
				var bulk_shift_status = $("#id_shift_status").val();
        		var attendance_date = $('#id_dly_date').val();					
				var shift_id = $("#id_shift_option").val();    	
				var work_cross_site = 1;

				$.ajax({
					url : "/monitoring/ajax/ajax_is_scheduled_between_site/",
					type : "POST",
					data : {          
						csrfmiddlewaretoken: '{{ csrf_token }}',
						attendance_date: attendance_date,
						shift_id: shift_id,
						shift_status: bulk_shift_status,
						cus_id: cus_id,
						cus_brn: cus_brn,
						cus_vol: cus_vol,
					},
					success: function(data) {
						alert(data.is_scheduled);

						if(data.is_error) {
							$.confirm({
								title: 'Confirmation',
								type: 'red',
								content: data.message,
								animation: 'zoom',
								animationBounce: 1.5,
								closeIcon: true,
								boxWidth: '38%',
								useBootstrap: false,		    
								buttons: {
									confirm: {
										text: 'ยืนยัน',
										btnClass: 'btn-danger',
										action: function () {
											
											skip_is_scheduled_record = 1
											//return false;		        					        		
										}
									},
									cancel: {					        	
										action: function () {											
											//alert("Cancel");
											//return false;
										}
									}
								}
							});
						} else {
							alert("TODO");
						}
					}
				});
				*/
				
		    	// Not absent / Call
				
		    	if(ui_phone_check==1) {
					//alert("edit + มาสาย + ควงรอ + โทรแจ้งเข้าเวรเอง");
		    		if(tel_amount=="0") {
						$.confirm({
						    title: 'Confirmation',
						    type: 'red',
						    content: 'ยืนยันที่จะป้อนค่าโทรแจ้งเวรเป็น 0 บาท',
							animation: 'zoom',
						    animationBounce: 1.5,
						    closeIcon: true,
						    boxWidth: '38%',
						    useBootstrap: false,		    
						    buttons: {
						        confirm: {
						        	text: 'ยืนยัน',
						        	btnClass: 'btn-danger',
						        	action: function () {						    		

						        		allowZeroBathForPhoneAmount = 1;
						        		//saveRecord(allowZeroBathForPhoneAmount,AEdly,dly_date,cus_id,cus_brn,cus_vol,emp_id,emp_rank,emp_dept,shift_id,shift_name,relief_emp_id,ui_phone_check,tel_time,tel_amount,ui_absent_status,ui_relief_status,ui_late_status,late_from,late_to,late_reason_option,late_hour,late_full_paid_status,id_search_emp_id,customer_wage_rate_id,customer_zone_id);										
						        		
										$.ajax({
											url : "/monitoring/ajax/is_scheduled/",
											type : "POST",
											data : {          
										  		csrfmiddlewaretoken: '{{ csrf_token }}',
										  		dly_date: dly_date,
										  		shift_id: shift_id,
										  		cus_id: cus_id,
										  		cus_brn: cus_brn,
										  		cus_vol: cus_vol,
										  		emp_id: emp_id,
											},
											success : function(data) {												
												if (data.is_scheduled) {
													$.alert({
													    title: 'Error',
													    type: 'red',
													    content: data.message,
													    animation: 'zoom',
													    animationBounce: 1.5,
													    closeIcon: false,
													    boxWidth: '38%',
													    useBootstrap: false,
													});
													return false;
												} else {												
													saveRecord(allowZeroBathForPhoneAmount,AEdly,dly_date,cus_id,cus_brn,cus_vol,emp_id,emp_rank,emp_dept,shift_id,shift_name,relief_emp_id,ui_phone_check,tel_time,tel_amount,ui_absent_status,ui_relief_status,ui_late_status,late_from,late_to,late_reason_option,late_hour,late_full_paid_status,id_search_emp_id,customer_wage_rate_id,customer_zone_id);
													$("#id_late_check").prop("checked", false);
													return false;
												}
											},
										});
															        		
									}
						        },
						        cancel: {					        	
						        	action: function () {
										//$("#id_call_amount_option").addClass("highlight").focus();
										$("#id_call_amount_option").css('border-color','red');
										$("#id_call_amount_option").css('border-style','solid');
						        	}
						        }
						    }
						});
		    		} else {


		    			//saveRecord(allowZeroBathForPhoneAmount,AEdly,dly_date,cus_id,cus_brn,cus_vol,emp_id,emp_rank,emp_dept,shift_id,shift_name,relief_emp_id,ui_phone_check,tel_time,tel_amount,ui_absent_status,ui_relief_status,ui_late_status,late_from,late_to,late_reason_option,late_hour,late_full_paid_status,id_search_emp_id,customer_wage_rate_id,customer_zone_id);
		    			
						$.ajax({
							url : "/monitoring/ajax/is_scheduled/",
							type : "POST",
							data : {          
						  		csrfmiddlewaretoken: '{{ csrf_token }}',
						  		dly_date: dly_date,
						  		shift_id: shift_id,
						  		cus_id: cus_id,
						  		cus_brn: cus_brn,
						  		cus_vol: cus_vol,
						  		emp_id: emp_id,
							},
							success : function(data) {
								//alert(data.is_scheduled);
								if (data.is_scheduled) {
									$.alert({
									    title: 'Error',
									    type: 'red',
									    content: data.message,
										//content: "aa",
									    animation: 'zoom',
									    animationBounce: 1.5,
									    closeIcon: false,
									    boxWidth: '38%',
									    useBootstrap: false,
									});
									return false;
								} else {
									//alert("b");
									saveRecord(allowZeroBathForPhoneAmount,AEdly,dly_date,cus_id,cus_brn,cus_vol,emp_id,emp_rank,emp_dept,shift_id,shift_name,relief_emp_id,ui_phone_check,tel_time,tel_amount,ui_absent_status,ui_relief_status,ui_late_status,late_from,late_to,late_reason_option,late_hour,late_full_paid_status,id_search_emp_id,customer_wage_rate_id,customer_zone_id);
									$("#id_late_check").prop("checked", false);
									return false;
								}
							},
						});
						
		    		}
		    	} else {
		    		// Not absent / Not Call
					//alert("c");
					//return false;

					//alert(relief_emp_id + " | " + ui_relief_status);
					//return false;
										
					//alert("edit + มาสาย + ควงรอ" + " | " + ui_late_status + "," + late_hour + "," + late_full_paid_status);
					//return false;
					
					

					if(ui_relief_status==1) {
						if(relief_emp_id!="") {

							//alert("edit + มาสาย + ควงรอ + ไม่ได้โทรแจ้งเข้าเวร");

							$.ajax({
							url : "/monitoring/ajax/save_daily_attendance_check_rule_1/",
							type : "POST",
							data : {          
								csrfmiddlewaretoken: '{{ csrf_token }}',
								dly_date: dly_date,
								shift_id: shift_id,
								cus_id: cus_id,
								cus_brn: cus_brn,
								cus_vol: cus_vol,
								emp_id: relief_emp_id,
							},
							success : function(data) {
								if (data.is_cross_site) {
									
									Timecross = data.Timecross;
									/*
									$.confirm({
										title: 'Confirmation',
										type: 'red',
										content: data.message,
										animation: 'zoom',
										animationBounce: 1.5,
										closeIcon: true,
										boxWidth: '38%',
										useBootstrap: false,		    
										buttons: {
											confirm: {
												text: 'ยืนยัน',
												btnClass: 'btn-danger',
												action: function () {
													alert("edit + มาสาย + ควงรอ" + " | " + ui_late_status + "," + late_hour + "," + late_full_paid_status);
													alert("saveRecord_cross_site()");
													//saveRecord_cross_site(allowZeroBathForPhoneAmount,AEdly,dly_date,cus_id,cus_brn,cus_vol,emp_id,emp_rank,emp_dept,shift_id,shift_name,relief_emp_id,ui_phone_check,tel_time,tel_amount,ui_absent_status,ui_relief_status,ui_late_status,late_from,late_to,late_reason_option,late_hour,late_full_paid_status,id_search_emp_id,customer_wage_rate_id,customer_zone_id, Timecross);
												}
											},
											cancel: {					        	
												action: function () {											
													$("#id_emp_id").focus();														
												}								        	
											}
										}
									});
									*/
									$.alert({
										title: 'Error',
										type: 'red',
										content: data.message,
										animation: 'zoom',
										animationBounce: 1.5,
										closeIcon: false,
										boxWidth: '38%',
										useBootstrap: false,
									});	
								} else {

									//alert("edit + มาสาย + ควงรอ" + " | " + ui_late_status + "," + late_hour + "," + late_full_paid_status);
									//alert("saveRecord()");
									saveRecord(allowZeroBathForPhoneAmount,AEdly,dly_date,cus_id,cus_brn,cus_vol,emp_id,emp_rank,emp_dept,shift_id,shift_name,relief_emp_id,ui_phone_check,tel_time,tel_amount,ui_absent_status,ui_relief_status,ui_late_status,late_from,late_to,late_reason_option,late_hour,late_full_paid_status,id_search_emp_id,customer_wage_rate_id,customer_zone_id);
									$("#id_late_check").prop("checked", false);
									return false;
								}
							},
						});
						} else {

						}

					} else {

						//alert("ERROR!");
						//return false;						
						//alert("edit + มาทำงาน + ไม่สาย + ไม่มีควงรอ + ไม่โทร");
						
						$.ajax({
							url : "/monitoring/ajax/is_scheduled/",
							type : "POST",
							data : {          
								csrfmiddlewaretoken: '{{ csrf_token }}',
								dly_date: dly_date,
								shift_id: shift_id,
								cus_id: cus_id,
								cus_brn: cus_brn,
								cus_vol: cus_vol,
								emp_id: emp_id,
							},
							success : function(data) {
								if (data.is_scheduled) {								
									$.alert({
										title: 'Error',
										type: 'red',
										content: data.message,
										animation: 'zoom',
										animationBounce: 1.5,
										closeIcon: false,
										boxWidth: '38%',
										useBootstrap: false,
									});
									return false;								
									//saveRecord(allowZeroBathForPhoneAmount,AEdly,dly_date,cus_id,cus_brn,cus_vol,emp_id,emp_rank,emp_dept,shift_id,shift_name,relief_emp_id,ui_phone_check,tel_time,tel_amount,ui_absent_status,ui_relief_status,ui_late_status,late_from,late_to,late_reason_option,late_hour,late_full_paid_status,id_search_emp_id,customer_wage_rate_id,customer_zone_id);
								} else {
									//alert(data.message);
									//alert("aa");
									saveRecord(allowZeroBathForPhoneAmount,AEdly,dly_date,cus_id,cus_brn,cus_vol,emp_id,emp_rank,emp_dept,shift_id,shift_name,relief_emp_id,ui_phone_check,tel_time,tel_amount,ui_absent_status,ui_relief_status,ui_late_status,late_from,late_to,late_reason_option,late_hour,late_full_paid_status,id_search_emp_id,customer_wage_rate_id,customer_zone_id);
									$("#id_late_check").prop("checked", false);

									/*
									$.ajax({
										url : "/monitoring/ajax/save_daily_attendance_check_rule_1/",
										type : "POST",
										data : {          
											csrfmiddlewaretoken: '{{ csrf_token }}',
											dly_date: dly_date,
											shift_id: shift_id,
											cus_id: cus_id,
											cus_brn: cus_brn,
											cus_vol: cus_vol,
											emp_id: emp_id,
										},
										success : function(data) {
											if (data.is_cross_site) {												
												$.alert({
													title: 'Error',
													type: 'red',
													content: data.message,
													animation: 'zoom',
													animationBounce: 1.5,
													closeIcon: false,
													boxWidth: '38%',
													useBootstrap: false,
												});	
																												
											} else {

												saveRecord(allowZeroBathForPhoneAmount,AEdly,dly_date,cus_id,cus_brn,cus_vol,emp_id,emp_rank,emp_dept,shift_id,shift_name,relief_emp_id,ui_phone_check,tel_time,tel_amount,ui_absent_status,ui_relief_status,ui_late_status,late_from,late_to,late_reason_option,late_hour,late_full_paid_status,id_search_emp_id,customer_wage_rate_id,customer_zone_id);

												return false;
											}
										},
									});
									*/


								}
							},
						});						
					}


		    	}    		
	    	}

	    }


    	// $("#id_late_check").prop("checked", false);
    });








    // SAVE_BUTTON_BK
    $(document).on('click', '#save_button_bk', function(e) {
    	var allowZeroBathForPhoneAmount = 0;
    	var AEdly = $("#id_add_new_record_status").val();
    	var dly_date = $("#id_dly_date").val();
      	var cus_id = $('#id_cus_id').val();
      	var cus_brn = $('#id_cus_brn').val();
      	var cus_vol = $('#id_cus_vol').val();    	
    	var emp_id = $("#id_emp_id").val();
    	var emp_rank = $("#id_emp_rank").val();
    	var emp_dept = $("#id_emp_dept").val();
    	var shift_id = $("#id_shift_option").val();
    	var shift_name = $("#id_shift_option option:selected").text();    	
    	var relief_emp_id = $("#id_relief_emp_id").val();






    	// TODO: Reviesed all status    	
    	var absent_status = 0;
    	if($("#id_absent_check").is(":checked")) 
    		absent_status = 1;

    	var late_status = 0;
    	if($("#id_late_check").is(":checked"))
    		late_status =1;

    	var tel_man = 0;
		if($("#id_phone_check").is(":checked"))
    		tel_man = 1;

    	var tel_time = $("#id_call_time").val();
    	var tel_amount = $("#id_call_amount_option").val();


    	var relief_status = 0;
    	if($("#id_relief_check").is(":checked")) 
    		relief_status = 1;














    	var late_from = $("#id_late_from").val();
    	var late_to = $("#id_late_to").val();
    	var late_reason_option = $("#id_late_reason_option").val();
    	var late_hour = $("#id_late_hour").val();
    	
    	if(late_status==1 & relief_emp_id=="") {
		  	$(document).Toasts('create', {
		    	class: "bg-danger", 
		    	title: "{% trans 'Error' %}",
		    	subtitle: '',
		    	autohide: true,
		    	delay: 2000,
		    	body: "กรุณาเลือกพนักงานที่มาเข้าเวรแทน",
		    	autoDismiss: true,
		    	close: true,
		    	autoremove: true,
		  	});

		  	/*
			$.alert({
			    title: 'Error',
			    type: 'red',
			    content: "กรุณาเลือกพนักงานที่มาเข้าเวรแทน..",
			    animation: 'zoom',
			    animationBounce: 1.5,
			    closeIcon: false,
			    boxWidth: '38%',
			    useBootstrap: false,
			});
			*/
						
			$("#id_relief_emp_id").css('border-color','red');
			$("#id_relief_emp_id").css('border-style','solid');			

			$("#id_relief_emp_id").focus();

    		return false;
    	}


    	// Check Total Hour Amount
    	if(late_status==1 & late_hour<=0) {
		  	$(document).Toasts('create', {
		    	class: "bg-danger", 
		    	title: "{% trans 'Error' %}",
		    	subtitle: '',
		    	autohide: true,
		    	delay: 2000,
		    	body: "กรุณาป้อนจำนวนชั่วโมง",
		    	autoDismiss: true,
		    	close: true,
		    	autoremove: true,
		  	});

			$("#id_late_hour").css('border-color','red');
			$("#id_late_hour").css('border-style','solid');
		  	$("#id_late_hour").focus();
		  	$("#id_late_hour").select();

		  	return false;
    	}

    	// Check Total Hour Amount
    	if(late_status==1 & late_hour>2) {
		  	$(document).Toasts('create', {
		    	class: "bg-danger", 
		    	title: "{% trans 'Error' %}",
		    	subtitle: '',
		    	autohide: true,
		    	delay: 2000,
		    	body: "เวลาควงรอเกินกว่า 2 ชั่วโมง",
		    	autoDismiss: true,
		    	close: true,
		    	autoremove: true,
		  	});

			$("#id_late_hour").css('border-color','red');
			$("#id_late_hour").css('border-style','solid');
		  	$("#id_late_hour").focus();
		  	$("#id_late_hour").select();

		  	return false;
    	}


    	var late_full_paid_status = 0;
    	if($("#id_late_full_paid_check").is(":checked"))
    		late_full_paid_status = 1;

    	//console.log(late_status,late_from,late_to,late_reason_option,late_hour,late_full_paid_status);

    	if(absent_status==1) {
    		if(relief_status==1) {
	    		if(relief_emp_id=="") {
				  	$(document).Toasts('create', {
				    	class: "bg-danger", 
				    	title: "{% trans 'Error' %}",
				    	subtitle: '',
				    	autohide: true,
				    	delay: 2000,		    	
				    	body: "กรุณาเลือกพนักงานที่มาเข้าเวรแทน &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;",
				    	autoDismiss: true,
				    	close: true,
				    	autoremove: true,
				  	});

				  	/*
					$.alert({
					    title: 'Error',
					    type: 'red',
					    content: "กรุณาเลือกพนักงานที่มาเข้าเวรแทน &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;",
					    animation: 'zoom',
					    animationBounce: 1.5,
					    closeIcon: false,
					    boxWidth: '38%',
					    useBootstrap: false,
					});
					*/

					$("#id_relief_emp_id").css('border-color','red');
					$("#id_relief_emp_id").css('border-style','solid');

					$('#id_relief_emp_id').focus();

					return false;    			
	    		} else {
	    			saveRecord(allowZeroBathForPhoneAmount,AEdly,dly_date,cus_id,cus_brn,cus_vol,emp_id,emp_rank,emp_dept,shift_id,shift_name,relief_emp_id,tel_man,tel_time,tel_amount,absent_status,relief_status,late_status,late_from,late_to,late_reason_option,late_hour,late_full_paid_status);
	    			return false;
	    		}

    		} else {
    			saveRecord(allowZeroBathForPhoneAmount,AEdly,dly_date,cus_id,cus_brn,cus_vol,emp_id,emp_rank,emp_dept,shift_id,shift_name,relief_emp_id,tel_man,tel_time,tel_amount,absent_status,relief_status,late_status,late_from,late_to,late_reason_option,late_hour,late_full_paid_status);
    			return false;
    		}
    	} else {
	    	// Check Phone Amount is 0
	    	if(tel_man==1) {
	    		if(tel_amount=="0") {
					$.confirm({
					    title: 'Confirmation',
					    type: 'red',
					    content: 'ยืนยันที่จะป้อนค่าโทรแจ้งเวรเป็น 0 บาท',
						animation: 'zoom',
					    animationBounce: 1.5,
					    closeIcon: true,
					    boxWidth: '38%',
					    useBootstrap: false,		    
					    buttons: {
					        confirm: {
					        	text: 'ยืนยัน',
					        	btnClass: 'btn-danger',
					        	action: function () {
					        		saveRecord(allowZeroBathForPhoneAmount,AEdly,dly_date,cus_id,cus_brn,cus_vol,emp_id,emp_rank,emp_dept,shift_id,shift_name,relief_emp_id,tel_man,tel_time,tel_amount,absent_status,relief_status,late_status,late_from,late_to,late_reason_option,late_hour,late_full_paid_status);
								}
					        },
					        cancel: {					        	
					        	action: function () {
									//$("#id_call_amount_option").addClass("highlight").focus();
									$("#id_call_amount_option").css('border-color','red');
									$("#id_call_amount_option").css('border-style','solid');
					        	}
					        }
					    }
					});
	    		} else {
	    			saveRecord(allowZeroBathForPhoneAmount,AEdly,dly_date,cus_id,cus_brn,cus_vol,emp_id,emp_rank,emp_dept,shift_id,shift_name,relief_emp_id,tel_man,tel_time,tel_amount,absent_status,relief_status,late_status,late_from,late_to,late_reason_option,late_hour,late_full_paid_status);
	    		}
	    	} else {
	    		saveRecord(allowZeroBathForPhoneAmount,AEdly,dly_date,cus_id,cus_brn,cus_vol,emp_id,emp_rank,emp_dept,shift_id,shift_name,relief_emp_id,tel_man,tel_time,tel_amount,absent_status,relief_status,late_status,late_from,late_to,late_reason_option,late_hour,late_full_paid_status);	
	    	}    		
    	}



    });


	// DELETE BUTTON
    $(document).on('click', '#delete_button', function(e) {
      	var cus_id = $('#id_cus_id').val();      	
      	var cus_brn = $('#id_cus_brn').val();
      	var cus_vol = $('#id_cus_vol').val();    	
    	var emp_id = $("#id_emp_id").val();
    	var shift_id = $("#id_shift_option").val();
    	var dly_date = $("#id_dly_date").val();
    	var emp_fullname_th = $('#id_emp_fullname_th').val();

    	//console.log(cus_id+","+cus_brn+","+cus_vol+","+emp_id+","+shift_option+","+dly_date)			
    	var cnt_id = cus_id + cus_brn + cus_vol

		//alert("debug");
		//return false;
		
		$.confirm({
		    title: 'Confirmation',
		    type: 'red',
		    content: 'ต้องการลบพนักงานรหัส <b>' + emp_id + "  (" + emp_fullname_th + ")</b><br>ออกจากหน่วยงาน <b>" + cnt_id.replace(/^0+/,'') + "</b>",
			animation: 'zoom',
		    animationBounce: 1.5,
		    closeIcon: true,
		    boxWidth: '38%',
		    useBootstrap: false,
		    buttons: {
		        confirm: {
		        	text: 'ยืนยัน',
		        	btnClass: 'btn-danger',
		        	action: function () {		        					
						showLoading();
						$.ajax({
					    	url : "/monitoring/ajax/delete_employee",
					    	type : "GET",
					    	data : {          
					      		csrfmiddlewaretoken: '{{ csrf_token }}',
					      		cus_id: cus_id,
					      		cus_brn: cus_brn,
					      		cus_vol: cus_vol,
					      		emp_id: emp_id,
					      		shift_id: shift_id,
					      		dly_date: dly_date,
					    	},
					    	success: function(data) {
					    		if(data.success) {
									$.ajax({
										url : "/monitoring/ajax/get_attendance_information/",
										type : "POST",
										data : {          
									  		csrfmiddlewaretoken: '{{ csrf_token }}',
									  		attendance_date: dly_date,
									  		cus_id: cus_id,
									  		cus_brn: cus_brn,
									  		cus_vol: cus_vol,
										},
										success : function(data) {
											if(data.is_found) {

												// Get Schedule list info
												result = "";
												schedule_list_length = data.schedule_list.length;
												for(i=0; i<schedule_list_length; i++) {
													result += data.schedule_list[i];
												}

												// TODO
												//$('#id_schedule_option').text(result);
												//$('#id_bulk_schedule_option').text("");

												// Get Attandance Employee List
												employee_leave_list = null
												result = create_attandance_table(data.employee_list, employee_leave_list);

												$('#id_employee_list').html(result);

												// TOTAL
												$("#totalNDP").html(data.totalNDP);
												$("#totalNNP").html(data.totalNNP);
												$("#totalPDP").html(data.totalPDP);
												$("#totalPNP").html(data.totalPNP);

												$("#totalNDA").html(data.totalNDA);
												$("#totalNNA").html(data.totalNNA);
												$("#totalPDA").html(data.totalPDA);
												$("#totalPNA").html(data.totalPNA);

												/*
												$("#totalNDM").html(data.totalNDM);
												$("#totalNNM").html(data.totalNNM);
												$("#totalPDM").html(data.totalPDM);
												$("#totalPNM").html(data.totalPNM);
												*/

												if(data.totalNDM>=0)
													$("#totalNDM").html("<span class='text-danger'>" + data.totalNDM + "</span>");
												else
													$("#totalNDM").html("<span class='text-danger'>" + data.totalNDM + "</span>");

												if(data.totalNNM>=0)
													$("#totalNNM").html("<span class='text-danger'>" + data.totalNNM + "</span>");						
												else
													$("#totalNNM").html("<span class='text-danger'>" + data.totalNNM + "</span>");
												
												if(data.totalPDM>=0)
													$("#totalPDM").html("<span class='text-danger'>" + data.totalPDM + "</span>");						
												else
													$("#totalPDM").html("<span class='text-danger'>" + data.totalPDM + "</span>");

												if(data.totalPNM>=0)
													$("#totalPNM").html("<span class='text-danger'>" + data.totalPNM + "</span>");						
												else
													$("#totalPNM").html("<span class='text-danger'>" + data.totalPNM + "</span>");


											}
										}
									});
					    			
							 		$("#dailyAttendanceDataEntryForm:input").attr("disabled", true);
							 		$("#dailyAttendanceDataEntryForm").trigger("reset");

									$("#totalNDP").html("");
									$("#totalNNP").html("");
									$("#totalPDP").html("");
									$("#totalPNP").html("");

									$("#totalNDA").html("");
									$("#totalNNA").html("");
									$("#totalPDA").html("");
									$("#totalPNA").html("");

									$("#totalNDM").html("");
									$("#totalNNM").html("");
									$("#totalPDM").html("");
									$("#totalPNM").html("");

									$("#id_absent_check").prop("checked", false);
									$("#id_late_check").prop("checked", false);
									$("#id_phone_check").prop("checked", false);

					    		} else {
					    			alert("ERROR: Please contact IT");
					    		}
					    		
					    	}
					    });
					   	$.LoadingOverlay("hide");
					}
		        },
		        cancel: {
		        	text: 'ยกเลิก',
		        	btnClass: 'btn-default',		        	
		        	action: function () {
		            	//$.alert('Canceled!');
		        	}
		        }
		    }
		});

    });

 	$("#cancelDailyAttendanceButton").click( function() {
    	event.preventDefault();    	

    	//$("#id_cus_id").val("0002526");
    	//$("#id_cus_id").val("0001486");
    	//$("#id_cus_brn").val("000");
    	//$("#id_cus_vol").val("001");

    	//$("#id_cus_id").val("");
    	$("#id_cus_brn").val("");
    	//$("#id_cus_vol").val("");

    	clearEmployeeListTable();
    	disableAllElements();

		$("#id_dly_date").attr("readonly", false);
		$("#id_search_shift_option").attr("readonly", false);

		$("#id_cus_id").attr("readonly", false);
		$("#id_cus_brn").attr("readonly", false);
		$("#id_cus_vol").attr("readonly", false);
		$("input[name=searchOptions]").attr("disabled", false);		

		$("#totalNDP").html("");
		$("#totalNNP").html("");
		$("#totalPDP").html("");
		$("#totalPNP").html("");

		$("#totalNDA").html("");
		$("#totalNNA").html("");
		$("#totalPDA").html("");
		$("#totalPNA").html("");

		$("#totalNDM").html("");
		$("#totalNNM").html("");
		$("#totalPDM").html("");
		$("#totalPNM").html("");

		// Clear red highlight textbox
		$("#id_relief_emp_id").css('border-color','');
		$("#id_relief_emp_id").css('border-style','');
		$("#id_call_amount_option").css('border-color','');		
		$("#id_call_amount_option").css('border-style','');
		$("#id_shift_option").css('border-color','');
		$("#id_shift_option").css('border-style','');
		$("#id_late_hour").css('border-color','');
		$("#id_late_hour").css('border-style','');			

		$("#daily_attendance_search_form :input").attr("disabled", false);					

        $("#id_customer_wage_rate_id").val(0);
        $("#id_customer_zone_id").val(0);

        $("#tab2-tab").text("Schedule Information");
        
        $('#cusomer_information_form').trigger("reset");
        
		//$("#id_customer_contract_service tbody").html("<tr><td colspan='19' class='text-center'><br><br><br>There is no data.<br><br><br><br></td></tr>");
		$('#id_customer_contract_service tbody').empty()

        $("#id_customer_schedule_list tbody").html("<tr><td colspan='16' class='text-center'><br><br><br>There is no data.<br><br><br><br></td></tr>");		

        $("#id_late_check").prop("checked", false);

		$('#id_emp_status').css('border-color', '');		    			
		$('#id_emp_status').css('background-color', '');

		$('#id_relief_emp_status').css('border-color', '');
		$('#id_relief_emp_status').css('background-color', '');

		$("#id_bulk_shift_list_option").css('border-color', '');
		$("#id_bulk_shift_list_option").css('background-color', '');
		$("#id_bulk_shift_list_option").css('border-style', '');

    	$("#id_cus_id").focus();
    	$("#id_cus_id").select();
    });

 	function clearRedHighlightTextbox() {
		// Clear red highlight textbox
		$("#id_call_amount_option").css('border-color','');		
		$("#id_call_amount_option").css('border-style','');
		$("#id_shift_option").css('border-color','');
		$("#id_shift_option").css('border-style',''); 		
 	}

	function export_to_excel() {
	  $(".buttons-excel").trigger("click");  
	}

</script>
{% endblock %}
		
