{% extends "page_generic.html" %}
{% load i18n %}
{% load static %}
{% load widget_tweaks %}
{% block title %}{{ page_title}} - Daily Attendance{% endblock %}
{% load static %}

{% block content %}
 	<!-- Content Wrapper. Contains page content -->
	<div class="content-wrapper">
	
		<div class="content-header">
			<div class="col-6 offset-3">

			</div>
		</div>

    	<!-- Main content -->
    	<section class="content">

    		<!-- SEARCH FORM -->
			<div class="card card-outline card-success" id="daily_attendance_search_card">
			  <div class="card-header">
			    <h3 class="card-title"><i class="fas fa-tasks"></i>&nbsp;&nbsp;<b>Daily Attendance</b></h3>
			    <div class="card-tools">
			 		<button type="button" class="btn btn-tool" data-card-widget="maximize"><i class="fas fa-expand"></i></button>
			      	<button type="button" class="btn btn-tool" data-card-widget="collapse"><i class="fas fa-minus"></i></button>
			    </div>
			    <!-- /.card-tools -->

			  </div>

			  <!-- /.card-header -->
			  <div class="card-body">
				<form class="form-inline" name="daily_attendance_search_form">
					{% csrf_token %}

			  	<div class="row col-12 bg-light">

			  		<div class="float-left text-left col-5">
					    <div class="form-inline">
					        <label class="control-label">Date</label>&nbsp;&nbsp;				        
					        <input type="text" class="form-control form-control-sm" id="id_date" placeholder="dd/mm/yyyy">&nbsp;&nbsp;
					    	<label class="control-label">Shift</label>&nbsp;&nbsp;
					        <select id="id_shift_option" class="form-control form-control-sm">
							  <option value="0">---------</option>
							  <option value="1" selected="">A | All</option>
							  <option value="2">D | Day shift</option>
							  <option value="3">N | Night shift</option>
					        </select>					        
					    </div>
					</div>

					<div class="float-right text-right col-7">
					    <div class="form-group">
		                      <input class="form-check-input" type="radio" name="searchOptions" id="id_search_by_cnt_id" value="1" checked>
		                      <label class="control-label" for="id_search_by_cnt_id">Contract No</label>&nbsp;
		                      <input type="number" min=0 id="id_cus_id" class="col-2" value="0002526">&nbsp;
		                      <input type="number" min=0 id="id_cus_brn" class="col-1" value="000">&nbsp;
		                      <input type="number" min=0 id="id_cus_vol" class="col-1" value="001">&nbsp;&nbsp;&nbsp;
		                      <input class="form-check-input" type="radio" name="searchOptions" id="id_search_by_empid" value="2" readonly>
		                      <label class="control-label" for="id_search_by_empid">Employee ID</label>&nbsp;
		                      <input type="text" id="id_emp_id" class="col-2" readonly>
	                    </div>
	                </div>

					    <!--
					    <div class="form-group">
					      <button type="button" id="generated_date_ok_button" class="btn btn-primary btn-sm">&nbsp;&nbsp;&nbsp;&nbsp;OK&nbsp;&nbsp;&nbsp;&nbsp;</button>&nbsp;
					      <button type="reset" class="btn btn-secondary btn-sm">Cancel</button>
					    </div>
					    -->	    					
				</div>
				</form>
			  </div>
			  <!-- /.card-body -->

			  <div class="card-footer">
			  	<!-- content goes here -->
			  </div>
			  <!-- /.card-footer -->
			</div>
			<!-- /.card -->







			<!-- DATA ENTRY FORM -->
			<div class="card card-outline card-secondary" id="daily_attendance_data_entry_card">

			  <!--
			  <div class="card-header">
			    <div class="card-tools">
			    	<button id="save_button" type="button" class="btn btn-success btn-sm"><i class="fas fa-plus fa-sm"></i>&nbsp;&nbsp;{% trans 'Add' %}</button>&nbsp;&nbsp;|&nbsp;&nbsp;
		        	<button id="save_button" type="button" class="btn btn-primary btn-sm"><i class="fas fa-save fa-sm"></i>&nbsp;&nbsp;{% trans 'Save' %}</button>
		        	<button id="delete_button" type="button" class="btn btn-danger btn-sm"><i class="fas fa-trash fa-sm"></i>&nbsp;&nbsp;{% trans 'Delete' %}</button>
			    </div>	
			  </div>
			  -->

			  <div class="card-body">
				<form class="form-inline" name="daily_attendance_form">
					{% csrf_token %}
				</form>

				<!-- Tab Header -->
		        <div class="clearfix">
		          <div class="float-left">
		            <ul class="nav nav-tabs navbar-expand nav-fill" id="customer" role="tablist">

		              <li class="nav-item active">
		                <a class="nav-link active" id="tab1-tab" data-toggle="tab" href="#tab1" role="tab" aria-controls="tab1">{% trans 'Attendance Information' %}</a>
		              </li>

		              <li class="nav-item">
		                <a class="nav-link" id="tab2-tab" data-toggle="tab" href="#tab2" role="tab" aria-controls="tab2">{% trans 'Contract/Schedule Information' %}</a>
		              </li>

		            </ul>        
		          </div>
		        </div>


		        <!-- Tab Body -->
		        <div class="tab-content" id="dailyAttendanceBodyTab">
		            <div class="tab-pane fade show active pt-2" id="tab1" role="tabpanel" aria-labelledby="tab1-tab">

		            	<div id="id_schedule_option">

		            	</div>

						<table class="table table-sm">
						  <thead>
						    <tr>
						      <th scope="col"></th>
						      <th scope="col">No</th>
						      <th scope="col">Emp ID</th>
						      <th scope="col">Name</th>
						      <th scope="col">Rank</th>
						      <th scope="col">Shift</th>
						      <th scope="col">Late</th>
						      <th scope="col">Full</th>
						      <th scope="col">Relief</th>
						      <th scope="col">Rel. ID</th>
						    </tr>
						  </thead>
						  <tbody>
						    <tr>
						      <td colspan="10" class="text-center"><br>There is no data.</td>
						    </tr>
						  </tbody>
						</table>

		        	</div>

		            <div class="tab-pane fade show" id="tab2" role="tabpanel" aria-labelledby="tab2-tab">
		            	2
		        	</div>

		        </div>



			  </div>
			  <!-- /.card-body -->

			  <div class="card-footer">
			  	<!-- content goes here -->
			  </div>
			  <!-- /.card-footer -->

			  <!--
			  <div id="test" class="overlay">
				<i class="fas fa-2x fa-sync-alt fa-spin"></i>
			  </div>
			  -->
			</div>
			<!-- /.card -->

    	</section>
	</div>
{% endblock %}

{% block javascript %}
<script>	
	$('#id_cus_id').focus();

	$(document).on('keyup keypress', '#daily_attendance_search_form input[type="text"]', function(e) {
		if(e.which == 13) {
			e.preventDefault();
			return false;
	    }
	});

    $(document).on('keypress', '#id_cus_id', function(e) {
      if(e.which == 13) {      
        e.preventDefault();

        var obj = $(this);
      	var id_cus_id = obj.val();

      	if(id_cus_id!=0) {
	      	while (id_cus_id.length < 7)
	        	id_cus_id = "0" + id_cus_id;
	      	$('#id_cus_id').val(id_cus_id);

	        $('#id_cus_brn').focus();
      	} else {
      		$(this).focus();
      	}

      }
    });

    $(document).on('keypress', '#id_cus_brn', function(e) {
      if(e.which == 13) {      
        e.preventDefault();

      	var obj = $(this);
      	var id_cus_brn = obj.val();

      	while (id_cus_brn.length < 3) 
        	id_cus_brn = "0" + id_cus_brn;
      	
      	$('#id_cus_brn').val(id_cus_brn);

        $('#id_cus_vol').focus();

      }
    });

    $(document).on('keypress', '#id_cus_vol', function(e) {
      if(e.which == 13) {      
        e.preventDefault();
        
        //alert("todo1");
    	var obj = $(this);
      	var id_cus_vol = obj.val();
      	while (id_cus_vol.length < 3) 
        	id_cus_vol = "0" + id_cus_vol;

        $('#id_cus_vol').val(id_cus_vol);

        var attendance_date = $('#id_date').val();
      	var cus_id = $('#id_cus_id').val();
      	var cus_brn = $('#id_cus_brn').val();
      	var cus_vol = $('#id_cus_vol').val();

		$.ajax({
			url : "/monitoring/ajax/get_attendance_information/",
			type : "POST",
			data : {          
		  		csrfmiddlewaretoken: '{{ csrf_token }}',
		  		attendance_date: attendance_date,
		  		cus_id: cus_id,
		  		cus_brn: cus_brn,
		  		cus_vol: cus_vol,
			},
			success : function(data) {

				if(data.is_found) {
					result = "";
					schedule_list_length = data.schedule_list.length;
					for(i=0; i<schedule_list_length; i++) {
						result += data.schedule_list[i];
					}

					$('#id_schedule_option').text(result);

				} else {
					alert("Not found");
				}
			}
		});
      	
      }
    });





    $(document).on('keypress', '#id_emp_id', function(e) {
      if(e.which == 13) {      
        e.preventDefault();
        alert("todo2");
      }
    });

	$('#id_date').datepicker({format: 'dd/mm/yyyy', altField: '#thealtdate', altFormat: 'dd/mm/yyyy', autoclose: true}).datepicker("setDate", new Date());
	
	$("input:radio[name='searchOptions']").change(function(){
		var _val = $(this).val();
		if(_val==1) {
			// Search by Contract ID
			$("#id_cus_id").focus();		
			$("#id_cus_id").attr("readonly", false);
			$("#id_cus_brn").attr("readonly", false);
			$("#id_cus_vol").attr("readonly", false);

			$("#id_emp_id").attr("readonly", true);
		} else {
			// Search by Employee ID
			$("#id_emp_id").focus();
			$("#id_emp_id").attr("readonly", false);
			$("#id_cus_id").attr("readonly", true);
			$("#id_cus_brn").attr("readonly", true);
			$("#id_cus_vol").attr("readonly", true);
		}
	});


	// AJAX


</script>
{% endblock %}
		
