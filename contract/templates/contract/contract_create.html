{% extends "page_generic.html" %}

{% load i18n %}
{% load static %}
{% load widget_tweaks %}
{% load humanize %}

{% block title %}{{ page_title}} - {% trans 'Create New Contract' %} {% endblock %}

{% block content %}

<!-- Content Wrapper. Contains page content -->
<div class="content-wrapper bg-white">
  
  <div class="content-header pt-2" style="padding:0">
    <div class="col-6 offset-3">
    <form id="contract_number_form" method="POST" class="form-inline">
    {% csrf_token %}

      <div class="form-row">
        <div class="form-group">
          <label for="inputPassword6">Contract No</label>&nbsp;&nbsp;
          {% render_field contract_create_form.cus_id %}&nbsp;
          {% render_field contract_create_form.cus_brn %}&nbsp;&nbsp;
          <label for="inputPassword6">Vol</label>&nbsp;&nbsp;
          {% render_field contract_create_form.cus_vol %}&nbsp;
        
          <button id="contract_lookup" type="button" class="btn btn-outline-primary btn-md" data-toggle="modal" data-url="{% url 'get_contract_list' %}"><i class="fas fa-search fa-md"></i></button>

        </div>
      </div>
    </form>
    </div>
  </div>


  <!-- Main content -->  
  <section class="content pt-2" id="main-content">
      <form id="contractupdateform" method="POST">
      {% csrf_token %}

    
    <div class="card card-default collapsed-card" style="background-color: #DCDCDC;">

      <div class="card-header" style="padding:8px 15px 4px 4px;">
        
        <h1 class="card-title">
          <span id="customer_name_title"><button type='button' class='btn btn-success'><span style='font-size:18px;font-weight:bold;'>Customer Name</span>&nbsp;&nbsp;<span class='badge badge-light'>Zone&nbsp;&nbsp;</span></button></span>
          
          <!--<button type="button" class="btn btn-tool" data-card-widget="collapse"><i class="fas fa-angle-down text-primary"></i></button>-->
        </h1>

        <div class="card-tools">


          <button class="btn btn-info btn-sm dropdown-toggle" role="button" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            <i class="fas fa-print fa-sm"></i>&nbsp;&nbsp;Print
          </button>
          <div class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenuLink">
            
            <a class="dropdown-item" href="#" onclick="print_contract()"><i class="fa fa-eye text-secondary" aria-hidden="true"></i>&nbsp;&nbsp;Display on screen</a>
            
            <input type="hidden" id="id_cnt_id_temp" name="cnt_id_temp" value="">

            <a class="dropdown-item" href="#" onclick="download_contract('{{contract.cnt_id}}')"><i class="fas fa-download text-secondary"></i>&nbsp;&nbsp;Download file</a>            
          </div>

          &nbsp;&nbsp;
          <button id="cancelCreateContract" type="reset" class="btn btn-sm btn-warning pull-right">Cancel</button>
          <button id="saveContract" class="btn btn-sm btn-primary"><i class="fas fa-save fa-sm"></i>&nbsp;&nbsp;{% trans 'Save' %}</button>

          <!--
          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
          <button type="button" class="btn btn-tool" data-card-widget="collapse"><i class="fas fa-plus text-primary"></i></button>
          -->
        </div>


      </div>

      <div class="card-body" style="background-color: #E8E8E8; padding:4px 2px 2px 2px;">

        <div class="" id="show-error">
        {% if contract_create_form.errors %}
            {% for field in form %}                
                {% for error in field.errors %}
                    <div class="alert alert-danger">
                        <i class="fas fa-exclamation"></i>&nbsp;&nbsp;Your data is not correct. {{ field.name }} - {{ error }}
                    </div>
                {% endfor %}
            {% endfor %}
        {% else %}
          {% if form_is_valid %}
            <div class="alert alert-success">
                <i class="fas fa-save"></i>&nbsp;&nbsp;Saved complete. Back to <a href="{% url 'customer-list' %}">Customer List</a>
            </div>
          {% endif %}
        {% endif %}
        </div>


        <div class="row">

          <div class="col-12">

            <ul class="nav nav-tabs" id="myTab" role="tablist">
              <li class="nav-item">
                <a class="nav-link active" id="thai-tab" data-toggle="tab" href="#thai" role="tab" aria-controls="thai" aria-selected="true">TH</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" id="english-tab" data-toggle="tab" href="#english" role="tab" aria-controls="english" aria-selected="false">EN</a>
              </li>
            </ul>

            <div class="tab-content bg-white" id="myTabContent" style="padding:2px 5px 2px 5px;">

              <div class="tab-pane fade show active" id="thai" role="tabpanel" aria-labelledby="thai-tab">

                <div class="form-row">
                  <div class="form-group col-md-4">
                    <label for="cus_name_th">{% trans 'Company' %}</label>
                    <input type="text" class="form-control form-control-sm" id="id_cus_name_th" name="cus_name_th" readonly value="{{ customer.cus_name_th }}">
                  </div>
                  <div class="form-group col-md-2">
                    <label for="id_cus_sht_th">{% trans 'Site Name' %}</label>
                    <input type="text" class="form-control form-control-sm" id="id_cus_sht_th" name="cus_sht_th" readonly value="">
                  </div>
                  <div class="form-group col-md-6">
                    <label for="cus_add_th">{% trans 'Address' %}</label>
                    <input type="text" class="form-control form-control-sm" id="id_cus_add_th" name="cus_add1_th" readonly value="{{ customer.cus_add1_th }}">
                  </div>                  
                </div>

                <div class="form-row">
                  <div class="form-group col-md-4">
                    <label for="id_cus_subdist_th">{% trans 'Sub-District' %}</label>
                    <input type="text" class="form-control form-control-sm" id="id_cus_subdist_th" name="cus_subdist_th" readonly value="{{ customer.cus_subdist_th }}">
                  </div>
                  <div class="form-group col-md-2">
                    <label for="id_cus_district_th">{% trans 'District' %}</label>
                    <input type="text" class="form-control form-control-sm" id="id_cus_district_th" name="cus_district_th" readonly value="{{ customer.cus_district }}">
                  </div>
                  <div class="form-group col-md-2">
                    <label for="id_cus_city_th">{% trans 'City' %}</label>
                    <input type="text" class="form-control form-control-sm" id="id_cus_city_th" name="cus_city_th" readonly value="{{ customer.cus_city }}">
                  </div>                  
                  <div class="form-group col-md-2">
                    <label for="id_cus_country_th">{% trans 'Country' %}</label>
                    <input type="text" class="form-control form-control-sm" id="id_cus_country_th" name="cus_country_th" readonly value="{{ customer.cus_country }}">
                  </div>                  
                  <div class="form-group col-md-2">
                    <label for="id_cus_zip_th">{% trans 'Zip' %}</label>
                    <input type="text" class="form-control form-control-sm" id="id_cus_zip_th" name="cus_zip_th" readonly value="{{ customer.cus_zip }}">
                  </div>                                    
                </div>

                <!-- CONTACT -->
                <div class="form-row">

                  <div class="form-group col-md-2">
                    <label for="id_cus_tel_th">{% trans 'Phone' %}</label>
                    <input type="text" class="form-control form-control-sm" id="id_cus_tel_th" name="cus_tel_th" readonly value="{{ customer.cus_tel }}">
                  </div>
                  <div class="form-group col-md-2">
                    <label for="id_cus_fax_th">{% trans 'Fax' %}</label>
                    <input type="text" class="form-control form-control-sm" id="id_cus_fax_th" name="cus_fax_th" readonly value="{{ customer.cus_fax }}">
                  </div>
                  <div class="form-group col-md-2">
                    <label for="id_site_contact_con_th">{% trans 'Contact' %}</label>
                    <input type="text" class="form-control form-control-sm" id="id_site_contact_con_th" name="site_contact_con_th" readonly value="{customer.site_contact_id}} {{customer.site_contact.con_fname_th}}&nbsp;{{customer.site_contact.con_lname_th}}">
                  </div>

                  <div class="form-group col-md-2">
                    <label for="id_site_contact_con_position_th">{% trans 'Position' %}</label>
                    <input type="text" class="form-control form-control-sm" id="id_site_contact_con_position_th" name="site_contact_con_position_th" readonly value="{{ customer.site_contact.con_position_th }}">
                  </div>                  
                  <div class="form-group col-md-2">
                    <label for="id_cus_email_th">{% trans 'Email' %}</label>
                    <input type="text" class="form-control form-control-sm" id="id_cus_email_th" name="cus_email_th" readonly value="{{ customer.cus_email }}">
                  </div>                  
                  <div class="form-group col-md-2">
                    <label for="id_cus_zone_th">{% trans 'Zone' %}</label>
                    <input id="id_cus_zone_th" type="text" class="form-control form-control-sm" readonly>
                    <input id="id_cus_zone_id" name="cus_zone_id" type="hidden">
                  </div>                  

                </div>

              </div>


              <!-- EN Tab -->
              <div class="tab-pane fade" id="english" role="tabpanel" aria-labelledby="english-tab">
                <div class="form-row">
                  <div class="form-group col-md-4">
                    <label for="id_cus_name_en">{% trans 'Company' %}</label>
                    <input type="text" class="form-control form-control-sm" id="id_cus_name_en" name="cus_name_en" readonly value="{{ customer.cus_name_en }}">
                  </div>
                  <div class="form-group col-md-2">
                    <label for="id_cus_sht_en">{% trans 'Site Name' %}</label>
                    <input type="text" class="form-control form-control-sm" id="id_cus_sht_en" name="cus_sht_en" readonly value="">
                  </div>
                  <div class="form-group col-md-6">
                    <label for="id_cus_add_en">{% trans 'Address' %}</label>
                    <input type="text" class="form-control form-control-sm" id="id_cus_add_en" name="cus_add_en" readonly value="{{ customer.cus_add1_en }}&nbsp;{{ customer.cus_add2_en }}">
                  </div>                  
                </div>

                <div class="form-row">
                  <div class="form-group col-md-4">
                    <label for="id_cus_subdist_en">{% trans 'Sub-District' %}</label>
                    <input type="text" class="form-control form-control-sm" id="id_cus_subdist_en" name="cus_subdist_en" readonly value="{{ customer.cus_subdist_en }}">
                  </div>
                  <div class="form-group col-md-2">
                    <label for="cus_district">{% trans 'District' %}</label>
                    <input type="text" class="form-control form-control-sm" id="id_cus_district_en" name="cus_district_en" readonly value="{{ customer.cus_district.dist_en }}">
                  </div>
                  <div class="form-group col-md-2">
                    <label for="cus_city">{% trans 'City' %}</label>
                    <input type="text" class="form-control form-control-sm" id="id_cus_city_en" name="cus_city_en" id_cus_districtreadonly value="{{ customer.cus_city.city_en }}">
                  </div>                  
                  <div class="form-group col-md-2">
                    <label for="cus_country">{% trans 'Country' %}</label>
                    <input type="text" class="form-control form-control-sm" id="id_cus_country_en" name="cus_country_en" readonly value="{{ customer.cus_country.country_en }}">
                  </div>                  
                  <div class="form-group col-md-2">
                    <label for="cus_country">{% trans 'Zip' %}</label>
                    <input type="text" class="form-control form-control-sm" id="id_cus_zip_en" name="cus_zip_en" readonly value="{{ customer.cus_zip }}">
                  </div>                                    
                </div>

                <!-- Contact EN -->
                <div class="form-row">
                  <div class="form-group col-md-2">
                    <label for="id_cus_tel_en">{% trans 'Phone' %}</label>
                    <input type="text" class="form-control form-control-sm" id="id_cus_tel_en" name="cus_tel_en" readonly value="{{ customer.cus_tel }}">
                  </div>
                  <div class="form-group col-md-2">
                    <label for="id_cus_fax_en">{% trans 'Fax' %}</label>
                    <input type="text" class="form-control form-control-sm" id="id_cus_fax_en" name="cus_fax_en" readonly value="{{ customer.cus_fax }}">
                  </div>
                  <div class="form-group col-md-2">
                    <label for="id_site_contact_con_en">{% trans 'Contact' %}</label>
                    <input type="text" class="form-control form-control-sm" id="id_site_contact_con_en" name="site_contact_con_en" readonly value="{{customer.site_contact_id}} {{customer.site_contact.con_fname_en}}&nbsp;{{customer.site_contact.con_lname_en}}">
                  </div>
                  <div class="form-group col-md-2">
                    <label for="id_site_contact_con_position_en">{% trans 'Position' %}</label>
                    <input type="text" class="form-control form-control-sm" id="id_site_contact_con_position_en" name="site_contact_con_position_en" readonly value="{{ customer.site_contact.con_position_en }}">
                  </div>                  
                  <div class="form-group col-md-2">
                    <label for="id_cus_email_en">{% trans 'Email' %}</label>
                    <input type="text" class="form-control form-control-sm" id="id_cus_email_en" name="cus_email_en" readonly value="{{ customer.cus_email }}">
                  </div>                  
                  <div class="form-group col-md-2">
                    <label for="id_cus_zone_en">{% trans 'Zone' %}</label>
                    <input id="id_cus_zone_en" type="text" class="form-control form-control-sm" readonly>
                  </div>                  

                </div>

              </div>
            </div>
          </div>


        </div>
        <!-- /.row -->
      </div>
      <!-- /.card-body -->
    </div>
    <!-- /.card -->







    <div class="card card-default">



      <div class="card-header" style="background-color: #DCDCDC; padding:5px 18px 0 0;">                
        <!--<div class="float-left"><h2 class="m-0 text-dark">{{contract.cnt_id}}</h2></div>-->
        <div class="float-left pl-1">
          <h1 class="card-title pt-1"><!--<i class="nav-icon fa fa-handshake"></i>&nbsp;&nbsp;--><strong>{% trans 'Contract Info' %}</strong></h1>
        </div>
        
        <div class="card-tools">

          <div class="float-left">

            <!-- Use new report condition | N or empty -->
            <div class="form-check d-inline">
              {% if contract.cnt_new == 'N' %}
              <input class="form-check-input" id="id_cnt_new" name="cnt_new" type="checkbox" checked>
              {% else %}
              <input class="form-check-input" id="id_cnt_new" name="cnt_new" type="checkbox">
              {% endif %}
              <label for="id_cnt_new" class="form-check-label" style="cursor: pointer;">New Report</label>&nbsp;&nbsp;&nbsp;&nbsp;
            </div>

            <!-- Amendment Flag -->
            <div class="form-check d-inline">
              <input class="form-check-input" id="id_amendment" name="amendment" type="checkbox">
              <label for="id_amendment" class="form-check-label" style="cursor: pointer;">Amendment</label>&nbsp;&nbsp;&nbsp;&nbsp;
            </div>

            <!-- Display Address condition | C or S -->
            <div class="form-check d-inline">
              {% if contract.cnt_print == 'C' %}
              <input class="form-check-input" id="id_cnt_print" name="cnt_print" type="checkbox" checked>
              <label id="id_cnt_print_label" class="form-check-label">Customer</label>&nbsp;&nbsp;&nbsp;&nbsp;
              {% else %}
              <input class="form-check-input" id="id_cnt_print" name="cnt_print" type="checkbox">
              <label for="id_cnt_print" id="id_cnt_print_label" class="form-check-label" style="cursor: pointer;">Site Address</label>&nbsp;&nbsp;&nbsp;&nbsp;
              {% endif %}
            </div>

            <!-- Auto expired | 0 or 1-->
            <div class="form-check d-inline">
              {% if contract.cnt_autoexpire %}
              <input class="form-check-input" id="id_cnt_autoexpire" name="cnt_autoexpire" type="checkbox" checked>
              {% else %}
              <input class="form-check-input" id="id_cnt_autoexpire" name="cnt_autoexpire" type="checkbox">
              {% endif %}
              <label for="id_cnt_autoexpire" class="form-check-label text-danger" style="cursor: pointer;">Auto expire</label>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;

              &nbsp;&nbsp;&nbsp;&nbsp;
              {% if contract.cnt_then == 'T' %}
              <div class="form-check form-check-inline">
                Print &nbsp;&nbsp;&nbsp;              
                <input class="form-check-input" type="radio" name="printOptions" id="id_print_th" value="T" checked>
                <label class="form-check-label" for="id_print_th">Thai</label>
              </div>
              <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="printOptions" id="id_print_en" value="E">
                <label class="form-check-label" for="id_print_en">English</label>
              </div>
              {% elif contract.cnt_then == 'E' %}
              <div class="form-check form-check-inline">
                Print &nbsp;&nbsp;          
                <input class="form-check-input" type="radio" name="printOptions" id="id_print_th" value="T">
                <label class="form-check-label" for="id_print_th" style="cursor: pointer;">Thai</label>
              </div>
              <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="printOptions" id="id_print_en" value="E" checked>
                <label class="form-check-label" for="id_print_en" style="cursor: pointer;">English</label>
              </div>
              {% else %}
              <div class="form-check form-check-inline">
                Print &nbsp;&nbsp;          
                <input class="form-check-input" type="radio" name="printOptions" id="id_print_th" value="T" checked>
                <label class="form-check-label" for="id_print_th" style="cursor: pointer;">Thai</label>
              </div>
              <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="printOptions" id="id_print_en" value="E">
                <label class="form-check-label" for="id_print_en" style="cursor: pointer;">English</label>
              </div>          
              {% endif %}
                          
            </div>                        

            <div class="float-right">

              <div class="btn-group">
                <label class="switch">                                 
                  {% if contract.cnt_active|default_if_none:0 %}
                  <input type="checkbox" id="id_cnt_active" name="cnt_active" value=1 checked>
                  {% else %}
                  <input type="checkbox" id="id_cnt_active" name="cnt_active" value=0>
                  {% endif %}                  
                  <div class="slider"></div>
                </label>  
              </div>

            </div>




          </div>

          {% comment %}
          &nbsp;        
          {% render_field contract_create_form.cnt_active id="id_cnt_active" class="form-control" type="checkbox" data-toggle="toggle" data-on="Active" data-off="Pending" data-onstyle="success" data-offstyle="danger"%}
          {% endcomment %}

        </div>
      </div>
      <!-- /.card-header -->

      <div class="card-body" style="background-color: #F0F0F0;">


        <div class="row">

          <div class="col-6">

            <div class="form-row">
              <!-- cnt_doc_no -->
              <div class="form-group col-md-6">
                <label for="id_cnt_doc_no">{% trans 'Contract Ref.' %}</label>
                <input id="id_cnt_doc_no" name="cnt_doc_no" type="text" class="form-control form-control-sm" value="{{contract.cnt_doc_no|default_if_none:''}}" autocomplete="off">
              </div>
              
              <!-- cnt_doc_date -->
              <div class="form-group col-md-6">
                <label>&nbsp;</label>                
                <div class="input-group date" id="dtp_cnt_doc_date" data-target-input="nearest">

                  {% if contract.cnt_doc_date|date:"d/m/Y" != "" %}
                    {% if contract.cnt_eff_frm|date:"d/m/Y" != "31/12/2999" %}
                    <input type="checkbox" checked id="chkCNTDocDate" class="form-inline float-left" onclick="checkCNTDocDateStatus()" style="margin-top:9px;">&nbsp;
                    <input type="text" name="cnt_doc_date" class="form-control form-control-sm" id="id_cnt_doc_date" value="{{contract.cnt_doc_date|date:'d/m/Y'}}" required="">
                    {% else %}
                    <input type="checkbox" id="chkCNTDocDate" class="form-inline float-left" onclick="checkCNTDocDateStatus()" style="margin-top:9px;">&nbsp;
                    <input type="text" name="cnt_doc_date" class="form-control form-control-sm" id="id_cnt_doc_date" value="{% now 'd/m/Y'%}" required="" readonly="">
                    {% endif %}
                  {% else %}
                    <input type="checkbox" id="chkCNTDocDate" class="form-inline float-left" onclick="checkCNTDocDateStatus()" style="margin-top:9px;">&nbsp;
                    <input type="text" name="cnt_doc_date" class="form-control form-control-sm" id="id_cnt_doc_date" value="{% now 'd/m/Y'%}" required="" readonly="">
                  {% endif %}

                  <!--
                  {{ contract_create_form.cnt_doc_date }}
                  <div class="input-group-append" data-target="#dtp_cnt_doc_date" data-toggle="datepicker">
                    <div class="input-group-text text-primary"><i class="fa fa-calendar"></i></div>
                  </div>
                  -->
                </div>                
              </div>

            </div>

            <div class="form-row">
              <!-- cnt_eff_frm -->
              <div class="form-group col-md-6">
                <label for="id_cnt_eff_frm">{% trans 'Effect Term' %}</label>
                <div class="input-group date" id="dtp_cnt_eff_frm" data-target-input="nearest">

                  {% if contract.cnt_eff_frm|date:"d/m/Y" != "" %}
                    {% if contract.cnt_eff_frm|date:"d/m/Y" != "31/12/2999" %}
                    <input type="checkbox" checked id="chkCNTEffFrom" class="form-inline float-left" onclick="checkCNTEffFromStatus()" style="margin-top:9px;">&nbsp;
                    <input type="text" name="id_cnt_eff_frm" class="form-control form-control-sm" id="id_cnt_eff_frm" value="{{contract.cnt_eff_frm|date:'d/m/Y'}}" required="">
                    {% else %}
                    <input type="checkbox" id="chkCNTEffFrom" class="form-inline float-left" onclick="checkCNTEffFromStatus()" style="margin-top:9px;">&nbsp;
                    <input type="text" name="id_cnt_eff_frm" class="form-control form-control-sm" id="id_cnt_eff_frm" value="{% now 'd/m/Y'%}" readonly>
                    {% endif %}
                  {% else %}
                    <input type="checkbox" id="chkCNTEffFrom" class="form-inline float-left" onclick="checkCNTEffFromStatus()" style="margin-top:9px;">&nbsp;
                    <input type="text" name="id_cnt_eff_frm" class="form-control form-control-sm" id="id_cnt_eff_frm" value="{% now 'd/m/Y'%}" readonly>
                  {% endif %}

                  <!--
                  {{ contract_create_form.cnt_eff_frm }}
                  <div class="input-group-append" data-target="#dtp_cnt_eff_frm" data-toggle="datepicker">
                    <div class="input-group-text text-primary"><i class="fa fa-calendar"></i></div>
                  </div>
                  -->
                </div>
              </div>
              
              <!-- cnt_eff_to -->
              <div class="form-group col-md-6">
                <label for="id_cnt_eff_to">&nbsp;</label>
                <div class="input-group date" id="dtp_cnt_eff_to" data-target-input="nearest">

                  {% if contract.cnt_eff_to|date:"d/m/Y" != "" %}
                    {% if contract.cnt_eff_to|date:"d/m/Y" != "31/12/2999" %}
                    <input type="checkbox" checked id="chkCNTEffTo" class="form-inline float-left" onclick="checkCNTEffToStatus()" style="margin-top:9px;">&nbsp;
                    <input type="text" name="id_cnt_eff_to" class="form-control form-control-sm" id="id_cnt_eff_to" value="{{contract.cnt_eff_to|date:'d/m/Y'}}" required="">
                    {% else %}
                    <input type="checkbox" id="chkCNTEffTo" class="form-inline float-left" onclick="checkCNTEffToStatus()" style="margin-top:9px;">&nbsp;
                    <input type="text" name="id_cnt_eff_to" class="form-control form-control-sm" id="id_cnt_eff_to" value="{% now 'd/m/Y'%}" required="" readonly="">                    
                    {% endif %}
                  {% else %}
                    <input type="checkbox" id="chkCNTEffTo" class="form-inline float-left" onclick="checkCNTEffToStatus()" style="margin-top:9px;">&nbsp;
                    <input type="text" name="id_cnt_eff_to" class="form-control form-control-sm" id="id_cnt_eff_to" value="{% now 'd/m/Y'%}" required="" readonly="">
                  {% endif %}
  
                  <!--                  
                  {{ contract_create_form.cnt_eff_to }}
                  <div class="input-group-append" data-target="#dtp_cnt_eff_to" data-toggle="datepicker">
                    <div class="input-group-text text-primary"><i class="fa fa-calendar"></i></div>
                  </div>
                  -->
                </div>
              </div>              
            </div>

            <div class="form-row">
              <div class="form-group col-md-6">
                <label for="id_cnt_sign_frm">{% trans 'Contract Term' %}</label>
                <div class="input-group date" id="dtp_cnt_sign_frm" data-target-input="nearest">

                  {% if contract.cnt_sign_frm|date:"d/m/Y" != "" %}
                    {% if contract.cnt_sign_frm|date:"d/m/Y" != "31/12/2999" %}
                    <input type="checkbox" checked id="chkCNTSignFrom" class="form-inline float-left" onclick="checkCNTSignFromStatus()" style="margin-top:9px;">&nbsp;
                    <input type="text" name="id_cnt_sign_frm" class="form-control form-control-sm" id="id_cnt_sign_frm" value="{{contract.cnt_sign_frm|date:'d/m/Y'}}" required="">
                    {% else %}
                    <input type="checkbox" id="chkCNTSignFrom" class="form-inline float-left" onclick="checkCNTSignFromStatus()" style="margin-top:9px;">&nbsp;
                    <input type="text" name="id_cnt_sign_frm" class="form-control form-control-sm" id="id_cnt_sign_frm" value="{% now 'd/m/Y'%}" required="" readonly="">                    
                    {% endif %}
                  {% else %}
                    <input type="checkbox" id="chkCNTSignFrom" class="form-inline float-left" onclick="checkCNTSignFromStatus()" style="margin-top:9px;">&nbsp;
                    <input type="text" name="id_cnt_sign_frm" class="form-control form-control-sm" id="id_cnt_sign_frm" value="{% now 'd/m/Y'%}" required="" readonly="">
                  {% endif %}
                  <!--
                  {{ contract_create_form.cnt_sign_frm }}
                  <div class="input-group-append" data-target="#dtp_cnt_sign_frm" data-toggle="datepicker">
                    <div class="input-group-text text-primary"><i class="fa fa-calendar"></i></div>
                  </div>
                  -->
                </div>
              </div>

              <div class="form-group col-md-6">
                <label for="id_cnt_sign_to">&nbsp;</label>
                <div class="input-group date" id="dtp_cnt_sign_to" data-target-input="nearest">

                  {% if contract.cnt_sign_to|date:"d/m/Y" != "" %}
                    {% if contract.cnt_sign_to|date:"d/m/Y" != "31/12/2999" %}
                    <input type="checkbox" checked id="chkCNTSignTo" class="form-inline float-left" onclick="checkCNTSignToStatus()" style="margin-top:9px;">&nbsp;
                    <input type="text" name="id_cnt_sign_to" class="form-control form-control-sm" id="id_cnt_sign_to" value="{{contract.cnt_sign_to|date:'d/m/Y'}}" required="">
                    {% else %}
                    <input type="checkbox" id="chkCNTSignTo" class="form-inline float-left" onclick="checkCNTSignToStatus()" style="margin-top:9px;">&nbsp;
                    <input type="text" name="id_cnt_sign_to" class="form-control form-control-sm" id="id_cnt_sign_to" value="{% now 'd/m/Y'%}" required="" readonly="">                    
                    {% endif %}
                  {% else %}
                    <input type="checkbox" id="chkCNTSignTo" class="form-inline float-left" onclick="checkCNTSignToStatus()" style="margin-top:9px;">&nbsp;
                    <input type="text" name="id_cnt_sign_to" class="form-control form-control-sm" id="id_cnt_sign_to" value="{% now 'd/m/Y'%}" required="" readonly="">
                  {% endif %}

                  <!--                  
                  {{ contract_create_form.cnt_sign_to }}
                  <div class="input-group-append" data-target="#dtp_cnt_sign_to" data-toggle="datepicker">
                    <div class="input-group-text text-primary"><i class="fa fa-calendar"></i></div>
                  </div>
                  -->
                </div>                
              </div>   
            </div>

          </div>



          <div class="col-6">

            <div class="form-row">
              <div class="form-group col-md-12">
                <label for="id_cnt_wage_id"><span class='text-danger'>*</span>&nbsp;{% trans 'Wage Rate' %}</label>
                <div class="input-group-append">
                  
                  <input type="text" id="id_wage_id_text" value="{{contract.cnt_wage_id_id}} " class="col-1 bg-green form-control form-control-sm text-center" style="border-style: none none none none; border-top-right-radius:0px;border-bottom-right-radius:0px; font-weight: bold; font-size: 16px;" readonly="">

                  <input type="text" id="id_cnt_wage_id_text" name="cnt_wage_id" class="form-control form-control-sm" value="{{contract.cnt_wage_id.wage_en}}{{contract.cnt_wage_id.wage_8hr}}" style="border-style: 1px none 1px none; border-top-left-radius:0px;border-bottom-left-radius:0px;  border-top-right-radius:0px; border-bottom-right-radius:0px;" readonly>

                  <!--
                  <input type="text" id="id_wage_id_text" value="{{contract.cnt_wage_id_id}} " class="col-1 bg-success form-control form-control-sm text-center" readonly="">
                  <input type="text" id="id_cnt_wage_id_text" name="cnt_wage_id" class="form-control form-control-sm" value="" readonly>
                  -->

                  <input type="hidden" id="id_cnt_wage_id" name="cnt_wage_id" value="{{ contract.cnt_wage_id_id|default_if_none:'' }}">

                  <button id="wage_rate_lookup" type="button" class="btn btn-outline-primary btn-sm" style="border-top-left-radius:0px;border-bottom-left-radius:0px;"data-toggle="modal" data-url="{% url 'get_wagerate_list' %}"><i class="fas fa-search fa-sm"></i></button>
                                  
                </div>                
              </div>
            </div>

            <div class="form-row">
              <div class="form-group col-md-6">
                <label for="id_cnt_guard_amt">{% trans 'Guard Amount' %}</label>
                <!--{{ contract_create_form.cnt_guard_amt }}-->
                <input type="number" name="cnt_guard_amt" min="0" step="any" class="form-control form-control-sm text-right" id="id_cnt_guard_amt" readonly="" disabled="disabled" style="font-weight: bold; font-size: 18px;">
              </div>
              <div class="form-group col-md-6">
                <label for="id_cnt_sale_amt">{% trans 'Sale Amount' %}</label>
                <!--{{ contract_create_form.cnt_sale_amt }}-->
                <!--<input type="text" id="id_cnt_sale_amt" name="cnt_sale_amt" class="form-control form-control-sm text-right inputmasking" value="0" readonly="">-->                
                <input type="text" min="0" class="form-control form-control-sm text-right " id="id_cnt_sale_amt" name="cnt_sale_amt" data-inputmask="'alias': 'numeric', 'groupSeparator': ',', 'autoGroup': true, 'digits': 2, 'digitsOptional': false, 'prefix': ' ', 'placeholder': '0.00'" readonly="" style="font-weight: bold; font-size: 18px;">
              </div>              
            </div>

            <div class="form-row">
              <div class="form-group col-md-12">
                <label for="id_cnt_apr_by_id">{% trans 'Authorized by' %}</label>
                {{ contract_create_form.cnt_apr_by_text }}
                <input type="hidden" id="id_cnt_apr_by_id" name="cnt_apr_by_id" value=100000>

              </div>                               
            </div>
          </div>
          
        </div>
        <!-- /.row -->     

        <div class="btn-group float-right">
          <!--
          <button type="button" class="btn btn-default text-info"><i class="fas fa-print fa-sm"></i>&nbsp;&nbsp;Print</button>
          <button type="button" class="btn btn-default text-info dropdown-toggle dropdown-icon" data-toggle="dropdown">
            <span class="sr-only">Toggle Dropdown</span>
            <div class="dropdown-menu" role="menu">
              <a class="dropdown-item" href="#">Thai</a>
              <div class="dropdown-divider"></div>
              <a class="dropdown-item" href="#">English</a>
            </div>
          </button>
          &nbsp;&nbsp;
          <button id="cancelCreateContract" type="reset" class="btn btn-default pull-right">Cancel</button>
          &nbsp;&nbsp;
          <button id="saveContract" class="btn btn-primary"><i class="fas fa-save fa-sm"></i>&nbsp;&nbsp;{% trans 'Save' %}</button>

          -->
        </div>


      </div>
      <!-- /.card-body -->
    </div>
    <!-- /.card -->



    <div id="service_list_table" class="card card-default">

      <div class="card-header" style="background-color: #DCDCDC; padding:5px 15px 5px 5px;">
        <h1 class="card-title pt-1"><!--<i class="fas fa-user-clock"></i>&nbsp;&nbsp;--><strong>{% trans 'Service List' %}</strong></h1>
        <div class="card-tools">        
          <button id="add_service_button" type="button" class="btn btn-success btn-sm" data-toggle="modal"><i class="fas fa-plus fa-sm"></i>&nbsp;&nbsp;{% trans 'Add new service' %}</button>
        </div>     
      </div>

      <!-- Service List -->      
      <div class="card-body" style="background-color: #FOFOFO; padding:2px;">
        <div class="row">
          
          <div class="col-md-12 table-responsive">

          <table id='customer-list-table' class='table table-striped table-sm'>
            <thead class='thead-light'>
              <tr class="table-secondary">
                <th>{% trans 'Eff Frm' %}</th>
                <th scope="col">{% trans 'Eff To' %}</th>            
                <th scope="col" nowrap>{% trans 'Shift Time' %}</th>
                <th scope="col">{% trans 'QTY' %}</th>
                <th scope="col">{% trans 'Rank' %}</th>
                <th scope="col">{% trans 'Rate' %}</th>
                <th scope="col">{% trans 'Ext.Cost' %}</th>
                <th scope="col">{% trans 'MON' %}</th>
                <th scope="col">{% trans 'TUE' %}</th>
                <th scope="col">{% trans 'WED' %}</th>
                <th scope="col">{% trans 'THU' %}</th>
                <th scope="col">{% trans 'FRI' %}</th>
                <th scope="col">{% trans 'SAT' %}</th>
                <th scope="col">{% trans 'SUN' %}</th>
                <th scope="col">{% trans 'PUB' %}</th>
                <th scope="col">{% trans 'Remark' %}</th>
                <th scope="col">{% trans 'Active' %}</th>
                <th>&nbsp;</th>
              </tr>
            </thead>
              <tbody>

                {% if cus_service %}

                {% for item in cus_service %}
                  <tr>
                  {% if item.srv_active %}
                  <td><small><a href="javascript:void(0);">{{item.srv_eff_frm|date:'d/m/Y'}}</a></small></td>
                  <td><small><a href="javascript:void(0);">{{item.srv_eff_to|date:'d/m/Y'}}</a></small></td>
                  <td><small><a href="javascript:void(0);">{{item.srv_shif_id.shf_desc}}</a></small></td>
                  <td align="center"><small><a href="javascript:void(0);">{{item.srv_qty}}</a></small></td>
                  <td><small><a href="javascript:void(0);">{{item.srv_rank}}</a></small></td>
                  <td align="right"><small><a href="javascript:void(0);">{{item.srv_rate|stringformat:".0f"}}</a></small></td>
                  <td align="right"><small><a href="javascript:void(0);">{{item.srv_cost|stringformat:".0f"}}</a></small></td>
                  <td align="center"><small><a href="javascript:void(0);">{{item.srv_mon}}</a></small></td>
                  <td align="center"><small><a href="javascript:void(0);">{{item.srv_tue}}</a></small></td>
                  <td align="center"><small><a href="javascript:void(0);">{{item.srv_wed}}</a></small></td>
                  <td align="center"><small><a href="javascript:void(0);">{{item.srv_thu}}</a></small></td>
                  <td align="center"><small><a href="javascript:void(0);">{{item.srv_fri}}</a></small></td>
                  <td align="center"><small><a href="javascript:void(0);">{{item.srv_sat}}</a></small></td>
                  <td align="center"><small><a href="javascript:void(0);">{{item.srv_sun}}</a></small></td>
                  <td align="center"><small><a href="javascript:void(0);">{{item.srv_pub}}</a></small></td>
                  <td><small><a href="javascript:void(0);">{{item.srv_rem}}</a></small></td>
                  <td><span class="badge badge-success">{% trans 'Active' %}</span></td>
                  {% else %}
                  <td><small>{{item.srv_eff_frm|date:'d/m/Y'}}</small></td>
                  <td><small>{{item.srv_eff_to|date:'d/m/Y'}}</small></td>
                  <td><small>{{item.srv_shif_id.shf_desc}}</small></td>
                  <td align="center"><small>{{item.srv_qty}}</small></td>
                  <td><small>{{item.srv_rank}}</small></td>
                  <td align="right"><small>{{item.srv_rate|stringformat:".0f"}}</small></td>
                  <td align="right"><small>{{item.srv_cost|stringformat:".0f"}}</small></td>
                  <td align="center"><small>{{item.srv_mon}}</small></td>
                  <td align="center"><small>{{item.srv_tue}}</small></td>
                  <td align="center"><small>{{item.srv_wed}}</small></td>
                  <td align="center"><small>{{item.srv_thu}}</small></td>
                  <td align="center"><small>{{item.srv_fri}}</small></td>
                  <td align="center"><small>{{item.srv_sat}}</small></td>
                  <td align="center"><small>{{item.srv_sun}}</small></td>
                  <td align="center"><small>{{item.srv_pub}}</small></td>
                  <td><small>{{item.srv_rem}}</small></td>                  
                  <td><span class="badge badge-secondary">{% trans 'Pending' %}</span></td>
                  {% endif %}

                  <td>
                    <div class="btn-group btn-group-sm nowrap">
                      <small>
                      
                      <!--
                      <a href="javascript:void(0);" type="button" class="btn btn-info btn-xs js-update-contract-service">
                        &nbsp;<i class="fas fa-pen fa-xs"></i>&nbsp;
                      </a>
                      -->

                      <button id="update_service_button" type="button" onclick="update_customer_service('{{item.srv_id}}')" class="btn btn-info btn-xs js-update-contract-service" data-toggle="modal">&nbsp;<i class="fas fa-pen fa-xs"></i>&nbsp;</button>

                      <button id="delete_service_button" type="button" onclick="delete_customer_service('{{item.srv_id}}')" class="btn btn-danger btn-xs js-delete-contract-service">
                        &nbsp;<i class="fas fa-trash fa-xs"></i>&nbsp;
                      </button>

                      </small>
                    </div>
                  </td>
                  </tr>

                {% endfor %}                  
                {% else %}
                  <tr><td colspan='18' class='text-center'><br><br><br>There is no data.<br><br><br><br><br></tr>
              {% endif %}                
              </tbody>
            </table>
          </div>
        </div>
      </div>

    </div>

    <div class="container pb-2">
      <div class="row"></div>
    </div>

  </section>
  </form>
<!-- /.content -->
</div>


<!-- Service List Modal -->
<div class="modal fade" id="service_list_modal" tabindex="-1" role="dialog">

  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLongTitle"><i class="fas fa-plus fa-sm"></i>&nbsp;&nbsp;<strong>{% trans 'Add a new service' %}</strong></h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>

      <div class="modal-body">
        

        <!-- Service List Modal -->
        <div class="row">
          <div class="col-12">
            <div class="card card-info">

              <div class="card-body">

                <div class="form-row">
                  <div class="form-group col-md-3">
                    <label for="cus_zip">{% trans 'Effect Term From' %}</label>
                    <input type="text" class="form-control form-control-sm" value="">
                  </div>
                  <div class="form-group col-md-3">
                    <label for="cus_tel">{% trans 'Effect Term To' %}</label>
                    <input type="text" class="form-control form-control-sm" value="">
                  </div>
                  <div class="form-group col-md-3">
                    <label for="cus_zip">{% trans 'Rank' %}</label>
                    <input type="text" class="form-control form-control-sm" value="">
                  </div>
                  <div class="form-group col-md-3">
                    <label for="cus_tel">{% trans 'Shift' %}</label>
                    <input type="text" class="form-control form-control-sm" value="">
                  </div>                  
                </div>
      
                <div class="form-row">

                  <div class="form-row col-6">
                    <div class="form-group col-3">
                      <label for="cus_zip">{% trans 'Mon' %}</label>
                      <input type="text" class="form-control form-control-sm" value="">
                    </div>
                    <div class="form-group col-3">
                      <label for="cus_zip">{% trans 'Tue' %}</label>
                      <input type="text" class="form-control form-control-sm" value="">
                    </div>
                    <div class="form-group col-3">
                      <label for="cus_zip">{% trans 'Wed' %}</label>
                      <input type="text" class="form-control form-control-sm" value="">
                    </div>
                    <div class="form-group col-3">
                      <label for="cus_zip">{% trans 'Thu' %}</label>                        
                      <input type="text" class="form-control form-control-sm" value="">
                    </div>
                  </div>

                  <div class="form-row col-6">
                    <div class="form-group col-3">
                      <label for="cus_zip">{% trans 'Fri' %}</label>
                      <input type="text" class="form-control form-control-sm" value="">
                    </div>
                    <div class="form-group col-3">
                      <label for="cus_zip">{% trans 'Sat' %}</label>
                      <input type="text" class="form-control form-control-sm" value="">
                    </div>
                    <div class="form-group col-3">
                      <label for="cus_zip">{% trans 'Sun' %}</label>
                      <input type="text" class="form-control form-control-sm" value="">
                    </div>
                    <div class="form-group col-3">
                      <label for="cus_zip">{% trans 'Pub' %}</label>                        
                      <input type="text" class="form-control form-control-sm" value="">
                    </div>
                  </div>

                </div>              

                <div class="form-row">
                  <div class="form-group col-md-3">
                    <label for="cus_zip">{% trans 'QTY' %}</label>
                    <input type="text" class="form-control form-control-sm" value="">
                  </div>
                  <div class="form-group col-md-3">
                    <label for="cus_tel">{% trans 'Cost' %}</label>
                    <input type="text" class="form-control form-control-sm" value="">
                  </div>

                  <div class="form-group col-md-3">
                    <label for="cus_zip">{% trans 'Total Cost' %}</label>
                    <input type="text" class="form-control form-control-sm" readonly>
                  </div>


                  <div class="form-group col-md-3 text-center">
                    <label for="cus_zip">&nbsp;</label>
                    <div class="form-check">
                      <!--<input class="form-check-input" type="checkbox" checked>-->
                      <input class="form-check-input" type="checkbox">
                      <label class="form-check-label">{% trans 'Active' %}</label>
                    </div>                                                
                  </div>

                </div>   

                <div class="form-row">
                  <div class="form-group col-md-6">
                    <label for="cus_zip">{% trans 'Remark' %}</label>
                    <input type="text" class="form-control form-control-sm" value="">
                  </div>
                  <div class="form-group col-md-6">
                    <label for="cus_tel">{% trans 'Cost Rate' %}</label>
                    <input type="text" class="form-control form-control-sm" value="">
                  </div>
                </div>   

              </div>
            </div>
          </div>
          
        </div>
        <!-- /.row --> 

      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary btn-md" data-dismiss="modal">{% trans 'Cancel' %}</button>
        <button type="button" class="btn btn-success btn-md">&nbsp;&nbsp;{% trans 'Add' %}&nbsp;&nbsp;</button>
      </div>
    </div>
  </div>
</div>




<!-- amnaj -->
<!-- Add new service modal -->
<div class="modal fade" id="add_new_service_list_modal" tabindex="-1" role="dialog">

  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      
      <div class="modal-header bg-success text-white" style="padding:7px;">
        <h5 class="modal-title" id="exampleModalLongTitle"><i class="fas fa-plus fa-sm text-white"></i>&nbsp;&nbsp;<strong>{% trans 'Add new service' %}</strong></h5>
        <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      
      <!--<div class="modal-body"></div>-->
      <div class="modal-body" style="padding:5px 5px 2px 5px;">
        <span class="text-center">{% trans 'Loading...' %}</span>
      </div>

      <div class="modal-footer" style="padding:5px 5px 5px 0;">
        <button type="button" class="btn btn-secondary btn-sm" data-dismiss="modal">&nbsp;&nbsp;{% trans 'Close' %}&nbsp;&nbsp;</button>
        <button onclick="add_new_service()" type="button" class="btn btn-primary btn-sm"><i class="fas fa-save fa-sm"></i>&nbsp;&nbsp;{% trans 'Save' %}&nbsp;&nbsp;</button>
      </div>
    </div>
  </div>

</div>



<!-- Update Service Modal -->
<div class="modal fade" id="update_service_modal" tabindex="-1" role="dialog">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLongTitle">
          <i class="fas fa-pen fa-sm"></i>&nbsp;&nbsp;<strong>{% trans 'Edit service' %}</strong>
          <input id="id_select_customer_service_id" type="hidden" readonly>
        </h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>

      <div class="modal-body">      
        <div class="row">
          <div class="col-12">
            <div class="card card-info">
              <div class="card-body">
                Loading...
              </div>
            </div>
          </div>          
        </div>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-secondary btn-md" data-dismiss="modal">{% trans 'Close' %}</button>      

        <button type="button" onclick="save_customer_service_item()" class="btn btn-primary btn-md">&nbsp;<i class="fas fa-save"></i>&nbsp;Save&nbsp;</button>

      </div>

    </div>
  </div>
</div>

<!-- Delete Service Modal -->
<div class="modal fade" id="delete_service_modal" tabindex="-1" role="dialog">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLongTitle">
          <i class="fas fa-trash fa-sm text-secondary"></i>&nbsp;&nbsp;<strong>{% trans 'Delete service' %}</strong>
          <input id="id_select_customer_service_id" type="hidden" readonly>
        </h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>

      <div class="modal-body">      
        <div class="row">
          <div class="col-12">
            <div class="card card-info">
              <div class="card-body">
                Loading...
              </div>
            </div>
          </div>          
        </div>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-secondary btn-md" data-dismiss="modal">{% trans 'Cancel' %}</button>      

        <button type="button" onclick="delete_customer_service_item()" class="btn btn-danger btn-md">&nbsp;<i class="fas fa-trash"></i>&nbsp;&nbsp;Delete&nbsp;</button>

      </div>

    </div>
  </div>
</div>

<!-- Wage Rate Modal -->
<div class="modal fade" id="wageratemodal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title"><i class="fas fa-search"></i>&nbsp;{% trans 'Select a Wage Rate' %}</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <span class="text-center">{% trans 'Loading...' %}</span>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary btn-sm" data-dismiss="modal">{% trans 'Close' %}</button>
      </div>
    </div>
  </div>
</div>

<!-- Search Contract Modal -->
<div class="modal fade" id="search_contract_modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">

      <div class="modal-header bg-primary text-white" style="padding:7px;">
        <h5 class="modal-title" id="exampleModalLongTitle"><i class="fas fa-search"></i>&nbsp;{% trans 'Select a Contract' %}</h5>
        <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>

      <div class="modal-body" style="padding:15px 0 0 12px;">
        <span class="text-center">{% trans 'Loading...' %}</span>
      </div>

      <div class="modal-footer" style="padding:5px 5px 5px 0;">

        <div class='float-left text-left col-10 pl-4'><span id="id_search_number_of_found_record"></span></div>
        <div class="float-right text-right col-2">
          <button type="button" class="btn btn-secondary btn-sm" data-dismiss="modal">{% trans 'Close' %}</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- /.content-wrapper -->
{% endblock %}



{% block javascript %}
<script>

  function showLoading() {
    $.LoadingOverlaySetup({
        background      : "rgba(0, 0, 0, 0.5)",
        image           : "/static/img/logo-small.png",        
        imageAnimation  : "1.5s fadein",
        imageColor      : "#ffcc00"
    });
    $.LoadingOverlay("show"); 
  }

  function isValidDate(dateString)
  {      
      // First check for the pattern
      if(!/^\d{1,2}\/\d{1,2}\/\d{4}$/.test(dateString)) {
        console.log("Invalid date format");
        return false;
      }
        
      // Parse the date parts to integers
      var parts = dateString.split("/");
      var day = parseInt(parts[0], 10);
      var month = parseInt(parts[1], 10);
      var year = parseInt(parts[2], 10);

      //console.log("validate date: " + day + ":" + month + ":" + year);

      // Check the ranges of month and year
      if(year < 1000 || year > 3000 || month == 0 || month > 12)
          return false;

      var monthLength = [ 31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31 ];

      // Adjust for leap years
      if(year % 400 == 0 || (year % 100 != 0 && year % 4 == 0))
          monthLength[1] = 29;

      // Check the range of the day
      return day > 0 && day <= monthLength[month - 1];
  };

  function checkCNTDocDateStatus(){    
    chkCNTDocDateStatus = $("#chkCNTDocDate").is(":checked");
    if(chkCNTDocDateStatus) {
      $('#id_cnt_doc_date').attr('readonly', false);
      $('#id_cnt_doc_date').attr("disabled", false);      
      $("#id_cnt_doc_date").focus();
    } else {
      $('#id_cnt_doc_date').attr('readonly', true);
      $('#id_cnt_doc_date').attr("disabled", true);
    }    
    return false;
  }


  function checkCNTEffFromStatus() { 
    chkCNTEffFromStatus = $("#chkCNTEffFrom").is(":checked");
    if(chkCNTEffFromStatus) {      
      $('#id_cnt_eff_frm').attr('readonly', false);
      $('#id_cnt_eff_frm').attr("disabled", false);      
      $("#id_cnt_eff_frm").focus();
    } else {
      $("#id_cnt_eff_frm").attr("disabled", true);
      $('#id_cnt_eff_frm').attr('readonly', true);      
    }    
  }


  function checkCNTEffToStatus() { 
    chkCNTEffToStatus = $("#chkCNTEffTo").is(":checked");
    if(chkCNTEffToStatus) {      
      $('#id_cnt_eff_to').attr('readonly', false);
      $('#id_cnt_eff_to').attr("disabled", false);      
      $("#id_cnt_eff_to").focus();
    } else {
      $("#id_cnt_eff_to").attr("disabled", true);
      $('#id_cnt_eff_to').attr('readonly', true);
    }    
  }



  // Add new service
  function checkCNTEffToNewStatus() { 
    chkCNTEffToNewStatus = $("#chkCNTEffToNew").is(":checked");
    if(chkCNTEffToNewStatus) {
      $('#id_dtp_cnt_eff_to_new').attr('readonly', false);
      $('#id_dtp_cnt_eff_to_new').attr("disabled", false);            
      $("#id_dtp_cnt_eff_to_new").focus();
    } else {
      $('#id_dtp_cnt_eff_to_new').attr('readonly', true);
      $('#id_dtp_cnt_eff_to_new').attr("disabled", true);            
      $("#id_dtp_cnt_eff_to_new").focus();
    }
  }


  // Edit service
  function checkCNTEffToNewStatusEdit() {
    chkCNTEffToNewStatus = $("#chkCNTEffToNewEdit").is(":checked");
    if(chkCNTEffToNewStatus) {
      $('#id_srv_eff_to').attr('readonly', false);
      $('#id_srv_eff_to').attr("disabled", false);            
      $("#id_srv_eff_to").focus();
    } else {
      $('#id_srv_eff_to').attr('readonly', true);
      $('#id_srv_eff_to').attr("disabled", true);            
      $("#id_srv_eff_to").focus();
    }
  }



  function checkCNTSignFromStatus() {

    chkCNTSignFromStatus = $("#chkCNTSignFrom").is(":checked");
    if(chkCNTSignFromStatus) {      
      console.log("check");
      $('#id_cnt_sign_frm').attr('readonly', false);
      $('#id_cnt_sign_frm').attr("disabled", false);      
      $("#id_cnt_sign_frm").focus();
    } else {
      console.log("not check");
      $("#id_cnt_sign_frm").attr("disabled", true);
      $('#id_cnt_sign_frm').attr('readonly', true);
    }    
  }


  function checkCNTSignToStatus() { 
    chkCNTSignToStatus = $("#chkCNTSignTo").is(":checked");
    if(chkCNTSignToStatus) {      
      $('#id_cnt_sign_to').attr('readonly', false);
      $('#id_cnt_sign_to').attr("disabled", false);      
      $("#id_cnt_sign_to").focus();
    } else {
      $("#id_cnt_sign_to").attr("disabled", true);
      $('#id_cnt_sign_to').attr('readonly', true);
    }    
  }


  $(document).ready(function(){
    $('input').inputmask();

    $("#id_cnt_doc_no").focus();

    $(document).on('keyup keypress', '#id_cus_contract_search_text', function(e) {
      if(e.which == 13) {
        
        e.preventDefault();
        if(this.value=="") {
          return false;  
        } else {
          cus_contract_search_modal();
        }
        
      }
    });


    $(document).on('keyup keypress', '#id_cus_contract_wagerate_search_text', function(e) {
      if(e.which == 13) {
        
        e.preventDefault();
        if(this.value=="") {
          return false;  
        } else {
          cus_contract_search_wagerate_modal();
        }
        
      }
    });

    // ID_CNT_DOC_NO
    $(document).on('keypress', '#id_cnt_doc_no', function(e) {
      if(e.which == 13) {      
        e.preventDefault();

        chkCNTDocDateStatus = $("#chkCNTDocDate").is(":checked");
        chkCNTEffFromStatus = $("#chkCNTEffFrom").is(":checked");
        chkCNTEffToStatus = $("#chkCNTEffTo").is(":checked");
        chkCNTSignFromStatus = $("#chkCNTSignFrom").is(":checked");
        chkCNTSignToStatus = $("#chkCNTSignTo").is(":checked");

        if(chkCNTDocDateStatus)
          $('#id_cnt_doc_date').focus();
        else if(chkCNTEffFromStatus)
          $('#id_cnt_eff_frm').focus();
        else if(chkCNTEffToStatus)
          $('#id_cnt_eff_to').focus();
        else if(chkCNTSignFromStatus)
          $('#id_cnt_sign_frm').focus();
        else if(chkCNTSignToStatus)
          $('#id_cnt_sign_to').focus();
        else
          return false;
      }
    });



    // ID_CNT_DOC_DATE

    $("#id_cnt_doc_date").inputmask("dd/mm/yyyy", {
      placeholder: "dd/mm/yyyy",
      insertMode: false, 
      showMaskOnHover: false,
      alias: "datetime",
     }
    );
  
    $(document).on('keypress', '#id_cnt_doc_date', function(e) {
      if(e.which == 13) {      
        e.preventDefault();

        var keyup_value;
        keyup_value = this.value;

        if(isValidDate(keyup_value)) {

          chkCNTDocDateStatus = $("#chkCNTDocDate").is(":checked");
          chkCNTEffFromStatus = $("#chkCNTEffFrom").is(":checked");
          chkCNTEffToStatus = $("#chkCNTEffTo").is(":checked");
          chkCNTSignFromStatus = $("#chkCNTSignFrom").is(":checked");
          chkCNTSignToStatus = $("#chkCNTSignTo").is(":checked");

          if(chkCNTEffFromStatus)
            $('#id_cnt_eff_frm').focus();
          else if(chkCNTEffToStatus)
            $('#id_cnt_eff_to').focus();
          else if(chkCNTSignFromStatus)
            $('#id_cnt_sign_frm').focus();
          else if(chkCNTSignToStatus)
            $('#id_cnt_sign_to').focus();
          else
            $('#id_cnt_doc_no').focus();

        } else {
          $('#id_cnt_doc_date').focus();

          $(document).Toasts('create', {
            class: "bg-danger", 
            title: "{% trans 'Error' %}",
            subtitle: '',
            autohide: true,
            delay: 2000,
            body: "",
            autoDismiss: true,
            close: true,
            autoremove: true,
          });        
        }
      }
    });    
    
    $("#id_cnt_doc_date").bind("focus",function(e){

      window.setTimeout(function() {
        $("#id_cnt_doc_date").select();
      }, 0);

      /*      
      console.log("id_cnt_doc_date_focus" + " | " + e.keyCode);
      if(e.keyCode!=undefined) {
        this.setSelectionRange(0,2);
      } else {
        const input = document.getElementById('id_cnt_doc_date');
        window.setTimeout(function() {
          input.setSelectionRange(0,2);
        }, 0);
      }
      */
    });

    $("#id_cnt_doc_date").bind("keyup",function(e){
      /*
      var keyup_point;
      var keyup_value;

      keyup_point = this.selectionStart;
      keyup_value = this.value;

      // NUMERIC PAD
      if ((e.keyCode >= 48 && e.keyCode <= 57) || (e.keyCode >= 96 && e.keyCode <= 105)) {
        console.log("numpad: " + keyup_point + " | value: " + keyup_value);

        if(keyup_point==3) {
          // isValidDate()
          if(isValidDate(keyup_value)) {
            console.log("TRUE");
          } else {
            console.log("FALSE");
          }

          if(keyup_value.substring(0,2)>31) {
            this.setSelectionRange(0, 2);
          } else {
            this.setSelectionRange(3, 5);
          }
          return false;
        }

        if(keyup_point==6) {
          if(keyup_value.substring(3, 5)>12) {
            this.setSelectionRange(3, 5);
          } else {
            this.setSelectionRange(6, 10);
          }
          return false;
        }
      }

      // LEFT
      if(e.keyCode == 37) {
        console.log("left arrow keyup_point:" + keyup_point);
        if(keyup_point==2) {
          this.setSelectionRange(2, 5);
        }   
        if(keyup_point==3) {
          this.setSelectionRange(0, 2);
        }           
        if(keyup_point==6) {
          this.setSelectionRange(3, 5);
        }
        if(keyup_point==9) {
          this.setSelectionRange(6, 10);
        }        
      }

      // RIGHT
      if(e.keyCode == 39) {
        console.log("right arrow keyup_point:" + keyup_point);

        if(keyup_point==2) {
          console.log("value:" + keyup_value);
                
          // isValidDate()
          if(isValidDate(keyup_value)) {
            console.log("TRUE");
            this.setSelectionRange(3, 5);
          } else {
            console.log("FALSE");
            this.setSelectionRange(0, 2);
          }
        } 
        if(keyup_point==5) {
          if(isValidDate(keyup_value)) {
            console.log("TRUE");
            this.setSelectionRange(6, 10);
          } else {
            console.log("FALSE");
            this.setSelectionRange(3, 5);
          }                  
        }
      }
      */
    });


    // ID_CNT_EFF_FRM
    //$("#id_cnt_eff_frm").inputmask("99/99/9999");
    $("#id_cnt_eff_frm").inputmask("dd/mm/yyyy", {
      placeholder: "dd/mm/yyyy",
      insertMode: false, 
      showMaskOnHover: false,
      alias: "datetime",
     }
    );
    $(document).on('keypress', '#id_cnt_eff_frm', function(e) {
      if(e.which == 13) {      
        e.preventDefault();
        
        var keyup_value;
        keyup_value = this.value;

        if(isValidDate(keyup_value)) {

          chkCNTDocDateStatus = $("#chkCNTDocDate").is(":checked");
          chkCNTEffFromStatus = $("#chkCNTEffFrom").is(":checked");
          chkCNTEffToStatus = $("#chkCNTEffTo").is(":checked");
          chkCNTSignFromStatus = $("#chkCNTSignFrom").is(":checked");
          chkCNTSignToStatus = $("#chkCNTSignTo").is(":checked");

          if(chkCNTEffToStatus)
            $('#id_cnt_eff_to').focus();
          else if(chkCNTSignFromStatus)
            $('#id_cnt_sign_frm').focus();
          else if(chkCNTSignToStatus)
            $('#id_cnt_sign_to').focus();
          else
            $('#id_cnt_doc_no').focus();

        } else {
          $('#id_cnt_eff_frm').focus();

          $(document).Toasts('create', {
            class: "bg-danger", 
            title: "{% trans 'Error' %}",
            subtitle: '',
            autohide: true,
            delay: 2000,
            body: "",
            autoDismiss: true,
            close: true,
            autoremove: true,
          });        
        }

      }
    });

    $("#id_cnt_eff_frm").bind("focus",function(e){
      window.setTimeout(function() {
        $("#id_cnt_eff_frm").select();
      }, 0);

      /*
      console.log("id_cnt_eff_frm_focus" + " | " + e.keyCode);
      if(e.keyCode!=undefined) {
        this.setSelectionRange(0,2);
      } else {
        const input = document.getElementById('id_cnt_eff_frm');
        window.setTimeout(function() {
          input.setSelectionRange(0,2);
        }, 0);
      }
      */
    });

    $("#id_cnt_eff_frm").bind("keyup",function(e){
      /*
      var keyup_point;
      var keyup_value;

      keyup_point = this.selectionStart;
      keyup_value = this.value;

      // NUMERIC PAD
      if ((e.keyCode >= 48 && e.keyCode <= 57) || (e.keyCode >= 96 && e.keyCode <= 105)) {
        console.log("numpad: " + keyup_point + " | value: " + keyup_value);

        if(keyup_point==3) {
          // isValidDate()
          if(isValidDate(keyup_value)) {
            console.log("TRUE");
          } else {
            console.log("FALSE");
          }

          if(keyup_value.substring(0,2)>31) {
            this.setSelectionRange(0, 2);
          } else {
            this.setSelectionRange(3, 5);
          }
          return false;
        }

        if(keyup_point==6) {
          if(keyup_value.substring(3, 5)>12) {
            this.setSelectionRange(3, 5);
          } else {
            this.setSelectionRange(6, 10);
          }
          return false;
        }
      }

      // LEFT
      if(e.keyCode == 37) {
        console.log("left arrow keyup_point:" + keyup_point);
        if(keyup_point==2) {
          this.setSelectionRange(2, 5);
        }   
        if(keyup_point==3) {
          this.setSelectionRange(0, 2);
        }           
        if(keyup_point==6) {
          this.setSelectionRange(3, 5);
        }
        if(keyup_point==9) {
          this.setSelectionRange(6, 10);
        }        
      }

      // RIGHT
      if(e.keyCode == 39) {
        console.log("right arrow keyup_point:" + keyup_point);

        if(keyup_point==2) {
          console.log("value:" + keyup_value);
                
          // isValidDate()
          if(isValidDate(keyup_value)) {
            console.log("TRUE");
            this.setSelectionRange(3, 5);
          } else {
            console.log("FALSE");
            this.setSelectionRange(0, 2);
          }
        } 
        if(keyup_point==5) {
          if(isValidDate(keyup_value)) {
            console.log("TRUE");
            this.setSelectionRange(6, 10);
          } else {
            console.log("FALSE");
            this.setSelectionRange(3, 5);
          }                  
        }
      }
      */
    });




    // ID_CNT_EFF_TO        
    $("#id_cnt_eff_to").inputmask("dd/mm/yyyy", {
      placeholder: "dd/mm/yyyy",
      insertMode: false, 
      showMaskOnHover: false,
      alias: "datetime",
     }
    );

    $(document).on('keypress', '#id_cnt_eff_to', function(e) {
      if(e.which == 13) {      
        e.preventDefault();

        var keyup_value;
        keyup_value = this.value;

        if(isValidDate(keyup_value)) {

          chkCNTDocDateStatus = $("#chkCNTDocDate").is(":checked");
          chkCNTEffFromStatus = $("#chkCNTEffFrom").is(":checked");
          chkCNTEffToStatus = $("#chkCNTEffTo").is(":checked");
          chkCNTSignFromStatus = $("#chkCNTSignFrom").is(":checked");
          chkCNTSignToStatus = $("#chkCNTSignTo").is(":checked");

          if(chkCNTSignFromStatus)
            $('#id_cnt_sign_frm').focus();
          else if(chkCNTSignToStatus)
            $('#id_cnt_sign_to').focus();
          else
            $('#id_cnt_doc_no').focus();

        } else {
          $('#id_cnt_eff_to').focus();

          $(document).Toasts('create', {
            class: "bg-danger", 
            title: "{% trans 'Error' %}",
            subtitle: '',
            autohide: true,
            delay: 2000,
            body: "",
            autoDismiss: true,
            close: true,
            autoremove: true,
          });        
        }


      }
    });
    $("#id_cnt_eff_to").bind("focus",function(e){
      window.setTimeout(function() {
        $("#id_cnt_eff_to").select();
      }, 0);

      /*
      console.log("id_cnt_eff_to_focus" + " | " + e.keyCode);
      if(e.keyCode!=undefined) {
        this.setSelectionRange(0,2);
      } else {
        const input = document.getElementById('id_cnt_eff_to');
        window.setTimeout(function() {
          input.setSelectionRange(0,2);
        }, 0);
      }
      */
    });

    $("#id_cnt_eff_to").bind("keyup",function(e){
      /*
      var keyup_point;
      var keyup_value;

      keyup_point = this.selectionStart;
      keyup_value = this.value;

      // NUMERIC PAD
      if ((e.keyCode >= 48 && e.keyCode <= 57) || (e.keyCode >= 96 && e.keyCode <= 105)) {
        console.log("numpad: " + keyup_point + " | value: " + keyup_value);

        if(keyup_point==3) {
          // isValidDate()
          if(isValidDate(keyup_value)) {
            console.log("TRUE");
          } else {
            console.log("FALSE");
          }

          if(keyup_value.substring(0,2)>31) {
            this.setSelectionRange(0, 2);
          } else {
            this.setSelectionRange(3, 5);
          }
          return false;
        }

        if(keyup_point==6) {
          if(keyup_value.substring(3, 5)>12) {
            this.setSelectionRange(3, 5);
          } else {
            this.setSelectionRange(6, 10);
          }
          return false;
        }
      }

      // LEFT
      if(e.keyCode == 37) {
        console.log("left arrow keyup_point:" + keyup_point);
        if(keyup_point==2) {
          this.setSelectionRange(2, 5);
        }   
        if(keyup_point==3) {
          this.setSelectionRange(0, 2);
        }           
        if(keyup_point==6) {
          this.setSelectionRange(3, 5);
        }
        if(keyup_point==9) {
          this.setSelectionRange(6, 10);
        }        
      }

      // RIGHT
      if(e.keyCode == 39) {
        console.log("right arrow keyup_point:" + keyup_point);

        if(keyup_point==2) {
          console.log("value:" + keyup_value);
                
          // isValidDate()
          if(isValidDate(keyup_value)) {
            console.log("TRUE");
            this.setSelectionRange(3, 5);
          } else {
            console.log("FALSE");
            this.setSelectionRange(0, 2);
          }
        } 
        if(keyup_point==5) {
          if(isValidDate(keyup_value)) {
            console.log("TRUE");
            this.setSelectionRange(6, 10);
          } else {
            console.log("FALSE");
            this.setSelectionRange(3, 5);
          }                  
        }
      }
      */
    });




    // ID_CNT_SIGN_FRM    
    $("#id_cnt_sign_frm").inputmask("dd/mm/yyyy", {
      placeholder: "dd/mm/yyyy",
      insertMode: false, 
      showMaskOnHover: false,
      alias: "datetime",
     }
    );

    $(document).on('keypress', '#id_cnt_sign_frm', function(e) {
      if(e.which == 13) {      
        e.preventDefault();
        
        var keyup_value;
        keyup_value = this.value;

        if(isValidDate(keyup_value)) {

          chkCNTDocDateStatus = $("#chkCNTDocDate").is(":checked");
          chkCNTEffFromStatus = $("#chkCNTEffFrom").is(":checked");
          chkCNTEffToStatus = $("#chkCNTEffTo").is(":checked");
          chkCNTSignFromStatus = $("#chkCNTSignFrom").is(":checked");
          chkCNTSignToStatus = $("#chkCNTSignTo").is(":checked");

          if(chkCNTSignToStatus)
            $('#id_cnt_sign_to').focus();
          else
            $('#id_cnt_doc_no').focus();

        } else {
          $('#id_cnt_sign_frm').focus();

          $(document).Toasts('create', {
            class: "bg-danger", 
            title: "{% trans 'Error' %}",
            subtitle: '',
            autohide: true,
            delay: 2000,
            body: "",
            autoDismiss: true,
            close: true,
            autoremove: true,
          });        
        }


      }
    });
    $("#id_cnt_sign_frm").bind("focus",function(e){
      window.setTimeout(function() {
        $("#id_cnt_sign_frm").select();
      }, 0);
      
      /*      
      console.log("id_cnt_sign_frm_focus" + " | " + e.keyCode);
      if(e.keyCode!=undefined) {
        this.setSelectionRange(0,2);
      } else {
        const input = document.getElementById('id_cnt_sign_frm');
        window.setTimeout(function() {
          input.setSelectionRange(0,2);
        }, 0);
      }
      */
    });

    $("#id_cnt_sign_frm").bind("keyup",function(e){
      /*
      var keyup_point;
      var keyup_value;

      keyup_point = this.selectionStart;
      keyup_value = this.value;

      // NUMERIC PAD
      if ((e.keyCode >= 48 && e.keyCode <= 57) || (e.keyCode >= 96 && e.keyCode <= 105)) {
        console.log("numpad: " + keyup_point + " | value: " + keyup_value);

        if(keyup_point==3) {
          // isValidDate()
          if(isValidDate(keyup_value)) {
            console.log("TRUE");
          } else {
            console.log("FALSE");
          }

          if(keyup_value.substring(0,2)>31) {
            this.setSelectionRange(0, 2);
          } else {
            this.setSelectionRange(3, 5);
          }
          return false;
        }

        if(keyup_point==6) {
          if(keyup_value.substring(3, 5)>12) {
            this.setSelectionRange(3, 5);
          } else {
            this.setSelectionRange(6, 10);
          }
          return false;
        }
      }

      // LEFT
      if(e.keyCode == 37) {
        console.log("left arrow keyup_point:" + keyup_point);
        if(keyup_point==2) {
          this.setSelectionRange(2, 5);
        }   
        if(keyup_point==3) {
          this.setSelectionRange(0, 2);
        }           
        if(keyup_point==6) {
          this.setSelectionRange(3, 5);
        }
        if(keyup_point==9) {
          this.setSelectionRange(6, 10);
        }        
      }

      // RIGHT
      if(e.keyCode == 39) {
        console.log("right arrow keyup_point:" + keyup_point);

        if(keyup_point==2) {
          console.log("value:" + keyup_value);
                
          // isValidDate()
          if(isValidDate(keyup_value)) {
            console.log("TRUE");
            this.setSelectionRange(3, 5);
          } else {
            console.log("FALSE");
            this.setSelectionRange(0, 2);
          }
        } 
        if(keyup_point==5) {
          if(isValidDate(keyup_value)) {
            console.log("TRUE");
            this.setSelectionRange(6, 10);
          } else {
            console.log("FALSE");
            this.setSelectionRange(3, 5);
          }                  
        }
      }
      */
    });




    // ID_CNT_SIGN_TO
    
    $("#id_cnt_sign_to").inputmask("dd/mm/yyyy", {
      placeholder: "dd/mm/yyyy",
      insertMode: false, 
      showMaskOnHover: false,
      alias: "datetime",
     }
    );

    $(document).on('keypress', '#id_cnt_sign_to', function(e) {
      if(e.which == 13) {      
        e.preventDefault();

        //$('#id_cnt_doc_no').focus();
        var keyup_value;
        keyup_value = this.value;

        if(isValidDate(keyup_value)) {

          chkCNTDocDateStatus = $("#chkCNTDocDate").is(":checked");
          chkCNTEffFromStatus = $("#chkCNTEffFrom").is(":checked");
          chkCNTEffToStatus = $("#chkCNTEffTo").is(":checked");
          chkCNTSignFromStatus = $("#chkCNTSignFrom").is(":checked");
          chkCNTSignToStatus = $("#chkCNTSignTo").is(":checked");

          $('#id_cnt_doc_no').focus();

        } else {
          $('#id_cnt_sign_to').focus();

          $(document).Toasts('create', {
            class: "bg-danger", 
            title: "{% trans 'Error' %}",
            subtitle: '',
            autohide: true,
            delay: 2000,
            body: "",
            autoDismiss: true,
            close: true,
            autoremove: true,
          });        
        }

      }
    });

    $("#id_cnt_sign_to").bind("focus",function(e){
      window.setTimeout(function() {
        $("#id_cnt_sign_to").select();
      }, 0);

      /*
      console.log("id_cnt_sign_to_focus" + " | " + e.keyCode);
      if(e.keyCode!=undefined) {
        this.setSelectionRange(0,2);
      } else {
        const input = document.getElementById('id_cnt_sign_to');
        window.setTimeout(function() {
          input.setSelectionRange(0,2);
        }, 0);
      }
      */
    });

    $("#id_cnt_sign_to").bind("keyup",function(e){
      /*
      var keyup_point;
      var keyup_value;

      keyup_point = this.selectionStart;
      keyup_value = this.value;

      // NUMERIC PAD
      if ((e.keyCode >= 48 && e.keyCode <= 57) || (e.keyCode >= 96 && e.keyCode <= 105)) {
        console.log("numpad: " + keyup_point + " | value: " + keyup_value);

        if(keyup_point==3) {
          // isValidDate()
          if(isValidDate(keyup_value)) {
            console.log("TRUE");
          } else {
            console.log("FALSE");
          }

          if(keyup_value.substring(0,2)>31) {
            this.setSelectionRange(0, 2);
          } else {
            this.setSelectionRange(3, 5);
          }
          return false;
        }

        if(keyup_point==6) {
          if(keyup_value.substring(3, 5)>12) {
            this.setSelectionRange(3, 5);
          } else {
            this.setSelectionRange(6, 10);
          }
          return false;
        }
      }

      // LEFT
      if(e.keyCode == 37) {
        console.log("left arrow keyup_point:" + keyup_point);
        if(keyup_point==2) {
          this.setSelectionRange(2, 5);
        }   
        if(keyup_point==3) {
          this.setSelectionRange(0, 2);
        }           
        if(keyup_point==6) {
          this.setSelectionRange(3, 5);
        }
        if(keyup_point==9) {
          this.setSelectionRange(6, 10);
        }        
      }

      // RIGHT
      if(e.keyCode == 39) {
        console.log("right arrow keyup_point:" + keyup_point);

        if(keyup_point==2) {
          console.log("value:" + keyup_value);
                
          // isValidDate()
          if(isValidDate(keyup_value)) {
            console.log("TRUE");
            this.setSelectionRange(3, 5);
          } else {
            console.log("FALSE");
            this.setSelectionRange(0, 2);
          }
        } 
        if(keyup_point==5) {
          if(isValidDate(keyup_value)) {
            console.log("TRUE");
            this.setSelectionRange(6, 10);
          } else {
            console.log("FALSE");
            this.setSelectionRange(3, 5);
          }                  
        }
      }
      */
    });

  });




  $(document).ready(function(){
    $('#id_cus_id').focus();
    $('#customer_name_title').html("<button type='button' class='btn btn-success'><span style='font-size:18px;font-weight:bold;'>Customer Name</span>&nbsp;&nbsp;&nbsp;<span class='badge badge-light'>Zone</span></button>");
    $("#main-content :input").attr("disabled", true);
  });

  $(document).on('keypress', '#id_cus_id', function(e) {
    if(e.which == 13) {      
      e.preventDefault();

      var obj = $(this);
      var id_cus_id = obj.val();
      while (id_cus_id.length < 7) 
        id_cus_id = "0" + id_cus_id;
      $('#id_cus_id').val(id_cus_id);
      
      cus_id = $("#id_cus_id").val();
      if(cus_id==0) {
        this.select();
        return false;
      }

      if(cus_id=="") {
        $('#id_cus_id').focus();
      } else {
        $.ajax({
          url : "/contract/ajax/get_cus_main/",
          type : "POST",
          data : {          
            csrfmiddlewaretoken: '{{ csrf_token }}',
            cus_id: cus_id,
          },
          success : function(json) {        
            if(json.is_existed) {
              
              if(json.cus_name_th.length<70) {
                cus_name_th_new = json.cus_name_th
              } else {
                cus_name_th_new = json.cus_name_th.substring(0,70) + "...";
              }

              //$('#customer_name_title').html("<h5 class='m-0 text-dark'><b>" + cus_name_th_new + "</b><small>&nbsp;&nbsp;<button type='button' class='btn btn-tool' data-card-widget='collapse'><i class='fas fa-angle-down text-dark'></i></button></small></h5>");                

              $('#customer_name_title').html("<button type='button' class='btn btn-success'><span style='font-size:18px;font-weight:bold;'>" + cus_name_th_new + "</span>&nbsp;&nbsp;&nbsp;<span class='badge badge-light'>Zone" + "</span></button><small>&nbsp;&nbsp;<button type='button' class='btn btn-tool' data-card-widget='collapse'><i class='fas fa-angle-down text-dark'></i></button></small>");

              $('#id_cus_brn').focus();

            } else {              
              $('#id_cus_id').focus();
            }
          },
        });        
      }
    }
  });

  $("#id_cus_id").on('click', function(){
    $("#id_cus_id").select();
  });
  $("#id_cus_brn").on('click', function(){
    $("#id_cus_brn").select();
  });
  $("#id_cus_vol").on('click', function(){
    $("#id_cus_vol").select();
  });

  $(document).on('keypress', '#id_cus_brn', function(e) {
    if(e.which == 13) {      
      e.preventDefault();

      // TODO - check existing customer
      var obj = $(this);
      var id_cus_brn = obj.val();
      while (id_cus_brn.length < 3) 
        id_cus_brn = "0" + id_cus_brn;
      $('#id_cus_brn').val(id_cus_brn);

      cus_id = $("#id_cus_id").val();
      cus_brn_text = $("#id_cus_brn").val();

      if(cus_brn_text=="") {
        $("#id_cus_brn").val('000');
        cus_brn = 0
      }
      else {
        cus_brn = cus_brn_text;
      }

      $.ajax({
        url : "/contract/ajax/get_customer/",
        type : "POST",
        data : {          
          csrfmiddlewaretoken: '{{ csrf_token }}',
          cus_id: cus_id,
          cus_brn: cus_brn,
        },
        success : function(json) {        
          if(json.is_existed) {

            if(json.cus_name_th.length<70) {
              cus_name_th_new = json.cus_name_th
            } else {
              cus_name_th_new = json.cus_name_th.substring(0,70) + "...";
            }

            //$('#customer_name_title').html("<h5 class='m-0 text-dark'><b>" + cus_name_th_new + "</b>&nbsp;&nbsp;&nbsp;<span class='badge badge-info'>" + json.cus_zone_id + " | " + json.cus_zone_th + "</span>" + "<small>&nbsp;&nbsp;<button type='button' class='btn btn-tool' data-card-widget='collapse'><i class='fas fa-angle-down text-dark'></i></button></small></h5>");   

            $('#customer_name_title').html("<button type='button' class='btn btn-success'><span style='font-size:18px;font-weight:bold;'>" + cus_name_th_new + "</span>&nbsp;&nbsp;&nbsp;<span class='badge badge-light'>" + json.cus_zone_id + " | " + json.cus_zone_th + "</span></button><small>&nbsp;&nbsp;<button type='button' class='btn btn-tool' data-card-widget='collapse'><i class='fas fa-angle-down text-dark'></i></button></small>");

            $('#id_cus_name_th').val(json.cus_name_th);
            $('#id_cus_sht_th').val(json.cus_sht_th);
            $('#id_cus_add_th').val(json.cus_add_th);
            $('#id_cus_subdist_th').val(json.cus_subdist_th);
            $('#id_cus_zip_th').val(json.cus_zip_th);        
            $('#id_cus_district_th').val(json.cus_district_th);
            $('#id_cus_city_th').val(json.cus_city_th);
            $('#id_cus_country_th').val(json.cus_country_th);
            $('#id_site_contact_id_th').val(json.site_contact_id_th);
            $('#id_site_contact_con_th').val(json.site_contact_con_th);
            $('#id_site_contact_con_position_th').val(json.site_contact_con_position_th);
            $('#id_site_contact_con_mobile_th').val(json.site_contact_con_mobile_th);
            $('#id_site_contact_con_email_th').val(json.site_contact_con_email_th);

            // EN
            $('#id_cus_name_en').val(json.cus_name_en);
            $('#id_cus_sht_en').val(json.cus_sht_en);
            $('#id_cus_add_en').val(json.cus_add_en);
            $('#id_cus_subdist_en').val(json.cus_subdist_en);
            $('#id_cus_zip_en').val(json.cus_zip_en);        
            $('#id_cus_district_en').val(json.cus_district_en);
            $('#id_cus_city_en').val(json.cus_city_en);
            $('#id_cus_country_en').val(json.cus_country_en);
            $('#id_site_contact_id_en').val(json.site_contact_id_en);
            $('#id_site_contact_con_en').val(json.site_contact_con_en);
            $('#id_site_contact_con_position_en').val(json.site_contact_con_position_en);
            $('#id_site_contact_con_mobile_en').val(json.site_contact_con_mobile_en);
            $('#id_site_contact_con_email_en').val(json.site_contact_con_email_en);
          
            $('#id_cus_tel_th').val(json.cus_tel);
            $('#id_cus_fax_th').val(json.cus_fax);
            $('#id_cus_email_th').val(json.cus_email);
            $('#id_cus_tel_en').val(json.cus_tel);
            $('#id_cus_fax_en').val(json.cus_fax);
            $('#id_cus_email_en').val(json.cus_email);

            $("#id_cus_zone_id").val(json.cus_zone_id);
            $('#id_cus_zone_th').val(json.cus_zone_id + " | " + json.cus_zone_th);
            $('#id_cus_zone_en').val(json.cus_zone_id + " | " + json.cus_zone_en);

            $('#id_cus_vol').focus();
          }
          else {
            alert("Customer " + cus_id + " Branch " + cus_brn + " does not existed. Please create a new customer.");
            $('#id_cus_brn').focus();
          }
        },
      });

      
    }
  });


  // ID_CUS_VOL CLICK
  $(document).on('keypress', '#id_cus_vol', function(e) {
    if(e.which == 13) {

      e.preventDefault();

      var obj = $(this);
      var id_cus_vol = obj.val();
      while (id_cus_vol.length < 3) 
        id_cus_vol = "0" + id_cus_vol;
      $('#id_cus_vol').val(id_cus_vol);
            
      var cnt_id = $('#id_cus_id').val();
      var cus_brn = $('#id_cus_brn').val();
      var cus_vol_text = $('#id_cus_vol').val();

      if(cnt_id=='' || cnt_id==null) {
        $.alert({
            title: 'Error',
            type: 'red',
            content: "Contract ID is required!",
            animation: 'zoom',
            animationBounce: 1.5,
            closeIcon: false,
            boxWidth: '38%',
            useBootstrap: false,
        });

        $('#id_cus_id').focus();
        return false;

      } else if(cus_brn=='' || cus_brn==null) {
        alert("Customer Branch is required");
        $('#id_cus_brn').focus();
      } else if(cus_vol_text=='' || cus_vol_text==null) {    
        $("#id_cus_vol").val('000');   
        cus_vol = 0;
      }
      else {
        cus_vol = cus_vol_text;
      }

      // TODO - check existing cnt_id

      showLoading();

      $.ajax({
        url : "/contract/ajax/get_cus_contract/",        
        type : "POST",
        data : {
          csrfmiddlewaretoken: '{{ csrf_token }}',
          cus_id: cus_id,
          cus_brn: cus_brn,
          cus_vol: cus_vol,
        },
        success : function(json) {        

          // check if contract used to be deleted          
          var upd_flag = json.cnt_upd_flag;
          var cnt_id = json.cnt_id;

          $("#id_cnt_id_temp").val(cnt_id);
          // $("#id_contract_number").text("No." + cnt_id);
          $("#id_contract_number").text("");
      
          $.LoadingOverlay("hide");

          if(upd_flag=='D') {    
            var retVal = confirm("Would you like to undelete Contract No." + cnt_id + " ?");
                      
            if( retVal == true ) {
              // Change upd_flag to 'R'
              $.ajax({
                url: "/contract/ajax/ajax_undelete_contract/",
                type: "POST",
                data: {        
                  csrfmiddlewaretoken: '{{ csrf_token }}',
                  cnt_id: cnt_id,
                },
                success: function(data) {
                  
                },
                error: function(data) {
                  
                },
              });
            } else {
              //alert("Cancel");

              $('#contract_number_form').trigger("reset");
              $('#contractupdateform').trigger("reset");
              $("#main-content :input").attr("disabled", true);
              $("#contract_number_form :input").attr("disabled", false);
              $("#id_cnt_active").prop("active", false);
              $("#service_list_table tbody").html("<tr><td colspan='18' class='text-center'><br><br><br>There is no data.<br><br><br><br></td></tr>");
              $('#customer_name_title').html("<button type='button' class='btn btn-success'><span style='font-size:18px;font-weight:bold;'>Customer Name</span>&nbsp;&nbsp;&nbsp;<span class='badge badge-light'>Zone</span></button>");
              $("#id_cnt_wage_id").val("");
              $("#id_cus_zone_id").val("");
              $("#id_cus_id").focus();

              return false;
            }
          } else {

          }

          if(json.is_existed) {

            var today = new Date();
            var dd = String(today.getDate()).padStart(2, '0');
            var mm = String(today.getMonth() + 1).padStart(2, '0');
            var yyyy = today.getFullYear();
            today = dd + '/' + mm + '/' + yyyy;

            cnt_id = json.cnt_id;       

            if(json.cnt_active) {
              $("#id_cnt_active").prop("checked", true);
            } else {
              $("#id_cnt_active").prop("checked", false);
            }

            $("#id_cnt_doc_no").val(json.cnt_doc_no);
            
            //console.log("doc_date:" + json.cnt_doc_date + " | eff_frm:" + json.cnt_eff_frm + " | eff_to:" + json.cnt_eff_to + " | sign_frm:" + json.cnt_sign_frm + " | sign_to:" + json.cnt_sign_to);

            if(json.cnt_doc_date==null || json.cnt_doc_date=="31/12/2999") {
              $("#chkCNTDocDate").prop("checked", false);
              $('#id_cnt_doc_date').attr('readonly', true);
              $('#id_cnt_doc_date').attr("disabled", true);
              $("#id_cnt_doc_date").val(today);
            } else {
              $("#chkCNTDocDate").prop("checked", true);
              $('#id_cnt_doc_date').attr('readonly', false);
              $('#id_cnt_doc_date').attr("disabled", false);      
              $("#id_cnt_doc_date").val(json.cnt_doc_date);              
            }
            

            if(json.cnt_eff_frm==null || json.cnt_eff_frm=="31/12/2999") {
              $("#chkCNTEffFrom").prop("checked", false);
              $('#id_cnt_eff_frm').attr('readonly', true);
              $('#id_cnt_eff_frm').attr("disabled", true);
              $("#id_cnt_eff_frm").val(today);              
            } else {
              $("#chkCNTEffFrom").prop("checked", true);
              $('#id_cnt_eff_frm').attr('readonly', false);
              $('#id_cnt_eff_frm').attr("disabled", false);
              $("#id_cnt_eff_frm").val(json.cnt_eff_frm);
            }


            if(json.cnt_eff_to==null || json.cnt_eff_to=="31/12/2999") {
              $("#chkCNTEffTo").prop("checked", false);
              $('#id_cnt_eff_to').attr('readonly', true);
              $('#id_cnt_eff_to').attr("disabled", true);
              $("#id_cnt_eff_to").val(today);
            } else {
              $("#chkCNTEffTo").prop("checked", true);
              $('#id_cnt_eff_to').attr('readonly', false);
              $('#id_cnt_eff_to').attr("disabled", false);
              $("#id_cnt_eff_to").val(json.cnt_eff_to);
            }

            
            if(json.cnt_sign_frm==null|| json.cnt_sign_frm=="31/12/2999") {
              $("#chkCNTSignFrom").prop("checked", false);
              $('#id_cnt_sign_frm').attr('readonly', true);
              $('#id_cnt_sign_frm').attr("disabled", true);
              $("#id_cnt_sign_frm").val(today);
            } else {
              $("#chkCNTSignFrom").prop("checked", true);
              $('#id_cnt_sign_frm').attr('readonly', false);
              $('#id_cnt_sign_frm').attr("disabled", false);
              $("#id_cnt_sign_frm").val(json.cnt_sign_frm);
            }

            
            if(json.cnt_sign_to==null|| json.cnt_sign_to=="31/12/2999") {
              $("#chkCNTSignTo").prop("checked", false);
              $('#id_cnt_sign_to').attr('readonly', true);
              $('#id_cnt_sign_to').attr("disabled", true);
              $("#id_cnt_sign_to").val(today);              
            } else {
              $("#chkCNTSignTo").prop("checked", true);
              $('#id_cnt_sign_to').attr('readonly', false);
              $('#id_cnt_sign_to').attr("disabled", false);
              $("#id_cnt_sign_to").val(json.cnt_sign_to);
            }


            
            $("#id_cnt_wage_id").val(json.cnt_wage_id);
            
            $("#id_wage_id_text").val(json.cnt_wage_id);

            if(json.cnt_wage_en!="") {
              $("#id_cnt_wage_id_text").val(json.cnt_wage_en + "  |  " + json.cnt_wage_8hr);  
            } else {
              $("#id_cnt_wage_id_text").val("");
            }
            
            if(json.cnt_guard_amt==0) {
              $("#id_cnt_guard_amt").val("");
            } else {
              $("#id_cnt_guard_amt").val(json.cnt_guard_amt);    
            }
            
            if(json.cnt_sale_amt==0) {
              $("#id_cnt_sale_amt").val(0.00);
            } else {
              $("#id_cnt_sale_amt").val(json.cnt_sale_amt);
            }                    

            if(json.cnt_new=='N') {
              $("#id_cnt_new").prop("checked", true);
            } else {
              $("#id_cnt_new").prop("checked", false);
            }

            if(json.cnt_print=='C') {
              $("#id_cnt_print").prop("checked", true);
              $('#id_cnt_print_label').text('Customer');
            } else {
              $("#id_cnt_print").prop("checked", false);
              $('#id_cnt_print_label').text('Site Address');
            }

            if(json.cnt_autoexpire) {
              $("#id_cnt_autoexpire").prop("checked", true);
            } else {
              $("#id_cnt_autoexpire").prop("checked", false);
            }

            if(json.cnt_then=="T") {
              $("#id_print_th").prop("checked", true); 
              $("#id_print_en").prop("checked", false); 
            }

            if(json.cnt_then=="E") {
              $("#id_print_en").prop("checked", true); 
              $("#id_print_th").prop("checked", false); 
            }

            $("#main-content :input").attr("disabled", false);
            $("#contract_number_form :input").attr("disabled", true);            
            $("#id_cnt_doc_no").focus();

            // Show cus_service if existed.
            if(json.cus_service_list.length > 0) {
              // Reloade service list table
              $.ajax({
                url : "/contract/ajax/reload_service_list",
                type: 'get',          
                dataType: 'json',
                data: {
                  cnt_id: cnt_id,
                },
                beforeSend: function () {
                  
                },    
                success: function (data) {

                  result = "";
                  result += "<div class='row'>";
                  result += "  <div class='col-md-12 table-responsive'>";
                  result += "    <table id='customer-list-table' class='table table-striped table-sm'>";
                  result += "      <thead class='thead-light'>";
                  result += "      <tr>";
                  result += "        <th>{% trans 'Eff Frm' %}</th>";
                  result += "        <th scope='col'>{% trans 'Eff To' %}</th>";
                  result += "        <th scope='col' nowrap>{% trans 'Shift Time' %}</th>";
                  result += "        <th scope='col' class='text-center'>{% trans 'QTY' %}</th>";
                  result += "        <th scope='col' class='text-center'>{% trans 'Rank' %}</th>";
                  result += "        <th scope='col'>{% trans 'Rate' %}</th>";
                  result += "        <th scope='col'>{% trans 'Ext.Cost' %}</th>";
                  result += "        <th scope='col' class='text-center'>{% trans 'MON' %}</th>";
                  result += "        <th scope='col' class='text-center'>{% trans 'TUE' %}</th>";
                  result += "        <th scope='col' class='text-center'>{% trans 'WED' %}</th>";
                  result += "        <th scope='col' class='text-center'>{% trans 'THU' %}</th>";
                  result += "        <th scope='col' class='text-center'>{% trans 'FRI' %}</th>";
                  result += "        <th scope='col' class='text-center'>{% trans 'SAT' %}</th>";
                  result += "        <th scope='col' class='text-center'>{% trans 'SUN' %}</th>";
                  result += "        <th scope='col' class='text-center'>{% trans 'PUB' %}</th>";
                  result += "        <th scope='col'>{% trans 'Remark' %}</th>";
                  result += "        <th scope='col'>{% trans 'Status' %}</th>";
                  result += "        <th>&nbsp;</th>";
                  result += "      </tr>";
                  result += "     </thead>";
                  result += "     <tbody>";
                                    
                  for(var i=0; i<data.cus_service_list.length; i++) {
                    srv_cost_text = data.cus_service_list[i]["srv_cost"].replace(/\B(?=(\d{3})+(?!\d))/g, ",");
                    srv_rate_text = data.cus_service_list[i]["srv_rate"].replace(/\B(?=(\d{3})+(?!\d))/g, ",");

                    result += "          <tr>";
                    if(data.cus_service_list[i]["srv_active"]==1) {
                      result += "          <td><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["srv_eff_frm"] + "</small></a></td>";
                      result += "          <td><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["srv_eff_to"] + "</small></a></td>";
                      result += "          <td><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["shf_desc"] + "</small></a></td>";
                      result += "          <td align='center'><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["srv_qty"] + "</small></a></td>";
                      result += "          <td class='text-center'><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["srv_rank"] + "</small></td>";
                      result += "          <td align='left'><a href='javascript:void(0);'><small>" + srv_rate_text + "</small></a></td>";                      
                      result += "          <td align='left'><a href='javascript:void(0);'><small>" + srv_cost_text + "</small></a></td>";                      
                      result += "          <td align='center'><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["srv_mon"] + "</small></a></td>";
                      result += "          <td align='center'><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["srv_tue"] + "</small></a></td>";
                      result += "          <td align='center'><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["srv_wed"] + "</small></a></td>";
                      result += "          <td align='center'><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["srv_thu"] + "</small></a></td>";
                      result += "          <td align='center'><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["srv_fri"] + "</small></a></td>";
                      result += "          <td align='center'><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["srv_sat"] + "</small></a></td>";
                      result += "          <td align='center'><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["srv_sun"] + "</small></a></td>";
                      result += "          <td align='center'><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["srv_pub"] + "</small></a></td>";
                      result += "          <td><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["srv_rem"] + "</small></a></td>";
                      }
                    else {
                      result += "          <td><small>" + data.cus_service_list[i]["srv_eff_frm"] + "</small></td>";
                      result += "          <td><small>" + data.cus_service_list[i]["srv_eff_to"] + "</small></td>";
                      result += "          <td><small>" + data.cus_service_list[i]["shf_desc"] + "</small></td>";
                      result += "          <td align='center'><small>" + data.cus_service_list[i]["srv_qty"] + "</small></td>";
                      result += "          <td class='text-center'><small>" + data.cus_service_list[i]["srv_rank"] + "</small></td>";
                      result += "          <td align='left'><small>" + srv_rate_text + "</small></td>";                      
                      result += "          <td align='left'><small>" + srv_cost_text + "</small></td>";  
                      result += "          <td align='center'><small>" + data.cus_service_list[i]["srv_mon"] + "</small></td>";
                      result += "          <td align='center'><small>" + data.cus_service_list[i]["srv_tue"] + "</small></td>";
                      result += "          <td align='center'><small>" + data.cus_service_list[i]["srv_wed"] + "</small></td>";
                      result += "          <td align='center'><small>" + data.cus_service_list[i]["srv_thu"] + "</small></td>";
                      result += "          <td align='center'><small>" + data.cus_service_list[i]["srv_fri"] + "</small></td>";
                      result += "          <td align='center'><small>" + data.cus_service_list[i]["srv_sat"] + "</small></td>";
                      result += "          <td align='center'><small>" + data.cus_service_list[i]["srv_sun"] + "</small></td>";
                      result += "          <td align='center'><small>" + data.cus_service_list[i]["srv_pub"] + "</small></td>";
                      result += "          <td><small>" + data.cus_service_list[i]["srv_rem"] + "</small></td>";
                    }

                    if(data.cus_service_list[i]["srv_active"]==1)
                      result += "          <td><span class='badge badge-success'>{% trans 'Active' %}</span></td>";
                    else
                      result += "          <td><span class='badge badge-secondary'>{% trans 'Pending' %}</span></td>";
                  
                    result += "          <td>";
                    result += "            <div class='btn-group btn-group-sm nowrap'>";
                    result += "              <small>";
                    result += "              <button type='button' onclick='update_customer_service(" + data.cus_service_list[i]["srv_id"] + ")' class='btn btn-info btn-xs js-update-contract-service' data-toggle='modal'>&nbsp;<i class='fas fa-pen fa-xs'></i>&nbsp;</button>";

                    result += "              <button type='button' onclick='delete_customer_service(" + data.cus_service_list[i]["srv_id"] + ")' class='btn btn-danger btn-xs js-delete-contract-service'>";
                    result += "                &nbsp;<i class='fas fa-trash fa-xs'></i>&nbsp;";
                    result += "              </button>";
                    result += "              </small>";
                    result += "            </div>";
                    result += "          </td>";
                  }
                    result += "          </tr>";
                  
                  result += "      </tbody>";
                  result += "    </table>";
                  result += "  </div>";
                  result += "</div>";

                  $("#service_list_table .card-body").html(result);

                  $.LoadingOverlay("hide");
                },
                error: function(data){
                  // do nothing        
                }
              });    


              //showLoading();
              $.LoadingOverlay("hide");

            }

          } else {

            if(json.customer_not_existed) {
              alert("Customer " + cus_id + " Branch " + cus_brn + " does not existed. Please create a new customer.");

              $("#main-content :input").attr("disabled", true);
              $("#contract_number_form :input").attr("disabled", false);
              $("#id_cus_brn").focus();
            } else {              
              
              //alert("new contract")
              
              $("#main-content :input").attr("disabled", false);
              $("#contract_number_form :input").attr("disabled", true);
              
              $("#chkCNTDocDate").prop("checked", true);
              $("#chkCNTEffFrom").prop("checked", true);
              $("#chkCNTEffTo").prop("checked", true);
              $("#chkCNTSignFrom").prop("checked", true);
              $("#chkCNTSignTo").prop("checked", true);


              $('#id_cnt_doc_date').attr('readonly', false);
              $('#id_cnt_doc_date').attr("disabled", false);      

              $('#id_cnt_eff_frm').attr('readonly', false);
              $('#id_cnt_eff_frm').attr("disabled", false);      
              $('#id_cnt_eff_to').attr('readonly', false);
              $('#id_cnt_eff_to').attr("disabled", false);      

              $('#id_cnt_sign_frm').attr('readonly', false);
              $('#id_cnt_sign_frm').attr("disabled", false);      
              $('#id_cnt_sign_to').attr('readonly', false);
              $('#id_cnt_sign_to').attr("disabled", false);      

              $("#id_cnt_doc_no").focus();                         
            }

            $.LoadingOverlay("hide");
          }             
        },
      });       
    }
  });  



  $('#id_cnt_print').on('click', function (e) {
    if ($('#id_cnt_print').is(":checked"))
      $('#id_cnt_print_label').text('Customer');
    else
      $('#id_cnt_print_label').text('Site Address');
  });


  // SAVE CONTRACT
  $("#saveContract").click( function() {
    event.preventDefault();

    var cus_id = $('#id_cus_id').val();
    var cus_brn = $('#id_cus_brn').val();
    var cus_vol = $('#id_cus_vol').val();

    if(cus_id=='' || cus_id==null) {
      alert("Contract ID is required!");
      $('#id_cus_id').focus();
    } else if(cus_brn=='' || cus_brn==null) {
      alert("Customer Branch is required");
      $('#id_cus_brn').focus();
    } else if(cus_vol=='' || cus_vol==null) {
      alert("Customer Volume is required");
      $('#id_cus_vol').focus();
    } else {

    var wage_id = $("#id_cnt_wage_id").val();
    if(wage_id=="") {
      $.alert({
          title: 'Error',
          type: 'red',
          content: "",
          animation: 'zoom',
          animationBounce: 1.5,
          closeIcon: false,
          boxWidth: '38%',
          useBootstrap: false,
      });
      return false;      
    } else {
      contract_form_validation(cus_id, cus_brn, cus_vol);
    }    

    }
  });

  $("#cancelCreateContract").click( function() {
    event.preventDefault();

    //$('#contract_number_form')[0].reset();
    $('#contract_number_form').trigger("reset");
    
    //$('#contractupdateform')[0].reset();
    $('#contractupdateform').trigger("reset");

    $("#main-content :input").attr("disabled", true);
    $("#contract_number_form :input").attr("disabled", false);

    // TODO - disable Active button when click Cancel button
    $("#id_cnt_active").prop("active", false);

    

    // Clear data
    $("#service_list_table tbody").html("<tr><td colspan='18' class='text-center'><br><br><br>There is no data.<br><br><br><br></td></tr>");
    
    //$('#customer_name_title').html("<h4><i class='far fa-question-circle fa-sm'></i>&nbsp;Customer</h4>");
    $('#customer_name_title').html("<button type='button' class='btn btn-success'><span style='font-size:18px;font-weight:bold;'>Customer Name</span>&nbsp;&nbsp;&nbsp;<span class='badge badge-light'>Zone</span></button>");

    $("#id_cnt_wage_id").val("");
    $("#id_cus_zone_id").val("");

    $("#id_cus_id").focus();
  });


  function contract_form_validation(cus_id, cus_brn, cus_vol) {

    // cnt_active
    if ($('#id_cnt_active').is(":checked"))
      cnt_active = 1;
    else
      cnt_active = 0;
    
    // cnt_new
    if ($('#id_cnt_new').is(":checked"))
      cnt_new = 'N';
    else
      cnt_new = '';

    // amendment
    if ($('#id_amendment').is(":checked"))
      amendment_flag = true;
    else
      amendment_flag = false;

    // cnt_print
    if ($('#id_cnt_print').is(":checked"))
      cnt_print = 'C';
    else
      cnt_print = 'S';

    // cnt_auto_expire
    if ($('#id_cnt_autoexpire').is(":checked"))
      cnt_autoexpire = 1;
    else
      cnt_autoexpire = 0;

    // cnt_doc_no
    cnt_doc_no = $('#id_cnt_doc_no').val();

    // cnt_doc_date
    cnt_doc_date = $('#id_cnt_doc_date').val();
    if ($('#chkCNTDocDate').is(":checked"))
      cnt_doc_date_status = 1;
    else
      cnt_doc_date_status = 0;


    // cnt_eff_frm
    cnt_eff_frm = $('#id_cnt_eff_frm').val();    
    if ($('#chkCNTEffFrom').is(":checked"))
      cnt_eff_frm_status = 1;
    else
      cnt_eff_frm_status = 0;


    // cnt_eff_to
    cnt_eff_to = $('#id_cnt_eff_to').val();
    if ($('#chkCNTEffTo').is(":checked"))
      cnt_eff_to_status = 1;
    else
      cnt_eff_to_status = 0;


    // cnt_sign_frm
    cnt_sign_frm = $('#id_cnt_sign_frm').val();
    if ($('#chkCNTSignFrom').is(":checked"))
      cnt_sign_frm_status = 1;
    else
      cnt_sign_frm_status = 0;

  
    // cnt_sign_to
    cnt_sign_to = $('#id_cnt_sign_to').val();
    if ($('#chkCNTSignTo').is(":checked"))
      cnt_sign_to_status = 1;
    else
      cnt_sign_to_status = 0;

    // cnt_wage_id
    cnt_wage_id = $('#id_cnt_wage_id').val();
    if(cnt_wage_id=="") {
      $.alert({
          title: 'Error',
          type: 'red',
          content: "",
          animation: 'zoom',
          animationBounce: 1.5,
          closeIcon: false,
          boxWidth: '38%',
          useBootstrap: false,
      });
      return false;      
    }

    // cnt_sale_amt
    cnt_sale_amt = $('#id_cnt_sale_amt').val();
    // cnt_guard_amt
    cnt_guard_amt = $('#id_cnt_guard_amt').val();
    //cnt_apr_by_id
    cnt_apr_by_id = $('#id_cnt_apr_by_id').val();     
    //cnt_apr_by_text
    cnt_apr_by_text = $('#id_cnt_apr_by_text').val(); 

    // zone
    cnt_zone_id = $('#id_cus_zone_id').val();    

    // cnt_th_en
    cnt_then = $('input[name="printOptions"]:checked').val();

    // cnt_print
    // cnt_print = $('#id_cnt_print').val();

    //console.log(cnt_new + ", " + amendment_flag + ", " + cnt_print + ", " + cnt_autoexpire + ", " + cnt_active);
  
    $.ajax({
      url : "/contract/ajax/create_contract/",
      type : "POST",
      data : {          
        csrfmiddlewaretoken: '{{ csrf_token }}',
        cus_id: cus_id,
        cus_brn: cus_brn,
        cus_vol: cus_vol,
        cnt_active: cnt_active,
        cnt_new: cnt_new,
        cnt_print: cnt_print,
        cnt_then: cnt_then,
        cnt_autoexpire: cnt_autoexpire,
        cnt_doc_no: cnt_doc_no,

        cnt_doc_date: cnt_doc_date,
        cnt_doc_date_status: cnt_doc_date_status,

        cnt_eff_frm: cnt_eff_frm,
        cnt_eff_frm_status: cnt_eff_frm_status,

        cnt_eff_to: cnt_eff_to,
        cnt_eff_to_status: cnt_eff_to_status,

        cnt_sign_frm: cnt_sign_frm,
        cnt_sign_frm_status: cnt_sign_frm_status,

        cnt_sign_to: cnt_sign_to,
        cnt_sign_to_status: cnt_sign_to_status,

        cnt_wage_id: cnt_wage_id,
        cnt_sale_amt: cnt_sale_amt,
        cnt_guard_amt: cnt_guard_amt,
        cnt_apr_by_id: cnt_apr_by_id,
        cnt_apr_by_text: cnt_apr_by_text,
        cnt_zone_id: cnt_zone_id,
      },
      success : function(json) {        
        if(json.form_is_valid) {
          $(document).Toasts('create', {
            class: json.class, 
            title: "{% trans 'Message' %}",
            subtitle: '',
            autohide: true,
            delay: 2000,
            body: json.result + "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;",
            autoDismiss: true,
            close: true,
            autoremove: true,
          });

          $.each($('.is-valid'), function() {
            $('.is-valid').removeClass('is-valid');              
          });            

          $.each($('.is-invalid'), function() {
            $('.is-invalid').addClass('is-valid');  
            $('.is-invalid').removeClass('is-invalid');              
          });           

        }
        else {          
          $(document).Toasts('create', {
            class: json.class,
            title: "{% trans 'Error' %}",
            subtitle: '',
            autohide: true,
            delay: 5000,
            body: json.message,
            autoDismiss: true,
            close: true,
            autoremove: true,
            preventDuplicates: true,       
          });

          $.each($('.is-invalid'), function() {
            $('.is-invalid').removeClass('is-invalid');
          });            

          for(error in json.errors) {
            $("#id_" + error).addClass("is-invalid");         
          };

        }
      },
    });

  };

  function cus_contract_select_wagerate(wage_id, wage_th, wage_en, wage_8hr) {
    $("#id_cnt_wage_id_text").val(wage_th + " | " + wage_8hr);
    $("#id_cnt_wage_id").val(wage_id);
    $("#id_wage_id_text").val(wage_id);
    $("#wageratemodal").modal("hide");    
  };

  function cus_contract_select_item(cnt_id, cnt_name_th, cnt_name_en) {    
    
    loadContract(cnt_id);

    $("#search_contract_modal").modal("hide");    
  };


  function loadContract(cnt_id) {
    cnt_id_text = cnt_id.toString();
    cus_id = cnt_id_text.substring(0, 4);
    cus_brn = cnt_id_text.substring(4, 7);
    cus_vol = cnt_id_text.substring(7, 10);

    while (cus_id.length < 7) 
      cus_id = "0" + cus_id;    
    $("#id_cus_id").val(cus_id);

    $("#id_cus_brn").val(cus_brn);
    $("#id_cus_vol").val(cus_vol);

    showLoading();

    $.ajax({
      url : "/contract/ajax/get_cus_main/",
      type : "POST",
      data : {
        csrfmiddlewaretoken: '{{ csrf_token }}',
        cus_id: cus_id,
      },
      success : function(json) {        
        if(json.is_existed) {                      

          if(json.cus_name_th.length<70) {
            cus_name_th_new = json.cus_name_th
          } else {
            cus_name_th_new = json.cus_name_th.substring(0,70) + "...";
          }

          //$('#customer_name_title').html("<h5 class='m-0 text-dark'><b>" + cus_name_th_new + "</b>&nbsp;&nbsp;&nbsp;<small>&nbsp;&nbsp;<button type='button' class='btn btn-tool' data-card-widget='collapse'><i class='fas fa-angle-down text-dark'></i></button></small></h5>");
          //$('#customer_name_title').html("<button type='button' class='btn btn-primary'>" + cus_name_th_new + "&nbsp;&nbsp;&nbsp;<span class='badge badge-light'>" + json.cus_zone_id + " | " + json.cus_zone_th + "</span></button>");

          $('#customer_name_title').html("<button type='button' class='btn btn-success'><span style='font-size:18px;font-weight:bold;'>" + cus_name_th_new + "</span>&nbsp;&nbsp;&nbsp;<span class='badge badge-light'>" + json.cus_zone_id + " | " + json.cus_zone_th + "</span></button>");

          loadCusBrn(cus_brn);
          loadCusVol(cus_id, cus_brn, cus_vol);
        } else {              
          alert("Error");
        }
      },
    }); 

    $.LoadingOverlay("hide");
  }

  function loadCusBrn() {
    $.ajax({
      url : "/contract/ajax/get_customer/",
      type : "POST",
      data : {          
        csrfmiddlewaretoken: '{{ csrf_token }}',
        cus_id: cus_id,
        cus_brn: cus_brn,
      },
      success : function(json) {        
        if(json.is_existed) {          
          if(json.cus_name_th.length<70) {
            cus_name_th_new = json.cus_name_th
          } else {
            cus_name_th_new = json.cus_name_th.substring(0,70) + "...";
          }

          //$('#customer_name_title').html("<h5 class='m-0 text-dark'><b>" + cus_name_th_new + "</b>&nbsp;&nbsp;&nbsp;<span class='badge badge-info'>" + json.cus_zone_id + " | " + json.cus_zone_th + "</span>" + "<small>&nbsp;&nbsp;<button type='button' class='btn btn-tool' data-card-widget='collapse'><i class='fas fa-angle-down text-dark'></i></button></small></h5>");

          //$('#customer_name_title').html("<button type='button' class='btn btn-primary'>" + cus_name_th_new + "&nbsp;&nbsp;&nbsp;<span class='badge badge-light'>" + json.cus_zone_id + " | " + json.cus_zone_th + "</span></button>");

          $('#customer_name_title').html("<button type='button' class='btn btn-success'><span style='font-size:18px;font-weight:bold;'>" + cus_name_th_new + "</span>&nbsp;&nbsp;&nbsp;<span class='badge badge-light'>" + json.cus_zone_id + " | " + json.cus_zone_th + "</span></button><small>&nbsp;&nbsp;<button type='button' class='btn btn-tool' data-card-widget='collapse'><i class='fas fa-angle-down text-dark'></i></button></small>");          

          $('#id_cus_name_th').val(json.cus_name_th);
          $('#id_cus_sht_th').val(json.cus_sht_th);
          $('#id_cus_add_th').val(json.cus_add_th);
          $('#id_cus_subdist_th').val(json.cus_subdist_th);
          $('#id_cus_zip_th').val(json.cus_zip_th);        
          $('#id_cus_district_th').val(json.cus_district_th);
          $('#id_cus_city_th').val(json.cus_city_th);
          $('#id_cus_country_th').val(json.cus_country_th);
          $('#id_site_contact_id_th').val(json.site_contact_id_th);
          $('#id_site_contact_con_th').val(json.site_contact_con_th);
          $('#id_site_contact_con_position_th').val(json.site_contact_con_position_th);
          $('#id_site_contact_con_mobile_th').val(json.site_contact_con_mobile_th);
          $('#id_site_contact_con_email_th').val(json.site_contact_con_email_th);

          // EN
          $('#id_cus_name_en').val(json.cus_name_en);
          $('#id_cus_sht_en').val(json.cus_sht_en);
          $('#id_cus_add_en').val(json.cus_add_en);
          $('#id_cus_subdist_en').val(json.cus_subdist_en);
          $('#id_cus_zip_en').val(json.cus_zip_en);        
          $('#id_cus_district_en').val(json.cus_district_en);
          $('#id_cus_city_en').val(json.cus_city_en);
          $('#id_cus_country_en').val(json.cus_country_en);
          $('#id_site_contact_id_en').val(json.site_contact_id_en);
          $('#id_site_contact_con_en').val(json.site_contact_con_en);
          $('#id_site_contact_con_position_en').val(json.site_contact_con_position_en);
          $('#id_site_contact_con_mobile_en').val(json.site_contact_con_mobile_en);
          $('#id_site_contact_con_email_en').val(json.site_contact_con_email_en);
        
          $('#id_cus_tel_th').val(json.cus_tel);
          $('#id_cus_fax_th').val(json.cus_fax);
          $('#id_cus_email_th').val(json.cus_email);
          $('#id_cus_tel_en').val(json.cus_tel);
          $('#id_cus_fax_en').val(json.cus_fax);
          $('#id_cus_email_en').val(json.cus_email);

          $("#id_cus_zone_id").val(json.cus_zone_id);
          $('#id_cus_zone_th').val(json.cus_zone_id + " | " + json.cus_zone_th);
          $('#id_cus_zone_en').val(json.cus_zone_id + " | " + json.cus_zone_en);

          $('#id_cus_vol').focus();
        }
        else {
          alert("Customer " + cus_id + " Branch " + cus_brn + " does not existed. Please create a new customer.");
          $('#id_cus_brn').focus();
        }
      },
    });
  }

  function loadCusVol(cus_id, cus_brn, cus_vol) {
    $.ajax({
      //url : "/contract/ajax/get_attendance_information/",
      url : "/contract/ajax/get_cus_contract/",        
      type : "POST",
      data : {
        csrfmiddlewaretoken: '{{ csrf_token }}',
        cus_id: cus_id,
        cus_brn: cus_brn,
        cus_vol: cus_vol,
      },
      success : function(json) {        

        // check if contract used to be deleted          
        var upd_flag = json.cnt_upd_flag;
        var cnt_id = json.cnt_id;

        $("#id_cnt_id_temp").val(cnt_id);
        // $("#id_contract_number").text("No." + cnt_id);
        $("#id_contract_number").text("");

        if(upd_flag=='D') {    
          var retVal = confirm("Would you like to undelete Contract No." + cnt_id + " ?");
                    
          if( retVal == true ) {
            // Change upd_flag to 'R'
            $.ajax({
              url: "/contract/ajax/ajax_undelete_contract/",
              type: "POST",
              data: {        
                csrfmiddlewaretoken: '{{ csrf_token }}',
                cnt_id: cnt_id,
              },
              success: function(data) {
                
              },
              error: function(data) {
                
              },
            });
          } else {

          }
        } else {

        }

        if(json.is_existed) {

          var today = new Date();
          var dd = String(today.getDate()).padStart(2, '0');
          var mm = String(today.getMonth() + 1).padStart(2, '0');
          var yyyy = today.getFullYear();
          today = dd + '/' + mm + '/' + yyyy;

          cnt_id = json.cnt_id;       

          if(json.cnt_active) {
            $("#id_cnt_active").prop("checked", true);
          } else {
            $("#id_cnt_active").prop("checked", false);
          }

          $("#id_cnt_doc_no").val(json.cnt_doc_no);
          
          //console.log("doc_date:" + json.cnt_doc_date + " | eff_frm:" + json.cnt_eff_frm + " | eff_to:" + json.cnt_eff_to + " | sign_frm:" + json.cnt_sign_frm + " | sign_to:" + json.cnt_sign_to);


          if(json.cnt_doc_date==null || json.cnt_doc_date=="31/12/2999") {
            $("#chkCNTDocDate").prop("checked", false);
            $('#id_cnt_doc_date').attr('readonly', true);
            $('#id_cnt_doc_date').attr("disabled", true);
            $("#id_cnt_doc_date").val(today);
          } else {
            $("#chkCNTDocDate").prop("checked", true);
            $('#id_cnt_doc_date').attr('readonly', false);
            $('#id_cnt_doc_date').attr("disabled", false);      
            $("#id_cnt_doc_date").val(json.cnt_doc_date);              
          }
          

          if(json.cnt_eff_frm==null || json.cnt_eff_frm=="31/12/2999") {
            $("#chkCNTEffFrom").prop("checked", false);
            $('#id_cnt_eff_frm').attr('readonly', true);
            $('#id_cnt_eff_frm').attr("disabled", true);
            $("#id_cnt_eff_frm").val(today);              
          } else {
            $("#chkCNTEffFrom").prop("checked", true);
            $('#id_cnt_eff_frm').attr('readonly', false);
            $('#id_cnt_eff_frm').attr("disabled", false);
            $("#id_cnt_eff_frm").val(json.cnt_eff_frm);
          }


          if(json.cnt_eff_to==null || json.cnt_eff_to=="31/12/2999") {
            $("#chkCNTEffTo").prop("checked", false);
            $('#id_cnt_eff_to').attr('readonly', true);
            $('#id_cnt_eff_to').attr("disabled", true);
            $("#id_cnt_eff_to").val(today);
          } else {
            $("#chkCNTEffTo").prop("checked", true);
            $('#id_cnt_eff_to').attr('readonly', false);
            $('#id_cnt_eff_to').attr("disabled", false);
            $("#id_cnt_eff_to").val(json.cnt_eff_to);
          }

          
          if(json.cnt_sign_frm==null|| json.cnt_sign_frm=="31/12/2999") {
            $("#chkCNTSignFrom").prop("checked", false);
            $('#id_cnt_sign_frm').attr('readonly', true);
            $('#id_cnt_sign_frm').attr("disabled", true);
            $("#id_cnt_sign_frm").val(today);
          } else {
            $("#chkCNTSignFrom").prop("checked", true);
            $('#id_cnt_sign_frm').attr('readonly', false);
            $('#id_cnt_sign_frm').attr("disabled", false);
            $("#id_cnt_sign_frm").val(json.cnt_sign_frm);
          }

          
          if(json.cnt_sign_to==null|| json.cnt_sign_to=="31/12/2999") {
            $("#chkCNTSignTo").prop("checked", false);
            $('#id_cnt_sign_to').attr('readonly', true);
            $('#id_cnt_sign_to').attr("disabled", true);
            $("#id_cnt_sign_to").val(today);              
          } else {
            $("#chkCNTSignTo").prop("checked", true);
            $('#id_cnt_sign_to').attr('readonly', false);
            $('#id_cnt_sign_to').attr("disabled", false);
            $("#id_cnt_sign_to").val(json.cnt_sign_to);
          }


          
          $("#id_cnt_wage_id").val(json.cnt_wage_id);
          
          $("#id_wage_id_text").val(json.cnt_wage_id);

          if(json.cnt_wage_en!="") {
            $("#id_cnt_wage_id_text").val(json.cnt_wage_en + "  |  " + json.cnt_wage_8hr);  
          } else {
            $("#id_cnt_wage_id_text").val("");
          }
          
          $("#id_cnt_guard_amt").val(json.cnt_guard_amt);
          
          $("#id_cnt_sale_amt").val(json.cnt_sale_amt);
          console.log(json.cnt_sale_amt);
          //$("#id_cnt_sale_amt").val(json.cnt_sale_amt.toString());
          //$("#id_cnt_sale_amt").val(parseFloat(json.cnt_sale_amt).toString().replace(/(\d)(?=(\d{3})+(?!\d))/g, '$1,'));

          if(json.cnt_new=='N') {
            $("#id_cnt_new").prop("checked", true);
          } else {
            $("#id_cnt_new").prop("checked", false);
          }

          if(json.cnt_print=='C') {
            $("#id_cnt_print").prop("checked", true);
            $('#id_cnt_print_label').text('Customer');
          } else {
            $("#id_cnt_print").prop("checked", false);
            $('#id_cnt_print_label').text('Site Address');
          }

          if(json.cnt_autoexpire) {
            $("#id_cnt_autoexpire").prop("checked", true);
          } else {
            $("#id_cnt_autoexpire").prop("checked", false);
          }

          if(json.cnt_then=="T") {
            $("#id_print_th").prop("checked", true); 
            $("#id_print_en").prop("checked", false); 
          }

          if(json.cnt_then=="E") {
            $("#id_print_en").prop("checked", true); 
            $("#id_print_th").prop("checked", false); 
          }

          $("#main-content :input").attr("disabled", false);
          $("#contract_number_form :input").attr("disabled", true);            
          $("#id_cnt_doc_no").focus();

          // Show cus_service if existed.
          if(json.cus_service_list.length > 0) {
            // Reloade service list table
            $.ajax({
              url : "/contract/ajax/reload_service_list",
              type: 'get',          
              dataType: 'json',
              data: {
                cnt_id: cnt_id,
              },
              beforeSend: function () {
                
              },    
              success: function (data) {
                result = "";
                result += "<div class='row'>";
                result += "  <div class='col-md-12 table-responsive'>";
                result += "    <table id='customer-list-table' class='table table-striped table-sm'>";
                result += "      <thead class='thead-light'>";
                result += "      <tr>";
                result += "        <th>{% trans 'Eff Frm' %}</th>";
                result += "        <th scope='col'>{% trans 'Eff To' %}</th>";
                result += "        <th scope='col' nowrap>{% trans 'Shift Time' %}</th>";
                result += "        <th scope='col' class='text-center'>{% trans 'QTY' %}</th>";
                result += "        <th scope='col' class='text-center'>{% trans 'Rank' %}</th>";
                result += "        <th scope='col'>{% trans 'Rate' %}</th>";
                result += "        <th scope='col'>{% trans 'Ext.Cost' %}</th>";
                result += "        <th scope='col' class='text-center'>{% trans 'MON' %}</th>";
                result += "        <th scope='col' class='text-center'>{% trans 'TUE' %}</th>";
                result += "        <th scope='col' class='text-center'>{% trans 'WED' %}</th>";
                result += "        <th scope='col' class='text-center'>{% trans 'THU' %}</th>";
                result += "        <th scope='col' class='text-center'>{% trans 'FRI' %}</th>";
                result += "        <th scope='col' class='text-center'>{% trans 'SAT' %}</th>";
                result += "        <th scope='col' class='text-center'>{% trans 'SUN' %}</th>";
                result += "        <th scope='col' class='text-center'>{% trans 'PUB' %}</th>";
                result += "        <th scope='col'>{% trans 'Remark' %}</th>";
                result += "        <th scope='col'>{% trans 'Status' %}</th>";
                result += "        <th>&nbsp;</th>";
                result += "      </tr>";
                result += "     </thead>";
                result += "     <tbody>";

                // id_cus_vol enter
                for(var i=0; i<data.cus_service_list.length; i++) {
                  srv_cost_text = data.cus_service_list[i]["srv_cost"].replace(/\B(?=(\d{3})+(?!\d))/g, ",");
                  srv_rate_text = data.cus_service_list[i]["srv_rate"].replace(/\B(?=(\d{3})+(?!\d))/g, ",");

                  result += "          <tr>";
                  if(data.cus_service_list[i]["srv_active"]==1) {
                    result += "          <td><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["srv_eff_frm"] + "</small></a></td>";
                    result += "          <td><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["srv_eff_to"] + "</small></a></td>";
                    result += "          <td><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["shf_desc"] + "</small></a></td>";
                    result += "          <td align='center'><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["srv_qty"] + "</small></a></td>";
                    result += "          <td class='text-center'><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["srv_rank"] + "</small></td>";
                    
                    //result += "          <td align='right'><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["srv_rate"] + "</small></a></td>";
                    result += "          <td align='right'><a href='javascript:void(0);'><small>" + srv_rate_text + "</small></a></td>";                      
                    //result += "          <td align='right'><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["srv_cost"] + "</small></a></td>";
                    result += "          <td align='right'><a href='javascript:void(0);'><small>" + srv_cost_text + "</small></a></td>";
                    
                    result += "          <td align='center'><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["srv_mon"] + "</small></a></td>";
                    result += "          <td align='center'><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["srv_tue"] + "</small></a></td>";
                    result += "          <td align='center'><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["srv_wed"] + "</small></a></td>";
                    result += "          <td align='center'><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["srv_thu"] + "</small></a></td>";
                    result += "          <td align='center'><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["srv_fri"] + "</small></a></td>";
                    result += "          <td align='center'><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["srv_sat"] + "</small></a></td>";
                    result += "          <td align='center'><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["srv_sun"] + "</small></a></td>";
                    result += "          <td align='center'><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["srv_pub"] + "</small></a></td>";
                    result += "          <td><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["srv_rem"] + "</small></a></td>";
                    }
                  else {
                    result += "          <td><small>" + data.cus_service_list[i]["srv_eff_frm"] + "</small></td>";
                    result += "          <td><small>" + data.cus_service_list[i]["srv_eff_to"] + "</small></td>";
                    result += "          <td><small>" + data.cus_service_list[i]["shf_desc"] + "</small></td>";
                    result += "          <td align='center'><small>" + data.cus_service_list[i]["srv_qty"] + "</small></td>";
                    result += "          <td class='text-center'><small>" + data.cus_service_list[i]["srv_rank"] + "</small></td>";

                    //result += "          <td align='right'><small>" + data.cus_service_list[i]["srv_rate"] + "</small></td>";
                    result += "          <td align='right'><small>" + srv_rate_text + "</small></td>";                      
                    //result += "          <td align='right'><small>" + data.cus_service_list[i]["srv_cost"] + "</small></td>";
                    result += "          <td align='right'><small>" + srv_cost_text + "</small></td>";

                    result += "          <td align='center'><small>" + data.cus_service_list[i]["srv_mon"] + "</small></td>";
                    result += "          <td align='center'><small>" + data.cus_service_list[i]["srv_tue"] + "</small></td>";
                    result += "          <td align='center'><small>" + data.cus_service_list[i]["srv_wed"] + "</small></td>";
                    result += "          <td align='center'><small>" + data.cus_service_list[i]["srv_thu"] + "</small></td>";
                    result += "          <td align='center'><small>" + data.cus_service_list[i]["srv_fri"] + "</small></td>";
                    result += "          <td align='center'><small>" + data.cus_service_list[i]["srv_sat"] + "</small></td>";
                    result += "          <td align='center'><small>" + data.cus_service_list[i]["srv_sun"] + "</small></td>";
                    result += "          <td align='center'><small>" + data.cus_service_list[i]["srv_pub"] + "</small></td>";
                    result += "          <td><small>" + data.cus_service_list[i]["srv_rem"] + "</small></td>";
                  }

                  if(data.cus_service_list[i]["srv_active"]==1)
                    result += "          <td><span class='badge badge-success'>{% trans 'Active' %}</span></td>";
                  else
                    result += "          <td><span class='badge badge-secondary'>{% trans 'Pending' %}</span></td>";
                
                  result += "          <td>";
                  result += "            <div class='btn-group btn-group-sm nowrap'>";
                  result += "              <small>";
                  result += "              <button type='button' onclick='update_customer_service(" + data.cus_service_list[i]["srv_id"] + ")' class='btn btn-info btn-xs js-update-contract-service' data-toggle='modal'>&nbsp;<i class='fas fa-pen fa-xs'></i>&nbsp;</button>";

                  result += "              <button type='button' onclick='delete_customer_service(" + data.cus_service_list[i]["srv_id"] + ")' class='btn btn-danger btn-xs js-delete-contract-service'>";
                  result += "                &nbsp;<i class='fas fa-trash fa-xs'></i>&nbsp;";
                  result += "              </button>";
                  result += "              </small>";
                  result += "            </div>";
                  result += "          </td>";
                }
                  result += "          </tr>";
                
                result += "      </tbody>";
                result += "    </table>";
                result += "  </div>";
                result += "</div>";

                $("#service_list_table .card-body").html(result);
              },
              error: function(data){
                // do nothing        
              }
            });    

            $.LoadingOverlay("hide");

          }

        } else {

          if(json.customer_not_existed) {
            alert("Customer " + cus_id + " Branch " + cus_brn + " does not existed. Please create a new customer.");

            $("#main-content :input").attr("disabled", true);
            $("#contract_number_form :input").attr("disabled", false);
            $("#id_cus_brn").focus();
          } else {              
            
            //alert("new contract")
            
            $("#main-content :input").attr("disabled", false);
            $("#contract_number_form :input").attr("disabled", true);
            
            $("#chkCNTDocDate").prop("checked", true);
            $("#chkCNTEffFrom").prop("checked", true);
            $("#chkCNTEffTo").prop("checked", true);
            $("#chkCNTSignFrom").prop("checked", true);
            $("#chkCNTSignTo").prop("checked", true);


            $('#id_cnt_doc_date').attr('readonly', false);
            $('#id_cnt_doc_date').attr("disabled", false);      

            $('#id_cnt_eff_frm').attr('readonly', false);
            $('#id_cnt_eff_frm').attr("disabled", false);      
            $('#id_cnt_eff_to').attr('readonly', false);
            $('#id_cnt_eff_to').attr("disabled", false);      

            $('#id_cnt_sign_frm').attr('readonly', false);
            $('#id_cnt_sign_frm').attr("disabled", false);      
            $('#id_cnt_sign_to').attr('readonly', false);
            $('#id_cnt_sign_to').attr("disabled", false);      

            $("#id_cnt_doc_no").focus();                         
          }
        
          $.LoadingOverlay("hide");
        }             
      },
    });
  }

  function cus_contract_search_wagerate_modal() {
    current_wage_id = $('#id_cnt_wage_id').val();
    search_option = $('#id_cus_contract_wagerate_option').val();
    search_text = $('#id_cus_contract_wagerate_search_text').val();
    page_no = 1;

    $.ajax({
        url : "/contract/ajax/get_wagerate_list_modal",
        type: 'get',   
        dataType: 'json',
        data : {          
          page_no : page_no,
          wage_th : search_text,
          search_option : search_option,          
          search_text : search_text,
          current_wage_id : current_wage_id,
        },
        success: function (data) {
          var result = ""
          var count = data.results.length;
          var wage_id = data.results[0]["wage_id"];
          var wage_th = data.results[0]["wage_th"];
          var wage_en = data.results[0]["wage_en"];
          var wage_8hr = data.results[0]["wage_8hr"];

          result += "<div class='row col-12'>";
          result += "<div class='col-8 offset-3 pb-2'>";
          result += "<form id='cus_contract_search_wagerate_modal_form' class='form-inline col-12' accept-charset='UTF-8'>";
          result += "  <div class='form-group mx-sm-3 mb-2'>";
          result += "  <select name='cus_contract_wagerate_option' class='form-control form-control-sm' required id='id_cus_contract_wagerate_option'>";
          result += "    <option value='1' selected>Wage ID</option>";
          result += "    <option value='2'>Wage (TH)</option>";
          result += "    <option value='3'>Wage (EN)</option>";
          result += "  </select>&nbsp;&nbsp;&nbsp;&nbsp;";
          result += "    <label for='id_cus_contract_wagerate_search_text' class='sr-only'>Search</label>";            
          result += "    <input type='text' class='form-control form-control-sm' id='id_cus_contract_wagerate_search_text' name='cus_contract_wagerate_search_text' placeholder='' autocomplete='off' >";
          result += "  </div>";
          result += "<a href='javascript:cus_contract_search_wagerate_modal()' type='button' class='btn btn-primary btn-sm mb-2'>Search</a>";
          result += "</form>";
          result += "</div>";

          result += "<div class='row col-12'>";
          result += "<table class='table table-hover table-sm'>";
          result += " <thead>";
          result += "   <tr>";
          result += "     <th scope='col'>{% trans 'Wage ID' %}</th>";
          result += "     <th scope='col'>{% trans 'Wage (TH)' %}</th>";
          result += "     <th scope='col'>{% trans 'Wage (EN)' %}</th>";
          result += "     <th scope='col'>&nbsp;</th>";
          result += "   </tr>";
          result += " </thead>";
          result += "<tbody>";
          result += "</div>";
          result += "<div>";

          for(var i=0; i<count; i++) {              
            var wage_id = data.results[i]["wage_id"];
            var wage_th = data.results[i]["wage_th"];
            var wage_en = data.results[i]["wage_en"];
            var wage_8hr = data.results[i]["wage_8hr"];

            result += "<tr>";
            result += "<td>" + wage_id + "</td>";        
            result += "<td>" + wage_th + "</td>";
            result += "<td>" + wage_en + "</td>";
            
            result += "<td><a href='javascript:cus_contract_select_wagerate(" + wage_id + ",\"" + wage_th + "\",\"" + wage_en + "\",\"" + wage_8hr + "\");' type='button' class='btn btn-outline-primary btn-sm'>Select</a></td>";

            result += "</tr>";              
          }
          result += " </tbody>";
          result += "</table>";

          if(data.is_paginated) {
            result += "<div>";
            result += "  <span>";
            if(data.previous_page != 0) {
              result += " <a href='javascript:get_cus_main_district_lookup(" + data.previous_page + ");'>" + "<i class='fas fa-arrow-circle-left'></i></a> ";
            }
            result += data.current_page_number + " / " + data.current_page_paginator_num_pages;
            result += " <a href='javascript:get_cus_main_district_lookup(" + data.next_page + ");'>" + "<i class='fas fa-arrow-circle-right'></i></a>";
            result += "    </span>";
            result += "</div>";
          }
          
          $("#wageratemodal .modal-body").html(result);          
        },
        error: function(data){
          result = "";
          result += "<div class='row col-12'>";
          result += "<div class='col-8 offset-3 pb-2'>";
          result += "<form id='cus_main_search_district_modal_form' class='form-inline col-12' accept-charset='UTF-8'>";
          result += "  <div class='form-group mx-sm-3 mb-2'>";
          result += "  <select name='cus_contract_wagerate_option' class='form-control form-control-sm' required id='id_cus_contract_wagerate_option'>";
          result += "    <option value='1' selected>Wage ID</option>";
          result += "    <option value='2'>Wage (TH)</option>";
          result += "    <option value='3'>Wage (EN)</option>";
          result += "  </select>&nbsp;&nbsp;&nbsp;&nbsp;";
          result += "    <label for='id_cus_contract_search_wagerate' class='sr-only'>Search</label>";            
          result += "    <input type='text' class='form-control form-control-sm' id='id_cus_contract_wagerate_search_text' name='cus_contract_wagerate_search_text' placeholder='' autocomplete='off' >";
          result += "  </div>";
          result += "<a href='javascript:cus_contract_search_wagerate_modal()' type='button' class='btn btn-primary btn-sm mb-2'>Search</a>";            
          result += "</form>";
          result += "</div>";

          result += "<table class='table table-hover table-sm'>";
          result += " <thead>";
          result += "   <tr>";
          result += "     <td colspan='4' class='text-center'><br>Not found.<br><br></td>";
          result += "   </tr>";
          result += " </thead>";
          result += "</tbody>";
          result += "</table>";

          $("#wageratemodal .modal-body").html(result);
        }          
    });
  }


 

  //
  function cus_contract_search_modal() {    
    page_no = 1;
    search_option = $('#id_cus_contract_search_option').val(); //1=cnt_id, 2=cus_name_th, 3=cus_name_en
    search_text = $('#id_cus_contract_search_text').val();
    //console.log(search_option + " | " + search_text);
    if(search_text=="") {
      $.alert({
          title: 'Error',
          type: 'red',
          content: "",
          animation: 'zoom',
          animationBounce: 1.5,
          closeIcon: false,
          boxWidth: '38%',
          useBootstrap: false,
      });      
      return false;
    } else {
      //return false;
    }  

    $.ajax({
        url : "/contract/ajax/get_contract_list_modal",
        type: 'get',   
        dataType: 'json',
        data : {          
          page_no : page_no,
          search_option : search_option,          
          search_text : search_text,
        },
        success: function (data) {
          var result = ""
          var count = data.results.length;
          var cnt_id = data.results[0]["cnt_id"];
          var cus_name_th = data.results[0]["cus_name_th"];
          var cus_name_en = data.results[0]["cus_name_en"];

          result += "<div class='row col-12' stye='padding:0;'>";

          result += "<div class='col-8 offset-3 pb-2'>";
          result += "<form id='search_contract_modal_form' class='form-inline col-12' accept-charset='UTF-8'>";
          result += "  <div class='form-group mx-sm-3 mb-2'>";
          result += "  <select name='cus_contract_search_option' class='form-control form-control-sm' required id='id_cus_contract_search_option'>";
          result += "    <option value='1'>Contract ID</option>";
          result += "    <option value='2' selected>Customer Name (TH)</option>";
          result += "    <option value='3'>Customer Name (EN)</option>";
          result += "  </select>&nbsp;&nbsp;&nbsp;&nbsp;";
          result += "    <label for='id_cus_main_search_district' class='sr-only'>Search</label>";            
          result += "    <input type='text' class='form-control form-control-sm' id='id_cus_contract_search_text' name='cus_contract_search_text' autocomplete='off' value=''>";
          result += "  </div>";
          result += "<a href='javascript:cus_contract_search_modal()' type='button' class='btn btn-primary btn-sm mb-2'>Search</a>";            
          result += "</form>";
          result += "</div>";

          
          result += "<div class='table-responsive' stye='padding:0;'>";
          
          //<table class='table table-responsive table-sm table-striped table-condensed table-wrapper-scroll-y my-custom-scrollbar' id="
          result += "<table class='table table-hover table-striped table-wrapper-scroll-y my-custom-scrollbar w-100'>";
          result += " <thead>";
          result += "   <tr class='text-left'>";
          result += "     <th scope='col' class='text-left' nowrap>{% trans 'Contract ID' %}.</th>";
          result += "     <th scope='col' class='text-left'>{% trans 'Customer Name (TH)' %}</th>";
          result += "     <th scope='col' class='text-left'>{% trans 'Customer Name (EN)' %}</th>";
          result += "     <th scope='col'>&nbsp;</th>";
          result += "   </tr>";
          result += " </thead>";

          result += "<tbody style='font-size:13px;'>";
          result += "</div>";
          result += "<div>";

          for(var i=0; i<count; i++) {              
            var cnt_id = data.results[i]["cnt_id"];
            var cus_name_th = data.results[i]["cus_name_th"];
            var cus_name_en = data.results[i]["cus_name_en"];

            result += "<tr>";
            result += "<td class='align-middle'>" + cnt_id + "</td>";        
            result += "<td class='align-middle'>" + cus_name_th + "</td>";
            result += "<td class='align-middle'>" + cus_name_en + "</td>";
            result += "<td class='text-right'><a href='javascript:cus_contract_select_item(" + cnt_id + ",\"" + cus_name_th + "\",\"" + cus_name_en + "\");' type='button' class='btn btn-outline-primary btn-sm'>&nbsp;&nbsp;Select&nbsp;&nbsp;</a></td>";
            result += "</tr>";          
          }
          result += " </tbody>";
          result += "</table>";            
          result += "</div>";

          $("#id_search_number_of_found_record").html("&nbsp;&nbsp;&nbsp;<span class='text-success'><b>" + search_text + "</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>" + count + "</b>&nbsp;&nbsp;");
          
          $("#search_contract_modal .modal-body").html(result);          
        },
        error: function(data){          
          result = "";
          result += "<div class='row col-12'>";
          result += "<div class='col-8 offset-3 pb-2'>";
          result += "<form id='cus_main_search_district_modal_form' class='form-inline col-12' accept-charset='UTF-8'>";
          result += "  <div class='form-group mx-sm-3 mb-2'>";
          result += "  <select name='cus_contract_search_option' class='form-control form-control-sm' required id='id_cus_contract_search_option'>";
          result += "    <option value='1'>Contract ID</option>";
          result += "    <option value='2' selected>Name (TH)</option>";
          result += "    <option value='3'>Name (EN)</option>";
          result += "  </select>&nbsp;&nbsp;&nbsp;&nbsp;";          
          result += "    <label for='id_cus_main_search_district' class='sr-only'>Search</label>";            
          result += "    <input type='text' class='form-control form-control-sm' id='id_cus_contract_search_text' name='cus_contract_search_text' autocomplete='off' value=''>";          
          result += "  </div>";
          result += "<a href='javascript:cus_contract_search_modal()' type='button' class='btn btn-primary btn-sm mb-2'>Search</a>";
          result += "</form>";
          result += "</div>";

          result += "<table class='table table-hover table-sm'>";
          result += " <thead>";
          result += "   <tr>";
          result += "     <td colspan='4' class='text-center'><br> &nbsp;&nbsp;<b>" + search_text + "</b><br><br></td>";
          result += "   </tr>";
          result += " </thead>";
          result += "</tbody>";
          result += "</table>";

          $("#id_search_number_of_found_record").html("");
          $("#search_contract_modal .modal-body").html(result);
        }          
    });
  }


  function delete_customer_service(service_id) {
    $('#id_select_customer_service_id').val(service_id);

    if (service_id != null) {
      result = "";
      result += "<div>Do you want to delete service ID <b>" + service_id + " </b></div>";
      $("#delete_service_modal .modal-body").html(result);
      $("#delete_service_modal").modal("show");
    }

  }

  function update_customer_service(service_id) {
    if (service_id != null) {

      $('#id_select_customer_service_id').val(service_id);

      $.ajax({
          url : "/contract/ajax/update_customer_service",
          type: 'get',          
          dataType: 'json',
          data: {
            service_id: service_id
          },
          beforeSend: function () {
            $("#update_service_modal").modal("show");
          },    
          success: function (data) {

            var com_rank_count = data.com_rank_list.length;
            var t_shift_count = data.t_shift_list.length;

            var result = "";
            result += "<div class='row'>";
            result += "<div class='col-12'>";
            result += "  <div class='card card-info'>";
            result += "    <div class='card-body'>";
            result += "      <div class='form-row'>";
        
          // SRV_EFF_FROM
            result += "  <div class='form-group col-md-3'>";
            result += "    <label>Effect From</label>";
            result += "    <div class='input-group date' id='dtp_srv_eff_frm_date' data-target-input='nearest'>";                        


            result += "   <input type='checkbox' checked id='chkCNTEffFromNew' class='form-inline float-left' onclick='checkCNTEffFromNewStatus()' style='margin-top:9px;'>&nbsp;";
            result += "   <input type='text' name='srv_eff_frm' class='form-control form-control-sm' id='id_srv_eff_frm' placeholder='dd/mm/yyyy' value='" + data.srv_eff_frm + "'>";

            //result += "      <input type='text' name='srv_eff_frm' value='" + data.srv_eff_frm + "' class='form-control form-control-sm' id='id_srv_eff_frm' placeholder='dd/mm/yyyy' required=''>";
            //result += "      <div class='input-group-append' data-target='#dtp_srv_eff_frm_date' data-toggle='datepicker'>";
            //result += "        <div class='input-group-text text-primary'><i class='fa fa-calendar'></i></div>";
            //result += "      </div>";


            result += "    </div>";            
            result += "  </div>";

            // SRV_EFF_TO
            result += "  <div class='form-group col-md-3'>";
            result += "    <label>Effect To</label>";
            result += "    <div class='input-group date' id='dtp_srv_eff_to_date' data-target-input='nearest'>";                        


            if(data.srv_eff_to=="31/12/2999") {
              result += "   <input type='checkbox' id='chkCNTEffToNewEdit' class='form-inline float-left' onclick='checkCNTEffToNewStatusEdit()' style='margin-top:9px;'>&nbsp;";
              result += "   <input type='text' name='srv_eff_to' class='form-control form-control-sm' id='id_srv_eff_to' placeholder='dd/mm/yyyy' value='" + data.srv_eff_to + "' readonly>";
            } else {
              result += "   <input type='checkbox' checked id='chkCNTEffToNewEdit' class='form-inline float-left' onclick='checkCNTEffToNewStatusEdit()' style='margin-top:9px;'>&nbsp;";
              result += "   <input type='text' name='srv_eff_to' class='form-control form-control-sm' id='id_srv_eff_to' placeholder='dd/mm/yyyy' value='" + data.srv_eff_to + "'>";
            }

            
            //result += "      <input type='text' name='srv_eff_to' value='" + data.srv_eff_to + "' class='form-control form-control-sm' id='id_srv_eff_to' placeholder='dd/mm/yyyy' required=''>";
            //result += "      <div class='input-group-append' data-target='#dtp_srv_eff_to_date' data-toggle='datepicker'>";
            //result += "        <div class='input-group-text text-primary'><i class='fa fa-calendar'></i></div>";
            //result += "      </div>";


            result += "    </div>";            
            result += "  </div>";

            // COM_RANK
            result += "        <div class='form-group col-md-3'>";
            result += "          <label for='cus_zip'>{% trans 'Rank' %}</label>";
            result += " <select name='cus_service_srv_rank' class='form-control col-sm-12 form-control-sm' id='id_cus_service_srv_rank'>";
            result += "  <option value=''>---------</option>";
            for(var i=0; i<com_rank_count; i++) {              
              if(data.srv_rank == data.com_rank_list[i]["rank_id"])
                result += "  <option value='" + data.com_rank_list[i]["rank_id"] + "' selected>" + data.com_rank_list[i]["rank_id"] + " # " + data.com_rank_list[i]["rank_en"] + "</option>";
              else
                result += "  <option value='" + data.com_rank_list[i]["rank_id"] + "'>" + data.com_rank_list[i]["rank_id"] + " # " + data.com_rank_list[i]["rank_en"] + "</option>";
            }
            result += " </select>";
            result += "        </div>";

            // T_SHIFT
            result += "        <div class='form-group col-md-3'>";
            result += "          <label for='cus_zip'>{% trans 'Shift' %}</label>";
            result += " <select name='cus_service_srv_shift' class='form-control col-sm-12 form-control-sm' id='id_cus_service_srv_shift'>";
            result += "  <option value=''>---------</option>";
            for(var i=0; i<t_shift_count; i++) {              
              if(data.srv_shif_id == data.t_shift_list[i]["shf_id"])
                result += "  <option value='" + data.t_shift_list[i]["shf_id"] + "' selected>" + data.t_shift_list[i]["shf_desc"] + "</option>";
              else
                result += "  <option value='" + data.t_shift_list[i]["shf_id"] + "'>" + data.t_shift_list[i]["shf_desc"] + "</option>";
            }
            result += " </select>";
            result += "        </div>";

            
            result += "      <div class='form-row'>";
            result += "        <div class='form-row col-6'>";

            // SRV_MON
            result += "          <div class='form-group col-3'>";
            result += "            <label for='srv_mon'>{% trans 'Mon' %}</label>";
            result += "            <input id='id_srv_mon' type='text' class='form-control form-control-sm' value='" + data.srv_mon + "'>";
            result += "          </div>";

            // SRV_TUE
            result += "          <div class='form-group col-3'>";
            result += "            <label for='cus_zip'>{% trans 'Tue' %}</label>";
            result += "           <input id='id_srv_tue' type='text' class='form-control form-control-sm' value='" + data.srv_tue + "'>";
            result += "          </div>";

            // SRV_WED
            result += "          <div class='form-group col-3'>";
            result += "            <label for='cus_zip'>{% trans 'Wed' %}</label>";
            result += "            <input id='id_srv_wed' type='text' class='form-control form-control-sm' value='" + data.srv_wed + "'>";
            result += "          </div>";

            // SRV_THU
            result += "          <div class='form-group col-3'>";
            result += "            <label for='cus_zip'>{% trans 'Thu' %}</label>";
            result += "            <input id='id_srv_thu' type='text' class='form-control form-control-sm' value='" + data.srv_thu + "'>";
            result += "          </div>";
            result += "        </div>";

            result += "        <div class='form-row col-6'>";

            // SRV_FRI
            result += "          <div class='form-group col-3'>";
            result += "            <label for='cus_zip'>{% trans 'Fri' %}</label>";
            result += "            <input id='id_srv_fri' type='text' class='form-control form-control-sm' value='" + data.srv_fri + "'>";
            result += "          </div>";

            // SRV_SAT
            result += "          <div class='form-group col-3'>";
            result += "            <label for='cus_zip'>{% trans 'Sat' %}</label>";
            result += "            <input id='id_srv_sat' type='text' class='form-control form-control-sm' value='" + data.srv_sat + "'>";
            result += "          </div>";

            // SRV_SUN
            result += "          <div class='form-group col-3'>";
            result += "            <label for='cus_zip'>{% trans 'Sun' %}</label>";
            result += "            <input id='id_srv_sun' type='text' class='form-control form-control-sm' value='" + data.srv_sun + "'>";
            result += "          </div>";

            // SRV_PUB
            result += "          <div class='form-group col-3'>";
            result += "            <label for='cus_zip'>{% trans 'Pub' %}</label>";
            result += "            <input id='id_srv_pub' type='text' class='form-control form-control-sm' value='" + data.srv_pub + "'>";
            result += "          </div>";

            result += "        </div>";
            result += "      </div>";

            result += "      <div class='form-row'>";

            // SRV_QTY
            result += "        <div class='form-group col-md-3'>";
            result += "          <label for='cus_zip'>{% trans 'QTY' %}</label>";
            result += "          <input id='id_srv_qty' type='text' class='form-control form-control-sm' value='" + data.srv_qty + "'>";
            result += "        </div>";

            // SRV_COST
            result += "        <div class='form-group col-md-3'>";
            result += "          <label for='cus_tel'>{% trans 'Cost' %}</label>";
            num = parseFloat(data.srv_rate);
            result += "          <input id='id_srv_rate' type='text' class='form-control form-control-sm' value='" + num.toFixed(0) + "'>";
            result += "        </div>";

            // SRV_TOTAL_COST
            num = parseFloat(data.srv_cost);
            result += "        <div class='form-group col-md-3'>";
            result += "          <label for='cus_zip'>{% trans 'Total Cost' %}</label>";
            result += "          <input id='id_srv_cost' type='text' class='form-control form-control-sm' value='" + num.toFixed(0) + "' readonly>";
            result += "        </div>";
            
            // SRV_ACTIVE
            result += "        <div class='form-group col-md-3 text-center'>";
            result += "          <label for='id_srv_active'>&nbsp;</label>";
            result += "          <div class='form-check'>";            
            if(data.srv_active==1) {
              result += "            <input id='id_srv_active' class='form-check-input' type='checkbox' checked>";
            } else {
              result += "            <input id='id_srv_active' class='form-check-input' type='checkbox'>";
            }            
            //result += "            <label class='form-check-label'>{% trans 'Active' %}</label>";
            result += "            <label for='id_srv_active' class='form-check-label' style='cursor: pointer;'>{% trans 'Active' %}</label>";
            result += "          </div>";
            result += "        </div>";

            result += "      </div>";
            result += "      <div class='form-row'>";

            // SRV_REM
            result += "        <div class='form-group col-md-6'>";
            result += "          <label for='cus_zip'>{% trans 'Remark' %}</label>";
            result += "          <input id='id_srv_rem' type='text' class='form-control form-control-sm' value='" + data.srv_rem + "'>";
            result += "        </div>";

            // SRV_COST_RATE
            num = parseFloat(data.srv_cost_rate);
            result += "        <div class='form-group col-md-6'>";
            result += "          <label for='cus_tel'>{% trans 'Cost Rate' %}</label>";
            result += "          <input id='id_srv_cost_rate' type='text' class='form-control form-control-sm' value='" + num + "'>";
            result += "        </div>";

            result += "      </div>";   
            result += "    </div>";
            result += "  </div>";
            result += "</div>";          
            result += "</div>";

            $("#update_service_modal .modal-body").html(result);            
          },
          error: function(data){
            $("#update_service_modal .modal-body").html("{% trans 'There is no data.' %}");
          }
      });
    }    
    else {
      alert("service id is null");
    }      
  };


  // Add new service
  function add_new_service() {
    cus_id = $('#id_cus_id').val();
    cus_brn = $('#id_cus_brn').val();
    cus_vol = $('#id_cus_vol').val();
    srv_eff_frm_new = $('#id_dtp_cnt_eff_frm_new').val();
    srv_eff_to_new = $('#id_dtp_cnt_eff_to_new').val();
    srv_rank_id_new = $('#id_com_rank_rank_id_new').val(); 
    srv_shift_id_new = $('#id_t_shift_id_new').val();      
    srv_mon_new = $('#id_srv_mon_new').val();
    srv_tue_new = $('#id_srv_tue_new').val();
    srv_wed_new = $('#id_srv_wed_new').val();
    srv_thu_new = $('#id_srv_thu_new').val();
    srv_fri_new = $('#id_srv_fri_new').val();
    srv_sat_new = $('#id_srv_sat_new').val();
    srv_sun_new = $('#id_srv_sun_new').val();
    srv_pub_new = $('#id_srv_pub_new').val();

    if ($('#chkCNTEffToNew').is(":checked"))
      srv_eff_to_new_status = 1;
    else
      srv_eff_to_new_status = 0;

    srv_qty_new = $('#id_srv_qty_new').val();
    srv_rate_new = $('#id_srv_rate_new').val();
    srv_cost_new = $('#id_srv_cost_new').val();
    srv_cost_rate_new = $('#id_srv_cost_rate_new').val();
    srv_rem_new = $('#id_srv_rem_new').val();    
    

    if ($('#id_srv_active_new').is(":checked"))
      srv_active_new = 1;
    else
      srv_active_new = 0;


    // Validation
    if(srv_rank_id_new=='') {
      $(document).Toasts('create', {
        class: 'bg-danger', 
        title: "{% trans 'Message' %}",
        subtitle: '',
        autohide: true,
        delay: 2000,      
        body: "Please select Rank.",
        autoDismiss: true,
        close: true,
        autoremove: true,
      });
      return false;
    }
    
    if(srv_shift_id_new=='') {
      $(document).Toasts('create', {
        class: 'bg-danger', 
        title: "{% trans 'Message' %}",
        subtitle: '',
        autohide: true,
        delay: 2000,      
        body: "Please select Shift.",
        autoDismiss: true,
        close: true,
        autoremove: true,
      });
      return false;
    }      

    if(srv_qty_new=='') {
      $(document).Toasts('create', {
        class: 'bg-danger', 
        title: "{% trans 'Message' %}",
        subtitle: '',
        autohide: true,
        delay: 2000,      
        body: "Please enter Quantity.",
        autoDismiss: true,
        close: true,
        autoremove: true,
      });
      return false;
    } 

    if(srv_rate_new=='') {
      $(document).Toasts('create', {
        class: 'bg-danger', 
        title: "{% trans 'Message' %}",
        subtitle: '',
        autohide: true,
        delay: 2000,      
        body: "Please enter Cost.",
        autoDismiss: true,
        close: true,
        autoremove: true,
      });
      return false;
    } 

    $.ajax({
      url : "/contract/ajax/add_new_service",
      type: 'get',          
      dataType: 'json',
      data: {
        cus_id: cus_id,
        cus_brn: cus_brn,
        cus_vol: cus_vol,
        srv_eff_frm_new: srv_eff_frm_new,
        srv_eff_to_new: srv_eff_to_new,
        srv_eff_to_new_status: srv_eff_to_new_status,
        srv_rank_new: srv_rank_id_new,
        srv_shift_id_new: srv_shift_id_new,
        srv_qty_new: srv_qty_new,
        srv_mon_new: srv_mon_new,
        srv_tue_new: srv_tue_new,
        srv_wed_new: srv_wed_new,
        srv_thu_new: srv_thu_new,
        srv_fri_new: srv_fri_new,
        srv_sat_new: srv_sat_new,        
        srv_sun_new: srv_sun_new,
        srv_pub_new: srv_pub_new,
        srv_active_new: srv_active_new,
        srv_rate_new: srv_rate_new,
        srv_cost_new: srv_cost_new,
        srv_cost_rate_new: srv_cost_rate_new,
        srv_rem_new: srv_rem_new,
      },
      beforeSend: function () {
        //
      },    
      success: function (data) {
        $(document).Toasts('create', {
          class: data.class, 
          title: "{% trans 'Message' %}",
          subtitle: '',
          autohide: true,
          delay: 2000,      
          body: data.message,
          autoDismiss: true,
          close: true,
          autoremove: true,
        });

        // Refresh Guard Amount, Sale Amount value
        $('#id_cnt_guard_amt').val(data.active_cnt_guard_amt);
        $('#id_cnt_sale_amt').val(data.active_cnt_sale_amt);

        // Reloade service list table
        // save service
        $.ajax({
          url : "/contract/ajax/reload_service_list",
          type: 'get',          
          dataType: 'json',
          data: {
            cnt_id: data.cnt_id,
          },
          beforeSend: function () {
            
          },    
          success: function (data) {
            result = "";
            result += "<div class='row'>";
            result += "  <div class='col-md-12 table-responsive'>";
            result += "    <table id='customer-list-table' class='table table-striped table-sm'>";
            result += "      <thead class='thead-light'>";
            result += "      <tr>";
            result += "        <th>{% trans 'Eff Frm' %}</th>";
            result += "        <th scope='col'>{% trans 'Eff To' %}</th>";
            result += "        <th scope='col' nowrap>{% trans 'Shift Time' %}</th>";
            result += "        <th scope='col' class='text-center'>{% trans 'QTY' %}</th>";
            result += "        <th scope='col' class='text-center'>{% trans 'Rank' %}</th>";
            result += "        <th scope='col'>{% trans 'Rate' %}</th>";
            result += "        <th scope='col'>{% trans 'Ext.Cost' %}</th>";
            result += "        <th scope='col' class='text-center'>{% trans 'MON' %}</th>";
            result += "        <th scope='col' class='text-center'>{% trans 'TUE' %}</th>";
            result += "        <th scope='col' class='text-center'>{% trans 'WED' %}</th>";
            result += "        <th scope='col' class='text-center'>{% trans 'THU' %}</th>";
            result += "        <th scope='col' class='text-center'>{% trans 'FRI' %}</th>";
            result += "        <th scope='col' class='text-center'>{% trans 'SAT' %}</th>";
            result += "        <th scope='col' class='text-center'>{% trans 'SUN' %}</th>";
            result += "        <th scope='col' class='text-center'>{% trans 'PUB' %}</th>";
            result += "        <th scope='col'>{% trans 'Remark' %}</th>";
            result += "        <th scope='col'>{% trans 'Status' %}</th>";
            result += "        <th>&nbsp;</th>";
            result += "      </tr>";
            result += "     </thead>";
            result += "     <tbody>";


            for(var i=0; i<data.cus_service_list.length; i++) { 

              srv_cost_text = data.cus_service_list[i]["srv_cost"].replace(/\B(?=(\d{3})+(?!\d))/g, ",");
              srv_rate_text = data.cus_service_list[i]["srv_rate"].replace(/\B(?=(\d{3})+(?!\d))/g, ",");

              result += "          <tr>";
              if(data.cus_service_list[i]["srv_active"]==1) {
                result += "          <td><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["srv_eff_frm"] + "</small></a></td>";
                result += "          <td><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["srv_eff_to"] + "</small></a></td>";
                result += "          <td><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["shf_desc"] + "</small></a></td>";
                result += "          <td align='center'><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["srv_qty"] + "</small></a></td>";
                result += "          <td class='text-center'><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["srv_rank"] + "</small></td>";

                //result += "          <td align='right'><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["srv_rate"] + "</small></a></td>";
                //result += "          <td align='right'><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["srv_cost"] + "</small></a></td>";
                result += "          <td align='right'><a href='javascript:void(0);'><small>" + srv_rate_text + "</small></a></td>";                                      
                result += "          <td align='right'><a href='javascript:void(0);'><small>" + srv_cost_text + "</small></a></td>";

                result += "          <td align='center'><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["srv_mon"] + "</small></a></td>";
                result += "          <td align='center'><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["srv_tue"] + "</small></a></td>";
                result += "          <td align='center'><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["srv_wed"] + "</small></a></td>";
                result += "          <td align='center'><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["srv_thu"] + "</small></a></td>";
                result += "          <td align='center'><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["srv_fri"] + "</small></a></td>";
                result += "          <td align='center'><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["srv_sat"] + "</small></a></td>";
                result += "          <td align='center'><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["srv_sun"] + "</small></a></td>";
                result += "          <td align='center'><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["srv_pub"] + "</small></a></td>";
                result += "          <td><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["srv_rem"] + "</small></a></td>";
                }
              else {
                result += "          <td><small>" + data.cus_service_list[i]["srv_eff_frm"] + "</small></td>";
                result += "          <td><small>" + data.cus_service_list[i]["srv_eff_to"] + "</small></td>";
                result += "          <td><small>" + data.cus_service_list[i]["shf_desc"] + "</small></td>";
                result += "          <td align='center'><small>" + data.cus_service_list[i]["srv_qty"] + "</small></td>";
                result += "          <td class='text-center'><small>" + data.cus_service_list[i]["srv_rank"] + "</small></td>";

                //result += "          <td align='right'><small>" + data.cus_service_list[i]["srv_rate"] + "</small></td>";
                //result += "          <td align='right'><small>" + data.cus_service_list[i]["srv_cost"] + "</small></td>";
                result += "          <td align='right'><small>" + srv_rate_text + "</small></td>";                      
                result += "          <td align='right'><small>" + srv_cost_text + "</small></td>";

                result += "          <td align='center'><small>" + data.cus_service_list[i]["srv_mon"] + "</small></td>";
                result += "          <td align='center'><small>" + data.cus_service_list[i]["srv_tue"] + "</small></td>";
                result += "          <td align='center'><small>" + data.cus_service_list[i]["srv_wed"] + "</small></td>";
                result += "          <td align='center'><small>" + data.cus_service_list[i]["srv_thu"] + "</small></td>";
                result += "          <td align='center'><small>" + data.cus_service_list[i]["srv_fri"] + "</small></td>";
                result += "          <td align='center'><small>" + data.cus_service_list[i]["srv_sat"] + "</small></td>";
                result += "          <td align='center'><small>" + data.cus_service_list[i]["srv_sun"] + "</small></td>";
                result += "          <td align='center'><small>" + data.cus_service_list[i]["srv_pub"] + "</small></td>";
                result += "          <td><small>" + data.cus_service_list[i]["srv_rem"] + "</small></td>";
              }

              if(data.cus_service_list[i]["srv_active"]==1)
                result += "          <td><span class='badge badge-success'>{% trans 'Active' %}</span></td>";
              else
                result += "          <td><span class='badge badge-secondary'>{% trans 'Pending' %}</span></td>";
            
              result += "          <td>";
              result += "            <div class='btn-group btn-group-sm nowrap'>";
              result += "              <small>";
              result += "              <button type='button' onclick='update_customer_service(" + data.cus_service_list[i]["srv_id"] + ")' class='btn btn-info btn-xs js-update-contract-service' data-toggle='modal'>&nbsp;<i class='fas fa-pen fa-xs'></i>&nbsp;</button>";

              result += "              <button type='button' onclick='delete_customer_service(" + data.cus_service_list[i]["srv_id"] + ")' class='btn btn-danger btn-xs js-delete-contract-service'>";
              result += "                &nbsp;<i class='fas fa-trash fa-xs'></i>&nbsp;";
              result += "              </button>";
              result += "              </small>";
              result += "            </div>";
              result += "          </td>";
            }
              result += "          </tr>";
            
            result += "      </tbody>";
            result += "    </table>";
            result += "  </div>";
            result += "</div>";

            $("#service_list_table .card-body").html(result);
            $("#add_new_service_list_modal").modal("hide");      

          },
          error: function(data){
            // do nothing        
          }
        });          

      },
      error: function(data){
        $(document).Toasts('create', {
          class: 'bg-danger', 
          title: "{% trans 'Message' %}",
          subtitle: '',
          autohide: true,
          delay: 2000,      
          body: "Cannot save ",
          autoDismiss: true,
          close: true,
          autoremove: true,
        });          
      }
    });            

  }

  // Save new service
  function save_new_service() {
    cnt_id = "{{contract.cnt_id}}";
    srv_eff_frm_new = $('#id_dtp_cnt_eff_frm_new').val();
    srv_eff_to_new = $('#id_dtp_cnt_eff_to_new').val();
    srv_rank_id_new = $('#id_com_rank_rank_id_new').val(); 
    srv_shift_id_new = $('#id_t_shift_id_new').val();      
    srv_mon_new = $('#id_srv_mon_new').val();
    srv_tue_new = $('#id_srv_tue_new').val();
    srv_wed_new = $('#id_srv_wed_new').val();
    srv_thu_new = $('#id_srv_thu_new').val();
    srv_fri_new = $('#id_srv_fri_new').val();
    srv_sat_new = $('#id_srv_sat_new').val();
    srv_sun_new = $('#id_srv_sun_new').val();
    srv_pub_new = $('#id_srv_pub_new').val();

    //srv_active_new = $('#id_srv_active_new').val();
    if ($('#chkCNTEffToNew').is(":checked"))
      srv_eff_to_new_status = 1;
    else
      srv_eff_to_new_status = 0;

    srv_qty_new = $('#id_srv_qty_new').val();
    srv_rate_new = $('#id_srv_rate_new').val();
    srv_cost_new = $('#id_srv_cost_new').val();
    srv_cost_rate_new = $('#id_srv_cost_rate_new').val();
    srv_rem_new = $('#id_srv_rem_new').val();    

    // Validation
    if(srv_rank_id_new=='') {
      $(document).Toasts('create', {
        class: 'bg-danger', 
        title: "{% trans 'Message' %}",
        subtitle: '',
        autohide: true,
        delay: 2000,      
        body: "Please select Rank.",
        autoDismiss: true,
        close: true,
        autoremove: true,
      });
      return false;
    }
    
    if(srv_shift_id_new=='') {
      $(document).Toasts('create', {
        class: 'bg-danger', 
        title: "{% trans 'Message' %}",
        subtitle: '',
        autohide: true,
        delay: 2000,      
        body: "Please select Shift.",
        autoDismiss: true,
        close: true,
        autoremove: true,
      });
      return false;
    }      

    if(srv_qty_new=='') {
      $(document).Toasts('create', {
        class: 'bg-danger', 
        title: "{% trans 'Message' %}",
        subtitle: '',
        autohide: true,
        delay: 2000,      
        body: "Please enter Quantity.",
        autoDismiss: true,
        close: true,
        autoremove: true,
      });
      return false;
    } 

    if(srv_rate_new=='') {
      $(document).Toasts('create', {
        class: 'bg-danger', 
        title: "{% trans 'Message' %}",
        subtitle: '',
        autohide: true,
        delay: 2000,      
        body: "Please enter Cost.",
        autoDismiss: true,
        close: true,
        autoremove: true,
      });
      return false;
    } 


    $.ajax({
      url : "/contract/ajax/save_new_service",
      type: 'get',          
      dataType: 'json',
      data: {
        cnt_id: cnt_id,
        srv_eff_frm_new: srv_eff_frm_new,
        srv_eff_to_new: srv_eff_to_new,
        srv_eff_to_new_status: srv_eff_to_new_status,
        srv_rank_new: srv_rank_id_new,
        srv_shift_id_new: srv_shift_id_new,
        srv_qty_new: srv_qty_new,
        srv_mon_new: srv_mon_new,
        srv_tue_new: srv_tue_new,
        srv_wed_new: srv_wed_new,
        srv_thu_new: srv_thu_new,
        srv_fri_new: srv_fri_new,
        srv_sat_new: srv_sat_new,        
        srv_sun_new: srv_sun_new,
        srv_pub_new: srv_pub_new,
        srv_active_new: srv_active_new,
        srv_rate_new: srv_rate_new,
        srv_cost_new: srv_cost_new,
        srv_cost_rate_new: srv_cost_rate_new,
        srv_rem_new: srv_rem_new,
      },
      beforeSend: function () {
        //
      },    
      success: function (data) {
        $(document).Toasts('create', {
          class: data.class, 
          title: "{% trans 'Message' %}",
          subtitle: '',
          autohide: true,
          delay: 2000,      
          body: data.message,
          autoDismiss: true,
          close: true,
          autoremove: true,
        });

        // Refresh Guard Amount, Sale Amount value
        $('#id_cnt_guard_amt').val(data.active_cnt_guard_amt);
        $('#id_cnt_sale_amt').val(data.active_cnt_sale_amt);

        // Reloade service list table
        $.ajax({
          url : "/contract/ajax/reload_service_list",
          type: 'get',          
          dataType: 'json',
          data: {
            cnt_id: data.cnt_id,
          },
          beforeSend: function () {
            
          },    
          success: function (data) {

            result = "";
            result += "<div class='row'>";
            result += "  <div class='col-md-12 table-responsive'>";
            result += "    <table id='customer-list-table' class='table table-striped table-sm'>";
            result += "      <thead class='thead-light'>";
            result += "      <tr>";
            result += "        <th>{% trans 'Eff Frm' %}</th>";
            result += "        <th scope='col'>{% trans 'Eff To' %}</th>";
            result += "        <th scope='col' nowrap>{% trans 'Shift Time' %}</th>";
            result += "        <th scope='col' class='text-center'>{% trans 'QTY' %}</th>";
            result += "        <th scope='col' class='text-center'>{% trans 'Rank' %}</th>";
            result += "        <th scope='col'>{% trans 'Rate' %}</th>";
            result += "        <th scope='col'>{% trans 'Ext.Cost' %}</th>";
            result += "        <th scope='col' class='text-center'>{% trans 'MON' %}</th>";
            result += "        <th scope='col' class='text-center'>{% trans 'TUE' %}</th>";
            result += "        <th scope='col' class='text-center'>{% trans 'WED' %}</th>";
            result += "        <th scope='col' class='text-center'>{% trans 'THU' %}</th>";
            result += "        <th scope='col' class='text-center'>{% trans 'FRI' %}</th>";
            result += "        <th scope='col' class='text-center'>{% trans 'SAT' %}</th>";
            result += "        <th scope='col' class='text-center'>{% trans 'SUN' %}</th>";
            result += "        <th scope='col' class='text-center'>{% trans 'PUB' %}</th>";
            result += "        <th scope='col'>{% trans 'Remark' %}</th>";
            result += "        <th scope='col'>{% trans 'Status' %}</th>";
            result += "        <th>&nbsp;</th>";
            result += "      </tr>";
            result += "     </thead>";
            result += "     <tbody>";

            for(var i=0; i<data.cus_service_list.length; i++) {            
              result += "          <tr>";
              if(data.cus_service_list[i]["srv_active"]==1) {
                result += "          <td><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["srv_eff_frm"] + "</small></a></td>";
                result += "          <td><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["srv_eff_to"] + "</small></a></td>";
                result += "          <td><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["shf_desc"] + "</small></a></td>";
                result += "          <td align='center'><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["srv_qty"] + "</small></a></td>";
                result += "          <td class='text-center'><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["srv_rank"] + "</small></td>";

                //result += "          <td align='right'><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["srv_rate"] + "</small></a></td>";
                //result += "          <td align='right'><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["srv_cost"] + "</small></a></td>";
                result += "          <td align='right'><a href='javascript:void(0);'><small>" + srv_rate_text + "</small></a></td>";                      
                result += "          <td align='right'><a href='javascript:void(0);'><small>" + srv_cost_text + "</small></a></td>";

                result += "          <td align='center'><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["srv_mon"] + "</small></a></td>";
                result += "          <td align='center'><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["srv_tue"] + "</small></a></td>";
                result += "          <td align='center'><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["srv_wed"] + "</small></a></td>";
                result += "          <td align='center'><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["srv_thu"] + "</small></a></td>";
                result += "          <td align='center'><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["srv_fri"] + "</small></a></td>";
                result += "          <td align='center'><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["srv_sat"] + "</small></a></td>";
                result += "          <td align='center'><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["srv_sun"] + "</small></a></td>";
                result += "          <td align='center'><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["srv_pub"] + "</small></a></td>";
                result += "          <td><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["srv_rem"] + "</small></a></td>";
                }
              else {
                result += "          <td><small>" + data.cus_service_list[i]["srv_eff_frm"] + "</small></td>";
                result += "          <td><small>" + data.cus_service_list[i]["srv_eff_to"] + "</small></td>";
                result += "          <td><small>" + data.cus_service_list[i]["shf_desc"] + "</small></td>";
                result += "          <td align='center'><small>" + data.cus_service_list[i]["srv_qty"] + "</small></td>";
                result += "          <td class='text-center'><small>" + data.cus_service_list[i]["srv_rank"] + "</small></td>";

                //result += "          <td align='right'><small>" + data.cus_service_list[i]["srv_rate"] + "</small></td>";
                //result += "          <td align='right'><small>" + data.cus_service_list[i]["srv_cost"] + "</small></td>";
                result += "          <td align='right'><small>" + srv_rate_text + "</small></td>";                      
                result += "          <td align='right'><small>" + srv_cost_text + "</small></td>";

                result += "          <td align='center'><small>" + data.cus_service_list[i]["srv_mon"] + "</small></td>";
                result += "          <td align='center'><small>" + data.cus_service_list[i]["srv_tue"] + "</small></td>";
                result += "          <td align='center'><small>" + data.cus_service_list[i]["srv_wed"] + "</small></td>";
                result += "          <td align='center'><small>" + data.cus_service_list[i]["srv_thu"] + "</small></td>";
                result += "          <td align='center'><small>" + data.cus_service_list[i]["srv_fri"] + "</small></td>";
                result += "          <td align='center'><small>" + data.cus_service_list[i]["srv_sat"] + "</small></td>";
                result += "          <td align='center'><small>" + data.cus_service_list[i]["srv_sun"] + "</small></td>";
                result += "          <td align='center'><small>" + data.cus_service_list[i]["srv_pub"] + "</small></td>";
                result += "          <td><small>" + data.cus_service_list[i]["srv_rem"] + "</small></td>";
              }

              if(data.cus_service_list[i]["srv_active"]==1)
                result += "          <td><span class='badge badge-success'>{% trans 'Active' %}</span></td>";
              else
                result += "          <td><span class='badge badge-secondary'>{% trans 'Pending' %}</span></td>";
            
              result += "          <td>";
              result += "            <div class='btn-group btn-group-sm nowrap'>";
              result += "              <small>";
              result += "              <button type='button' onclick='update_customer_service(" + data.cus_service_list[i]["srv_id"] + ")' class='btn btn-info btn-xs js-update-contract-service' data-toggle='modal'>&nbsp;<i class='fas fa-pen fa-xs'></i>&nbsp;</button>";

              result += "              <button type='button' onclick='delete_customer_service(" + data.cus_service_list[i]["srv_id"] + ")' class='btn btn-danger btn-xs js-delete-contract-service'>";
              result += "                &nbsp;<i class='fas fa-trash fa-xs'></i>&nbsp;";
              result += "              </button>";
              result += "              </small>";
              result += "            </div>";
              result += "          </td>";
            }
              result += "          </tr>";
            
            result += "      </tbody>";
            result += "    </table>";
            result += "  </div>";
            result += "</div>";

            $("#service_list .card-body").html(result);
            $("#add_new_service_list_modal").modal("hide");      

          },
          error: function(data){
            // do nothing        
          }
        });          

      },
      error: function(data){
        $(document).Toasts('create', {
          class: 'bg-danger', 
          title: "{% trans 'Message' %}",
          subtitle: '',
          autohide: true,
          delay: 2000,      
          body: "Cannot save ",
          autoDismiss: true,
          close: true,
          autoremove: true,
        });          
      }
    });            

  }


  function save_customer_service_item() {    
    srv_id = $('#id_select_customer_service_id').val();    

    if(srv_id == null || srv_id == "") {
      alert("Service ID not found!");      
    } else {
      srv_eff_frm = $('#id_srv_eff_frm').val();


      srv_eff_to = $('#id_srv_eff_to').val();
      if ($('#chkCNTEffToNewEdit').is(":checked"))
        srv_eff_to_status = 1;
      else
        srv_eff_to_status = 0;

      srv_rank = $('#id_cus_service_srv_rank').val(); 
      srv_shift_id = $('#id_cus_service_srv_shift').val();      
      srv_qty = $('#id_srv_qty').val();        
      srv_mon = $('#id_srv_mon').val();
      srv_tue = $('#id_srv_tue').val();
      srv_wed = $('#id_srv_wed').val();
      srv_thu = $('#id_srv_thu').val();
      srv_fri = $('#id_srv_fri').val();
      srv_sat = $('#id_srv_sat').val();
      srv_sun = $('#id_srv_sun').val();
      srv_pub = $('#id_srv_pub').val();
            
      if ($('#id_srv_active').is(":checked"))
        srv_active = 1;
      else
        srv_active = 0;

      srv_rate = $('#id_srv_rate').val();
      srv_cost = $('#id_srv_cost').val();
      srv_cost_rate = $('#id_srv_cost_rate').val();
      srv_rem = $('#id_srv_rem').val();

      $.ajax({
        url : "/contract/ajax/save_customer_service_item",
        type: 'get',          
        dataType: 'json',
        data: {
          srv_id: srv_id,
          srv_eff_frm: srv_eff_frm,
          srv_eff_to: srv_eff_to,
          srv_eff_to_status: srv_eff_to_status,
          srv_rank: srv_rank,
          srv_shift_id: srv_shift_id,
          srv_qty: srv_qty,
          srv_mon: srv_mon,
          srv_tue: srv_tue,
          srv_wed: srv_wed,
          srv_thu: srv_thu,
          srv_fri: srv_fri,
          srv_sat: srv_sat,          
          srv_sun: srv_sun,
          srv_pub: srv_pub,
          srv_active: srv_active,
          srv_rate: srv_rate,
          srv_cost: srv_cost,
          srv_cost_rate: srv_cost_rate,
          srv_rem: srv_rem,
        },
        beforeSend: function () {
          
        },    
        success: function (data) {
          $(document).Toasts('create', {
            class: data.class, 
            title: "{% trans 'Message' %}",
            subtitle: '',
            autohide: true,
            delay: 2000,      
            body: data.message,
            autoDismiss: true,
            close: true,
            autoremove: true,
          });

          // Refresh Guard Amount, Sale Amount value
          $('#id_cnt_guard_amt').val(data.active_cnt_guard_amt);
          $('#id_cnt_sale_amt').val(data.active_cnt_sale_amt);
          
          // Reloade service list table
          $.ajax({
            url : "/contract/ajax/reload_service_list",
            type: 'get',          
            dataType: 'json',
            data: {
              cnt_id: data.cnt_id,
            },
            beforeSend: function () {
              
            },    
            success: function (data) {

              result = "";
              result += "<div class='row'>";
              result += "  <div class='col-md-12 table-responsive'>";
              result += "    <table id='customer-list-table' class='table table-striped table-sm'>";
              result += "      <thead class='thead-light'>";
              result += "      <tr>";
              result += "        <th>{% trans 'Eff Frm' %}</th>";
              result += "        <th scope='col'>{% trans 'Eff To' %}</th>";
              result += "        <th scope='col' nowrap>{% trans 'Shift Time' %}</th>";
              result += "        <th scope='col' class='text-center'>{% trans 'QTY' %}</th>";
              result += "        <th scope='col' class='text-center'>{% trans 'Rank' %}</th>";
              result += "        <th scope='col'>{% trans 'Rate' %}</th>";
              result += "        <th scope='col'>{% trans 'Ext.Cost' %}</th>";
              result += "        <th scope='col' class='text-center'>{% trans 'MON' %}</th>";
              result += "        <th scope='col' class='text-center'>{% trans 'TUE' %}</th>";
              result += "        <th scope='col' class='text-center'>{% trans 'WED' %}</th>";
              result += "        <th scope='col' class='text-center'>{% trans 'THU' %}</th>";
              result += "        <th scope='col' class='text-center'>{% trans 'FRI' %}</th>";
              result += "        <th scope='col' class='text-center'>{% trans 'SAT' %}</th>";
              result += "        <th scope='col' class='text-center'>{% trans 'SUN' %}</th>";
              result += "        <th scope='col' class='text-center'>{% trans 'PUB' %}</th>";
              result += "        <th scope='col'>{% trans 'Remark' %}</th>";
              result += "        <th scope='col'>{% trans 'Status' %}</th>";
              result += "        <th>&nbsp;</th>";
              result += "      </tr>";
              result += "     </thead>";
              result += "     <tbody>";

              for(var i=0; i<data.cus_service_list.length; i++) {            
                srv_cost_text = data.cus_service_list[i]["srv_cost"].replace(/\B(?=(\d{3})+(?!\d))/g, ",");
                srv_rate_text = data.cus_service_list[i]["srv_rate"].replace(/\B(?=(\d{3})+(?!\d))/g, ",");

                result += "          <tr>";
                if(data.cus_service_list[i]["srv_active"]==1) {
                  result += "          <td><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["srv_eff_frm"] + "</small></a></td>";
                  result += "          <td><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["srv_eff_to"] + "</small></a></td>";
                  result += "          <td><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["shf_desc"] + "</small></a></td>";
                  result += "          <td align='center'><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["srv_qty"] + "</small></a></td>";
                  result += "          <td class='text-center'><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["srv_rank"] + "</small></td>";

                  //result += "          <td align='right'><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["srv_rate"] + "</small></a></td>";
                  //result += "          <td align='right'><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["srv_cost"] + "</small></a></td>";
                  result += "          <td align='right'><a href='javascript:void(0);'><small>" + srv_rate_text + "</small></a></td>";                      
                  result += "          <td align='right'><a href='javascript:void(0);'><small>" + srv_cost_text + "</small></a></td>";

                  result += "          <td align='center'><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["srv_mon"] + "</small></a></td>";
                  result += "          <td align='center'><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["srv_tue"] + "</small></a></td>";
                  result += "          <td align='center'><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["srv_wed"] + "</small></a></td>";
                  result += "          <td align='center'><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["srv_thu"] + "</small></a></td>";
                  result += "          <td align='center'><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["srv_fri"] + "</small></a></td>";
                  result += "          <td align='center'><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["srv_sat"] + "</small></a></td>";
                  result += "          <td align='center'><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["srv_sun"] + "</small></a></td>";
                  result += "          <td align='center'><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["srv_pub"] + "</small></a></td>";
                  result += "          <td><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["srv_rem"] + "</small></a></td>";
                  }
                else {
                  result += "          <td><small>" + data.cus_service_list[i]["srv_eff_frm"] + "</small></td>";
                  result += "          <td><small>" + data.cus_service_list[i]["srv_eff_to"] + "</small></td>";
                  result += "          <td><small>" + data.cus_service_list[i]["shf_desc"] + "</small></td>";
                  result += "          <td align='center'><small>" + data.cus_service_list[i]["srv_qty"] + "</small></td>";
                  result += "          <td class='text-center'><small>" + data.cus_service_list[i]["srv_rank"] + "</small></td>";

                  //result += "          <td align='right'><small>" + data.cus_service_list[i]["srv_rate"] + "</small></td>";
                  //result += "          <td align='right'><small>" + data.cus_service_list[i]["srv_cost"] + "</small></td>";                  
                  result += "          <td align='right'><small>" + srv_rate_text + "</small></td>";                      
                  result += "          <td align='right'><small>" + srv_cost_text + "</small></td>";
  
                  result += "          <td align='center'><small>" + data.cus_service_list[i]["srv_mon"] + "</small></td>";
                  result += "          <td align='center'><small>" + data.cus_service_list[i]["srv_tue"] + "</small></td>";
                  result += "          <td align='center'><small>" + data.cus_service_list[i]["srv_wed"] + "</small></td>";
                  result += "          <td align='center'><small>" + data.cus_service_list[i]["srv_thu"] + "</small></td>";
                  result += "          <td align='center'><small>" + data.cus_service_list[i]["srv_fri"] + "</small></td>";
                  result += "          <td align='center'><small>" + data.cus_service_list[i]["srv_sat"] + "</small></td>";
                  result += "          <td align='center'><small>" + data.cus_service_list[i]["srv_sun"] + "</small></td>";
                  result += "          <td align='center'><small>" + data.cus_service_list[i]["srv_pub"] + "</small></td>";
                  result += "          <td><small>" + data.cus_service_list[i]["srv_rem"] + "</small></td>";
                }

                if(data.cus_service_list[i]["srv_active"]==1)
                  result += "          <td><span class='badge badge-success'>{% trans 'Active' %}</span></td>";
                else
                  result += "          <td><span class='badge badge-secondary'>{% trans 'Pending' %}</span></td>";
              
                result += "          <td>";
                result += "            <div class='btn-group btn-group-sm nowrap'>";
                result += "              <small>";
                result += "              <button type='button' onclick='update_customer_service(" + data.cus_service_list[i]["srv_id"] + ")' class='btn btn-info btn-xs js-update-contract-service' data-toggle='modal'>&nbsp;<i class='fas fa-pen fa-xs'></i>&nbsp;</button>";

                result += "              <button type='button' onclick='delete_customer_service(" + data.cus_service_list[i]["srv_id"] + ")' class='btn btn-danger btn-xs js-delete-contract-service'>";
                result += "                &nbsp;<i class='fas fa-trash fa-xs'></i>&nbsp;";
                result += "              </button>";
                result += "              </small>";
                result += "            </div>";
                result += "          </td>";
              }
                result += "          </tr>";
              
              result += "      </tbody>";
              result += "    </table>";
              result += "  </div>";
              result += "</div>";

              $("#service_list_table .card-body").html(result);
              $("#update_service_modal").modal("hide");

            },
            error: function(data){
              // do nothing        
            }
          });          
        },
        error: function(data){
          // do nothing          
        }
      });            
    }
  }



  function delete_customer_service_item() {
    srv_id = $('#id_select_customer_service_id').val();

    $.ajax({
        url : "/contract/ajax/delete_customer_service",
        type: 'get',
        dataType: 'json',
        data: {
          srv_id: srv_id
        },
        beforeSend: function () {
          
        },    
        success: function (data) {
          $("#delete_service_modal").modal("hide");

          $(document).Toasts('create', {
            class: data.class, 
            title: "{% trans 'Message' %}",
            subtitle: '',
            autohide: true,
            delay: 2000,      
            body: data.message,
            autoDismiss: true,
            close: true,
            autoremove: true,
          });                    

          // Refresh Guard Amount, Sale Amount value
          $('#id_cnt_guard_amt').val(data.active_cnt_guard_amt);
          $('#id_cnt_sale_amt').val(data.active_cnt_sale_amt);


        // Reloade service list table
        $.ajax({
          url : "/contract/ajax/reload_service_list",
          type: 'get',          
          dataType: 'json',
          data: {
            cnt_id: data.cnt_id,
          },
          beforeSend: function () {
            
          },    
          success: function (data) {
      
            result = "";
            result += "<div class='row'>";
            result += "  <div class='col-md-12 table-responsive'>";
            result += "    <table id='customer-list-table' class='table table-striped table-sm'>";
            result += "      <thead class='thead-light'>";
            result += "      <tr>";
            result += "        <th>{% trans 'Eff Frm' %}</th>";
            result += "        <th scope='col'>{% trans 'Eff To' %}</th>";
            result += "        <th scope='col' nowrap>{% trans 'Shift Time' %}</th>";
            result += "        <th scope='col' class='text-center'>{% trans 'QTY' %}</th>";
            result += "        <th scope='col' class='text-center'>{% trans 'Rank' %}</th>";
            result += "        <th scope='col'>{% trans 'Rate' %}</th>";
            result += "        <th scope='col'>{% trans 'Ext.Cost' %}</th>";
            result += "        <th scope='col' class='text-center'>{% trans 'MON' %}</th>";
            result += "        <th scope='col' class='text-center'>{% trans 'TUE' %}</th>";
            result += "        <th scope='col' class='text-center'>{% trans 'WED' %}</th>";
            result += "        <th scope='col' class='text-center'>{% trans 'THU' %}</th>";
            result += "        <th scope='col' class='text-center'>{% trans 'FRI' %}</th>";
            result += "        <th scope='col' class='text-center'>{% trans 'SAT' %}</th>";
            result += "        <th scope='col' class='text-center'>{% trans 'SUN' %}</th>";
            result += "        <th scope='col' class='text-center'>{% trans 'PUB' %}</th>";
            result += "        <th scope='col'>{% trans 'Remark' %}</th>";
            result += "        <th scope='col'>{% trans 'Status' %}</th>";
            result += "        <th>&nbsp;</th>";
            result += "      </tr>";
            result += "     </thead>";
            result += "     <tbody>";

            for(var i=0; i<data.cus_service_list.length; i++) {            
              srv_cost_text = data.cus_service_list[i]["srv_cost"].replace(/\B(?=(\d{3})+(?!\d))/g, ",");
              srv_rate_text = data.cus_service_list[i]["srv_rate"].replace(/\B(?=(\d{3})+(?!\d))/g, ",");

              result += "          <tr>";
              if(data.cus_service_list[i]["srv_active"]==1) {
                result += "          <td><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["srv_eff_frm"] + "</small></a></td>";
                result += "          <td><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["srv_eff_to"] + "</small></a></td>";
                result += "          <td><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["shf_desc"] + "</small></a></td>";
                result += "          <td align='center'><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["srv_qty"] + "</small></a></td>";
                result += "          <td class='text-center'><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["srv_rank"] + "</small></td>";

                //result += "          <td align='right'><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["srv_rate"] + "</small></a></td>";
                //result += "          <td align='right'><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["srv_cost"] + "</small></a></td>";
                result += "          <td align='right'><a href='javascript:void(0);'><small>" + srv_rate_text + "</small></a></td>";                      
                result += "          <td align='right'><a href='javascript:void(0);'><small>" + srv_cost_text + "</small></a></td>";

                result += "          <td align='center'><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["srv_mon"] + "</small></a></td>";
                result += "          <td align='center'><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["srv_tue"] + "</small></a></td>";
                result += "          <td align='center'><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["srv_wed"] + "</small></a></td>";
                result += "          <td align='center'><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["srv_thu"] + "</small></a></td>";
                result += "          <td align='center'><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["srv_fri"] + "</small></a></td>";
                result += "          <td align='center'><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["srv_sat"] + "</small></a></td>";
                result += "          <td align='center'><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["srv_sun"] + "</small></a></td>";
                result += "          <td align='center'><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["srv_pub"] + "</small></a></td>";
                result += "          <td><a href='javascript:void(0);'><small>" + data.cus_service_list[i]["srv_rem"] + "</small></a></td>";
                }
              else {
                result += "          <td><small>" + data.cus_service_list[i]["srv_eff_frm"] + "</small></td>";
                result += "          <td><small>" + data.cus_service_list[i]["srv_eff_to"] + "</small></td>";
                result += "          <td><small>" + data.cus_service_list[i]["shf_desc"] + "</small></td>";
                result += "          <td align='center'><small>" + data.cus_service_list[i]["srv_qty"] + "</small></td>";
                result += "          <td class='text-center'><small>" + data.cus_service_list[i]["srv_rank"] + "</small></td>";

                //result += "          <td align='right'><small>" + data.cus_service_list[i]["srv_rate"] + "</small></td>";
                //result += "          <td align='right'><small>" + data.cus_service_list[i]["srv_cost"] + "</small></td>";
                result += "          <td align='right'><small>" + srv_rate_text + "</small></td>";                                            
                result += "          <td align='right'><small>" + srv_cost_text + "</small></td>";
  
                result += "          <td align='center'><small>" + data.cus_service_list[i]["srv_mon"] + "</small></td>";
                result += "          <td align='center'><small>" + data.cus_service_list[i]["srv_tue"] + "</small></td>";
                result += "          <td align='center'><small>" + data.cus_service_list[i]["srv_wed"] + "</small></td>";
                result += "          <td align='center'><small>" + data.cus_service_list[i]["srv_thu"] + "</small></td>";
                result += "          <td align='center'><small>" + data.cus_service_list[i]["srv_fri"] + "</small></td>";
                result += "          <td align='center'><small>" + data.cus_service_list[i]["srv_sat"] + "</small></td>";
                result += "          <td align='center'><small>" + data.cus_service_list[i]["srv_sun"] + "</small></td>";
                result += "          <td align='center'><small>" + data.cus_service_list[i]["srv_pub"] + "</small></td>";
                result += "          <td><small>" + data.cus_service_list[i]["srv_rem"] + "</small></td>";
              }

              if(data.cus_service_list[i]["srv_active"]==1)
                result += "          <td><span class='badge badge-success'>{% trans 'Active' %}</span></td>";
              else
                result += "          <td><span class='badge badge-secondary'>{% trans 'Pending' %}</span></td>";
            
              result += "          <td>";
              result += "            <div class='btn-group btn-group-sm nowrap'>";
              result += "              <small>";
              result += "              <button type='button' onclick='update_customer_service(" + data.cus_service_list[i]["srv_id"] + ")' class='btn btn-info btn-xs js-update-contract-service' data-toggle='modal'>&nbsp;<i class='fas fa-pen fa-xs'></i>&nbsp;</button>";

              result += "              <button type='button' onclick='delete_customer_service(" + data.cus_service_list[i]["srv_id"] + ")' class='btn btn-danger btn-xs js-delete-contract-service'>";
              result += "                &nbsp;<i class='fas fa-trash fa-xs'></i>&nbsp;";
              result += "              </button>";
              result += "              </small>";
              result += "            </div>";
              result += "          </td>";
            }
              result += "          </tr>";
            
            result += "      </tbody>";
            result += "    </table>";
            result += "  </div>";
            result += "</div>";

            $("#service_list_table .card-body").html(result);
            $("#add_new_service_list_modal").modal("hide");

          },
          error: function(data){
            // do nothing        
          }
        });    

        },
        error: function(data){
          alert("error!");
        }
    });
  }


  $(document).ready(function(){    

    $('#add_service_button').on('click', function (e) {      
      var obj = $(this);
      cnt_eff_frm = $('#id_cnt_eff_frm').val();
      cnt_eff_to = $('#id_cnt_eff_to').val();

      // Get rank list
      $.ajax({
          url: "/contract/ajax/get_rank_shift_list/",
          type: 'get',          
          dataType: 'json',
          data: {
            cnt_eff_frm: cnt_eff_frm,
            cnt_eff_to: cnt_eff_to,
          },          
          beforeSend: function () {
            
          },
          success: function (data) {
            var com_rank_count = data.com_rank_list.length;
            var t_shift_count = data.t_shift_list.length;

            var result = ""
            result += "";

            result += "<div class='row'>";
            result += "<div class='col-12'>";
            result += "<div class='card card-info'>";
            result += "<div class='card-body'>";
            result += "<div class='form-row'>";                  
            result += "<div class='form-group col-md-3'>";
            result += "<label for='id_dtp_cnt_eff_frm_new'>{% trans 'Effect Term From' %}</label>";            
            result += "<div class='input-group date' data-target-input='nearest'>";


            result += "   <input type='checkbox' checked id='chkCNTEffFromNew' class='form-inline float-left' onclick='checkCNTEffFromNewStatus()' style='margin-top:9px;'>&nbsp;";
            result += "   <input type='text' name='dtp_cnt_eff_frm_new' class='form-control form-control-sm' id='id_dtp_cnt_eff_frm_new' placeholder='dd/mm/yyyy' value='" + cnt_eff_frm + "'>";

            //result += "<input type='text' name='dtp_cnt_eff_frm_new' class='form-control form-control-sm' id='id_dtp_cnt_eff_frm_new' placeholder='dd/mm/yyyy' value='" + cnt_eff_frm + "'>";
            //result += "<div class='input-group-append' data-target='#dtp_cnt_eff_frm_new' data-toggle='datepicker'>";
            //result += "<div class='input-group-text text-primary'><i class='fa fa-calendar'></i></div>";
            //result += "</div>";


            result += "</div>";              
            result += "</div>";

            result += "<div class='form-group col-md-3'>";
            result += "<label for='id_dtp_cnt_eff_to_new'>{% trans 'Effect Term To' %}</label>";
            result += "<div class='input-group date' data-target-input='nearest'>";


            if ($('#chkCNTEffTo').is(":checked")) {
              result += "   <input type='checkbox' checked id='chkCNTEffToNew' class='form-inline float-left' onclick='checkCNTEffToNewStatus()' style='margin-top:9px;'>&nbsp;";
              result += "   <input type='text' name='dtp_cnt_eff_to_new' class='form-control form-control-sm' id='id_dtp_cnt_eff_to_new' placeholder='dd/mm/yyyy' value='" + cnt_eff_to + "'>";
            } else {
              result += "   <input type='checkbox' id='chkCNTEffToNew' class='form-inline float-left' onclick='checkCNTEffToNewStatus()' style='margin-top:9px;'>&nbsp;";
              result += "   <input type='text' name='dtp_cnt_eff_to_new' class='form-control form-control-sm' id='id_dtp_cnt_eff_to_new' placeholder='dd/mm/yyyy' value='" + cnt_eff_to + "' readonly=''>";
            }

            //result += "<input type='text' name='dtp_cnt_eff_to_new' class='form-control form-control-sm' id='id_dtp_cnt_eff_to_new' placeholder='dd/mm/yyyy' value='" + cnt_eff_to + "'>";
            //result += "<div class='input-group-append' data-target='#dtp_cnt_eff_to_new' data-toggle='datepicker'>";
            //result += "<div class='input-group-text text-primary'><i class='fa fa-calendar'></i></div>";
            //result += "</div>";


            result += "</div>";              
            result += "</div>";

            // COM_RANK
            result += "        <div class='form-group col-md-3'>";
            result += "          <label for='id_com_rank_rank_id_new'>{% trans 'Rank' %}</label>";
            result += " <select name='com_rank_rank_id_new' class='form-control col-sm-12 form-control-sm' id='id_com_rank_rank_id_new'>";
            result += "  <option value=''>---------</option>";
            for(var i=0; i<com_rank_count; i++) {              
              if(data.srv_rank == data.com_rank_list[i]["rank_id"])
                result += "  <option value='" + data.com_rank_list[i]["rank_id"] + "' selected>" + data.com_rank_list[i]["rank_id"] + " # " + data.com_rank_list[i]["rank_en"] + "</option>";
              else
                result += "  <option value='" + data.com_rank_list[i]["rank_id"] + "'>" + data.com_rank_list[i]["rank_id"] + " # " + data.com_rank_list[i]["rank_en"] + "</option>";
            }
            result += " </select>";
            result += "        </div>";

            // T_SHIFT
            result += "        <div class='form-group col-md-3'>";
            result += "          <label for='id_t_shift_id_new'>{% trans 'Shift' %}</label>";
            result += " <select name='id_t_shift_id_new' class='form-control col-sm-12 form-control-sm' id='id_t_shift_id_new'>";
            result += "  <option value=''>---------</option>";
            for(var i=0; i<t_shift_count; i++) {              
              if(data.srv_shif_id == data.t_shift_list[i]["shf_id"])
                result += "  <option value='" + data.t_shift_list[i]["shf_id"] + "' selected>" + data.t_shift_list[i]["shf_desc"] + "</option>";
              else
                result += "  <option value='" + data.t_shift_list[i]["shf_id"] + "'>" + data.t_shift_list[i]["shf_desc"] + "</option>";
            }
            result += " </select>";
            result += "        </div>";

            result += "<div class='form-row'>";
            result += "<div class='form-row col-6'>";
            result += "<div class='form-group col-3'>";
            result += "<label for='id_srv_mon_new'>{% trans 'Mon' %}</label>";
            result += "<input id='id_srv_mon_new' type='number' class='form-control form-control-sm' value='0'>";
            result += "</div>";

            result += "<div class='form-group col-3'>";
            result += "<label for='id_srv_tue_new'>{% trans 'Tue' %}</label>";
            result += "<input id='id_srv_tue_new' type='number' class='form-control form-control-sm' value='0'>";
            result += "</div>";

            result += "<div class='form-group col-3'>";
            result += "<label for='id_srv_wed_new'>{% trans 'Wed' %}</label>";
            result += "<input id='id_srv_wed_new' type='number' class='form-control form-control-sm' value='0'>";
            result += "</div>";

            result += "<div class='form-group col-3'>";
            result += "<label for='id_srv_thu_new'>{% trans 'Thu' %}</label>";
            result += "<input id='id_srv_thu_new' type='number' class='form-control form-control-sm' value='0'>";
            result += "</div>";

            result += "</div>";
            result += "<div class='form-row col-6'>";
            result += "<div class='form-group col-3'>";
            result += "<label for='id_srv_fri_new'>{% trans 'Fri' %}</label>";
            result += "<input id='id_srv_fri_new' type='number' class='form-control form-control-sm' value='0'>";
            result += "</div>";

            result += "<div class='form-group col-3'>";
            result += "<label for='id_srv_sat_new'>{% trans 'Sat' %}</label>";
            result += "<input id='id_srv_sat_new' type='number' class='form-control form-control-sm' value='0'>";
            result += "</div>";

            result += "<div class='form-group col-3'>";
            result += "<label for='id_srv_sun_new'>{% trans 'Sun' %}</label>";
            result += "<input id='id_srv_sun_new' type='number' class='form-control form-control-sm' value='0'>";
            result += "</div>";

            result += "<div class='form-group col-3'>";
            result += "<label for='id_srv_pub_new'>{% trans 'Pub' %}</label>";
            result += "<input id='id_srv_pub_new' type='number' class='form-control form-control-sm' value='0'>";
            result += "</div>";

            result += "</div>";
            result += "</div>";

            result += "<div class='form-row'>";
            result += "<div class='form-group col-md-3'>";
            result += "<label for='id_srv_qty_new'>{% trans 'QTY' %}</label>";
            result += "<input id='id_srv_qty_new' type='number' class='form-control form-control-sm' value='0'>";
            result += "</div>";

            result += "<div class='form-group col-md-3'>";
            result += "<label for='id_srv_rate_new'>{% trans 'Cost' %}</label>";
            result += "<input id='id_srv_rate_new' type='number' class='form-control form-control-sm' value='0'>";
            result += "</div>";

            result += "<div class='form-group col-md-3'>";
            result += "<label for='id_srv_cost_new'>{% trans 'Total Cost' %}</label>";
            result += "<input id='id_srv_cost_new' type='text' class='form-control form-control-sm' value='0' readonly>";
            result += "</div>";

            result += "<div class='form-group col-md-3 text-center'>";
            result += "<label for='id_srv_active_new'>&nbsp;</label>";
            result += "<div class='form-check'>";
            
            result += "<input id='id_srv_active_new' class='form-check-input' type='checkbox'>";
            result += "<label for='id_srv_active_new' class='form-check-label' style='cursor: pointer;'>{% trans 'Active' %}</label>";

            result += "</div>";                                              
            result += "</div>";
            result += "</div>";

            result += "<div class='form-row'>";
            result += "<div class='form-group col-md-6'>";
            result += "<label for='id_srv_rem_new'>{% trans 'Remark' %}</label>";
            result += "<input id='id_srv_rem_new' type='text' class='form-control form-control-sm' value=''>";
            result += "</div>";

            result += "<div class='form-group col-md-6'>";
            result += "<label for='id_srv_cost_rate_new'>{% trans 'Cost Rate' %}</label>";
            result += "<input id='id_srv_cost_rate_new' type='number' class='form-control form-control-sm' value='0'>";
            result += "</div>";
            result += "</div>";
            result += "</div>";
            result += "</div>";
            result += "</div>";          
            result += "</div>";

            $("#add_new_service_list_modal .modal-body").html(result);            
            $('#add_new_service_list_modal').on('shown.bs.modal', function (e) {
              $('#id_srv_qty_new').focus();
            });            
          },
          error: function(data){
            $("#add_new_service_list_modal .modal-body").html("{% trans 'There is no data.' %}");
          }
      });

      $("#add_new_service_list_modal").modal("show");

    });


    $('#wage_rate_lookup').on('click', function (e) {
      var obj = $(this);  
      $.ajax({
          url: obj.attr("data-url"),
          type: 'get',          
          dataType: 'json',
          beforeSend: function () {
            $("#wageratemodal").modal("show");
          },
          success: function (data) {
            var result = ""
            var count = data.results.length;
            var wage_id = data.results[0]["wage_id"];
            var wage_th = data.results[0]["wage_th"];
            var wage_en = data.results[0]["wage_en"];

            result += "<div class='row col-12'>";
            result += "<div class='col-8 offset-3 pb-2'>";
            result += "<form id='cus_main_search_district_modal_form' class='form-inline col-12' accept-charset='UTF-8'>";
            result += "  <div class='form-group mx-sm-3 mb-2'>";
            result += "  <select name='cus_contract_wagerate_option' class='form-control form-control-sm' required id='id_cus_contract_wagerate_option'>";
            result += "    <option value='1'>Wage ID</option>";
            result += "    <option value='2' selected>Wage (TH)</option>";
            result += "    <option value='3'>Wage (EN)</option>";
            result += "  </select>&nbsp;&nbsp;&nbsp;&nbsp;";
            result += "    <label for='id_cus_main_search_district' class='sr-only'>Search</label>";            
            result += "    <input type='text' class='form-control form-control-sm' id='id_cus_contract_wagerate_search_text' name='cus_contract_wagerate_search_text' placeholder='' autocomplete='off' >";
            result += "  </div>";
            result += "<a href='javascript:cus_contract_search_wagerate_modal()' type='button' class='btn btn-primary btn-sm mb-2'>Search</a>";            
            result += "</form>";
            result += "</div>";

            result += "<div class='row col-12'>";
            result += "<table class='table table-hover table-sm'>";
            result += " <thead>";
            result += "   <tr>";
            result += "     <th scope='col'>{% trans 'Wage ID' %}</th>";
            result += "     <th scope='col'>{% trans 'Wage (TH)' %}</th>";
            result += "     <th scope='col'>{% trans 'Wage (EN)' %}</th>";
            result += "     <th scope='col'>&nbsp;</th>";
            result += "   </tr>";
            result += " </thead>";
            result += "<tbody>";
            result += "</div>";
            result += "<div>";

            for(var i=0; i<count; i++) {              
              var wage_id = data.results[i]["wage_id"];
              var wage_th = data.results[i]["wage_th"];
              var wage_en = data.results[i]["wage_en"];
              var wage_8hr = data.results[i]["wage_8hr"];

              result += "<tr>";
              result += "<td>" + wage_id + "</td>";        
              result += "<td>" + wage_th + "</td>";
              result += "<td>" + wage_en + "</td>";
              result += "<td><a href='javascript:cus_contract_select_wagerate(" + wage_id + ",\"" + wage_th + "\",\"" + wage_en + "\",\"" + wage_8hr + "\");' type='button' class='btn btn-outline-primary btn-sm'>Select</a></td>";
              result += "</tr>";              
            }
            result += " </tbody>";
            result += "</table>";

            $("#wageratemodal .modal-body").html(result);            


          },
          error: function(data){
            $("#wageratemodal .modal-body").html("{% trans 'There is no data.' %}");
          }          
      });      
    });


    $('#contract_lookup').on('click', function (e) {
      $("#id_search_number_of_found_record").html("");
      var obj = $(this);  
      $.ajax({
          url: obj.attr("data-url"),
          type: 'get',          
          dataType: 'json',
          beforeSend: function () {
            $("#search_contract_modal").modal("show");
            $('#search_contract_modal').on('shown.bs.modal', function () {
              $("#id_cus_contract_search_text").focus();
            });            
          },
          success: function (data) {
            var result = ""
            var count = data.results.length;
            var cnt_id = data.results[0]["cnt_id"];
            var cus_name_th = data.results[0]["cus_name_th"];
            var cus_name_en = data.results[0]["cus_name_en"];

            result += "<div class='row col-12' stye='padding:0;'>";

            result += "<div class='col-8 offset-3 pb-2'>";
            result += "<form id='search_contract_modal_form' class='form-inline col-12' accept-charset='UTF-8'>";
            result += "  <div class='form-group mx-sm-3 mb-2'>";
            result += "  <select name='cus_contract_search_option' class='form-control form-control-sm' required id='id_cus_contract_search_option'>";
            result += "    <option value='1'>Contract ID</option>";
            result += "    <option value='2' selected>Customer Name (TH)</option>";
            result += "    <option value='3'>Customer Name (EN)</option>";
            result += "  </select>&nbsp;&nbsp;&nbsp;&nbsp;";
            result += "    <label for='id_cus_main_search_district' class='sr-only'>Search</label>";            
            result += "    <input type='text' class='form-control form-control-sm' id='id_cus_contract_search_text' name='cus_contract_search_text' autocomplete='off' value=''>";
            result += "  </div>";
            result += "<a href='javascript:cus_contract_search_modal()' type='button' class='btn btn-primary btn-sm mb-2'>Search</a>";            
            result += "</form>";
            result += "</div>";

            
            result += "<div class='table-responsive' stye='padding:0;'>";
            
            //<table class='table table-responsive table-sm table-striped table-condensed table-wrapper-scroll-y my-custom-scrollbar' id="
            result += "<table class='table table-hover table-striped table-wrapper-scroll-y my-custom-scrollbar'>";
            result += " <thead>";
            result += "   <tr class='text-left'>";
            result += "     <th scope='col' class='text-left' nowrap>{% trans 'Contract ID' %}.</th>";
            result += "     <th scope='col' class='text-left'>{% trans 'Customer Name (TH)' %}</th>";
            result += "     <th scope='col' class='text-left'>{% trans 'Customer Name (EN)' %}</th>";
            result += "     <th scope='col'>&nbsp;</th>";
            result += "   </tr>";
            result += " </thead>";

            result += "<tbody style='font-size:13px;'>";
            result += "</div>";
            result += "<div>";

            for(var i=0; i<count; i++) {              
              var cnt_id = data.results[i]["cnt_id"];
              var cus_name_th = data.results[i]["cus_name_th"];
              var cus_name_en = data.results[i]["cus_name_en"];

              result += "<tr>";
              result += "<td class='align-middle'>" + cnt_id + "</td>";        
              result += "<td class='align-middle'>" + cus_name_th + "</td>";
              result += "<td class='align-middle'>" + cus_name_en + "</td>";
              result += "<td class='text-right'><a href='javascript:cus_contract_select_item(" + cnt_id + ",\"" + cus_name_th + "\",\"" + cus_name_en + "\");' type='button' class='btn btn-outline-primary btn-sm'>&nbsp;&nbsp;Select&nbsp;&nbsp;</a></td>";
              result += "</tr>";              
            }
            result += " </tbody>";
            result += "</table>";            
            result += "</div>";

            $("#search_contract_modal .modal-body").html(result);     
            

          },
          error: function(data){
            $("#search_contract_modal .modal-body").html("{% trans 'There is no data.' %}");
          }          
      });      
    });    

  });


</script>






<script>

  $(function () {


    /*
    $("#id_cnt_doc_date").datepicker({
      format: 'dd/mm/yyyy',
      autoclose: true,
      orientation: "bottom",
      constrainInput: false,
      onSelect: function () {
        console.log("AA");
        $(this).off( "focus" );
      }        
    }).on('keypress', function (e) {
      //e.preventDefault();
      //return false;
    });

    $("#dtp_cnt_doc_date").datepicker({
      format: 'dd/mm/yyyy',
      autoclose: true,
      orientation: "bottom",
      constrainInput: false
    });

    $("#dtp_cnt_eff_frm").datepicker({
      format: 'dd/mm/yyyy',
      autoclose: true,
      orientation: "bottom"
    });

    $("#dtp_cnt_eff_to").datepicker({
      format: 'dd/mm/yyyy',
      autoclose: true,
      orientation: "bottom"
    });

    $("#dtp_cnt_sign_frm").datepicker({
      format: 'dd/mm/yyyy',
      autoclose: true,
      orientation: "bottom"
    });

    $("#dtp_cnt_sign_to").datepicker({
      format: 'dd/mm/yyyy',
      autoclose: true,
      orientation: "bottom"
    });    
    */
  


    // Add new service modal
    $('#add_new_service_list_modal').on('shown.bs.modal', function (e) {

      $("#id_com_rank_rank_id_new").change(function () {
          $('#id_t_shift_id_new').focus();
      });

      $("#id_t_shift_id_new").change(function () {
          $('#id_srv_qty_new').focus();
      });


      // ID_DTP_CNT_EFF_FRM_NEW
      $("#id_dtp_cnt_eff_frm_new").inputmask("dd/mm/yyyy", {
        placeholder: "dd/mm/yyyy",
        insertMode: false, 
        showMaskOnHover: false,
        alias: "datetime",
       }
      );
      $(document).on('keypress', '#id_dtp_cnt_eff_frm_new', function(e) {
        if(e.which == 13) {      
          e.preventDefault();

          var keyup_value;
          keyup_value = this.value;

          if(isValidDate(keyup_value)) {
            $('#id_dtp_cnt_eff_to_new').focus();
          } else {
            $('#id_dtp_cnt_eff_frm_new').focus();
            $(document).Toasts('create', {
              class: "bg-danger", 
              title: "{% trans 'Error' %}",
              subtitle: '',
              autohide: true,
              delay: 2000,
              body: "",
              autoDismiss: true,
              close: true,
              autoremove: true,
            });        
          }
        }
      });
      $("#id_dtp_cnt_eff_frm_new").bind("focus",function(e){
        window.setTimeout(function() {
          $("#id_dtp_cnt_eff_frm_new").select();
        }, 0);
      });

    

      // ID_DTP_CNT_EFF_FRM_NEW
      $("#id_dtp_cnt_eff_to_new").inputmask("dd/mm/yyyy", {
        placeholder: "dd/mm/yyyy",
        insertMode: false, 
        showMaskOnHover: false,
        alias: "datetime",
       }
      );
      $(document).on('keypress', '#id_dtp_cnt_eff_to_new', function(e) {
        if(e.which == 13) {      
          e.preventDefault();

          var keyup_value;
          keyup_value = this.value;

          if(isValidDate(keyup_value)) {
            $('#id_srv_qty_new').focus();
          } else {
            $('#id_dtp_cnt_eff_to_new').focus();
            $(document).Toasts('create', {
              class: "bg-danger", 
              title: "{% trans 'Error' %}",
              subtitle: '',
              autohide: true,
              delay: 2000,
              body: "",
              autoDismiss: true,
              close: true,
              autoremove: true,
            });        
          }
        }
      });
      $("#id_dtp_cnt_eff_to_new").bind("focus",function(e){
        window.setTimeout(function() {
          $("#id_dtp_cnt_eff_to_new").select();
        }, 0);
      });

      /*
      $("#id_dtp_cnt_eff_to_new").inputmask("99/99/9999");
      $(document).on('keypress', '#id_dtp_cnt_eff_to_new', function(e) {
        if(e.which == 13) {      
          e.preventDefault();

          var keyup_value;
          keyup_value = this.value;

          if(isValidDate(keyup_value)) {
            $('#id_srv_qty_new').focus();
          } else {
            $('#id_dtp_cnt_eff_to_new').focus();
            $(document).Toasts('create', {
              class: "bg-danger", 
              title: "{% trans 'Error' %}",
              subtitle: '',
              autohide: true,
              delay: 2000,
              body: "",
              autoDismiss: true,
              close: true,
              autoremove: true,
            });        
          }
        }
      });
      $("#id_dtp_cnt_eff_to_new").bind("focus",function(e){
        console.log("id_cnt_eff_to_focus" + " | " + e.keyCode);
        if(e.keyCode!=undefined) {
          this.setSelectionRange(0,2);
        } else {
          const input = document.getElementById('id_dtp_cnt_eff_to_new');
          window.setTimeout(function() {
            input.setSelectionRange(0,2);
          }, 0);
        }
      });

      $("#id_dtp_cnt_eff_to_new").bind("keyup",function(e){
        var keyup_point;
        var keyup_value;

        keyup_point = this.selectionStart;
        keyup_value = this.value;

        // NUMERIC PAD
        if ((e.keyCode >= 48 && e.keyCode <= 57) || (e.keyCode >= 96 && e.keyCode <= 105)) {
          console.log("numpad: " + keyup_point + " | value: " + keyup_value);

          if(keyup_point==3) {
            // isValidDate()
            if(isValidDate(keyup_value)) {
              console.log("TRUE");
            } else {
              console.log("FALSE");
            }

            if(keyup_value.substring(0,2)>31) {
              this.setSelectionRange(0, 2);
            } else {
              this.setSelectionRange(3, 5);
            }
            return false;
          }

          if(keyup_point==6) {
            if(keyup_value.substring(3, 5)>12) {
              this.setSelectionRange(3, 5);
            } else {
              this.setSelectionRange(6, 10);
            }
            return false;
          }
        }

        // LEFT
        if(e.keyCode == 37) {
          console.log("left arrow keyup_point:" + keyup_point);
          if(keyup_point==2) {
            this.setSelectionRange(2, 5);
          }   
          if(keyup_point==3) {
            this.setSelectionRange(0, 2);
          }           
          if(keyup_point==6) {
            this.setSelectionRange(3, 5);
          }
          if(keyup_point==9) {
            this.setSelectionRange(6, 10);
          }        
        }

        // RIGHT
        if(e.keyCode == 39) {
          console.log("right arrow keyup_point:" + keyup_point);

          if(keyup_point==2) {
            console.log("value:" + keyup_value);
                  
            // isValidDate()
            if(isValidDate(keyup_value)) {
              console.log("TRUE");
              this.setSelectionRange(3, 5);
            } else {
              console.log("FALSE");
              this.setSelectionRange(0, 2);
            }
          } 
          if(keyup_point==5) {
            if(isValidDate(keyup_value)) {
              console.log("TRUE");
              this.setSelectionRange(6, 10);
            } else {
              console.log("FALSE");
              this.setSelectionRange(3, 5);
            }                  
          }
        }
      });
      */

      // SRV_QTY_NEW
      $('#id_srv_qty_new').on('focus', function (e) {
        $(this).select();
      });      
      $('#id_srv_qty_new').on('keypress', function (e) {        
        var qty = $(this);
        if(e.which === 13) {
          if(qty.val() > 0) {
            day = qty.val();
            $('#id_srv_mon_new').val(day);
            $('#id_srv_tue_new').val(day);
            $('#id_srv_wed_new').val(day);
            $('#id_srv_thu_new').val(day);
            $('#id_srv_fri_new').val(day);
            $('#id_srv_sat_new').val(day);
            $('#id_srv_sun_new').val(day);
            $('#id_srv_pub_new').val(day);
          } else if(qty.val() == 0) {
            $(this).val(0);
            day = 0;
            $('#id_srv_mon_new').val(day);
            $('#id_srv_tue_new').val(day);
            $('#id_srv_wed_new').val(day);
            $('#id_srv_thu_new').val(day);
            $('#id_srv_fri_new').val(day);
            $('#id_srv_sat_new').val(day);
            $('#id_srv_sun_new').val(day);
            $('#id_srv_pub_new').val(day);            
          }
          else {
            $(this).val(0);
            day = 0;
            $('#id_srv_mon_new').val(day);
            $('#id_srv_tue_new').val(day);
            $('#id_srv_wed_new').val(day);
            $('#id_srv_thu_new').val(day);
            $('#id_srv_fri_new').val(day);
            $('#id_srv_sat_new').val(day);
            $('#id_srv_sun_new').val(day);
            $('#id_srv_pub_new').val(day);            
          }

          $('#id_srv_rate_new').focus();

          event.preventDefault();
          return false;        
        }
      });
      //
      $('#id_srv_qty_new').on('keyup', function (e) {
        var qty = $(this);
        if(e.which === 13){
          total = qty * $('#id_srv_rate_new').val();
          $('#id_srv_cost_new').val(total);
        } else {
          total = $(this).val() * $('#id_srv_rate_new').val();
          $('#id_srv_cost_new').val(total); 
        }
      });


      // SRV_RATE_NEW
      $('#id_srv_rate_new').on('focus', function (e) {
        $(this).select();
      });
      $('#id_srv_rate_new').on('keyup', function (e) {        
        var cost = $(this);
        if(e.which === 13){
          total = cost.val() * $('#id_srv_qty_new').val();
          $('#id_srv_cost_new').val(total);
        } else {
          total = $(this).val() * $('#id_srv_qty_new').val();
          $('#id_srv_cost_new').val(total);
        }
      });
      $('#id_srv_rate_new').on('keypress', function (e) {        
        if(e.which === 13)
          $('#id_srv_rem_new').focus();      
      });


      // SRV_REMARK_NEW
      $('#id_srv_rem_new').on('focus', function (e) {
        $(this).select();
      });            
      $('#id_srv_rem_new').on('keypress', function (e) {
        if(e.which === 13){
          $('#id_srv_cost_rate_new').focus();
          event.preventDefault();
          return false;        
        }
      });

      // SRV_COST_RATE_NEW
      $('#id_srv_cost_rate_new').on('focus', function (e) {
        $(this).select();
      });


      // SRV_MON_NEW
      $('#id_srv_mon_new').on('focus', function (e) {
        $(this).select();
      });      
      $('#id_srv_mon_new').on('keypress', function (e) {
        if(e.which === 13){
          $('#id_srv_tue_new').focus();
          event.preventDefault();
          return false;        
        }
      });

      // SRV_TUE_NEW
      $('#id_srv_tue_new').on('focus', function (e) {
        $(this).select();
      });      
      $('#id_srv_tue_new').on('keypress', function (e) {
        if(e.which === 13){
          $('#id_srv_wed_new').focus();
          event.preventDefault();
          return false;        
        }
      });

      // SRV_WED_NEW
      $('#id_srv_wed_new').on('focus', function (e) {
        $(this).select();
      });      
      $('#id_srv_wed_new').on('keypress', function (e) {
        if(e.which === 13){
          $('#id_srv_thu_new').focus();
          event.preventDefault();
          return false;        
        }
      });

      // SRV_THU_NEW
      $('#id_srv_thu_new').on('focus', function (e) {
        $(this).select();
      });
      $('#id_srv_thu_new').on('keypress', function (e) {
        if(e.which === 13){
          $('#id_srv_fri_new').focus();
          event.preventDefault();
          return false;        
        }
      });

      // SRV_FRI_NEW
      $('#id_srv_fri_new').on('focus', function (e) {
        $(this).select();
      });      
      $('#id_srv_fri_new').on('keypress', function (e) {
        if(e.which === 13){
          $('#id_srv_sat_new').focus();
          event.preventDefault();
          return false;        
        }
      });

      // SRV_SAT_NEW
      $('#id_srv_sat_new').on('focus', function (e) {
        $(this).select();
      });      
      $('#id_srv_sat_new').on('keypress', function (e) {
        if(e.which === 13){
          $('#id_srv_sun_new').focus();
          event.preventDefault();
          return false;        
        }
      });

      // SRV_SUN_NEW
      $('#id_srv_sun_new').on('focus', function (e) {
        $(this).select();
      });      
      $('#id_srv_sun_new').on('keypress', function (e) {
        if(e.which === 13){
          $('#id_srv_pub_new').focus();
          event.preventDefault();
          return false;        
        }
      });


      // SRV_PUB_NEW
      $('#id_srv_pub_new').on('focus', function (e) {
        $(this).select();
      });      
      $('#id_srv_pub_new').on('keypress', function (e) {
        if(e.which === 13){
          $('#id_srv_qty_new').focus();
          event.preventDefault();
          return false;        
        }
      });   
                  
    });


    // Update service modal    
    $('#update_service_modal').on('shown.bs.modal', function (e) {

      // SRV_EFF_FRM
      /*
      $("#dtp_srv_eff_frm_date").datepicker({
        format: 'dd/mm/yyyy',
        autoclose: true,
        orientation: "bottom"
      }); 

      // SRV_EFF_TO
      $("#dtp_srv_eff_to_date").datepicker({
        format: 'dd/mm/yyyy',
        autoclose: true,
        orientation: "bottom"
      }); 
      */
    // ID_SRV_EFF_TO
    $("#id_srv_eff_to").inputmask("99/99/9999");
    $(document).on('keypress', '#id_srv_eff_to', function(e) {
      if(e.which == 13) {      
        e.preventDefault();

        var keyup_value;
        keyup_value = this.value;

        if(isValidDate(keyup_value)) {
          $('#id_srv_qty').focus();
        } else {
          $('#id_srv_eff_to').focus();
          $(document).Toasts('create', {
            class: "bg-danger", 
            title: "{% trans 'Error' %}",
            subtitle: '',
            autohide: true,
            delay: 2000,
            body: "",
            autoDismiss: true,
            close: true,
            autoremove: true,
          });        
        }
      }
    });
    
    $("#id_srv_eff_to").bind("focus",function(e){
      if(e.keyCode!=undefined) {
        this.setSelectionRange(0,2);
      } else {
        const input = document.getElementById('id_srv_eff_to');
        window.setTimeout(function() {
          input.setSelectionRange(0,2);
        }, 0);
      }
    });

    $("#id_srv_eff_to").bind("keyup",function(e){
      var keyup_point;
      var keyup_value;

      keyup_point = this.selectionStart;
      keyup_value = this.value;

      // NUMERIC PAD
      if ((e.keyCode >= 48 && e.keyCode <= 57) || (e.keyCode >= 96 && e.keyCode <= 105)) {
        console.log("numpad: " + keyup_point + " | value: " + keyup_value);

        if(keyup_point==3) {
          // isValidDate()
          if(isValidDate(keyup_value)) {
            console.log("TRUE");
          } else {
            console.log("FALSE");
          }

          if(keyup_value.substring(0,2)>31) {
            this.setSelectionRange(0, 2);
          } else {
            this.setSelectionRange(3, 5);
          }
          return false;
        }

        if(keyup_point==6) {
          if(keyup_value.substring(3, 5)>12) {
            this.setSelectionRange(3, 5);
          } else {
            this.setSelectionRange(6, 10);
          }
          return false;
        }
      }

      // LEFT
      if(e.keyCode == 37) {
        console.log("left arrow keyup_point:" + keyup_point);
        if(keyup_point==2) {
          this.setSelectionRange(2, 5);
        }   
        if(keyup_point==3) {
          this.setSelectionRange(0, 2);
        }           
        if(keyup_point==6) {
          this.setSelectionRange(3, 5);
        }
        if(keyup_point==9) {
          this.setSelectionRange(6, 10);
        }        
      }

      // RIGHT
      if(e.keyCode == 39) {
        console.log("right arrow keyup_point:" + keyup_point);

        if(keyup_point==2) {
          console.log("value:" + keyup_value);
                
          // isValidDate()
          if(isValidDate(keyup_value)) {
            console.log("TRUE");
            this.setSelectionRange(3, 5);
          } else {
            console.log("FALSE");
            this.setSelectionRange(0, 2);
          }
        } 
        if(keyup_point==5) {
          if(isValidDate(keyup_value)) {
            console.log("TRUE");
            this.setSelectionRange(6, 10);
          } else {
            console.log("FALSE");
            this.setSelectionRange(3, 5);
          }                  
        }
      }
    });


      // SRV_QTY
      $('#id_srv_qty').on('keypress', function (e) {
        var qty = $(this);
        if(e.which === 13) {
          if(qty.val() > 0) {
            day = qty.val();
            $('#id_srv_mon').val(day);
            $('#id_srv_tue').val(day);
            $('#id_srv_wed').val(day);
            $('#id_srv_thu').val(day);
            $('#id_srv_fri').val(day);
            $('#id_srv_sat').val(day);
            $('#id_srv_sun').val(day);
            $('#id_srv_pub').val(day);
          } else {
            $(this).val(1);
            day = 1;
            $('#id_srv_mon').val(day);
            $('#id_srv_tue').val(day);
            $('#id_srv_wed').val(day);
            $('#id_srv_thu').val(day);
            $('#id_srv_fri').val(day);
            $('#id_srv_sat').val(day);
            $('#id_srv_sun').val(day);
            $('#id_srv_pub').val(day);            
          }

          $('#id_srv_rate').focus();
          event.preventDefault();
          return false;        
        }
      });

      $('#id_srv_qty').on('keyup', function (e) {
        var qty = $(this);
        if(e.which === 13){
          total = qty * $('#id_srv_rate').val();
          $('#id_srv_cost').val(total);
        } else {
          total = $(this).val() * $('#id_srv_rate').val();
          $('#id_srv_cost').val(total); 
        }
      });

      $('#id_srv_rate').on('keyup', function (e) {        
        var cost = $(this);
        if(e.which === 13){
          total = cost.val() * $('#id_srv_qty').val();
          $('#id_srv_cost').val(total);
        } else {
          total = $(this).val() * $('#id_srv_qty').val();
          $('#id_srv_cost').val(total);
        }
      });

      $('#id_srv_rate').on('keypress', function (e) {        
        if(e.which === 13)
          $('#id_srv_rem').focus();      
      });

      // SRV_MON
      $('#id_srv_mon').on('keypress', function (e) {
        if(e.which === 13){
          $('#id_srv_tue').focus();
          event.preventDefault();
          return false;        
        }
      });

      // SRV_TUE
      $('#id_srv_tue').on('keypress', function (e) {
        if(e.which === 13){
          $('#id_srv_wed').focus();
          event.preventDefault();
          return false;        
        }
      });

      // SRV_WED
      $('#id_srv_wed').on('keypress', function (e) {
        if(e.which === 13){
          $('#id_srv_thu').focus();
          event.preventDefault();
          return false;        
        }
      });

      $('#id_srv_thu').on('keypress', function (e) {
        if(e.which === 13){
          $('#id_srv_fri').focus();
          event.preventDefault();
          return false;        
        }
      });

      // SRV_FRI
      $('#id_srv_fri').on('keypress', function (e) {
        if(e.which === 13){
          $('#id_srv_sat').focus();
          event.preventDefault();
          return false;        
        }
      });

      // SRV_SAT
      $('#id_srv_sat').on('keypress', function (e) {
        if(e.which === 13){
          $('#id_srv_sun').focus();
          event.preventDefault();
          return false;        
        }
      });

      // SRV_SUN
      $('#id_srv_sun').on('keypress', function (e) {
        if(e.which === 13){
          $('#id_srv_pub').focus();
          event.preventDefault();
          return false;        
        }
      });
      
    });

  });

  function print_contract() {
    language_option = $("input[name=printOptions]:checked").val();
    cnt_id = $("#id_cnt_id_temp").val();    
    if($("input[name=cnt_new]:checked").val())
      is_new_report = 1;
    else
      is_new_report = 0;

    if($("input[name=amendment]:checked").val())
      is_amendment = 1;
    else
      is_amendment = 0;

    if($("input[name=cnt_print]:checked").val())
      is_customer_address = 'C';
    else
      is_customer_address = 'S';  

    var href = "/contract/generate-contract/" + cnt_id + "/" + language_option + "/" + is_new_report + "/" + is_amendment + "/" + is_customer_address;

    window.open(
      href,
      '_blank'
    );
  }


  function download_contract(cnt_id) {  
    language_option = $("input[name=printOptions]:checked").val();
    cnt_id = $("#id_cnt_id_temp").val();    
    if($("input[name=cnt_new]:checked").val())
      is_new_report = 1;
    else
      is_new_report = 0;

    if($("input[name=amendment]:checked").val())
      is_amendment = 1;
    else
      is_amendment = 0;

    if($("input[name=cnt_print]:checked").val())
      is_customer_address = 'C';
    else
      is_customer_address = 'S';  

    var href = "/contract/download-contract/" + cnt_id + "/" + language_option + "/" + is_new_report + "/" + is_amendment + "/" + is_customer_address;

    window.open(
      href,
      '_blank'
    );
  }



</script>

{% endblock %}
