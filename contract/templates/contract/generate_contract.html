{% extends "page_generic_print.html" %}

{% load i18n %}
{% block title %} {{ page_title}} - {% trans 'Contract Document' %} {% endblock %}
{% load static %}
{% load widget_tweaks %}

{% block content %}

  <!-- Content Wrapper. Contains page content -->
  <div class="content-wrapper">
    
    <!-- Content Header (Page header) -->
    <div class="content-header">
      <div class="container-fluid">
        <div class="row mb-2">
          <div class="col-sm-6">
            <h1 class="m-0 text-dark">{% trans 'Contract Document Preview' %}</h1>
          </div>
          <div class="col-sm-6">
            <div class="float-right">
              <button type="button" class="btn btn-info btn-sm js-create-customer" data-url=""><i class="fas fa-download"></i>&nbsp;&nbsp;{% trans 'Download' %}</button>            
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- /.content-header -->

    <!-- Main content -->
    <section class="content">

      <!-- Default box -->
      <div id="contract_list" class="card">

        <!--
        <div class="card-header" style="vertical-align: middle;">
          <div class="card-tools">
            <button type="button" class="btn btn-info btn-sm js-create-customer" data-url=""><i class="fas fa-download"></i>&nbsp;&nbsp;{% trans 'Download' %}</button>            
          </div>
        </div>
        -->

        <div class="card-body">                  
          TODO
        </div>        

        <!--
        <div class="card-footer">
          &nbsp;
        </div>
        -->

    </div>

    </section>

  </div>
{% endblock %}




{% block javascript %}
<script>

  /*
  $('#id_cus_id').focus();
  $("#id_cus_id").select();
  
  $(document).on('keypress', '#id_cus_id', function(e) {
    if(e.which == 13) {      
      e.preventDefault();
      cus_id = $("#id_cus_id").val();

      if(cus_id <= 0) {
        $('#id_cus_id').focus();        
      } else {
        $("#search_contract_form").submit();
        $("#id_cus_id").select();
      }
    }
  });

  $("#id_cus_id").on('click', function(){
    //$(this).select();
    $("#id_cus_id").select();
  });

  $(document).on('click', '#search_contract_button', function(event) {
    $("#search_contract_form").submit();
    $("#id_cus_id").select();
  });

  $("#contract-form").submit(function(e) {
    e.preventDefault();

    var data = $(this).serialize();
    $.ajax({
          type:'POST',
          url:'{% url "contract_create" %}',
          data:{
              cus_id:$('#id_cus_id').val(),
              //cus_brn:$('#id_cus_brn').val(),
              //cus_vol:$('#id_cus_vol').val(),
              csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val(),
              action: 'post'
          },
          beforeSend: function(){
            $('#waitingDialog').modal();          
          },
          complete: function(){
            $('#waitingDialog').modal('hide');
          },
          success:function(json){
            $(".card-body").html("");
            $(".card-title").html('Company');

            $(".card-body").html(json.html_form);
            $(".card-title").html(json.cus_name_th);
            $("#id_cus_id_error").html('');
            $("#id_cus_brn_error").html('');
            $("#id_cus_vol_error").html('');

            if (json.errorlist) {     
              for (item in json.errorlist) {
                switch(item) {
                  case 'cus_id':
                    if(json.errorlist.cus_id)
                      $("#id_cus_id_error").html(json.errorlist.cus_id);
                    break;
                  case 'cus_brn':
                    if(json.errorlist.cus_brn)
                      $("#id_cus_brn_error").html(json.errorlist.cus_brn);
                    break;
                  case 'cus_vol':
                    if(json.errorlist.cus_vol)
                      $("#id_cus_vol_error").html(json.errorlist.cus_vol);
                    break;
                }
              }
            }

            $("#id_cus_id").select();
          },
          error : function(xhr,errmsg,err) {
          console.log(xhr.status + ": " + xhr.responseText);
      }
    });

  });


  function delete_customer_contract(cnt_id) {
    $('#id_select_customer_contract_id').val(cnt_id);

    if (cnt_id != null) {
      result = "";
      result += "<div>Would you like to delete the Service ID <b>" + cnt_id + " </b>&nbsp;&nbsp;?</div>";

      $("#delete_customer_contract_modal .modal-body").html(result);
      $("#delete_customer_contract_modal").modal("show");
    }
  }


  function delete_customer_contract_item() {
    cnt_id = $('#id_select_customer_contract_id').val();
    cus_id = $('#id_cus_id').val();
    //alert(cus_id);

    $.ajax({
        url : "/contract/ajax/delete_customer_contract",
        type: 'get',
        dataType: 'json',
        data: {
          cnt_id: cnt_id,
          cus_id: cus_id,
        },
        beforeSend: function () {
          
        },    
        success: function (data) {          

          $(document).Toasts('create', {
            class: data.class, 
            title: "{% trans 'System Message' %}",
            subtitle: '',
            autohide: true,
            delay: 2000,      
            body: data.message,
            autoDismiss: true,
            close: true,
            autoremove: true,
          });                    
        


        // Reloade contract list table
        $.ajax({
          url : "/contract/ajax/reload_contract_list",
          type: 'get',          
          dataType: 'json',
          data: {
            cnt_id: data.cnt_id,
            cus_id: cus_id,
          },
          beforeSend: function () {
            
          },    
          success: function (data) {

            if(cus_id!=""){
              result = "";
              result += "<div class='float-right pb-3'><a href='contract/create' type='button' class='btn btn-success btn-md'><i class='fas fa-plus fa-xs'></i>&nbsp;&nbsp;{% trans 'New Contract' %}</a></div>";
              result += "<table id='customer-list-table' class='table table-bordered table-striped table-sm'>";
              result += "  <thead>";
              result += "  <tr>";
              result += "    <th scope='col'>{% trans 'Contract ID' %}</th>";
              result += "    <th scope='col'>{% trans 'Customer Name (TH)' %}</th>";
              result += "    <th scope='col'>{% trans 'Customer Name (EN)' %}</th>";
              result += "    <th scope='col'>&nbsp;</th>";
              result += "  </tr>";
              result += "  </thead>";
              result += "  <tbody>";

              if(data.cus_contract_list.length > 0) {
              for(var i=0; i<data.cus_contract_list.length; i++) {
                result += "  <tr>";          
                result += "      <td>" + data.cus_contract_list[i]["cnt_id"] + "</td>";
                result += "      <td><a href=''>" + data.cus_contract_list[i]["cus_name_th"] + "</a></td>";
                result += "      <td><a href=''>" + data.cus_contract_list[i]["cus_name_en"] + "</a></td>";
                result += "      <td class='text-right py-0 align-middle'>";
                result += "        <div class='btn-group btn-group-sm'>";
                result += "          <a href='contract/" + data.cus_contract_list[i]["cnt_id"] + "/update' type='button' class='btn btn-info btn-xs js-update-customer' data-url=''>";
                result += "            <i class='fas fa-pen fa-xs'></i>";
                result += "          </a>&nbsp;";
                result += "          <button type='button' onclick='delete_customer_contract(" + data.cus_contract_list[i]["cnt_id"] + ")' class='btn btn-danger btn-xs js-delete-contract'><i class='fas fa-trash fa-xs'></i></button>";
                result += "        </div>";
                result += "      </td>";
                result += "  </tr>";              
              }  
              } else {
                result += "  <tr class='bg-warning'>";
                result += "    <td colspan='5' align='center'><br>{% trans 'There is no contract.' %}<br><br></td>";
                result += "  </tr>";
              }

              result += "  </tbody>";
              result += "</table>";

              //amnaj
              $("#contract_list .card-body").html(result);
              $("#delete_customer_contract_modal").modal("hide");

            } else {
              //alert("reload page");
              location.reload();
              $("#delete_customer_contract_modal").modal("hide");
            }
            
            
          },
          error: function(data){
            // do nothing        
          }
        });    

        },
        error: function(data){
          alert("error!");
        }
    });
  }
  */

</script>

{% endblock %}