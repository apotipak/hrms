{% extends "page_report.html" %}

{% load i18n %}
{% block title %} {{ page_title}} - {% trans 'Report' %} {% endblock %}
{% load static %}
{% load widget_tweaks %}

{% block content %}

  <!-- Content Wrapper. Contains page content -->
  <div class="content-wrapper pt-2">

    <!-- Main content -->
    <section class="content">

      <div class="col-md-12 p-0 pt-2">

        <form method="post" autocomplete="off" name="search_form">
          {% csrf_token %}
          
          <div class="card-body p-0 pt-2">
            <div class="form-group">

              <div class="input-group col-12">

               <div class="input-group-prepend pr-2 pt-1" style="width:100px;"><label>Contract No</label></div>
                <div class="input-group-prepend"><span class="input-group-text border-bottom-0 rounded-0" style="background-color: #d2d4d6; width:60px;">From</span></div>
                <input type="number" name="contract_number_from" class="form-control border-bottom-1 border-left-0 rounded-0 bg-white" style="width:50px;" value="1661000001" id="id_contract_number_from">
                <div class="input-group-prepend"><span class="input-group-text border-bottom-0 rounded-0" style="background-color: #d2d4d6; width:42px;">To</span></div>
                <input type="number" name="contract_number_to" class="form-control datepicker border-bottom-1 border-left-0 rounded-0 bg-white" style="width:50px;" required="" id="id_contract_number_to" value="1661000001">

                &nbsp;&nbsp;

                <div class="input-group-prepend pr-2 pt-1" style="width:85px;"><label>Work Date</label></div>

                <div class="input-group-prepend"><span class="input-group-text border-bottom-0 rounded-0" style="background-color: #d2d4d6; width:67px;">From</span></div>

                <input type="text" name="start_date" class="form-control datepicker border-bottom-1 border-left-0 rounded-0 bg-white" placeholder="dd/mm/yyyy" required="" value="{{start_date}}" id="id_start_date" readonly="readonly">
                
                <div class="input-group-prepend"><span class="input-group-text border-bottom-0 rounded-0" style="background-color: #d2d4d6; width:42px;">To</span></div>
                <input type="text" name="end_date" class="form-control datepicker border-bottom-1 border-left-0 rounded-0 bg-white" placeholder="dd/mm/yyyy" required="" id="id_end_date" value="{{end_date}}" readonly="readonly">

                &nbsp;&nbsp;<a href="javascript:SearchFormSubmit();" class="btn btn-outline-info" role="button">SEARCH</a>
              </div>

            </div>
          </div>

        </form>        

      </div>
      <!-- /.col -->

      <div class="card-header" style="padding: 0 2px 10px 0;">
        <hr>
        <h5 class="card-title"><i class="far fa-list-alt"></i>&nbsp;<b>GPM403 Daily Guard Performance by Contract</b> | <small>รายงานจำนวน รปภ.เรียงตามสัญญา</small></h5>

        <div class="float-right pb-1">
          <div class="d-flex flex-row-reverse">
            <!--<button class="btn btn-success btn-sm" onclick="export_to_excel()">&nbsp;<i class="far fa-file-excel"></i>&nbsp;&nbsp;Export to Excel</button>-->
          </div>
        </div>
      <!-- /.card-header -->

      <font size="2em;">      
      <table class="table table-sm table-bordered table-striped table-hover" id="report_table">
        <thead class="bg-secondary">
          <tr>
            <th class="align-middle text-center" scope="col">NO.</th>
            <th class="align-middle text-center" scope="col" nowrap>First Name</th>
            <th class="align-middle text-center" scope="col" nowrap>Last Name</th>
            <th class="align-middle text-center" scope="col" nowrap>Shift</th>
            <th class="align-middle text-center" scope="col" nowrap>DEPT</th>
          </tr>
        </thead>
        
        <tbody>
          <tr>
            <th class="text-center" colspan='5'><br><br><br><br><br></th>
          </tr>
        </tbody>

      </table>
      </font>

      </div>
    

    </section>
    <!-- /.content -->
  </div>




{% endblock %}



{% block javascript %}
  <script>

  function showLoading() {
    $.LoadingOverlaySetup({
        background      : "rgba(0, 0, 0, 0.5)",
        image           : "/static/img/logo-small.png",        
        imageAnimation  : "1.5s fadein",
        imageColor      : "#ffcc00"
    });
    $.LoadingOverlay("show"); 
  }

  function SearchFormSubmit() {    
    var contract_number_from = $('#id_contract_number_from').val();
    var contract_number_to = $('#id_contract_number_to').val();
    var start_date = $('#id_start_date').val();
    var end_date = $('#id_end_date').val(); 
    
    showLoading();

    $.ajax({
      url: "/reports/control-room/daily-attend/ajax-gpm403-daily-guard-performance-by-contract/",
      type: "POST",
      data: {
        csrfmiddlewaretoken: '{{ csrf_token }}',
        contract_number_from: contract_number_from,
        contract_number_to: contract_number_to,
        start_date: start_date,
        end_date: end_date,
      },
      success : function(data) {
              
        number_of_rows = data.dly_plan_list.length;
        row_count = 0
        
        if(data.is_error) {
          alert("ERROR: " + data.error_message);
        } else {          
          result = "";
          row_count = 1;
          if(row_count>0) {
            for(i=0; i<number_of_rows; i++) {            
              result += "<tr>";
              result += "<td class='text-center' nowrap>" + row_count + "</td>";
              result += "<td class='text-left' nowrap>" + data.dly_plan_list[i]["emp_fname_th"] + "</td>";
              result += "<td class='text-left' nowrap>" + data.dly_plan_list[i]["emp_lname_th"] + "</td>";
              result += "<td class='text-left' nowrap>" + data.dly_plan_list[i]["shf_desc"] + "</td>";
              result += "<td class='text-left' nowrap>" + data.dly_plan_list[i]["dept_en"] + "</td>";
              result += "</tr>";
              row_count = row_count + 1;
            }
          } else {
              result = "";
              result = "<tr style='background-color: #d2d4d6;'><td scope='row' class='text-center' colspan='25'><br><br>There is no data.<br><br><br></td></tr>";
          }
        }        

        $.LoadingOverlay("hide");
        $("#report_table tbody").html(result);      

      }
    });
  }  

  $(document).ready(function () {    
    $('#id_start_date').datepicker({format: 'dd/mm/yyyy', altField: '#thealtdate', altFormat: 'dd/mm/yyyy', autoclose: true, todayHighlight: true}).datepicker("setDate", new Date());
    $('#id_end_date').datepicker({format: 'dd/mm/yyyy', altField: '#thealtdate', altFormat: 'dd/mm/yyyy', autoclose: true, todayHighlight: true}).datepicker("setDate", new Date());
  });

  </script>
{% endblock %}  