{% extends "page_report.html" %}

{% load i18n %}
{% block title %} {{ page_title}} - {% trans 'Report - Contract List' %} {% endblock %}
{% load static %}
{% load widget_tweaks %}

{% block content %}

  <!-- Content Wrapper. Contains page content -->
  <div class="content-wrapper pt-2">

    <!-- Main content -->
    <section class="content">

                  <div class="col-md-12">

                    <form method="post" autocomplete="off" name="search_form">
                      {% csrf_token %}
                      
                      <div class="card-body">
                        <div class="form-group">

                          <div class="input-group col-8 offset-2">

                            <div class="input-group-prepend pr-2 pt-1" style="width:100px;"><label>Contract No</label></div>
                            <div class="input-group-prepend"><span class="input-group-text border-bottom-0 rounded-0" style="background-color: #d2d4d6; width:60px;">From</span></div>
                            <input type="number" name="start_date" class="form-control border-bottom-1 border-left-0 rounded-0 bg-white" style="width:50px;" value="0" id="id_contract_number_from">
                            <div class="input-group-prepend"><span class="input-group-text border-bottom-0 rounded-0" style="background-color: #d2d4d6; width:42px;">To</span></div>
                            <input type="number" name="end_date" class="form-control datepicker border-bottom-1 border-left-0 rounded-0 bg-white" style="width:50px;" required="" id="id_contract_number_to" value="9999999999">
                           
                          </div>

                          <div class="input-group col-8 offset-2">
                            <div class="input-group-prepend pr-2 pt-1" style="width:100px;"><label>Status</label></div>
                            <select id="id_contract_status_option" name="contract_status_option" class="form-control form-control-md" style="width:20px;border-top-right-radius:0px;border-bottom-right-radius:0px;">
                              <option value="" selected>ALL</option>
                              <option value="1">ACTIVE</option>
                              <option value="2">PENDING</option>
                            </select>
                          </div>

                          <div class="input-group col-8 offset-2">
                            <div class="input-group-prepend pr-2 pt-1" style="width:100px;"><label>Zone</label></div>
                            <select id="id_contract_zone_option" name="contract_zone_option" class="form-control form-control-md" style="width:120px;border-top-right-radius:0px;border-bottom-right-radius:0px;">
                              <option value="" selected>ALL</option>
                              {% for item in zone_list %}
                              <option value="{{item.zone_id}}">{{item.zone_id}} | {{ item.zone_en}}</option>
                              {% endfor %}
                            </select>
                          </div>

                          <div class="input-group col-8 offset-2">
                            <div class="row float-right"><a href="javascript:SearchFormSubmit();" class="btn btn-warning" role="button"><i class="fas fa-search fa-md"></i>&nbsp;Search</a></div>
                          </div>
                        </div>
                      </div>

                    </form>  

                  </div>
                  <!-- /.col -->


        <div class="row">
          <div class="col-md-12">
            <div class="card">
              <div class="card-header">
                <h5 class="card-title">Report - Contract List</h5>

                <div class="card-tools">
                  <div class="btn-group">
                    <button type="button" class="btn btn-tool dropdown-toggle" data-toggle="dropdown">
                      <i class="fas fa-print fa-md"></i>
                    </button>
                    <div class="dropdown-menu dropdown-menu-right" role="menu">
                      <font size="2.8em;">
                        <a href="javascript:ToDo();" class="dropdown-item">Print Preview</a>                        
                        <a href="#" class="dropdown-item">Download File</a>
                      </font>
                    </div>
                  </div>
                </div>
              </div>
              <!-- /.card-header -->


              <div class="card-body">
                <div class="row">


                  <div class="card-body">
                    <div class="table-responsive table-striped">
                      <font size='2em;'>
                      <table class="table table-sm table-bordered" id="contract_list_table">
                        <thead>
                          <tr>
                            <th class="align-middle text-center" scope="col" rowspan="2">No.</th>
                            <th class="align-middle text-center" scope="col" rowspan="2">Contract ID</th>
                            <th class="align-middle text-center" scope="col" rowspan="2">Site Name</th>
                            <th class="align-middle text-center" scope="col" rowspan="2">Zone</th>
                            <th class="align-middle text-center" scope="col" colspan="2">Date</th>
                          </tr>

                          <tr>
                            <th class="align-middle text-center" scope="col">MO</th>
                            <th class="align-middle text-center" scope="col">TU</th>
                          </tr>

                        </thead>
                        <tbody>
                          <tr>
                            <th scope="row" class="text-center" colspan="6">There is no data.</th>
                          </tr>
                        </tbody>
                      </table>
                      </font>
                    </div>
                  </div>  


                </div>
                <!-- /.row -->
              </div>
              <!-- ./card-body -->


              <div class="card-footer">
                <div class="row">
                  &nbsp;
                </div>                                
              </div>
              
              
            </div>
            <!-- /.card -->
          </div>
          <!-- /.col -->
        </div>
        <!-- /.row -->
    </section>
    <!-- /.content -->
  </div>




{% endblock %}




{% block javascript %}
<script>
function showLoading() {
  $.LoadingOverlaySetup({
      background      : "rgba(0, 0, 0, 0.5)",
      image           : "/static/img/logo-small.png",        
      imageAnimation  : "1.5s fadein",
      imageColor      : "#ffcc00"
  });
  $.LoadingOverlay("show"); 
}


$(document).on('keyup keypress', '#id_contract_number_from', function(e) {
  if(e.which == 13) {
    
    e.preventDefault();
    if(this.value=="") {
      return false;  
    } else {
    	$('#id_contract_number_to').focus();
    	$('#id_contract_number_to').select();
    }
    
  }
});
$("#id_contract_number_from").on('click', function(){
	$("#id_contract_number_from").select();
});

$(document).on('keyup keypress', '#id_contract_number_to', function(e) {
  if(e.which == 13) {
    
    e.preventDefault();
    if(this.value=="") {
      return false;
    }
    
  }
});
$("#id_contract_number_to").on('click', function(){
	$("#id_contract_number_to").select();
});

function ToDo() {
  alert("todo");
}

function SearchFormSubmit() {
  var contract_number_from = $('#id_contract_number_from').val();
  var contract_number_to = $('#id_contract_number_to').val();
  var contract_status = $('#id_contract_status_option').val();
  var contract_zone = $('#id_contract_zone_option').val();

  showLoading();

  $.ajax({      
    url : "/contract-report/ajax/report_search_contract/",        
    type : "POST",
    data : {
      csrfmiddlewaretoken: '{{ csrf_token }}',
      contract_number_from: contract_number_from,
      contract_number_to: contract_number_to,
      contract_status: contract_status,
      contract_zone: contract_zone,
    },
    success : function(data) {

      number_of_rows = data.contract_list.length;

      if(data.is_error) {
        alert("ERROR: " + data.error_message);
      } else {          
        result = "";
        row_count = 1;
        for(i=0; i<number_of_rows; i++) {
          cnt_id = data.contract_list[i]["cnt_id"];
          cus_name_th = data.contract_list[i]["cus_name_th"];
          cus_name_en = data.contract_list[i]["cus_name_en"];
          cnt_zone = data.contract_list[i]["cnt_zone"];

          result += "<tr>";
          result += "<th scope='row' class='text-left'>" + row_count + "</th>";
          result += "<th class='text-left'>" + cnt_id + "</th>";
          result += "<th class='text-left'>" + cus_name_th + "<br><small>" + cus_name_en + "</small></th>";          
          result += "<th class='text-left'>" + cnt_zone + "</th>";
          result += "<th class='text-left'>&nbsp;</th>";
          result += "<th class='text-left'>&nbsp;</th>";
          result += "</tr>";

          row_count = row_count + 1;
        }          
      }
    
      $("#contract_list_table tbody").html(result);
      
    },
  });

  $.LoadingOverlay("hide");
}

$(document).ready(function(){

  //$('#id_contract_number_from').focus();
  //$('#id_contract_number_from').select();

});

</script>

{% endblock %}